<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="preconnect" href="https://fonts.gstatic.com"/>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet"/>
    <script src="node_modules/@fds-components/fds-treeview/dist/fds-treeview.js"></script>
    <script src="node_modules/@fds-components/fds-image-editor-button/dist/fds-image-editor-button.js"></script>
    <script src="node_modules/@fds-components/fds-tabs/dist/fds-tabs.js"></script>
    <script src="node_modules/@fds-components/fds-tippy/dist/fds-tippy.js"></script>
    <script src="node_modules/@fds-components/fds-ai-image-editor/dist/fds-ai-image-editor.js?3"></script>
    <script src="node_modules/@fds-components/fds-pose-editor/dist/fds-pose-editor.js?5"></script>
    <script src="node_modules/@fds-components/fds-image-editor-slider/dist/fds-image-editor-slider.js?3"></script>
    <script src="node_modules/@fds-components/fds-3d-scene/dist/fds-3d-scene.js?3"></script>
   <script src="node_modules/@fds-components/fds-image-editor-dialog/dist/fds-image-editor-dialog.js?3"></script> 
<script src="http://localhost:4002/fds-image-editor-selection.js"></script>
    <script src="node_modules/@fds-components/fds-image-editor-toggle/dist/fds-image-editor-toggle.js?3"></script>
    <script src="node_modules/@fds-components/fds-image-editor-progress-bar/dist/fds-image-editor-progress-bar.js?3"></script>
    <script src="node_modules/@fds-components/fds-image-editor-menu/dist/fds-image-editor-menu.js?1"></script> 

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, height=device-height"/>

    <script src="node_modules/@fds-components/fds-image-transform/dist/fds-image-transform.js?2"></script>
    <script src="node_modules/@fds-components/fds-image-editor-gradient/dist/fds-image-editor-gradient.js?2"></script>
    <script src="node_modules/@fds-components/fds-image-editor-paint-bucket/dist/fds-image-editor-paint-bucket.js?2"></script>

    <script src="node_modules/@fds-components/fds-local-files/dist/fds-local-files.js?1"></script>
    <link
            href="https://fonts.googleapis.com/css?family=Montez|Lobster|Josefin+Sans|Shadows+Into+Light|Pacifico|Amatic+SC:700|Orbitron:400,900|Rokkitt|Righteous|Dancing+Script:700|Bangers|Chewy|Sigmar+One|Architects+Daughter|Abril+Fatface|Covered+By+Your+Grace|Kaushan+Script|Gloria+Hallelujah|Satisfy|Lobster+Two:700|Comfortaa:700|Cinzel|Courgette"
            rel="stylesheet"
            type="text/css"
            data-noprefix
    />

    <script src="bootstrap.js?1"></script>
    <script src="appdata/brushes/tinycolor.js"></script>
    <script src="appdata/brushes/brush_Default.js?1"></script>
    <script src="appdata/brushes/brush_Oil_A.js?4"></script>
    <script src="appdata/brushes/brush_FromLayers.js?20"></script>

    <script src="babylon/babylon.js"></script>
    <script src="babylon/babylonjs.loaders.min.js"></script>
    <script src="babylon/babylon.gridMaterial.min.js"></script>
    <script src="babylon/babylon.gui.min.js"></script>

    <script src="fds-image-editor-canvas.js?18"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet"/>


   


    <style>
        :root {
            color-scheme: dark;
        }

        body {
            font-size: 15px;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, 'Segoe UI', Helvetica, Arial,
            'Apple Color Emoji', 'Segoe UI Emoji';

            background-color: var(--theme-bgcolor);
            margin: 0;
            overflow: hidden;
        }

        html {
            scroll-behavior: smooth;
        }

        * {
            box-sizing: border-box;
        }

        .psColorScheme {
            --theme-stage-color: #282828;
            --theme-btn-selected-bgcolor: #454545;
            --theme-btn-selected-border-color: #5e5e5e;
            --theme-btn-text-color: #dddddd;
            --theme-bgcolor: #4c4c4c;
            --theme-dialog-bgcolor: #4c4c4c;
            --theme-text-color: #dddddd;
            --theme-internal-seperator-color: #707070;
            /* Slider */
            --theme-slider-track-bgcolor: #757575;
            --theme-slider-track-focus-bgcolor: #367ebd;
            --theme-slider-track-border-color: #010101;
            --theme-slider-thumb-color: #dddddd;
        }

        .darkColorScheme {
            --theme-stage-color: #1d1d1d;
            --theme-btn-selected-bgcolor: #ddb74f;
            --theme-btn-selected2-bgcolor: #e3ce74;

            --theme-btn-selected-border-color: #ddb74f;
            --theme-btn-text-color: #fbfbfb;
            --theme-btn-selected-text-color: #272727;
            --theme-bgcolor: #323232;
            --theme-dialog-bgcolor: #202020;
            --theme-text-color: #ebebeb;
            --theme-internal-seperator-color: #535353;
            /* Slider */
            --theme-slider-track-bgcolor: #757575;
            --theme-slider-track-focus-bgcolor: #ddb74f;
            --theme-slider-track-border-color: #010101;
            --theme-slider-thumb-color: #dddddd;
        }

        .swal-button--confirm {
            border: none;
            background-color: #ddb74f;
            color: #272727;
        }

        .swal-button--confirm:not([disabled]):hover {
            border: none;
            background-color: #e3ce74;
        }

        .swal-title {
            font-weight: bold;
            font-size: 16px;
        }

        .colorScheme {
            --stage-color: var(--theme-stage-color);
            --btn-selected-bgcolor: var(--theme-btn-selected-bgcolor);
            --btn-selected2-bgcolor: var(--theme-btn-selected2-bgcolor);
            --btn-selected-border-color: var(--theme-btn-selected-border-color);
            --btn-text-color: var(--theme-btn-text-color);
            --btn-selected-text-color: var(--theme-btn-selected-text-color);

            --bgcolor: var(--theme-bgcolor);
            --dialog-bgcolor: var(--theme-dialog-bgcolor);
            --text-color: var(--theme-text-color);
            /* Slider */
            --slider-track-bgcolor: var(--theme-slider-track-bgcolor);
            --slider-track-focus-bgcolor: var(--theme-slider-track-focus-bgcolor);
            --slider-track-border-color: var(--theme-slider-track-border-color);
            --slider-ipad-track-border-color: var(--theme-slider-track-bgcolor);
            --slider-thumb-color: var(--theme-slider-thumb-color);

            --btn-bw-simple-bgcolor: #6b6b6b;
            --btn-bw-simple-bgcolor-hover: var(--theme-btn-selected-bgcolor);
            --btn-bw-simple-color: white;
            --btn-bw-simple-color-hover: #000000;
        }
    </style>
</head>
<body class="darkColorScheme">
<script>

    class Gyre {
        serverName
        currentExtensionName

        setCurrentExtensionName(extensionName) {
            this.currentExtensionName = extensionName
        }

        getFullExtensionPath(extensionName) {
            return this.serverName + "/gyre_extensions/" + extensionName
        }

        loadScript(path, extensionName = "") {
            if (!extensionName) extensionName = this.currentExtensionName
            let src = this.getFullExtensionPath(extensionName) + "/" + path
            let script = window.document.createElement("script")
            script.async = false
            script.src = src
            document.head.appendChild(script)
        }
    }

    globalThis.gyre = new Gyre()

    const params = new URLSearchParams(window.location.search);
    // Get a specific parameter value by its name
    const paramName = params.get('comfy');
    if (paramName) window.comfyuimode = true;
    window.addEventListener('load', () => {

        window.demomode = !window.postMessageAdapter
        window.developmode = false;
        let documentInfo = {width: 2301, height: 1536}
        let layers = []
        let Config = {}
        let serverFeatures = {}
        let component = document.querySelector('fds-ai-editor')
        component.registerBrush(new brush_Default(), 'brush_Default')
        component.registerBrush(new brush_FromLayers(), 'brush_FromLayers')
        component.registerBrush(new brush_Oil_A(), 'brush_Oil_A')
globalThis.gyre.registerPlugin("fds-image-editor-selection",{type:"tool",floatingToolBar:true,floatingToolBarWidth:425,refreshOnScroll:true,
"title":"Selection Tools",
"layerTypes": ["image"],
      "tools": [
        {
          "name": "freeform",
          "title": "Freeform Selection",
          "icon": "fds-image-editor-selection-freeform",                   
          "floatingToolBarWidth": 440
        },
        {
          "name": "rectangle",
          "title": "Rectangle Selection",
          "icon": "fds-image-editor-selection-rectangle",
          "floatingToolBarWidth": 440
        },
        {
          "name": "ellipse",
          "title": "Ellipse Selection",
          "icon": "fds-image-editor-selection-ellipse",
          "floatingToolBarWidth": 440
        },        
      ],
        "icons": {
            "toolbar-icon": {
                "body": '  <path d="M 6.67 32.124 Q 32 8 52 42 C 41.838 52.018 28.144 62.39 14.802 61.282 C 4.596 55.365 4.054 37.498 6.599 32.053" stroke-width="3" fill="none" stroke-dasharray="3,3"/><circle cx="48" cy="32" r="5" />',
                "width": 64,
                "height": 64
            },            
            "freeform": {
                "body": '  <path d="M 6.67 32.124 Q 32 8 52 42 C 41.838 52.018 28.144 62.39 14.802 61.282 C 4.596 55.365 4.054 37.498 6.599 32.053" stroke-width="3" fill="none" stroke-dasharray="3,3"/><circle cx="48" cy="32" r="5" />',
                "width": 64,
                "height": 64                
            },
            "rectangle": {
                "body": '<rect x="4" y="4" width="56" height="56"  stroke-width="3" fill="none" stroke-dasharray="4,4"/>',
                "width": 64,
                "height": 64                
            },
            "ellipse": {
                "body": '<ellipse cx="32" cy="32" rx="28" ry="20"  stroke-width="3" fill="none" stroke-dasharray="4,4"/>',
                "width": 64,
                "height": 64                
            }

        }
    })
        if (!window.uxpHost && window.demomode) {
            component.document = documentInfo
            component.layers = layers
            component.paletteValues.Config = Config
            component.paletteValues.generate = Config.generalConfig.dlgData
            component.paletteValues.generate.prompt = Config.globalData.prompt
            component.paletteValues.generate.modifiers = Config.globalData.modifiers
            component.paletteValues.generate.mode = ''
            component.paletteValues.serverFeatures = serverFeatures
        }
    })
    // handle unhandled promise rejections
    window.addEventListener('unhandledrejection', function (event) {
        console.log(event.reason)
        console.log(event.promise)
        alert(event.reason)
    })
</script>
<!--  <img id="test" width="500" /> -->
<fds-ai-editor class="darkColorScheme"></fds-ai-editor>
</body>
</html>
