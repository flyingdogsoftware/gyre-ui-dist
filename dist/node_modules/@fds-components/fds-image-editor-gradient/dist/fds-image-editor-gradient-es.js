function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function l(t,e,n){return t.set(n),e}function c(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode&&t.parentNode.removeChild(t)}function d(t){return document.createElement(t)}function h(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function f(){return t=" ",document.createTextNode(t);var t}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e,n){e in t?t[e]="boolean"==typeof t[e]&&""===n||n:g(t,e,n)}function y(t,e,n,o){null==n?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function $(t){const e={};for(const n of t)e[n.name]=n.value;return e}let x;function b(t){x=t}function v(){if(!x)throw new Error("Function called outside component initialization");return x}function w(){const t=v();return(e,n,{cancelable:o=!1}={})=>{const i=t.$$.callbacks[e];if(i){const r=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,o,e),i}(e,n,{cancelable:o});return i.slice().forEach((e=>{e.call(t,r)})),!r.defaultPrevented}return!0}}const E=[],k=[];let C=[];const _=[],L=Promise.resolve();let S=!1;function M(t){C.push(t)}const T=new Set;let R=0;function z(){if(0!==R)return;const t=x;do{try{for(;R<E.length;){const t=E[R];R++,b(t),A(t.$$)}}catch(t){throw E.length=0,R=0,t}for(b(null),E.length=0,R=0;k.length;)k.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];T.has(e)||(T.add(e),e())}C.length=0}while(E.length);for(;_.length;)_.pop()();S=!1,T.clear(),b(t)}function A(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const N=new Set;function P(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];C.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),C=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function j(t,e){-1===t.$$.dirty[0]&&(E.push(t),S||(S=!0,L.then(z)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function V(r,s,l,c,a,d,h,f=[-1]){const p=x;b(r);const g=r.$$={fragment:null,ctx:[],props:d,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(p?p.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:s.target||p.$$.root};h&&h(g.root);let m=!1;if(g.ctx=l?l(r,s.props||{},((t,e,...n)=>{const o=n.length?n[0]:e;return g.ctx&&a(g.ctx[t],g.ctx[t]=o)&&(!g.skip_bound&&g.bound[t]&&g.bound[t](o),m&&j(r,t)),e})):[],g.update(),m=!0,o(g.before_update),g.fragment=!!c&&c(g.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);g.fragment&&g.fragment.l(t),t.forEach(u)}else g.fragment&&g.fragment.c();s.intro&&((y=r.$$.fragment)&&y.i&&(N.delete(y),y.i($))),function(t,n,r,s){const{fragment:l,after_update:c}=t.$$;l&&l.m(n,r),s||M((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),c.forEach(M)}(r,s.target,s.anchor,s.customElement),z()}var y,$;b(p)}let O;"function"==typeof HTMLElement&&(O=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(i);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){o(this.$$.on_disconnect)}$destroy(){P(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});const I=[];let U=function(e,n=t){let o;const i=new Set;function s(t){if(r(e,t)&&(e=t,o)){const t=!I.length;for(const t of i)t[1](),I.push(t,e);if(t){for(let t=0;t<I.length;t+=2)I[t][0](I[t+1]);I.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(r,l=t){const c=[r,l];return i.add(c),1===i.size&&(o=n(s)||t),r(e),()=>{i.delete(c),0===i.size&&o&&(o(),o=null)}}}}({});function B(t){let e,n,i,r,s,l,h,$,x;return{c(){e=d("div"),n=d("div"),i=d("fds-gradient-editor"),r=f(),s=d("div"),l=d("div"),h=d("fds-image-editor-button"),h.textContent="Reset Line",m(i,"value",t[2]),m(i,"id","gradientList"),g(n,"class","formLine"),m(h,"type","button"),y(l,"display","flex"),y(l,"align-items","center"),g(s,"class","formLine"),g(e,"class","editcoord")},m(o,u){a(o,e,u),c(e,n),c(n,i),c(e,r),c(e,s),c(s,l),c(l,h),$||(x=[p(i,"change",t[11]),p(h,"click",t[12])],$=!0)},p(t,e){4&e&&m(i,"value",t[2])},d(t){t&&u(e),$=!1,o(x)}}}function q(e){let n,i,r,s,l,h,$,x,b,v,w=e[0]&&B(e);return{c(){n=d("div"),i=d("div"),r=d("fds-image-editor-button"),r.textContent="Parameters",s=f(),l=d("fds-image-editor-button"),l.textContent="Done",h=f(),$=d("fds-image-editor-button"),$.textContent="Cancel",x=f(),w&&w.c(),this.c=t,m(r,"type","button"),m(l,"type","button"),m($,"type","button"),y(i,"display","flex"),y(i,"align-items","center"),g(n,"class","show"),y(n,"display","inline-flex")},m(t,o){a(t,n,o),c(n,i),c(i,r),c(i,s),c(i,l),c(i,h),c(i,$),c(n,x),w&&w.m(n,null),b||(v=[p(r,"click",e[8]),p(l,"click",e[9]),p($,"click",e[10])],b=!0)},p(t,[e]){t[0]?w?w.p(t,e):(w=B(t),w.c(),w.m(n,null)):w&&(w.d(1),w=null)},i:t,o:t,d(t){t&&u(n),w&&w.d(),b=!1,o(v)}}}function D(t){3===(t=t.replace(/^#/,"")).length&&(t=t.split("").map((t=>t+t)).join(""));return`${parseInt(t.substring(0,2),16)}, ${parseInt(t.substring(2,4),16)}, ${parseInt(t.substring(4,6),16)}`}function F(t,e,n){let o;s(t,U,(t=>n(1,o=t)));let i=v().$$.root.host,r="",{toolinst:c}=e;function a(t,e){i.dispatchEvent(new CustomEvent("change",{detail:{name:t,value:e}}))}function u(t){l(U,o.value=t.value,o)}function d(){l(U,o.resetLine=!0,o)}if(globalThis.gyre&&!r){let t=D(globalThis.gyre.paletteValues.foregroundColor),e=D(globalThis.gyre.paletteValues.backgroundColor);r=`10:${t}\n            90:${e}`,l(U,o.value=r,o)}function h(){n(2,r=o.value)}let{editcoord:f}=e;return t.$$set=t=>{"toolinst"in t&&n(6,c=t.toolinst),"editcoord"in t&&n(0,f=t.editcoord)},t.$$.update=()=>{2&t.$$.dirty&&o&&h()},[f,o,r,a,u,d,c,h,()=>{n(0,f=!f),l(U,o.editcoord=f,o),a("editcoord",f)},()=>{l(U,o.done=!0,o)},()=>{l(U,o.cancel=!0,o)},t=>{u(t.detail)},()=>{d()}]}function H(t,e,n){const o=t.slice();return o[40]=e[n].percentage,o[41]=e[n].color,o[42]=e[n].x,o[43]=e[n].y,o[45]=n,o}function J(t){let e,n,i,r,s,l;function c(){return t[14](t[45])}return{c(){e=h("circle"),g(e,"cx",n=t[42]),g(e,"cy",i=t[43]),g(e,"r","8"),g(e,"fill",r=t[41]),g(e,"stroke","black"),g(e,"stroke-width","2")},m(n,o){a(n,e,o),s||(l=[p(e,"mousedown",c),p(e,"mouseup",t[6])],s=!0)},p(o,s){t=o,4&s[0]&&n!==(n=t[42])&&g(e,"cx",n),4&s[0]&&i!==(i=t[43])&&g(e,"cy",i),4&s[0]&&r!==(r=t[41])&&g(e,"fill",r)},d(t){t&&u(e),s=!1,o(l)}}}function W(e){let n,i,r,s,l,m,$,x,b,v,w,E,k,C,_,L,S,M=e[2],T=[];for(let t=0;t<M.length;t+=1)T[t]=J(H(e,M,t));return{c(){n=d("div"),i=d("canvas"),r=f(),s=h("svg"),l=h("line"),v=h("circle"),k=h("circle");for(let t=0;t<T.length;t+=1)T[t].c();this.c=t,y(i,"position","absolute"),y(i,"width",e[4].width+"px"),y(i,"height",e[4].height+"px"),y(i,"z-index","-10"),g(l,"x1",m=e[0].x1),g(l,"y1",$=e[0].y1),g(l,"x2",x=e[0].x2),g(l,"y2",b=e[0].y2),g(l,"stroke","black"),g(l,"stroke-width","2"),g(v,"cx",w=e[0].x1),g(v,"cy",E=e[0].y1),g(v,"r","8"),g(v,"fill","white"),g(v,"stroke","black"),g(v,"stroke-width","2"),g(k,"cx",C=e[0].x2),g(k,"cy",_=e[0].y2),g(k,"r","8"),g(k,"fill","white"),g(k,"stroke","black"),g(k,"stroke-width","2"),g(s,"width",e[4].width),g(s,"height",e[4].height),y(n,"width",e[4].width+"px"),y(n,"height",e[4].height+"px"),y(n,"position","relative")},m(t,o){a(t,n,o),c(n,i),e[11](i),c(n,r),c(n,s),c(s,l),c(s,v),c(s,k);for(let t=0;t<T.length;t+=1)T[t]&&T[t].m(s,null);e[15](s),L||(S=[p(v,"mousedown",e[12]),p(v,"mouseup",e[6]),p(k,"mousedown",e[13]),p(k,"mouseup",e[6])],L=!0)},p(t,e){if(1&e[0]&&m!==(m=t[0].x1)&&g(l,"x1",m),1&e[0]&&$!==($=t[0].y1)&&g(l,"y1",$),1&e[0]&&x!==(x=t[0].x2)&&g(l,"x2",x),1&e[0]&&b!==(b=t[0].y2)&&g(l,"y2",b),1&e[0]&&w!==(w=t[0].x1)&&g(v,"cx",w),1&e[0]&&E!==(E=t[0].y1)&&g(v,"cy",E),1&e[0]&&C!==(C=t[0].x2)&&g(k,"cx",C),1&e[0]&&_!==(_=t[0].y2)&&g(k,"cy",_),100&e[0]){let n;for(M=t[2],n=0;n<M.length;n+=1){const o=H(t,M,n);T[n]?T[n].p(o,e):(T[n]=J(o),T[n].c(),T[n].m(s,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=M.length}},i:t,o:t,d(t){t&&u(n),e[11](null),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(T,t),e[15](null),L=!1,o(S)}}}function Y(t,e,n){let o;s(t,U,(t=>n(10,o=t)));let i,r,c,a=v().$$.root.host,u={x1:0,y1:0,x2:10,y2:10},{value:d}=e,h={width:globalThis.gyre.paletteValues.selectedLayer._width,height:globalThis.gyre.paletteValues.selectedLayer._height},{ratio:f=window.devicePixelRatio}=e,p=null,g=null;w();let m,y,$,x,b=[],E="white",C="white";function _(){n(0,u.x1=.1*h.width,u),n(0,u.y1=.1*h.height,u),n(0,u.x2=.9*h.width,u),n(0,u.y2=.9*h.height,u),A()}function L(t){return r=globalThis.gyre.canvas.zoom||100,t/(parseFloat(r)/100/f)}function S(){return b.sort(((t,e)=>t.percentage-e.percentage)),b.map((t=>{let e=100*t.percentage,n=t.color;return"string"==typeof n&&n.startsWith("#")&&(n=function(t){3===(t=t.replace("#","")).length&&(t=t.split("").map((t=>t+t)).join(""));let e=parseInt(t,16);return`${e>>16&255},${e>>8&255},${255&e}`}(n)),`${e}:${n}`})).join("\n")}function M(){o.value&&n(7,d=o.value),o.resetLine&&(_(),l(U,o.resetLine=!1,o)),o.done&&(l(U,o.done=!1,o),function(){m={...u},n(0,u={x1:L(u.x1),y1:L(u.y1),x2:L(u.x2),y2:L(u.y2)}),y=JSON.parse(JSON.stringify(b)),n(2,b=b.map((t=>(t.x=L(t.x),t.y=L(t.y),t)))),$=P.width,x=P.height,n(3,P.width=L(P.width),P),n(3,P.height=L(P.height),P),j("ignoreclientSize");const t=P.toDataURL("image/png");n(3,P.width=$,P),n(3,P.height=x,P),n(0,u=m),n(2,b=y),j(),function(){if(!globalThis.gyre)return;let t=P.toDataURL("image/png"),e=globalThis.gyre.paletteValues.selectedLayer.url;globalThis.gyre.undo_redo_add("gradient","imagegenerated",{urlBefore:e,urlAfter:t},((t,e)=>{let n;"undo"===e&&(n=t.data.urlBefore),"redo"===e&&(n=t.data.urlAfter),globalThis.gyre.paletteValues.selectedLayer.url=n,globalThis.gyre.paletteValues.selectedLayer._refreshCallback()}))}(),a.dispatchEvent(new CustomEvent("change",{detail:{type:"imagegenerated",dataURL:t}}))}()),o.cancel&&(a.dispatchEvent(new CustomEvent("change",{detail:{type:"cancelimagegenerate"}})),l(U,o.cancel=!1,o)),o.editcoord!==c&&(a.dispatchEvent(new CustomEvent("change",{detail:{type:"editcoord",value:o.editcoord}})),c=o.editcoord)}function T(t,e=null){p=t,g=e}function R(){p=null,g=null}function z(t){if(!p)return;const e=i.getBoundingClientRect(),r=t.clientX-e.left,s=t.clientY-e.top;if("x1"===p)n(0,u.x1=r,u),n(0,u.y1=s,u),A();else if("x2"===p)n(0,u.x2=r,u),n(0,u.y2=s,u),A();else if("middlePoint"===p){const t=u.x2-u.x1,e=u.y2-u.y1,o=Math.sqrt(t*t+e*e),i=((r-u.x1)*t+(s-u.y1)*e)/(o*o);n(2,b[g].percentage=Math.max(0,Math.min(1,i)),b)}A(),n(7,d=S()),l(U,o.value=d,o),a.dispatchEvent(new CustomEvent("change",{detail:{type:"coordinates",value:d}}))}function A(){b.forEach((t=>{t.x=u.x1+t.percentage*(u.x2-u.x1),t.y=u.y1+t.percentage*(u.y2-u.y1)})),j(),n(2,b)}var N;N=()=>{window.addEventListener("mousemove",z),window.addEventListener("mouseup",R),d&&A()},v().$$.on_mount.push(N),function(t){v().$$.on_destroy.push(t)}((()=>{window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",R)}));let P=null;function j(t){if(!P)return;const e=P.getContext("2d");if(t?(n(3,P),n(3,P)):(n(3,P.width=P.clientWidth||P.width,P),n(3,P.height=P.clientHeight||P.height,P)),0===P.width||0===P.height)return;const o=Math.atan2(u.y2-u.y1,u.x2-u.x1),i=Math.sqrt(P.width**2+P.height**2),r=u.x1-i*Math.cos(o),s=u.y1-i*Math.sin(o),l=u.x2+i*Math.cos(o),c=u.y2+i*Math.sin(o),a=e.createLinearGradient(r,s,l,c);a.addColorStop(0,E),b.forEach((t=>{const e=u.x1+(u.x2-u.x1)*t.percentage,n=u.y1+(u.y2-u.y1)*t.percentage,o=Math.hypot(e-r,n-s)/Math.hypot(l-r,c-s);a.addColorStop(o,t.color)})),a.addColorStop(1,C),e.fillStyle=a,e.fillRect(0,0,P.width,P.height)}return t.$$set=t=>{"value"in t&&n(7,d=t.value),"ratio"in t&&n(8,f=t.ratio)},t.$$.update=()=>{1024&t.$$.dirty[0]&&o&&M(),128&t.$$.dirty[0]&&d&&(!function(t){n(2,b=[]),t.trim().split("\n").forEach((t=>{let[e,n]=t.split(":"),o=parseFloat(e)/100,i="#"+n.split(",").map(Number).map((t=>t.toString(16).padStart(2,"0"))).join("").toUpperCase();b.push({percentage:o,color:i})})),b.sort(((t,e)=>t.percentage-e.percentage));let e=b.find((t=>0===t.percentage));E=e?e.color:b[0].color;let o=b.find((t=>1===t.percentage));C=o?o.color:b[b.length-1].color}(d),A(),M()),1&t.$$.dirty[0]&&h&&!u.x1&&_()},[u,i,b,P,h,T,R,d,f,_,o,function(t){k[t?"unshift":"push"]((()=>{P=t,n(3,P)}))},()=>T("x1"),()=>T("x2"),t=>T("middlePoint",t),function(t){k[t?"unshift":"push"]((()=>{i=t,n(1,i)}))}]}customElements.define("fds-image-editor-gradient-dialog",class extends O{constructor(t){super();const e=document.createElement("style");e.textContent='*{box-sizing:border-box}.editcoord{min-width:330px;min-height:100px;box-shadow:0 0 1rem 0 rgba(255, 255, 255, .2);border-radius:8px;background-color:rgba(0, 0, 0, .65);backdrop-filter:blur(10px);color:rgba(255, 255, 255, 0.6);position:absolute;left:0px;top:50px;padding:14px;font-family:"Segoe UI", Roboto, system-ui;z-index:2000}.formLine{displaY:block;margin-bottom:20px}.formLine{margin-bottom:5px}.show{display:block}',this.shadowRoot.appendChild(e),V(this,{target:this.shadowRoot,props:$(this.attributes),customElement:!0},F,q,r,{toolinst:6,refresh:7,editcoord:0},null),t&&(t.target&&a(t.target,this,t.anchor),t.props&&(this.$set(t.props),z()))}static get observedAttributes(){return["toolinst","refresh","editcoord"]}get toolinst(){return this.$$.ctx[6]}set toolinst(t){this.$$set({toolinst:t}),z()}get refresh(){return this.$$.ctx[7]}get editcoord(){return this.$$.ctx[0]}set editcoord(t){this.$$set({editcoord:t}),z()}});class G extends O{constructor(t){super();const e=document.createElement("style");e.textContent="circle{cursor:pointer}",this.shadowRoot.appendChild(e),V(this,{target:this.shadowRoot,props:$(this.attributes),customElement:!0},Y,W,r,{value:7,ratio:8,resetLine:9},null,[-1,-1]),t&&(t.target&&a(t.target,this,t.anchor),t.props&&(this.$set(t.props),z()))}static get observedAttributes(){return["value","ratio","resetLine"]}get value(){return this.$$.ctx[7]}set value(t){this.$$set({value:t}),z()}get ratio(){return this.$$.ctx[8]}set ratio(t){this.$$set({ratio:t}),z()}get resetLine(){return this.$$.ctx[9]}}customElements.define("fds-image-editor-gradient",G);export{G as default};
//# sourceMappingURL=fds-image-editor-gradient-es.js.map
