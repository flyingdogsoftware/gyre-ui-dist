var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t,e,n){return t.set(n),e}function a(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode&&t.parentNode.removeChild(t)}function d(t){return document.createElement(t)}function h(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function g(){return t=" ",document.createTextNode(t);var t}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function f(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function y(t,e,n){e in t?t[e]="boolean"==typeof t[e]&&""===n||n:f(t,e,n)}function m(t,e,n,o){null==n?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function $(t){const e={};for(const n of t)e[n.name]=n.value;return e}let x;function b(t){x=t}function w(){if(!x)throw new Error("Function called outside component initialization");return x}const v=[],E=[];let k=[];const L=[],T=Promise.resolve();let _=!1;function C(t){k.push(t)}const S=new Set;let V=0;function M(){if(0!==V)return;const t=x;do{try{for(;V<v.length;){const t=v[V];V++,b(t),R(t.$$)}}catch(t){throw v.length=0,V=0,t}for(b(null),v.length=0,V=0;E.length;)E.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];S.has(e)||(S.add(e),e())}k.length=0}while(v.length);for(;L.length;)L.pop()();_=!1,S.clear(),b(t)}function R(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(C)}}const z=new Set;function P(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];k.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),k=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function j(t,e){-1===t.$$.dirty[0]&&(v.push(t),_||(_=!0,T.then(M)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function A(r,l,s,a,c,d,h,g=[-1]){const p=x;b(r);const f=r.$$={fragment:null,ctx:[],props:d,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(p?p.$$.context:[])),callbacks:n(),dirty:g,skip_bound:!1,root:l.target||p.$$.root};h&&h(f.root);let y=!1;if(f.ctx=s?s(r,l.props||{},((t,e,...n)=>{const o=n.length?n[0]:e;return f.ctx&&c(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),y&&j(r,t)),e})):[],f.update(),y=!0,o(f.before_update),f.fragment=!!a&&a(f.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);f.fragment&&f.fragment.l(t),t.forEach(u)}else f.fragment&&f.fragment.c();l.intro&&((m=r.$$.fragment)&&m.i&&(z.delete(m),m.i($))),function(t,n,r,l){const{fragment:s,after_update:a}=t.$$;s&&s.m(n,r),l||C((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(C)}(r,l.target,l.anchor,l.customElement),M()}var m,$;b(p)}let N;"function"==typeof HTMLElement&&(N=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(i);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){o(this.$$.on_disconnect)}$destroy(){P(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});const O=[];let I=function(e,n=t){let o;const i=new Set;function l(t){if(r(e,t)&&(e=t,o)){const t=!O.length;for(const t of i)t[1](),O.push(t,e);if(t){for(let t=0;t<O.length;t+=2)O[t][0](O[t+1]);O.length=0}}}return{set:l,update:function(t){l(t(e))},subscribe:function(r,s=t){const a=[r,s];return i.add(a),1===i.size&&(o=n(l)||t),r(e),()=>{i.delete(a),0===i.size&&o&&(o(),o=null)}}}}({});function U(t){let e,n,i,r,l,s,h,$,x;return{c(){e=d("div"),n=d("div"),i=d("fds-gradient-editor"),r=g(),l=d("div"),s=d("div"),h=d("fds-image-editor-button"),h.textContent="Reset Line",y(i,"value",t[3]),y(i,"id","gradientList"),f(n,"class","formLine"),y(h,"type","button"),m(s,"display","flex"),m(s,"align-items","center"),f(l,"class","formLine"),f(e,"class","editcoord")},m(o,u){c(o,e,u),a(e,n),a(n,i),a(e,r),a(e,l),a(l,s),a(s,h),$||(x=[p(i,"change",t[12]),p(h,"click",t[13])],$=!0)},p(t,e){8&e&&y(i,"value",t[3])},d(t){t&&u(e),$=!1,o(x)}}}function B(e){let n,i,r,l,s,h,$,x,b,w,v=e[0]&&U(e);return{c(){n=d("div"),i=d("div"),r=d("fds-image-editor-button"),r.textContent="Parameters",l=g(),s=d("fds-image-editor-button"),s.textContent="Done",h=g(),$=d("fds-image-editor-button"),$.textContent="Cancel",x=g(),v&&v.c(),this.c=t,y(r,"type","button"),y(s,"type","button"),y($,"type","button"),m(i,"display","flex"),m(i,"align-items","center"),f(n,"class","show"),m(n,"display","inline-flex")},m(t,o){c(t,n,o),a(n,i),a(i,r),a(i,l),a(i,s),a(i,h),a(i,$),a(n,x),v&&v.m(n,null),b||(w=[p(r,"click",e[9]),p(s,"click",e[10]),p($,"click",e[11])],b=!0)},p(t,[e]){t[0]?v?v.p(t,e):(v=U(t),v.c(),v.m(n,null)):v&&(v.d(1),v=null)},i:t,o:t,d(t){t&&u(n),v&&v.d(),b=!1,o(w)}}}function F(t){3===(t=t.replace(/^#/,"")).length&&(t=t.split("").map((t=>t+t)).join(""));return`${parseInt(t.substring(0,2),16)}, ${parseInt(t.substring(2,4),16)}, ${parseInt(t.substring(4,6),16)}`}function q(e,n,o){let i,r,a=t,c=()=>(a(),a=l(r,(t=>o(1,i=t))),r);e.$$.on_destroy.push((()=>a())),globalThis.gyre&&globalThis.gyre.paletteValues.tools?c(r=globalThis.gyre.paletteValues.tools.fdsimageeditorgradient):c(r=I);let u=w().$$.root.host,d="",{toolinst:h}=n;function g(t,e){u.dispatchEvent(new CustomEvent("change",{detail:{name:t,value:e}}))}function p(t){s(r,i.value=t.value,i)}function f(){s(r,i.resetLine=!0,i)}if(globalThis.gyre&&!d){let t=F(globalThis.gyre.paletteValues.foregroundColor),e=F(globalThis.gyre.paletteValues.backgroundColor);d=`10:${t}\n            90:${e}`,s(r,i.value=d,i)}function y(){o(3,d=i.value)}let{editcoord:m}=n;return e.$$set=t=>{"toolinst"in t&&o(7,h=t.toolinst),"editcoord"in t&&o(0,m=t.editcoord)},e.$$.update=()=>{2&e.$$.dirty&&i&&y()},[m,i,r,d,g,p,f,h,y,()=>{o(0,m=!m),s(r,i.editcoord=m,i),g("editcoord",m)},()=>{s(r,i.done=!0,i)},()=>{s(r,i.cancel=!0,i)},t=>{p(t.detail)},()=>{f()}]}function D(t,e,n){const o=t.slice();return o[48]=e[n].percentage,o[49]=e[n].color,o[50]=e[n].x,o[51]=e[n].y,o[53]=n,o}function H(t){let e,n,i,r,l,s,a,d,g;function y(){return t[19](t[53])}function m(){return t[20](t[53])}return{c(){e=h("circle"),l=h("circle"),f(e,"cx",n=t[50]),f(e,"cy",i=t[51]),f(e,"r","6"),f(e,"fill",r=t[49]),f(e,"stroke","white"),f(e,"stroke-width","2"),f(l,"cx",s=t[50]),f(l,"cy",a=t[51]),f(l,"r","8"),f(l,"fill","none"),f(l,"stroke","black"),f(l,"stroke-width","2")},m(n,o){c(n,e,o),c(n,l,o),d||(g=[p(e,"mousedown",y),p(e,"mouseup",t[8]),p(l,"mousedown",m),p(l,"mouseup",t[8])],d=!0)},p(o,c){t=o,32&c[0]&&n!==(n=t[50])&&f(e,"cx",n),32&c[0]&&i!==(i=t[51])&&f(e,"cy",i),32&c[0]&&r!==(r=t[49])&&f(e,"fill",r),32&c[0]&&s!==(s=t[50])&&f(l,"cx",s),32&c[0]&&a!==(a=t[51])&&f(l,"cy",a)},d(t){t&&u(e),t&&u(l),d=!1,o(g)}}}function J(e){let n,i,r,l,s,y,$,x,b,w,v,E,k,L,T,_,C,S,V,M=e[5],R=[];for(let t=0;t<M.length;t+=1)R[t]=H(D(e,M,t));return{c(){n=d("div"),i=d("canvas"),r=g(),l=h("svg"),s=h("line"),w=h("circle"),k=h("circle");for(let t=0;t<R.length;t+=1)R[t].c();this.c=t,m(i,"position","absolute"),m(i,"width",e[2].width+"px"),m(i,"height",e[2].height+"px"),m(i,"z-index","-10"),m(i,"opacity",e[0]/100),f(s,"x1",y=e[1].x1),f(s,"y1",$=e[1].y1),f(s,"x2",x=e[1].x2),f(s,"y2",b=e[1].y2),f(s,"stroke","black"),f(s,"stroke-width","2"),f(w,"cx",v=e[1].x1),f(w,"cy",E=e[1].y1),f(w,"r","8"),f(w,"fill","white"),f(w,"stroke","black"),f(w,"stroke-width","2"),f(k,"cx",L=e[1].x2),f(k,"cy",T=e[1].y2),f(k,"r","8"),f(k,"fill","white"),f(k,"stroke","black"),f(k,"stroke-width","2"),f(l,"width",_=e[2].width),f(l,"height",C=e[2].height),m(n,"width",e[2].width+"px"),m(n,"height",e[2].height+"px"),m(n,"position","relative")},m(t,o){c(t,n,o),a(n,i),e[16](i),a(n,r),a(n,l),a(l,s),a(l,w),a(l,k);for(let t=0;t<R.length;t+=1)R[t]&&R[t].m(l,null);e[21](l),S||(V=[p(w,"mousedown",e[17]),p(w,"mouseup",e[8]),p(k,"mousedown",e[18]),p(k,"mouseup",e[8])],S=!0)},p(t,e){if(4&e[0]&&m(i,"width",t[2].width+"px"),4&e[0]&&m(i,"height",t[2].height+"px"),1&e[0]&&m(i,"opacity",t[0]/100),2&e[0]&&y!==(y=t[1].x1)&&f(s,"x1",y),2&e[0]&&$!==($=t[1].y1)&&f(s,"y1",$),2&e[0]&&x!==(x=t[1].x2)&&f(s,"x2",x),2&e[0]&&b!==(b=t[1].y2)&&f(s,"y2",b),2&e[0]&&v!==(v=t[1].x1)&&f(w,"cx",v),2&e[0]&&E!==(E=t[1].y1)&&f(w,"cy",E),2&e[0]&&L!==(L=t[1].x2)&&f(k,"cx",L),2&e[0]&&T!==(T=t[1].y2)&&f(k,"cy",T),416&e[0]){let n;for(M=t[5],n=0;n<M.length;n+=1){const o=D(t,M,n);R[n]?R[n].p(o,e):(R[n]=H(o),R[n].c(),R[n].m(l,null))}for(;n<R.length;n+=1)R[n].d(1);R.length=M.length}4&e[0]&&_!==(_=t[2].width)&&f(l,"width",_),4&e[0]&&C!==(C=t[2].height)&&f(l,"height",C),4&e[0]&&m(n,"width",t[2].width+"px"),4&e[0]&&m(n,"height",t[2].height+"px")},i:t,o:t,d(t){t&&u(n),e[16](null),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(R,t),e[21](null),S=!1,o(V)}}}function W(e,n,o){let i,r,a=t,c=()=>(a(),a=l(r,(t=>o(15,i=t))),r);e.$$.on_destroy.push((()=>a())),globalThis.gyre&&globalThis.gyre.paletteValues.tools?c(r=globalThis.gyre.paletteValues.tools.fdsimageeditorgradient):c(r=I);let{opacity:u}=n;globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&(u=globalThis.gyre.paletteValues.selectedLayer.opacity);let d,h,g=w().$$.root.host,p={x1:0,y1:0,x2:10,y2:10},{value:f}=n,y={width:512,height:512};globalThis.gyre&&(h=globalThis.gyre.canvas.zoom||100);let m,$=h,{ratio:x=window.devicePixelRatio}=n,b=parseFloat(h)/100/x,v={},k=null,L=null;globalThis.gyre&&z();let T,_,C,S,V=[],M="white",R="white";function z(){o(2,y={width:globalThis.gyre.canvas.width*b,height:globalThis.gyre.canvas.height*b})}function P(){o(1,p.x1=.1*y.width,p),o(1,p.y1=.1*y.height,p),o(1,p.x2=.9*y.width,p),o(1,p.y2=.9*y.height,p),F()}function j(t){return t/b}function A(){return V.sort(((t,e)=>t.percentage-e.percentage)),V.map((t=>{let e=100*t.percentage,n=t.color;return"string"==typeof n&&n.startsWith("#")&&(n=function(t){3===(t=t.replace("#","")).length&&(t=t.split("").map((t=>t+t)).join(""));let e=parseInt(t,16);return`${e>>16&255},${e>>8&255},${255&e}`}(n)),`${e}:${n}`})).join("\n")}function N(){globalThis.gyre&&o(13,h=globalThis.gyre.canvas.zoom||100),b=parseFloat(h)/100/x,z(),globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&o(0,u=globalThis.gyre.paletteValues.selectedLayer.opacity),i.value&&o(9,f=i.value),i.resetLine&&(P(),s(r,i.resetLine=!1,i)),i.done&&(s(r,i.done=!1,i),function(){T={...p},o(1,p={x1:j(p.x1),y1:j(p.y1),x2:j(p.x2),y2:j(p.y2)}),_=JSON.parse(JSON.stringify(V)),o(5,V=V.map((t=>(t.x=j(t.x),t.y=j(t.y),t)))),C=H.width,S=H.height,o(6,H.width=j(H.width),H),o(6,H.height=j(H.height),H),J("ignoreclientSize");const t=H.toDataURL("image/png");o(6,H.width=C,H),o(6,H.height=S,H),o(1,p=T),o(5,V=_),J(),function(){if(!globalThis.gyre)return;let t=H.toDataURL("image/png"),e=globalThis.gyre.paletteValues.selectedLayer.url;globalThis.gyre.undo_redo_add("gradient","imagegenerated",{urlBefore:e,urlAfter:t},((t,e)=>{let n;"undo"===e&&(n=t.data.urlBefore),"redo"===e&&(n=t.data.urlAfter),globalThis.gyre.paletteValues.selectedLayer.url=n,globalThis.gyre.paletteValues.selectedLayer&&globalThis.gyre.paletteValues.selectedLayer._refreshCallback&&globalThis.gyre.paletteValues.selectedLayer._refreshCallback()}))}(),g.dispatchEvent(new CustomEvent("change",{detail:{type:"imagegenerated",dataURL:t}}))}()),i.cancel&&(g.dispatchEvent(new CustomEvent("change",{detail:{type:"cancelimagegenerate"}})),s(r,i.cancel=!1,i)),i.editcoord!==m&&(g.dispatchEvent(new CustomEvent("change",{detail:{type:"editcoord",value:i.editcoord}})),m=i.editcoord)}function O(t,e=null){k=t,L=e}function U(){k=null,L=null}function B(t){if(!k)return;const e=d.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;if("x1"===k)o(1,p.x1=n,p),o(1,p.y1=i,p),q();else if("x2"===k)o(1,p.x2=n,p),o(1,p.y2=i,p),q();else if("middlePoint"===k){const t=p.x2-p.x1,e=p.y2-p.y1,r=Math.sqrt(t*t+e*e),l=((n-p.x1)*t+(i-p.y1)*e)/(r*r);o(5,V[L].percentage=Math.max(0,Math.min(1,l)),V)}F()}function F(){!function(){for(const t in p)p.hasOwnProperty(t)&&(v[t]=p[t]/b)}(),q(),o(9,f=A()),s(r,i.value=f,i),g.dispatchEvent(new CustomEvent("change",{detail:{type:"coordinates",value:f}}))}function q(){V.forEach((t=>{t.x=p.x1+t.percentage*(p.x2-p.x1),t.y=p.y1+t.percentage*(p.y2-p.y1)})),J(),o(5,V)}var D;D=()=>{window.addEventListener("mousemove",B),window.addEventListener("mouseup",U),f&&q()},w().$$.on_mount.push(D),function(t){w().$$.on_destroy.push(t)}((()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",U)}));let H=null;function J(t){if(!H)return;const e=H.getContext("2d");if(t?(o(6,H),o(6,H)):(o(6,H.width=H.clientWidth||H.width,H),o(6,H.height=H.clientHeight||H.height,H)),0===H.width||0===H.height)return;const n=Math.atan2(p.y2-p.y1,p.x2-p.x1),i=Math.sqrt(H.width**2+H.height**2),r=p.x1-i*Math.cos(n),l=p.y1-i*Math.sin(n),s=p.x2+i*Math.cos(n),a=p.y2+i*Math.sin(n),c=e.createLinearGradient(r,l,s,a);c.addColorStop(0,M),V.forEach((t=>{const e=p.x1+(p.x2-p.x1)*t.percentage,n=p.y1+(p.y2-p.y1)*t.percentage,o=Math.hypot(e-r,n-l)/Math.hypot(s-r,a-l);c.addColorStop(o,t.color)})),c.addColorStop(1,R),e.fillStyle=c,e.fillRect(0,0,H.width,H.height)}return e.$$set=t=>{"opacity"in t&&o(0,u=t.opacity),"value"in t&&o(9,f=t.value),"ratio"in t&&o(10,x=t.ratio)},e.$$.update=()=>{32768&e.$$.dirty[0]&&i&&N(),512&e.$$.dirty[0]&&f&&(!function(t){o(5,V=[]),t.trim().split("\n").forEach((t=>{let[e,n]=t.split(":"),o=parseFloat(e)/100,i="#"+n.split(",").map(Number).map((t=>t.toString(16).padStart(2,"0"))).join("").toUpperCase();V.push({percentage:o,color:i})})),V.sort(((t,e)=>t.percentage-e.percentage));let e=V.find((t=>0===t.percentage));M=e?e.color:V[0].color;let n=V.find((t=>1===t.percentage));R=n?n.color:V[V.length-1].color}(f),q(),N()),6&e.$$.dirty[0]&&y&&!p.x1&&P(),24576&e.$$.dirty[0]&&$&&$!=h&&(null!=v.x1&&null!=v.x2&&setTimeout((()=>{let t={...v};Object.keys(t).forEach((e=>{t[e]=t[e]*b})),o(1,p={...t}),F()}),100),o(14,$=h))},[u,p,y,r,d,V,H,O,U,f,x,P,N,h,$,i,function(t){E[t?"unshift":"push"]((()=>{H=t,o(6,H)}))},()=>O("x1"),()=>O("x2"),t=>O("middlePoint",t),t=>O("middlePoint",t),function(t){E[t?"unshift":"push"]((()=>{d=t,o(4,d)}))}]}customElements.define("fds-image-editor-gradient-dialog",class extends N{constructor(t){super();const e=document.createElement("style");e.textContent='*{box-sizing:border-box}.editcoord{min-width:330px;min-height:100px;box-shadow:0 0 1rem 0 rgba(255, 255, 255, .2);border-radius:8px;background-color:rgba(0, 0, 0, .65);backdrop-filter:blur(10px);color:rgba(255, 255, 255, 0.6);position:absolute;left:0px;top:50px;padding:14px;font-family:"Segoe UI", Roboto, system-ui;z-index:2000}.formLine{displaY:block;margin-bottom:20px}.formLine{margin-bottom:5px}.show{display:block}',this.shadowRoot.appendChild(e),A(this,{target:this.shadowRoot,props:$(this.attributes),customElement:!0},q,B,r,{toolinst:7,refresh:8,editcoord:0},null),t&&(t.target&&c(t.target,this,t.anchor),t.props&&(this.$set(t.props),M()))}static get observedAttributes(){return["toolinst","refresh","editcoord"]}get toolinst(){return this.$$.ctx[7]}set toolinst(t){this.$$set({toolinst:t}),M()}get refresh(){return this.$$.ctx[8]}get editcoord(){return this.$$.ctx[0]}set editcoord(t){this.$$set({editcoord:t}),M()}});class Y extends N{constructor(t){super();const e=document.createElement("style");e.textContent="circle{cursor:pointer}",this.shadowRoot.appendChild(e),A(this,{target:this.shadowRoot,props:$(this.attributes),customElement:!0},W,J,r,{opacity:0,value:9,ratio:10,resetLine:11,refresh:12},null,[-1,-1]),t&&(t.target&&c(t.target,this,t.anchor),t.props&&(this.$set(t.props),M()))}static get observedAttributes(){return["opacity","value","ratio","resetLine","refresh"]}get opacity(){return this.$$.ctx[0]}set opacity(t){this.$$set({opacity:t}),M()}get value(){return this.$$.ctx[9]}set value(t){this.$$set({value:t}),M()}get ratio(){return this.$$.ctx[10]}set ratio(t){this.$$set({ratio:t}),M()}get resetLine(){return this.$$.ctx[11]}get refresh(){return this.$$.ctx[12]}}return customElements.define("fds-image-editor-gradient",Y),Y}();
//# sourceMappingURL=fds-image-editor-gradient.js.map
