var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function s(t,e,n){return t.set(n),e}function l(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode&&t.parentNode.removeChild(t)}function d(t){return document.createElement(t)}function h(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function f(){return t=" ",document.createTextNode(t);var t}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e,n){e in t?t[e]="boolean"==typeof t[e]&&""===n||n:g(t,e,n)}function $(t,e,n,o){null==n?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function x(t){const e={};for(const n of t)e[n.name]=n.value;return e}let y;function b(t){y=t}function v(){if(!y)throw new Error("Function called outside component initialization");return y}function w(){const t=v();return(e,n,{cancelable:o=!1}={})=>{const i=t.$$.callbacks[e];if(i){const r=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,o,e),i}(e,n,{cancelable:o});return i.slice().forEach((e=>{e.call(t,r)})),!r.defaultPrevented}return!0}}const E=[],k=[];let C=[];const _=[],L=Promise.resolve();let S=!1;function M(t){C.push(t)}const R=new Set;let z=0;function N(){if(0!==z)return;const t=y;do{try{for(;z<E.length;){const t=E[z];z++,b(t),P(t.$$)}}catch(t){throw E.length=0,z=0,t}for(b(null),E.length=0,z=0;k.length;)k.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];R.has(e)||(R.add(e),e())}C.length=0}while(E.length);for(;_.length;)_.pop()();S=!1,R.clear(),b(t)}function P(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const j=new Set;function A(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];C.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),C=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function O(t,e){-1===t.$$.dirty[0]&&(E.push(t),S||(S=!0,L.then(N)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function T(r,c,s,l,a,d,h,f=[-1]){const p=y;b(r);const g=r.$$={fragment:null,ctx:[],props:d,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(p?p.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:c.target||p.$$.root};h&&h(g.root);let m=!1;if(g.ctx=s?s(r,c.props||{},((t,e,...n)=>{const o=n.length?n[0]:e;return g.ctx&&a(g.ctx[t],g.ctx[t]=o)&&(!g.skip_bound&&g.bound[t]&&g.bound[t](o),m&&O(r,t)),e})):[],g.update(),m=!0,o(g.before_update),g.fragment=!!l&&l(g.ctx),c.target){if(c.hydrate){const t=function(t){return Array.from(t.childNodes)}(c.target);g.fragment&&g.fragment.l(t),t.forEach(u)}else g.fragment&&g.fragment.c();c.intro&&(($=r.$$.fragment)&&$.i&&(j.delete($),$.i(x))),function(t,n,r,c){const{fragment:s,after_update:l}=t.$$;s&&s.m(n,r),c||M((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),l.forEach(M)}(r,c.target,c.anchor,c.customElement),N()}var $,x;b(p)}let U;"function"==typeof HTMLElement&&(U=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(i);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){o(this.$$.on_disconnect)}$destroy(){A(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});const q=[];let F=function(e,n=t){let o;const i=new Set;function c(t){if(r(e,t)&&(e=t,o)){const t=!q.length;for(const t of i)t[1](),q.push(t,e);if(t){for(let t=0;t<q.length;t+=2)q[t][0](q[t+1]);q.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(r,s=t){const l=[r,s];return i.add(l),1===i.size&&(o=n(c)||t),r(e),()=>{i.delete(l),0===i.size&&o&&(o(),o=null)}}}}({});function H(t){let e,n,i,r,c,s,h,x,y,b,v,w,E;return{c(){e=d("div"),n=d("div"),i=d("fds-gradient-editor"),r=f(),c=d("div"),s=d("div"),h=d("fds-image-editor-button"),h.textContent="Reset Line",x=f(),y=d("fds-image-editor-button"),y.textContent="Done",b=f(),v=d("fds-image-editor-button"),v.textContent="Cancel",m(i,"value",t[2]),m(i,"id","gradientList"),g(n,"class","formLine"),m(h,"type","button"),m(y,"type","button"),m(v,"type","button"),$(s,"display","flex"),$(s,"align-items","center"),g(c,"class","formLine"),g(e,"class","editcoord")},m(o,u){a(o,e,u),l(e,n),l(n,i),l(e,r),l(e,c),l(c,s),l(s,h),l(s,x),l(s,y),l(s,b),l(s,v),w||(E=[p(i,"change",t[9]),p(h,"click",t[10]),p(y,"click",t[11]),p(v,"click",t[12])],w=!0)},p(t,e){4&e&&m(i,"value",t[2])},d(t){t&&u(e),w=!1,o(E)}}}function B(e){let n,o,i,r,c,s,h=e[0]&&H(e);return{c(){n=d("div"),o=d("div"),i=d("fds-image-editor-button"),i.textContent="Parameters",r=f(),h&&h.c(),this.c=t,m(i,"type","button"),$(o,"display","flex"),$(o,"align-items","center"),g(n,"class","show"),$(n,"display","inline-flex")},m(t,u){a(t,n,u),l(n,o),l(o,i),l(n,r),h&&h.m(n,null),c||(s=p(i,"click",e[8]),c=!0)},p(t,[e]){t[0]?h?h.p(t,e):(h=H(t),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},i:t,o:t,d(t){t&&u(n),h&&h.d(),c=!1,s()}}}function D(t,e,n){let o;c(t,F,(t=>n(1,o=t)));let i=v().$$.root.host,r="10:0,0,090:255,255,255",{toolinst:l}=e;function a(t,e){i.dispatchEvent(new CustomEvent("change",{detail:{name:t,value:e}}))}function u(t){s(F,o.value=t.value,o)}function d(){s(F,o.resetLine=!0,o)}function h(){n(2,r=o.value)}let{editcoord:f}=e;return t.$$set=t=>{"toolinst"in t&&n(6,l=t.toolinst),"editcoord"in t&&n(0,f=t.editcoord)},t.$$.update=()=>{2&t.$$.dirty&&o&&h()},[f,o,r,a,u,d,l,h,()=>{n(0,f=!f),s(F,o.editcoord=f,o),a("editcoord",f)},t=>{u(t.detail)},()=>{d()},()=>{s(F,o.done=!0,o)},()=>{s(F,o.cancel=!0,o)}]}function I(t,e,n){const o=t.slice();return o[39]=e[n].percentage,o[40]=e[n].color,o[41]=e[n].x,o[42]=e[n].y,o[44]=n,o}function J(t){let e,n,i,r,c,s;function l(){return t[14](t[44])}return{c(){e=h("circle"),g(e,"cx",n=t[41]),g(e,"cy",i=t[42]),g(e,"r","8"),g(e,"fill",r=t[40]),g(e,"stroke","black"),g(e,"stroke-width","2")},m(n,o){a(n,e,o),c||(s=[p(e,"mousedown",l),p(e,"mouseup",t[6])],c=!0)},p(o,c){t=o,4&c[0]&&n!==(n=t[41])&&g(e,"cx",n),4&c[0]&&i!==(i=t[42])&&g(e,"cy",i),4&c[0]&&r!==(r=t[40])&&g(e,"fill",r)},d(t){t&&u(e),c=!1,o(s)}}}function V(e){let n,i,r,c,s,m,x,y,b,v,w,E,k,C,_,L,S,M=e[2],R=[];for(let t=0;t<M.length;t+=1)R[t]=J(I(e,M,t));return{c(){n=d("div"),i=d("canvas"),r=f(),c=h("svg"),s=h("line"),v=h("circle"),k=h("circle");for(let t=0;t<R.length;t+=1)R[t].c();this.c=t,$(i,"position","absolute"),$(i,"width",e[4].width+"px"),$(i,"height",e[4].height+"px"),$(i,"z-index","-10"),g(s,"x1",m=e[0].x1),g(s,"y1",x=e[0].y1),g(s,"x2",y=e[0].x2),g(s,"y2",b=e[0].y2),g(s,"stroke","black"),g(s,"stroke-width","2"),g(v,"cx",w=e[0].x1),g(v,"cy",E=e[0].y1),g(v,"r","8"),g(v,"fill","white"),g(v,"stroke","black"),g(v,"stroke-width","2"),g(k,"cx",C=e[0].x2),g(k,"cy",_=e[0].y2),g(k,"r","8"),g(k,"fill","white"),g(k,"stroke","black"),g(k,"stroke-width","2"),g(c,"width",e[4].width),g(c,"height",e[4].height),$(n,"width",e[4].width+"px"),$(n,"height",e[4].height+"px"),$(n,"position","relative")},m(t,o){a(t,n,o),l(n,i),e[11](i),l(n,r),l(n,c),l(c,s),l(c,v),l(c,k);for(let t=0;t<R.length;t+=1)R[t]&&R[t].m(c,null);e[15](c),L||(S=[p(v,"mousedown",e[12]),p(v,"mouseup",e[6]),p(k,"mousedown",e[13]),p(k,"mouseup",e[6])],L=!0)},p(t,e){if(1&e[0]&&m!==(m=t[0].x1)&&g(s,"x1",m),1&e[0]&&x!==(x=t[0].y1)&&g(s,"y1",x),1&e[0]&&y!==(y=t[0].x2)&&g(s,"x2",y),1&e[0]&&b!==(b=t[0].y2)&&g(s,"y2",b),1&e[0]&&w!==(w=t[0].x1)&&g(v,"cx",w),1&e[0]&&E!==(E=t[0].y1)&&g(v,"cy",E),1&e[0]&&C!==(C=t[0].x2)&&g(k,"cx",C),1&e[0]&&_!==(_=t[0].y2)&&g(k,"cy",_),100&e[0]){let n;for(M=t[2],n=0;n<M.length;n+=1){const o=I(t,M,n);R[n]?R[n].p(o,e):(R[n]=J(o),R[n].c(),R[n].m(c,null))}for(;n<R.length;n+=1)R[n].d(1);R.length=M.length}},i:t,o:t,d(t){t&&u(n),e[11](null),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(R,t),e[15](null),L=!1,o(S)}}}function W(t,e,n){let o;c(t,F,(t=>n(10,o=t)));let i,r,l,a=v().$$.root.host,u={x1:0,y1:0,x2:10,y2:10},{value:d}=e,h={width:globalThis.gyre.paletteValues.selectedLayer._width,height:globalThis.gyre.paletteValues.selectedLayer._height},{ratio:f=window.devicePixelRatio}=e,p=null,g=null;w();let m,$,x,y,b=[],E="white",C="white";function _(){n(0,u.x1=.1*h.width,u),n(0,u.y1=.1*h.height,u),n(0,u.x2=.9*h.width,u),n(0,u.y2=.9*h.height,u),P()}function L(t){return r=globalThis.gyre.canvas.zoom||100,t/(parseFloat(r)/100/f)}function S(){return b.sort(((t,e)=>t.percentage-e.percentage)),b.map((t=>{let e=100*t.percentage,n=t.color;return"string"==typeof n&&n.startsWith("#")&&(n=function(t){3===(t=t.replace("#","")).length&&(t=t.split("").map((t=>t+t)).join(""));let e=parseInt(t,16);return`${e>>16&255},${e>>8&255},${255&e}`}(n)),`${e}:${n}`})).join("\n")}function M(){o.value&&n(7,d=o.value),o.resetLine&&(_(),s(F,o.resetLine=!1,o)),o.done&&(s(F,o.done=!1,o),function(){m={...u},n(0,u={x1:L(u.x1),y1:L(u.y1),x2:L(u.x2),y2:L(u.y2)}),$=JSON.parse(JSON.stringify(b)),n(2,b=b.map((t=>(t.x=L(t.x),t.y=L(t.y),t)))),x=A.width,y=A.height,n(3,A.width=L(A.width),A),n(3,A.height=L(A.height),A),O("ignoreclientSize");const t=A.toDataURL("image/png");n(3,A.width=x,A),n(3,A.height=y,A),n(0,u=m),n(2,b=$),O(),a.dispatchEvent(new CustomEvent("change",{detail:{type:"imagegenerated",dataURL:t}}))}()),o.cancel&&(a.dispatchEvent(new CustomEvent("change",{detail:{type:"cancelimagegenerate"}})),s(F,o.cancel=!1,o)),o.editcoord!==l&&(a.dispatchEvent(new CustomEvent("change",{detail:{type:"editcoord",value:o.editcoord}})),l=o.editcoord)}function R(t,e=null){p=t,g=e}function z(){p=null,g=null}function N(t){if(!p)return;const e=i.getBoundingClientRect(),r=t.clientX-e.left,c=t.clientY-e.top;if("x1"===p)n(0,u.x1=r,u),n(0,u.y1=c,u),P();else if("x2"===p)n(0,u.x2=r,u),n(0,u.y2=c,u),P();else if("middlePoint"===p){const t=u.x2-u.x1,e=u.y2-u.y1,o=Math.sqrt(t*t+e*e),i=((r-u.x1)*t+(c-u.y1)*e)/(o*o);n(2,b[g].percentage=Math.max(0,Math.min(1,i)),b)}P(),n(7,d=S()),s(F,o.value=d,o),a.dispatchEvent(new CustomEvent("change",{detail:{type:"coordinates",value:d}}))}function P(){b.forEach((t=>{t.x=u.x1+t.percentage*(u.x2-u.x1),t.y=u.y1+t.percentage*(u.y2-u.y1)})),O(),n(2,b)}var j;j=()=>{window.addEventListener("mousemove",N),window.addEventListener("mouseup",z),d&&P()},v().$$.on_mount.push(j),function(t){v().$$.on_destroy.push(t)}((()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",z)}));let A=null;function O(t){if(!A)return;const e=A.getContext("2d");if(t?(n(3,A),n(3,A)):(n(3,A.width=A.clientWidth||A.width,A),n(3,A.height=A.clientHeight||A.height,A)),0===A.width||0===A.height)return;const o=Math.atan2(u.y2-u.y1,u.x2-u.x1),i=Math.sqrt(A.width**2+A.height**2),r=u.x1-i*Math.cos(o),c=u.y1-i*Math.sin(o),s=u.x2+i*Math.cos(o),l=u.y2+i*Math.sin(o),a=e.createLinearGradient(r,c,s,l);a.addColorStop(0,E),b.forEach((t=>{const e=u.x1+(u.x2-u.x1)*t.percentage,n=u.y1+(u.y2-u.y1)*t.percentage,o=Math.hypot(e-r,n-c)/Math.hypot(s-r,l-c);a.addColorStop(o,t.color)})),a.addColorStop(1,C),e.fillStyle=a,e.fillRect(0,0,A.width,A.height)}return t.$$set=t=>{"value"in t&&n(7,d=t.value),"ratio"in t&&n(8,f=t.ratio)},t.$$.update=()=>{1024&t.$$.dirty[0]&&o&&M(),128&t.$$.dirty[0]&&d&&(!function(t){n(2,b=[]),t.trim().split("\n").forEach((t=>{let[e,n]=t.split(":"),o=parseFloat(e)/100,i="#"+n.split(",").map(Number).map((t=>t.toString(16).padStart(2,"0"))).join("").toUpperCase();b.push({percentage:o,color:i})})),b.sort(((t,e)=>t.percentage-e.percentage));let e=b.find((t=>0===t.percentage));E=e?e.color:b[0].color;let o=b.find((t=>1===t.percentage));C=o?o.color:b[b.length-1].color}(d),P()),1&t.$$.dirty[0]&&h&&!u.x1&&_()},[u,i,b,A,h,R,z,d,f,_,o,function(t){k[t?"unshift":"push"]((()=>{A=t,n(3,A)}))},()=>R("x1"),()=>R("x2"),t=>R("middlePoint",t),function(t){k[t?"unshift":"push"]((()=>{i=t,n(1,i)}))}]}customElements.define("fds-image-editor-gradient-dialog",class extends U{constructor(t){super();const e=document.createElement("style");e.textContent='*{box-sizing:border-box}.editcoord{min-width:330px;min-height:100px;box-shadow:0 0 1rem 0 rgba(255, 255, 255, .2);border-radius:8px;background-color:rgba(0, 0, 0, .65);backdrop-filter:blur(10px);color:rgba(255, 255, 255, 0.6);position:absolute;left:0px;top:50px;padding:14px;font-family:"Segoe UI", Roboto, system-ui;z-index:2000}.formLine{displaY:block;margin-bottom:20px}.formLine{margin-bottom:5px}.show{display:block}',this.shadowRoot.appendChild(e),T(this,{target:this.shadowRoot,props:x(this.attributes),customElement:!0},D,B,r,{toolinst:6,refresh:7,editcoord:0},null),t&&(t.target&&a(t.target,this,t.anchor),t.props&&(this.$set(t.props),N()))}static get observedAttributes(){return["toolinst","refresh","editcoord"]}get toolinst(){return this.$$.ctx[6]}set toolinst(t){this.$$set({toolinst:t}),N()}get refresh(){return this.$$.ctx[7]}get editcoord(){return this.$$.ctx[0]}set editcoord(t){this.$$set({editcoord:t}),N()}});class Y extends U{constructor(t){super();const e=document.createElement("style");e.textContent="circle{cursor:pointer}",this.shadowRoot.appendChild(e),T(this,{target:this.shadowRoot,props:x(this.attributes),customElement:!0},W,V,r,{value:7,ratio:8,resetLine:9},null,[-1,-1]),t&&(t.target&&a(t.target,this,t.anchor),t.props&&(this.$set(t.props),N()))}static get observedAttributes(){return["value","ratio","resetLine"]}get value(){return this.$$.ctx[7]}set value(t){this.$$set({value:t}),N()}get ratio(){return this.$$.ctx[8]}set ratio(t){this.$$set({ratio:t}),N()}get resetLine(){return this.$$.ctx[9]}}return customElements.define("fds-image-editor-gradient",Y),Y}();
//# sourceMappingURL=fds-image-editor-gradient.js.map
