var app=function(){"use strict";function noop(){}function run(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run)}function is_function(e){return"function"==typeof e}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let src_url_equal_anchor;function src_url_equal(e,t){return src_url_equal_anchor||(src_url_equal_anchor=document.createElement("a")),src_url_equal_anchor.href=t,e===src_url_equal_anchor.href}function is_empty(e){return 0===Object.keys(e).length}function action_destroyer(e){return e&&is_function(e.destroy)?e.destroy:noop}const globals="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function append(e,t){e.appendChild(t)}function insert(e,t,n){e.insertBefore(t,n||null)}function detach(e){e.parentNode&&e.parentNode.removeChild(e)}function destroy_each(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function element(e){return document.createElement(e)}function svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function text(e){return document.createTextNode(e)}function space(){return text(" ")}function empty(){return text("")}function listen(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function attr(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function set_custom_element_data(e,t,n){t in e?e[t]="boolean"==typeof e[t]&&""===n||n:attr(e,t,n)}function to_number(e){return""===e?null:+e}function children(e){return Array.from(e.childNodes)}function set_input_value(e,t){e.value=null==t?"":t}function set_style(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function toggle_class(e,t,n){e.classList[n?"add":"remove"](t)}function custom_event(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,r,t),i}class HtmlTag{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=svg_element(t.nodeName):this.e=element(11===t.nodeType?"TEMPLATE":t.nodeName),this.t="TEMPLATE"!==t.tagName?t:t.content,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)insert(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(detach)}}function attribute_to_object(e){const t={};for(const n of e)t[n.name]=n.value;return t}let current_component;function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(e){get_current_component().$$.on_mount.push(e)}function createEventDispatcher(){const e=get_current_component();return(t,n,{cancelable:r=!1}={})=>{const i=e.$$.callbacks[t];if(i){const o=custom_event(t,n,{cancelable:r});return i.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}const dirty_components=[],binding_callbacks=[];let render_callbacks=[];const flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function tick(){return schedule_update(),resolved_promise}function add_render_callback(e){render_callbacks.push(e)}const seen_callbacks=new Set;let flushidx=0;function flush(){if(0!==flushidx)return;const e=current_component;do{try{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}}catch(e){throw dirty_components.length=0,flushidx=0,e}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(e)}function update(e){if(null!==e.fragment){e.update(),run_all(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(add_render_callback)}}function flush_render_callbacks(e){const t=[],n=[];render_callbacks.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),render_callbacks=t}const outroing=new Set;function transition_in(e,t){e&&e.i&&(outroing.delete(e),e.i(t))}function mount_component(e,t,n,r){const{fragment:i,after_update:o}=e.$$;i&&i.m(t,n),r||add_render_callback((()=>{const t=e.$$.on_mount.map(run).filter(is_function);e.$$.on_destroy?e.$$.on_destroy.push(...t):run_all(t),e.$$.on_mount=[]})),o.forEach(add_render_callback)}function destroy_component(e,t){const n=e.$$;null!==n.fragment&&(flush_render_callbacks(n.after_update),run_all(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function make_dirty(e,t){-1===e.$$.dirty[0]&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function init(e,t,n,r,i,o,a,c=[-1]){const u=current_component;set_current_component(e);const s=e.$$={fragment:null,ctx:[],props:o,update:noop,not_equal:i,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:blank_object(),dirty:c,skip_bound:!1,root:t.target||u.$$.root};a&&a(s.root);let l=!1;if(s.ctx=n?n(e,t.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return s.ctx&&i(s.ctx[t],s.ctx[t]=o)&&(!s.skip_bound&&s.bound[t]&&s.bound[t](o),l&&make_dirty(e,t)),n})):[],s.update(),l=!0,run_all(s.before_update),s.fragment=!!r&&r(s.ctx),t.target){if(t.hydrate){const e=children(t.target);s.fragment&&s.fragment.l(e),e.forEach(detach)}else s.fragment&&s.fragment.c();t.intro&&transition_in(e.$$.fragment),mount_component(e,t.target,t.anchor,t.customElement),flush()}set_current_component(u)}let SvelteElement;function add(e,t){return{x:e.x+t.x,y:e.y+t.y}}function subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}}function scale(e,t){return{x:e.x*t,y:e.y*t}}function rotate(e,t,n={x:0,y:0}){const r=e.x-n.x,i=e.y-n.y;return{x:n.x+r*Math.cos(t)-i*Math.sin(t),y:n.y+i*Math.cos(t)+r*Math.sin(t)}}function direction(e){const t=Math.atan(e.x/e.y);return e.y>0?t+Math.PI:t}function length(e){return Math.sqrt(e.x*e.x+e.y*e.y)}"function"==typeof HTMLElement&&(SvelteElement=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(run).filter(is_function);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){run_all(this.$$.on_disconnect)}$destroy(){destroy_component(this,1),this.$destroy=noop}$on(e,t){if(!is_function(t))return noop;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});var vector={add:add,subtract:subtract,sub:subtract,scale:scale,rotate:rotate,direction:direction,length:length,len:length};class magneticLines{rotatePoint(e,t,n){const r=Math.cos(n),i=Math.sin(n);return{x:e*r-t*i,y:e*i+t*r}}calcMagneticLine(e,t,n,r){let i,o,a,c,u,s=r.x,l=r.y,f=r.width,m=r.height,h=r.rotation,d=s+f/2,p=l+m/2;if("side"===t)"top"===e?(i=this.rotatePoint(0,-m/2,h),o=h,u=f+1e3):"right"===e?(i=this.rotatePoint(f/2,0,h),o=h+Math.PI/2,u=m+1e3):"bottom"===e?(i=this.rotatePoint(0,m/2,h),o=h+Math.PI,u=f+1e3):"left"===e&&(i=this.rotatePoint(-f/2,0,h),o=h-Math.PI/2,u=m+1e3),a=d+i.x,c=p+i.y;else if("center"===t){a=d,c=p,"horizontal"===n?o=h:"vertical"===n?o=h+Math.PI/2:"aligned"===n&&(o=h);u=Math.hypot(f,m)+1e3}return{x_line:a,y_line:c,lineLength:u,theta_line:o}}rotatePositionBackToOriginal(e,t){let n=this.centerX,r=this.centerY;const i=e.x,o=e.y,a=e.width,c=e.height,u=i+a/2,s=o+c/2;return{x:n+(u-n)*Math.cos(t)-(s-r)*Math.sin(t)-a/2,y:r+(u-n)*Math.sin(t)+(s-r)*Math.cos(t)-c/2,width:a,height:c,rotation:t}}rotateBoxesToZero(e,t){let n=0,r=0;return e.forEach((e=>{n+=e.x+e.width/2,r+=e.y+e.height/2})),n/=e.length,r/=e.length,this.centerX=n,this.centerY=r,e.forEach((e=>{let i=e.x+e.width/2,o=e.y+e.height/2,a=n+(i-n)*Math.cos(-t)-(o-r)*Math.sin(-t),c=r+(i-n)*Math.sin(-t)+(o-r)*Math.cos(-t);e.x=a-e.width/2,e.y=c-e.height/2,e.rotation=0})),e}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var numeric1_2_6=createCommonjsModule((function(module,exports){var numeric=exports;void 0!==commonjsGlobal&&(commonjsGlobal.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var n,r,i;for(void 0===t&&(t=15),r=.5,n=new Date;;){for(i=r*=2;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;if(new Date-n>t)break}for(i=r;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;return 1e3*(3*r-1)/(new Date-n)},numeric._myIndexOf=function(e){var t,n=this.length;for(t=0;t<n;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),r=e/Math.pow(10,n),i=r.toPrecision(numeric.precision);return 10===parseFloat(i)&&(n++,i=(r=1).toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+n.toString()}return"Infinity"}var n=[];return function e(r){var i;if(void 0===r)return n.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof r)return n.push('"'+r+'"'),!1;if("boolean"==typeof r)return n.push(r.toString()),!1;if("number"==typeof r){var o=t(r),a=r.toPrecision(numeric.precision),c=parseFloat(r.toString()).toString(),u=[o,a,c,parseFloat(a).toString(),parseFloat(c).toString()];for(i=1;i<u.length;i++)u[i].length<o.length&&(o=u[i]);return n.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===r)return n.push("null"),!1;if("function"==typeof r){n.push(r.toString());var s=!1;for(i in r)r.hasOwnProperty(i)&&(s?n.push(",\n"):n.push("\n{"),s=!0,n.push(i),n.push(": \n"),e(r[i]));return s&&n.push("}\n"),!0}if(r instanceof Array){if(r.length>numeric.largeArray)return n.push("...Large Array..."),!0;s=!1;for(n.push("["),i=0;i<r.length;i++)i>0&&(n.push(","),s&&n.push("\n ")),s=e(r[i]);return n.push("]"),!0}for(i in n.push("{"),s=!1,r)r.hasOwnProperty(i)&&(s&&n.push(",\n"),s=!0,n.push(i),n.push(": \n"),e(r[i]));return n.push("}"),!0}(e),n.join("")},numeric.parseDate=function(e){return function e(t){if("string"==typeof t)return Date.parse(t.replace(/-/g,"/"));if(!(t instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseFloat=function(e){return function e(t){if("string"==typeof t)return parseFloat(t);if(!(t instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseCSV=function(e){var t,n,r,i=e.split("\n"),o=[],a=/(([^'",]*)|('[^']*')|("[^"]*")),/g,c=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,u=0;for(n=0;n<i.length;n++){var s,l=(i[n]+",").match(a);if(l.length>0){for(o[u]=[],t=0;t<l.length;t++)s=(r=l[t]).substr(0,r.length-1),c.test(s)?o[u][t]=parseFloat(s):o[u][t]=s;u++}}return o},numeric.toCSV=function(e){var t,n,r,i,o,a=numeric.dim(e);for(r=a[0],a[1],o=[],t=0;t<r;t++){for(i=[],n=0;n<r;n++)i[n]=e[t][n].toString();o[t]=i.join(", ")}return o.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length);var r,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1;for(e.length,r=t;r<n;r++)o=o>>>8^i[255&(o^e[r])];return~o}var n,r,i,o,a,c,u,s,l,f,m=e[0].length,h=e[0][0].length,d=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,h>>24&255,h>>16&255,h>>8&255,255&h,m>>24&255,m>>16&255,m>>8&255,255&m,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(f=t(d,12,29),d[29]=f>>24&255,d[30]=f>>16&255,d[31]=f>>8&255,d[32]=255&f,n=1,r=0,u=0;u<m;u++){for(u<m-1?d.push(0):d.push(1),a=3*h+1+(0===u)&255,c=3*h+1+(0===u)>>8&255,d.push(a),d.push(c),d.push(255&~a),d.push(255&~c),0===u&&d.push(0),s=0;s<h;s++)for(i=0;i<3;i++)r=(r+(n=(n+(a=(a=e[i][u][s])>255?255:a<0?0:Math.round(a)))%65521))%65521,d.push(a);d.push(0)}return l=(r<<16)+n,d.push(l>>24&255),d.push(l>>16&255),d.push(l>>8&255),d.push(255&l),o=d.length-41,d[33]=o>>24&255,d[34]=o>>16&255,d[35]=o>>8&255,d[36]=255&o,f=t(d,37),d.push(f>>24&255),d.push(f>>16&255),d.push(f>>8&255),d.push(255&f),d.push(0),d.push(0),d.push(0),d.push(0),d.push(73),d.push(69),d.push(78),d.push(68),d.push(174),d.push(66),d.push(96),d.push(130),"data:image/png;base64,"+function(e){var t,n,r,i,o,a,c,u=e.length,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="";for(t=0;t<u;t+=3)o=((3&(n=e[t]))<<4)+((r=e[t+1])>>4),a=((15&r)<<2)+((i=e[t+2])>>6),c=63&i,t+1>=u?a=c=64:t+2>=u&&(c=64),l+=s.charAt(n>>2)+s.charAt(o)+s.charAt(a)+s.charAt(c);return l}(d)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t;return"object"==typeof e?"object"==typeof(t=e[0])?"object"==typeof t[0]?numeric._dim(e):[e.length,t.length]:[e.length]:[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,n){var r,i;if(!(t instanceof Array&&n instanceof Array))return!1;if((i=t.length)!==n.length)return!1;for(r=0;r<i;r++)if(t[r]!==n[r]){if("object"!=typeof t[r])return!1;if(!e(t[r],n[r]))return!1}return!0},numeric.rep=function(e,t,n){void 0===n&&(n=0);var r,i=e[n],o=Array(i);if(n===e.length-1){for(r=i-2;r>=0;r-=2)o[r+1]=t,o[r]=t;return-1===r&&(o[0]=t),o}for(r=i-1;r>=0;r--)o[r]=numeric.rep(e,t,n+1);return o},numeric.dotMMsmall=function(e,t){var n,r,i,o,a,c,u,s,l,f,m;for(o=e.length,a=t.length,c=t[0].length,u=Array(o),n=o-1;n>=0;n--){for(s=Array(c),l=e[n],i=c-1;i>=0;i--){for(f=l[a-1]*t[a-1][i],r=a-2;r>=1;r-=2)m=r-1,f+=l[r]*t[r][i]+l[m]*t[m][i];0===r&&(f+=l[0]*t[0][i]),s[i]=f}u[n]=s}return u},numeric._getCol=function(e,t,n){var r;for(r=e.length-1;r>0;--r)n[r]=e[r][t],n[--r]=e[r][t];0===r&&(n[0]=e[0][t])},numeric.dotMMbig=function(e,t){var n,r,i,o=numeric._getCol,a=t.length,c=Array(a),u=e.length,s=t[0].length,l=new Array(u),f=numeric.dotVV;for(--a,r=--u;-1!==r;--r)l[r]=Array(s);for(r=--s;-1!==r;--r)for(o(t,r,c),i=u;-1!==i;--i)n=e[i],l[i][r]=f(n,c);return l},numeric.dotMV=function(e,t){var n,r=e.length;t.length;var i=Array(r),o=numeric.dotVV;for(n=r-1;n>=0;n--)i[n]=o(e[n],t);return i},numeric.dotVM=function(e,t){var n,r,i,o,a,c,u;for(i=e.length,o=t[0].length,a=Array(o),r=o-1;r>=0;r--){for(c=e[i-1]*t[i-1][r],n=i-2;n>=1;n-=2)u=n-1,c+=e[n]*t[n][r]+e[u]*t[u][r];0===n&&(c+=e[0]*t[0][r]),a[r]=c}return a},numeric.dotVV=function(e,t){var n,r,i=e.length,o=e[i-1]*t[i-1];for(n=i-2;n>=1;n-=2)r=n-1,o+=e[n]*t[n]+e[r]*t[r];return 0===n&&(o+=e[0]*t[0]),o},numeric.dot=function(e,t){var n=numeric.dim;switch(1e3*n(e).length+n(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,n,r,i,o=e.length,a=Array(o);for(t=o-1;t>=0;t--){for(i=Array(o),n=t+2,r=o-1;r>=n;r-=2)i[r]=0,i[r-1]=0;for(r>t&&(i[r]=0),i[t]=e[t],r=t-1;r>=1;r-=2)i[r]=0,i[r-1]=0;0===r&&(i[0]=0),a[t]=i}return a},numeric.getDiag=function(e){var t,n=Math.min(e.length,e[0].length),r=Array(n);for(t=n-1;t>=1;--t)r[t]=e[t][t],r[--t]=e[t][t];return 0===t&&(r[0]=e[0][0]),r},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,n){void 0===n&&(n="");var r,i,o=[],a=/\[i\]$/,c="",u=!1;for(r=0;r<e.length;r++)a.test(e[r])?c=i=e[r].substring(0,e[r].length-3):i=e[r],"ret"===i&&(u=!0),o.push(i);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+c+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(u?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,t,n){void 0===n&&(n="");var r,i,o=[],a=/\[i\]$/,c="",u=!1;for(r=0;r<e.length;r++)a.test(e[r])?c=i=e[r].substring(0,e[r].length-3):i=e[r],"ret"===i&&(u=!0),o.push(i);return o[e.length]="var _n = "+c+".length;\nvar i"+(u?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function e(t,n,r,i,o){var a;if(i!==r.length-1)for(a=r[i]-1;a>=0;a--)e("object"==typeof t?t[a]:t,"object"==typeof n?n[a]:n,r,i+1,o);else o(t,n)},numeric._biforeach2=function e(t,n,r,i,o){if(i===r.length-1)return o(t,n);var a,c=r[i],u=Array(c);for(a=c-1;a>=0;--a)u[a]=e("object"==typeof t?t[a]:t,"object"==typeof n?n[a]:n,r,i+1,o);return u},numeric._foreach=function e(t,n,r,i){var o;if(r!==n.length-1)for(o=n[r]-1;o>=0;o--)e(t[o],n,r+1,i);else i(t)},numeric._foreach2=function e(t,n,r,i){if(r===n.length-1)return i(t);var o,a=n[r],c=Array(a);for(o=a-1;o>=0;o--)c[o]=e(t[o],n,r+1,i);return c},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var n,r,i="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(i="var "+t+" = Math."+t+";\n",n=function(e,n,r){return e+" = "+t+"("+n+","+r+")"},r=function(e,n){return e+" = "+t+"("+e+","+n+")"}):(n=function(e,n,r){return e+" = "+n+" "+t+" "+r},r=numeric.opseq.hasOwnProperty(e+"eq")?function(e,n){return e+" "+t+"= "+n}:function(e,n){return e+" = "+e+" "+t+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+r("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,n,r,i,o,a,c,u=numeric.dim(e),s=Math.abs,l=u[0],f=u[1],m=numeric.clone(e),h=numeric.identity(l);for(a=0;a<f;++a){var d=-1,p=-1;for(o=a;o!==l;++o)(c=s(m[o][a]))>p&&(d=o,p=c);for(n=m[d],m[d]=m[a],m[a]=n,i=h[d],h[d]=h[a],h[a]=i,e=n[a],c=a;c!==f;++c)n[c]/=e;for(c=f-1;-1!==c;--c)i[c]/=e;for(o=l-1;-1!==o;--o)if(o!==a){for(t=m[o],r=h[o],e=t[a],c=a+1;c!==f;++c)t[c]-=n[c]*e;for(c=f-1;c>0;--c)r[c]-=i[c]*e,r[--c]-=i[c]*e;0===c&&(r[0]-=i[0]*e)}}return h},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var n,r,i,o,a,c,u,s,l=t[0],f=1,m=numeric.clone(e);for(r=0;r<l-1;r++){for(i=r,n=r+1;n<l;n++)Math.abs(m[n][r])>Math.abs(m[i][r])&&(i=n);for(i!==r&&(u=m[i],m[i]=m[r],m[r]=u,f*=-1),o=m[r],n=r+1;n<l;n++){for(c=(a=m[n])[r]/o[r],i=r+1;i<l-1;i+=2)s=i+1,a[i]-=o[i]*c,a[s]-=o[s]*c;i!==l&&(a[i]-=o[i]*c)}if(0===o[r])return 0;f*=o[r]}return f*m[r][r]},numeric.transpose=function(e){var t,n,r,i,o,a=e.length,c=e[0].length,u=Array(c);for(n=0;n<c;n++)u[n]=Array(a);for(t=a-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=c-1;n>=1;--n)(o=u[n])[t]=i[n],o[t-1]=r[n],(o=u[--n])[t]=i[n],o[t-1]=r[n];0===n&&((o=u[0])[t]=i[0],o[t-1]=r[0])}if(0===t){for(r=e[0],n=c-1;n>=1;--n)u[n][0]=r[n],u[--n][0]=r[n];0===n&&(u[0][0]=r[0])}return u},numeric.negtranspose=function(e){var t,n,r,i,o,a=e.length,c=e[0].length,u=Array(c);for(n=0;n<c;n++)u[n]=Array(a);for(t=a-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=c-1;n>=1;--n)(o=u[n])[t]=-i[n],o[t-1]=-r[n],(o=u[--n])[t]=-i[n],o[t-1]=-r[n];0===n&&((o=u[0])[t]=-i[0],o[t-1]=-r[0])}if(0===t){for(r=e[0],n=c-1;n>=1;--n)u[n][0]=-r[n],u[--n][0]=-r[n];0===n&&(u[0][0]=-r[0])}return u},numeric._random=function e(t,n){var r,i,o=t[n],a=Array(o);if(n===t.length-1){for(i=Math.random,r=o-1;r>=1;r-=2)a[r]=i(),a[r-1]=i();return 0===r&&(a[0]=i()),a}for(r=o-1;r>=0;r--)a[r]=e(t,n+1);return a},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,n){if(void 0===n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var r,i=Array(n);for(r=--n;r>=0;r--)i[r]=(r*t+(n-r)*e)/n;return i},numeric.getBlock=function(e,t,n){var r=numeric.dim(e);return function e(i,o){var a,c=t[o],u=n[o]-c,s=Array(u);if(o===r.length-1){for(a=u;a>=0;a--)s[a]=i[a+c];return s}for(a=u;a>=0;a--)s[a]=e(i[a+c],o+1);return s}(e,0)},numeric.setBlock=function(e,t,n,r){var i=numeric.dim(e);return function e(r,o,a){var c,u=t[a],s=n[a]-u;if(a===i.length-1)for(c=s;c>=0;c--)r[c+u]=o[c];for(c=s;c>=0;c--)e(r[c+u],o[c],a+1)}(e,r,0),e},numeric.getRange=function(e,t,n){var r,i,o,a,c=t.length,u=n.length,s=Array(c);for(r=c-1;-1!==r;--r)for(s[r]=Array(u),o=s[r],a=e[t[r]],i=u-1;-1!==i;--i)o[i]=a[n[i]];return s},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var n,r,i,o,a,c=t[0],u=t[1];for(n=0,r=0,i=0;i<c;++i)n+=e[i][0].length;for(o=0;o<u;++o)r+=e[0][o][0].length;var s=Array(n);for(i=0;i<n;++i)s[i]=Array(r);var l,f,m,h,d,p=0;for(i=0;i<c;++i){for(l=r,o=u-1;-1!==o;--o)for(l-=(a=e[i][o])[0].length,m=a.length-1;-1!==m;--m)for(d=a[m],f=s[p+m],h=d.length-1;-1!==h;--h)f[l+h]=d[h];p+=e[i][0].length}return s},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var n=numeric.dim(e),r=numeric.dim(t);if(1!==n.length||1!==r.length)throw new Error("numeric: tensor product is only defined for vectors");var i,o,a,c,u=n[0],s=r[0],l=Array(u);for(o=u-1;o>=0;o--){for(i=Array(s),c=e[o],a=s-1;a>=3;--a)i[a]=c*t[a],i[--a]=c*t[a],i[--a]=c*t[a],i[--a]=c*t[a];for(;a>=0;)i[a]=c*t[a],--a;l[o]=i}return l},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,n,r,i){var o;if(numeric.indexOf,"string"!=typeof i)for(o in i="",numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||t.indexOf(o)>=0||n.indexOf(o)>=0||r.indexOf(o)>=0)&&o.length>1&&(i+="var "+o+" = numeric."+o+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+r+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var n=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,n),t(numeric.neg(this.y),n))}return new T(t(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var t=numeric.div;return this.y?new numeric.T(t(this.x,e.x),t(this.y,e.x)):new numeric.T(t(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),e(n)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),numeric.negtranspose(n)):new numeric.T(e(t))},numeric.Tunop=function(e,t,n){return"string"!=typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if(void 0===e.y)return new numeric.T(numeric.inv(e.x));var t,n,r,i,o,a,c,u,s,l,f,m,h,d,p,g,y,x,v=e.x.length,b=numeric.identity(v),_=numeric.rep([v,v],0),w=numeric.clone(e.x),k=numeric.clone(e.y);for(s=0;s<v;s++){for(m=(d=w[s][s])*d+(p=k[s][s])*p,f=s,l=s+1;l<v;l++)(h=(d=w[l][s])*d+(p=k[l][s])*p)>m&&(f=l,m=h);for(f!==s&&(x=w[s],w[s]=w[f],w[f]=x,x=k[s],k[s]=k[f],k[f]=x,x=b[s],b[s]=b[f],b[f]=x,x=_[s],_[s]=_[f],_[f]=x),t=w[s],n=k[s],o=b[s],a=_[s],d=t[s],p=n[s],l=s+1;l<v;l++)g=t[l],y=n[l],t[l]=(g*d+y*p)/m,n[l]=(y*d-g*p)/m;for(l=0;l<v;l++)g=o[l],y=a[l],o[l]=(g*d+y*p)/m,a[l]=(y*d-g*p)/m;for(l=s+1;l<v;l++){for(r=w[l],i=k[l],c=b[l],u=_[l],d=r[s],p=i[s],f=s+1;f<v;f++)g=t[f],y=n[f],r[f]-=g*d-y*p,i[f]-=y*d+g*p;for(f=0;f<v;f++)g=o[f],y=a[f],c[f]-=g*d-y*p,u[f]-=y*d+g*p}}for(s=v-1;s>0;s--)for(o=b[s],a=_[s],l=s-1;l>=0;l--)for(c=b[l],u=_[l],d=w[l][s],p=k[l][s],f=v-1;f>=0;f--)g=o[f],y=a[f],c[f]-=d*g-p*y,u[f]-=d*y+p*g;return new numeric.T(b,_)},numeric.T.prototype.get=function(e){var t,n=this.x,r=this.y,i=0,o=e.length;if(r){for(;i<o;)n=n[t=e[i]],r=r[t],i++;return new numeric.T(n,r)}for(;i<o;)n=n[t=e[i]],i++;return new numeric.T(n)},numeric.T.prototype.set=function(e,t){var n,r=this.x,i=this.y,o=0,a=e.length,c=t.x,u=t.y;if(0===a)return u?this.y=u:i&&(this.y=void 0),this.x=r,this;if(u){for(i||(i=numeric.rep(numeric.dim(r),0),this.y=i);o<a-1;)r=r[n=e[o]],i=i[n],o++;return r[n=e[o]]=c,i[n]=u,this}if(i){for(;o<a-1;)r=r[n=e[o]],i=i[n],o++;return r[n=e[o]]=c,i[n]=c instanceof Array?numeric.rep(numeric.dim(c),0):0,this}for(;o<a-1;)r=r[n=e[o]],o++;return r[n=e[o]]=c,this},numeric.T.prototype.getRows=function(e,t){var n,r,i=t-e+1,o=Array(i),a=this.x,c=this.y;for(n=e;n<=t;n++)o[n-e]=a[n];if(c){for(r=Array(i),n=e;n<=t;n++)r[n-e]=c[n];return new numeric.T(o,r)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,t,n){var r,i=this.x,o=this.y,a=n.x,c=n.y;for(r=e;r<=t;r++)i[r]=a[r-e];if(c)for(o||(o=numeric.rep(numeric.dim(i),0),this.y=o),r=e;r<=t;r++)o[r]=c[r-e];else if(o)for(r=e;r<=t;r++)o[r]=numeric.rep([a[r-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,n=this.y;return n?new numeric.T(t[e],n[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var n=this.x,r=this.y,i=t.x,o=t.y;return n[e]=i,o?(r||(r=numeric.rep(numeric.dim(n),0),this.y=r),r[e]=o):r&&(r=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var n=this.x,r=this.y,i=numeric.getBlock;return r?new numeric.T(i(n,e,t),i(r,e,t)):new numeric.T(i(n,e,t))},numeric.T.prototype.setBlock=function(e,t,n){n instanceof numeric.T||(n=new numeric.T(n));var r=this.x,i=this.y,o=numeric.setBlock,a=n.x,c=n.y;if(c)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),o(r,e,t,a),o(i,e,t,c),this;o(r,e,t,a),i&&o(i,e,t,numeric.rep(numeric.dim(a),0))},numeric.T.rep=function(e,t){var n=numeric.T;t instanceof n||(t=new n(t));var r=t.x,i=t.y,o=numeric.rep;return i?new n(o(e,r),o(e,i)):new n(o(e,r))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,n=e.y,r=numeric.diag;return n?new numeric.T(r(t),r(n)):new numeric.T(r(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,n=this.y;return n?new e.T(e.getDiag(t),e.getDiag(n)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),n=(e[0]>=0?1:-1)*numeric.norm2(e);t[0]+=n;var r=numeric.norm2(t);if(0===r)throw new Error("eig: internal error");return numeric.div(t,r)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var n,r,i,o,a,c,u,s,l,f,m=t[0],h=numeric.clone(e),d=numeric.identity(m);for(r=0;r<m-2;r++){for(o=Array(m-r-1),n=r+1;n<m;n++)o[n-r-1]=h[n][r];if(numeric.norm2(o)>0){for(a=numeric.house(o),c=numeric.getBlock(h,[r+1,r],[m-1,m-1]),u=numeric.tensor(a,numeric.dot(a,c)),n=r+1;n<m;n++)for(s=h[n],l=u[n-r-1],i=r;i<m;i++)s[i]-=2*l[i-r];for(c=numeric.getBlock(h,[0,r+1],[m-1,m-1]),u=numeric.tensor(numeric.dot(c,a),a),n=0;n<m;n++)for(s=h[n],l=u[n],i=r+1;i<m;i++)s[i]-=2*l[i-r-1];for(c=Array(m-r-1),n=r+1;n<m;n++)c[n-r-1]=d[n];for(u=numeric.tensor(a,numeric.dot(a,c)),n=r+1;n<m;n++)for(f=d[n],l=u[n-r-1],i=0;i<m;i++)f[i]-=2*l[i]}}return{H:h,Q:d}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(e,t){void 0===t&&(t=1e4),e=numeric.clone(e),numeric.clone(e);var n,r,i,o,a,c,u,s,l,f,m,h,d,p,g,y,x,v,b=numeric.dim(e)[0],_=numeric.identity(b);if(b<3)return{Q:_,B:[[0,b-1]]};var w=numeric.epsilon;for(v=0;v<t;v++){for(y=0;y<b-1;y++)if(Math.abs(e[y+1][y])<w*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){var k=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),M=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[b-1,b-1]),t);for(h=Array(y+1),g=0;g<=y;g++)h[g]=_[g];for(d=numeric.dot(k.Q,h),g=0;g<=y;g++)_[g]=d[g];for(h=Array(b-y-1),g=y+1;g<b;g++)h[g-y-1]=_[g];for(d=numeric.dot(M.Q,h),g=y+1;g<b;g++)_[g]=d[g-y-1];return{Q:_,B:k.B.concat(numeric.add(M.B,y+1))}}var $,T,A;if(i=e[b-2][b-2],o=e[b-2][b-1],a=e[b-1][b-2],s=i+(c=e[b-1][b-1]),u=i*c-o*a,l=numeric.getBlock(e,[0,0],[2,2]),s*s>=4*u)$=.5*(s+Math.sqrt(s*s-4*u)),T=.5*(s-Math.sqrt(s*s-4*u)),l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,$+T)),numeric.diag(numeric.rep([3],$*T)));else l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,s)),numeric.diag(numeric.rep([3],u)));for(n=[l[0][0],l[1][0],l[2][0]],r=numeric.house(n),h=[e[0],e[1],e[2]],d=numeric.tensor(r,numeric.dot(r,h)),g=0;g<3;g++)for(m=e[g],p=d[g],x=0;x<b;x++)m[x]-=2*p[x];for(h=numeric.getBlock(e,[0,0],[b-1,2]),d=numeric.tensor(numeric.dot(h,r),r),g=0;g<b;g++)for(m=e[g],p=d[g],x=0;x<3;x++)m[x]-=2*p[x];for(h=[_[0],_[1],_[2]],d=numeric.tensor(r,numeric.dot(r,h)),g=0;g<3;g++)for(f=_[g],p=d[g],x=0;x<b;x++)f[x]-=2*p[x];for(y=0;y<b-2;y++){for(x=y;x<=y+1;x++)if(Math.abs(e[x+1][x])<w*(Math.abs(e[x][x])+Math.abs(e[x+1][x+1]))){k=numeric.QRFrancis(numeric.getBlock(e,[0,0],[x,x]),t),M=numeric.QRFrancis(numeric.getBlock(e,[x+1,x+1],[b-1,b-1]),t);for(h=Array(x+1),g=0;g<=x;g++)h[g]=_[g];for(d=numeric.dot(k.Q,h),g=0;g<=x;g++)_[g]=d[g];for(h=Array(b-x-1),g=x+1;g<b;g++)h[g-x-1]=_[g];for(d=numeric.dot(M.Q,h),g=x+1;g<b;g++)_[g]=d[g-x-1];return{Q:_,B:k.B.concat(numeric.add(M.B,x+1))}}for(A=Math.min(b-1,y+3),n=Array(A-y),g=y+1;g<=A;g++)n[g-y-1]=e[g][y];for(r=numeric.house(n),h=numeric.getBlock(e,[y+1,y],[A,b-1]),d=numeric.tensor(r,numeric.dot(r,h)),g=y+1;g<=A;g++)for(m=e[g],p=d[g-y-1],x=y;x<b;x++)m[x]-=2*p[x-y];for(h=numeric.getBlock(e,[0,y+1],[b-1,A]),d=numeric.tensor(numeric.dot(h,r),r),g=0;g<b;g++)for(m=e[g],p=d[g],x=y+1;x<=A;x++)m[x]-=2*p[x-y-1];for(h=Array(A-y),g=y+1;g<=A;g++)h[g-y-1]=_[g];for(d=numeric.tensor(r,numeric.dot(r,h)),g=y+1;g<=A;g++)for(f=_[g],p=d[g-y-1],x=0;x<b;x++)f[x]-=2*p[x]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var n,r,i,o,a,c,u,s,l,f,m,h,d,p,g,y,x=numeric.toUpperHessenberg(e),v=numeric.QRFrancis(x.H,t),b=numeric.T,_=e.length,w=v.B,k=numeric.dot(v.Q,numeric.dot(x.H,numeric.transpose(v.Q))),M=new b(numeric.dot(v.Q,x.Q)),$=w.length,T=Math.sqrt;for(r=0;r<$;r++)if((n=w[r][0])===w[r][1]);else{if(o=n+1,a=k[n][n],c=k[n][o],u=k[o][n],s=k[o][o],0===c&&0===u)continue;(f=(l=-a-s)*l-4*(a*s-c*u))>=0?((g=(a-(m=l<0?-.5*(l-T(f)):-.5*(l+T(f))))*(a-m)+c*c)>(y=u*u+(s-m)*(s-m))?(d=(a-m)/(g=T(g)),p=c/g):(d=u/(y=T(y)),p=(s-m)/y),i=new b([[p,-d],[d,p]]),M.setRows(n,o,i.dot(M.getRows(n,o)))):(m=-.5*l,h=.5*T(-f),(g=(a-m)*(a-m)+c*c)>(y=u*u+(s-m)*(s-m))?(d=(a-m)/(g=T(g+h*h)),p=c/g,m=0,h/=g):(d=u/(y=T(y+h*h)),p=(s-m)/y,m=h/y,h=0),i=new b([[p,-d],[d,p]],[[m,h],[h,-m]]),M.setRows(n,o,i.dot(M.getRows(n,o))))}var A=M.dot(e).dot(M.transjugate()),j=(_=e.length,numeric.T.identity(_));for(o=0;o<_;o++)if(o>0)for(r=o-1;r>=0;r--){var S=A.get([r,r]),q=A.get([o,o]);numeric.neq(S.x,q.x)||numeric.neq(S.y,q.y)?(m=A.getRow(r).getBlock([r],[o-1]),h=j.getRow(o).getBlock([r],[o-1]),j.set([o,r],A.get([r,o]).neg().sub(m.dot(h)).div(S.sub(q)))):j.setRow(o,j.getRow(r))}for(o=0;o<_;o++)m=j.getRow(o),j.setRow(o,m.div(m.norm2()));return j=j.transpose(),j=M.transjugate().dot(j),{lambda:A.getDiag(),E:j}},numeric.ccsSparse=function(e){var t,n,r,i=e.length,o=[];for(n=i-1;-1!==n;--n)for(r in t=e[n]){for(r=parseInt(r);r>=o.length;)o[o.length]=0;0!==t[r]&&o[r]++}var a=o.length,c=Array(a+1);for(c[0]=0,n=0;n<a;++n)c[n+1]=c[n]+o[n];var u=Array(c[a]),s=Array(c[a]);for(n=i-1;-1!==n;--n)for(r in t=e[n])0!==t[r]&&(o[r]--,u[c[r]+o[r]]=n,s[c[r]+o[r]]=t[r]);return[c,u,s]},numeric.ccsFull=function(e){var t,n,r,i,o=e[0],a=e[1],c=e[2],u=numeric.ccsDim(e),s=u[0],l=u[1],f=numeric.rep([s,l],0);for(t=0;t<l;t++)for(r=o[t],i=o[t+1],n=r;n<i;++n)f[a[n]][t]=c[n];return f},numeric.ccsTSolve=function(e,t,n,r,i){var o,a,c,u,s,l,f,m=e[0],h=e[1],d=e[2],p=m.length-1,g=Math.max,y=0;function x(e){var t;if(0===n[e]){for(n[e]=1,t=m[e];t<m[e+1];++t)x(h[t]);i[y]=e,++y}}for(void 0===r&&(n=numeric.rep([p],0)),void 0===r&&(r=numeric.linspace(0,n.length-1)),void 0===i&&(i=[]),o=r.length-1;-1!==o;--o)x(r[o]);for(i.length=y,o=i.length-1;-1!==o;--o)n[i[o]]=0;for(o=r.length-1;-1!==o;--o)a=r[o],n[a]=t[a];for(o=i.length-1;-1!==o;--o){for(a=i[o],c=m[a],u=g(m[a+1],c),s=c;s!==u;++s)if(h[s]===a){n[a]/=d[s];break}for(f=n[a],s=c;s!==u;++s)(l=h[s])!==a&&(n[l]-=f*d[s])}return n},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,n,r,i,o){var a,c,u,s=0,l=i.length,f=this.k,m=this.k1,h=this.j;if(0===r[e])for(r[e]=1,h[0]=e,f[0]=c=t[e],m[0]=u=t[e+1];;)if(c>=u){if(i[l]=h[s],0===s)return;++l,c=f[--s],u=m[s]}else 0===r[a=o[n[c]]]?(r[a]=1,f[s]=c,h[++s]=a,c=t[a],m[s]=u=t[a+1]):++c},numeric.ccsLPSolve=function(e,t,n,r,i,o,a){var c=e[0],u=e[1],s=e[2];c.length;var l,f,m,h,d,p,g,y,x,v=t[0],b=t[1],_=t[2];for(f=v[i],m=v[i+1],r.length=0,l=f;l<m;++l)a.dfs(o[b[l]],c,u,n,r,o);for(l=r.length-1;-1!==l;--l)n[r[l]]=0;for(l=f;l!==m;++l)n[h=o[b[l]]]=_[l];for(l=r.length-1;-1!==l;--l){for(d=c[h=r[l]],p=c[h+1],g=d;g<p;++g)if(o[u[g]]===h){n[h]/=s[g];break}for(x=n[h],g=d;g<p;++g)(y=o[u[g]])!==h&&(n[y]-=x*s[g])}return n},numeric.ccsLUP1=function(e,t){var n,r,i,o,a,c,u,s=e[0].length-1,l=[numeric.rep([s+1],0),[],[]],f=[numeric.rep([s+1],0),[],[]],m=l[0],h=l[1],d=l[2],p=f[0],g=f[1],y=f[2],x=numeric.rep([s],0),v=numeric.rep([s],0),b=numeric.ccsLPSolve,_=Math.abs,w=numeric.linspace(0,s-1),k=numeric.linspace(0,s-1),M=new numeric.ccsDFS(s);for(void 0===t&&(t=1),n=0;n<s;++n){for(b(l,e,x,v,n,k,M),o=-1,a=-1,r=v.length-1;-1!==r;--r)(i=v[r])<=n||(c=_(x[i]))>o&&(a=i,o=c);for(_(x[n])<t*o&&(r=w[n],o=w[a],w[n]=o,k[o]=n,w[a]=r,k[r]=a,o=x[n],x[n]=x[a],x[a]=o),o=m[n],a=p[n],u=x[n],h[o]=w[n],d[o]=1,++o,r=v.length-1;-1!==r;--r)c=x[i=v[r]],v[r]=0,x[i]=0,i<=n?(g[a]=i,y[a]=c,++a):(h[o]=w[i],d[o]=c/u,++o);m[n+1]=o,p[n+1]=a}for(r=h.length-1;-1!==r;--r)h[r]=k[h[r]];return{L:l,U:f,P:w,Pinv:k}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,n,r,i,o,a){var c,u,s,l=0,f=i.length,m=this.k,h=this.k1,d=this.j;if(0===r[e])for(r[e]=1,d[0]=e,m[0]=u=t[o[e]],h[0]=s=t[o[e]+1];;){if(isNaN(u))throw new Error("Ow!");if(u>=s){if(i[f]=o[d[l]],0===l)return;++f,u=m[--l],s=h[l]}else 0===r[c=n[u]]?(r[c]=1,m[l]=u,d[++l]=c,u=t[c=o[c]],h[l]=s=t[c+1]):++u}},numeric.ccsLPSolve0=function(e,t,n,r,i,o,a,c){var u=e[0],s=e[1],l=e[2];u.length;var f,m,h,d,p,g,y,x,v,b=t[0],_=t[1],w=t[2];for(m=b[i],h=b[i+1],r.length=0,f=m;f<h;++f)c.dfs(_[f],u,s,n,r,o,a);for(f=r.length-1;-1!==f;--f)n[a[d=r[f]]]=0;for(f=m;f!==h;++f)n[d=_[f]]=w[f];for(f=r.length-1;-1!==f;--f){for(x=a[d=r[f]],p=u[d],g=u[d+1],y=p;y<g;++y)if(s[y]===x){n[x]/=l[y];break}for(v=n[x],y=p;y<g;++y)n[s[y]]-=v*l[y];n[x]=v}},numeric.ccsLUP0=function(e,t){var n,r,i,o,a,c,u,s=e[0].length-1,l=[numeric.rep([s+1],0),[],[]],f=[numeric.rep([s+1],0),[],[]],m=l[0],h=l[1],d=l[2],p=f[0],g=f[1],y=f[2],x=numeric.rep([s],0),v=numeric.rep([s],0),b=numeric.ccsLPSolve0,_=Math.abs,w=numeric.linspace(0,s-1),k=numeric.linspace(0,s-1),M=new numeric.ccsDFS0(s);for(void 0===t&&(t=1),n=0;n<s;++n){for(b(l,e,x,v,n,k,w,M),o=-1,a=-1,r=v.length-1;-1!==r;--r)(i=v[r])<=n||(c=_(x[w[i]]))>o&&(a=i,o=c);for(_(x[w[n]])<t*o&&(r=w[n],o=w[a],w[n]=o,k[o]=n,w[a]=r,k[r]=a),o=m[n],a=p[n],u=x[w[n]],h[o]=w[n],d[o]=1,++o,r=v.length-1;-1!==r;--r)c=x[w[i=v[r]]],v[r]=0,x[w[i]]=0,i<=n?(g[a]=i,y[a]=c,++a):(h[o]=w[i],d[o]=c/u,++o);m[n+1]=o,p[n+1]=a}for(r=h.length-1;-1!==r;--r)h[r]=k[h[r]];return{L:l,U:f,P:w,Pinv:k}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,n){var r=numeric.ccsDim(e),i=r[0],o=r[1];void 0===t?t=numeric.linspace(0,i-1):"number"==typeof t&&(t=[t]),void 0===n?n=numeric.linspace(0,o-1):"number"==typeof n&&(n=[n]);var a,c,u,s,l=t.length,f=n.length,m=numeric.rep([o],0),h=[],d=[],p=[m,h,d],g=e[0],y=e[1],x=e[2],v=numeric.rep([i],0),b=0,_=numeric.rep([i],0);for(c=0;c<f;++c){var w=g[s=n[c]],k=g[s+1];for(a=w;a<k;++a)_[u=y[a]]=1,v[u]=x[a];for(a=0;a<l;++a)_[t[a]]&&(h[b]=a,d[b]=v[t[a]],++b);for(a=w;a<k;++a)_[u=y[a]]=0;m[c+1]=b}return p},numeric.ccsDot=function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],c=t[2],u=numeric.ccsDim(e),s=numeric.ccsDim(t),l=u[0];u[1];var f,m,h,d,p,g,y,x,v,b,_,w=s[1],k=numeric.rep([l],0),M=numeric.rep([l],0),$=Array(l),T=numeric.rep([w],0),A=[],j=[],S=[T,A,j];for(h=0;h!==w;++h){for(d=o[h],p=o[h+1],v=0,m=d;m<p;++m)for(b=a[m],_=c[m],g=n[b],y=n[b+1],f=g;f<y;++f)0===M[x=r[f]]&&($[v]=x,M[x]=1,v+=1),k[x]=k[x]+i[f]*_;for(p=(d=T[h])+v,T[h+1]=p,m=v-1;-1!==m;--m)_=d+m,f=$[m],A[_]=f,j[_]=k[f],M[f]=0,k[f]=0;T[h+1]=T[h]+v}return S},numeric.ccsLUPSolve=function(e,t){var n=e.L,r=e.U;e.P;var i=t[0],o=!1;"object"!=typeof i&&(i=(t=[[0,t.length],numeric.linspace(0,t.length-1),t])[0],o=!0);var a,c,u,s,l,f,m=t[1],h=t[2],d=n[0].length-1,p=i.length-1,g=numeric.rep([d],0),y=Array(d),x=numeric.rep([d],0),v=Array(d),b=numeric.rep([p+1],0),_=[],w=[],k=numeric.ccsTSolve,M=0;for(a=0;a<p;++a){for(l=0,u=i[a],s=i[a+1],c=u;c<s;++c)f=e.Pinv[m[c]],v[l]=f,x[f]=h[c],++l;for(v.length=l,k(n,x,g,v,y),c=v.length-1;-1!==c;--c)x[v[c]]=0;if(k(r,g,x,y,v),o)return x;for(c=y.length-1;-1!==c;--c)g[y[c]]=0;for(c=v.length-1;-1!==c;--c)f=v[c],_[M]=f,w[M]=x[f],x[f]=0,++M;b[a+1]=M}return[b,_,w]},numeric.ccsbinop=function(e,t){return void 0===t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,n=e[0],r=e[1],i=e[2],o=numeric.sup(r)+1,a=n.length,c=numeric.rep([o],0),u=Array(a),s=Array(a),l=numeric.rep([o],0);for(t=0;t<a;++t)l[r[t]]++;for(t=0;t<o;++t)c[t+1]=c[t]+l[t];var f,m,h=c.slice(0);for(t=0;t<a;++t)u[f=h[m=r[t]]]=n[t],s[f]=i[t],h[m]=h[m]+1;return[c,u,s]},numeric.ccsGather=function(e){var t,n,r,i,o,a=e[0],c=e[1],u=e[2],s=a.length-1,l=c.length,f=Array(l),m=Array(l),h=Array(l);for(o=0,t=0;t<s;++t)for(r=a[t],i=a[t+1],n=r;n!==i;++n)m[o]=t,f[o]=c[n],h[o]=u[n],++o;return[f,m,h]},numeric.sdim=function e(t,n,r){if(void 0===n&&(n=[]),"object"!=typeof t)return n;var i;for(i in void 0===r&&(r=0),r in n||(n[r]=0),t.length>n[r]&&(n[r]=t.length),t)t.hasOwnProperty(i)&&e(t[i],n,r+1);return n},numeric.sclone=function e(t,n,r){void 0===n&&(n=0),void 0===r&&(r=numeric.sdim(t).length);var i,o=Array(t.length);if(n===r-1){for(i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);return o}for(i in t)t.hasOwnProperty(i)&&(o[i]=e(t[i],n+1,r));return o},numeric.sdiag=function(e){var t,n,r=e.length,i=Array(r);for(t=r-1;t>=1;t-=2)n=t-1,i[t]=[],i[t][t]=e[t],i[n]=[],i[n][n]=e[n];return 0===t&&(i[0]=[],i[0][0]=e[t]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,n,r,i=[];for(t in e.length,e)if(e.hasOwnProperty(t))for(n in r=e[t])r.hasOwnProperty(n)&&("object"!=typeof i[n]&&(i[n]=[]),i[n][t]=r[n]);return i},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var n=e.length;t.length;var r,i,o,a,c,u,s,l=numeric.stranspose(t),f=l.length,m=Array(n);for(o=n-1;o>=0;o--){for(s=[],r=e[o],c=f-1;c>=0;c--){for(a in u=0,i=l[c],r)r.hasOwnProperty(a)&&a in i&&(u+=r[a]*i[a]);u&&(s[c]=u)}m[o]=s}return m},numeric.sdotMV=function(e,t){var n,r,i,o,a=e.length,c=Array(a);for(r=a-1;r>=0;r--){for(i in o=0,n=e[r])n.hasOwnProperty(i)&&t[i]&&(o+=n[i]*t[i]);o&&(c[r]=o)}return c},numeric.sdotVM=function(e,t){var n,r,i,o,a=[];for(n in e)if(e.hasOwnProperty(n))for(r in i=t[n],o=e[n],i)i.hasOwnProperty(r)&&(a[r]||(a[r]=0),a[r]+=o*i[r]);return a},numeric.sdotVV=function(e,t){var n,r=0;for(n in e)e[n]&&t[n]&&(r+=e[n]*t[n]);return r},numeric.sdot=function(e,t){var n=numeric.sdim(e).length,r=numeric.sdim(t).length;switch(1e3*n+r){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+r)}},numeric.sscatter=function(e){var t,n,r,i,o=e[0].length,a=e.length,c=[];for(n=o-1;n>=0;--n)if(e[a-1][n]){for(i=c,r=0;r<a-2;r++)i[t=e[r][n]]||(i[t]=[]),i=i[t];i[e[r][n]]=e[r+1][n]}return c},numeric.sgather=function e(t,n,r){var i,o,a;for(o in void 0===n&&(n=[]),void 0===r&&(r=[]),i=r.length,t)if(t.hasOwnProperty(o))if(r[i]=parseInt(o),"number"==typeof(a=t[o])){if(a){if(0===n.length)for(o=i+1;o>=0;--o)n[o]=[];for(o=i;o>=0;--o)n[o].push(r[o]);n[i+1].push(a)}}else e(a,n,r);return r.length>i&&r.pop(),n},numeric.cLU=function(e){var t,n,r,i,o,a,c=e[0],u=e[1],s=e[2],l=c.length,f=0;for(t=0;t<l;t++)c[t]>f&&(f=c[t]);f++;var m,h=Array(f),d=Array(f),p=numeric.rep([f],1/0),g=numeric.rep([f],-1/0);for(r=0;r<l;r++)t=c[r],(n=u[r])<p[t]&&(p[t]=n),n>g[t]&&(g[t]=n);for(t=0;t<f-1;t++)g[t]>g[t+1]&&(g[t+1]=g[t]);for(t=f-1;t>=1;t--)p[t]<p[t-1]&&(p[t-1]=p[t]);for(t=0;t<f;t++)d[t]=numeric.rep([g[t]-p[t]+1],0),h[t]=numeric.rep([t-p[t]],0),t-p[t]+1,g[t]-t+1;for(r=0;r<l;r++)d[t=c[r]][u[r]-p[t]]=s[r];for(t=0;t<f-1;t++)for(i=t-p[t],v=d[t],n=t+1;p[n]<=t&&n<f;n++)if(o=t-p[n],a=g[t]-t,m=(b=d[n])[o]/v[i]){for(r=1;r<=a;r++)b[r+o]-=m*v[r+i];h[n][t-p[n]]=m}var y,x,v=[],b=[],_=[],w=[],k=[],M=[];for(l=0,y=0,t=0;t<f;t++){for(i=p[t],o=g[t],x=d[t],n=t;n<=o;n++)x[n-i]&&(v[l]=t,b[l]=n,_[l]=x[n-i],l++);for(x=h[t],n=i;n<t;n++)x[n-i]&&(w[y]=t,k[y]=n,M[y]=x[n-i],y++);w[y]=t,k[y]=t,M[y]=1,y++}return{U:[v,b,_],L:[w,k,M]}},numeric.cLUsolve=function(e,t){var n=e.L,r=e.U,i=numeric.clone(t),o=n[0],a=n[1],c=n[2],u=r[0],s=r[1],l=r[2],f=u.length;o.length;var m,h,d=i.length;for(h=0,m=0;m<d;m++){for(;a[h]<m;)i[m]-=c[h]*i[a[h]],h++;h++}for(h=f-1,m=d-1;m>=0;m--){for(;s[h]>m;)i[m]-=l[h]*i[s[h]],h--;i[m]/=l[h],h--}return i},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var n,r,i,o=numeric.rep(e,-1);if("function"!=typeof t)if("L"===t)t=function(t,n){return t>=e[0]/2||n<e[1]/2};else t=function(e,t){return!0};for(i=0,n=1;n<e[0]-1;n++)for(r=1;r<e[1]-1;r++)t(n,r)&&(o[n][r]=i,i++);return o},numeric.cdelsq=function(e){var t,n,r,i,o,a=[[-1,0],[0,-1],[0,1],[1,0]],c=numeric.dim(e),u=c[0],s=c[1],l=[],f=[],m=[];for(t=1;t<u-1;t++)for(n=1;n<s-1;n++)if(!(e[t][n]<0)){for(r=0;r<4;r++)i=t+a[r][0],o=n+a[r][1],e[i][o]<0||(l.push(e[t][n]),f.push(e[i][o]),m.push(-1));l.push(e[t][n]),f.push(e[t][n]),m.push(4)}return[l,f,m]},numeric.cdotMV=function(e,t){var n,r,i,o=e[0],a=e[1],c=e[2],u=o.length;for(i=0,r=0;r<u;r++)o[r]>i&&(i=o[r]);for(i++,n=numeric.rep([i],0),r=0;r<u;r++)n[o[r]]+=c[r]*t[a[r]];return n},numeric.Spline=function(e,t,n,r,i){this.x=e,this.yl=t,this.yr=n,this.kl=r,this.kr=i},numeric.Spline.prototype._at=function(e,t){var n,r,i,o=this.x,a=this.yl,c=this.yr,u=this.kl,s=this.kr,l=numeric.add,f=numeric.sub,m=numeric.mul;n=f(m(u[t],o[t+1]-o[t]),f(c[t+1],a[t])),r=l(m(s[t+1],o[t]-o[t+1]),f(c[t+1],a[t]));var h=(i=(e-o[t])/(o[t+1]-o[t]))*(1-i);return l(l(l(m(1-i,a[t]),m(i,c[t+1])),m(n,h*(1-i))),m(r,h*i))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,n,r,i=this.x,o=i.length,a=Math.floor;for(t=0,n=o-1;n-t>1;)i[r=a((t+n)/2)]<=e?t=r:n=r;return this._at(e,t)}o=e.length;var c,u=Array(o);for(c=o-1;-1!==c;--c)u[c]=this.at(e[c]);return u},numeric.Spline.prototype.diff=function(){var e,t,n,r=this.x,i=this.yl,o=this.yr,a=this.kl,c=this.kr,u=i.length,s=a,l=c,f=Array(u),m=Array(u),h=numeric.add,d=numeric.mul,p=numeric.div,g=numeric.sub;for(e=u-1;-1!==e;--e)t=r[e+1]-r[e],n=g(o[e+1],i[e]),f[e]=p(h(d(n,6),d(a[e],-4*t),d(c[e+1],-2*t)),t*t),m[e+1]=p(h(d(n,-6),d(a[e],2*t),d(c[e+1],4*t)),t*t);return new numeric.Spline(r,s,l,f,m)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],n=this.x,r=this.yl,i=this.yr,o=this.kl,a=this.kr;"number"==typeof r[0]&&(r=[r],i=[i],o=[o],a=[a]);var c,u,s,l,f,m,h,d,p,g,y,x,v,b,_,w,k,M,$,T,A,j,S,q=r.length,P=n.length-1,E=(t=Array(q),Math.sqrt);for(c=0;c!==q;++c){for(l=r[c],f=i[c],m=o[c],h=a[c],d=[],u=0;u!==P;u++){for(u>0&&f[u]*l[u]<0&&d.push(n[u]),w=n[u+1]-n[u],n[u],y=l[u],x=f[u+1],p=m[u]/w,v=(g=h[u+1]/w)+3*y+2*p-3*x,b=3*(g+p+2*(y-x)),(_=e(p-g+3*(y-x))+12*g*y)<=0?k=(M=v/b)>n[u]&&M<n[u+1]?[n[u],M,n[u+1]]:[n[u],n[u+1]]:(M=(v-E(_))/b,$=(v+E(_))/b,k=[n[u]],M>n[u]&&M<n[u+1]&&k.push(M),$>n[u]&&$<n[u+1]&&k.push($),k.push(n[u+1])),A=k[0],M=this._at(A,u),s=0;s<k.length-1;s++)if(j=k[s+1],$=this._at(j,u),0!==M)if(0===$||M*$>0)A=j,M=$;else{for(var L=0;!((S=(M*j-$*A)/(M-$))<=A||S>=j);)if((T=this._at(S,u))*$>0)j=S,$=T,-1===L&&(M*=.5),L=-1;else{if(!(T*M>0))break;A=S,M=T,1===L&&($*=.5),L=1}d.push(S),A=k[s+1],M=this._at(A,u)}else d.push(A),A=j,M=$;0===$&&d.push(j)}t[c]=d}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,n,r){var i,o=e.length,a=[],c=[],u=[],s=numeric.sub,l=numeric.mul,f=numeric.add;for(i=o-2;i>=0;i--)c[i]=e[i+1]-e[i],u[i]=s(t[i+1],t[i]);"string"!=typeof n&&"string"!=typeof r||(n=r="periodic");var m=[[],[],[]];switch(typeof n){case"undefined":a[0]=l(3/(c[0]*c[0]),u[0]),m[0].push(0,0),m[1].push(0,1),m[2].push(2/c[0],1/c[0]);break;case"string":a[0]=f(l(3/(c[o-2]*c[o-2]),u[o-2]),l(3/(c[0]*c[0]),u[0])),m[0].push(0,0,0),m[1].push(o-2,0,1),m[2].push(1/c[o-2],2/c[o-2]+2/c[0],1/c[0]);break;default:a[0]=n,m[0].push(0),m[1].push(0),m[2].push(1)}for(i=1;i<o-1;i++)a[i]=f(l(3/(c[i-1]*c[i-1]),u[i-1]),l(3/(c[i]*c[i]),u[i])),m[0].push(i,i,i),m[1].push(i-1,i,i+1),m[2].push(1/c[i-1],2/c[i-1]+2/c[i],1/c[i]);switch(typeof r){case"undefined":a[o-1]=l(3/(c[o-2]*c[o-2]),u[o-2]),m[0].push(o-1,o-1),m[1].push(o-2,o-1),m[2].push(1/c[o-2],2/c[o-2]);break;case"string":m[1][m[1].length-1]=0;break;default:a[o-1]=r,m[0].push(o-1),m[1].push(o-1),m[2].push(1)}a="number"!=typeof a[0]?numeric.transpose(a):[a];var h=Array(a.length);if("string"==typeof n)for(i=h.length-1;-1!==i;--i)h[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(m)),a[i]),h[i][o-1]=h[i][0];else for(i=h.length-1;-1!==i;--i)h[i]=numeric.cLUsolve(numeric.cLU(m),a[i]);return h="number"==typeof t[0]?h[0]:numeric.transpose(h),new numeric.Spline(e,t,t,h,h)},numeric.fftpow2=function e(t,n){var r=t.length;if(1!==r){var i,o,a=Math.cos,c=Math.sin,u=Array(r/2),s=Array(r/2),l=Array(r/2),f=Array(r/2);for(o=r/2,i=r-1;-1!==i;--i)l[--o]=t[i],f[o]=n[i],--i,u[o]=t[i],s[o]=n[i];e(u,s),e(l,f),o=r/2;var m,h,d,p=-6.283185307179586/r;for(i=r-1;-1!==i;--i)-1===--o&&(o=r/2-1),h=a(m=p*i),d=c(m),t[i]=u[o]+h*l[o]-d*f[o],n[i]=s[o]+h*f[o]+d*l[o]}},numeric._ifftpow2=function e(t,n){var r=t.length;if(1!==r){var i,o,a=Math.cos,c=Math.sin,u=Array(r/2),s=Array(r/2),l=Array(r/2),f=Array(r/2);for(o=r/2,i=r-1;-1!==i;--i)l[--o]=t[i],f[o]=n[i],--i,u[o]=t[i],s[o]=n[i];e(u,s),e(l,f),o=r/2;var m,h,d,p=6.283185307179586/r;for(i=r-1;-1!==i;--i)-1===--o&&(o=r/2-1),h=a(m=p*i),d=c(m),t[i]=u[o]+h*l[o]-d*f[o],n[i]=s[o]+h*f[o]+d*l[o]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,n,r){var i,o,a,c,u;for(numeric.fftpow2(e,t),numeric.fftpow2(n,r),i=e.length-1;-1!==i;--i)o=e[i],c=t[i],a=n[i],u=r[i],e[i]=o*a-c*u,t[i]=o*u+c*a;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,n=this.x,r=this.y,i=n.length,o=Math.log,a=o(2),c=Math.ceil(o(2*i-1)/a),u=Math.pow(2,c),s=numeric.rep([u],0),l=numeric.rep([u],0),f=Math.cos,m=Math.sin,h=-3.141592653589793/i,d=numeric.rep([u],0),p=numeric.rep([u],0);for(e=0;e<i;e++)d[e]=n[e];if(void 0!==r)for(e=0;e<i;e++)p[e]=r[e];for(s[0]=1,e=1;e<=u/2;e++)t=h*e*e,s[e]=f(t),l[e]=m(t),s[u-e]=f(t),l[u-e]=m(t);var g=new numeric.T(d,p),y=new numeric.T(s,l);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),(g=g.mul(y)).x.length=i,g.y.length=i,g},numeric.T.prototype.ifft=function(){var e,t,n=this.x,r=this.y,i=n.length,o=Math.log,a=o(2),c=Math.ceil(o(2*i-1)/a),u=Math.pow(2,c),s=numeric.rep([u],0),l=numeric.rep([u],0),f=Math.cos,m=Math.sin,h=3.141592653589793/i,d=numeric.rep([u],0),p=numeric.rep([u],0);for(e=0;e<i;e++)d[e]=n[e];if(void 0!==r)for(e=0;e<i;e++)p[e]=r[e];for(s[0]=1,e=1;e<=u/2;e++)t=h*e*e,s[e]=f(t),l[e]=m(t),s[u-e]=f(t),l[u-e]=m(t);var g=new numeric.T(d,p),y=new numeric.T(s,l);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),(g=g.mul(y)).x.length=i,g.y.length=i,g.div(i)},numeric.gradient=function(e,t){var n=t.length,r=e(t);if(isNaN(r))throw new Error("gradient: f(x) is a NaN!");var i,o,a,c=Math.max,u=numeric.clone(t),s=Array(n);numeric.div,numeric.sub;c=Math.max;var l,f,m,h,d,p,g=Math.abs,y=Math.min,x=0;for(i=0;i<n;i++)for(var v=c(1e-6*r,1e-8);;){if(++x>20)throw new Error("Numerical gradient fails");if(u[i]=t[i]+v,o=e(u),u[i]=t[i]-v,a=e(u),u[i]=t[i],isNaN(o)||isNaN(a))v/=16;else{if(s[i]=(o-a)/(2*v),l=t[i]-v,f=t[i],m=t[i]+v,h=(o-r)/v,d=(r-a)/v,p=c(g(s[i]),g(r),g(o),g(a),g(l),g(f),g(m),1e-8),!(y(c(g(h-s[i]),g(d-s[i]),g(h-d))/p,v/p)>.001))break;v/=16}}return s},numeric.uncmin=function(e,t,n,r,i,o,a){var c=numeric.gradient;void 0===a&&(a={}),void 0===n&&(n=1e-8),void 0===r&&(r=function(t){return c(e,t)}),void 0===i&&(i=1e3);var u,s,l=(t=numeric.clone(t)).length,f=e(t);if(isNaN(f))throw new Error("uncmin: f(x0) is a NaN!");var m=Math.max,h=numeric.norm2;n=m(n,numeric.epsilon);var d,p,g,y=a.Hinv||numeric.identity(l),x=numeric.dot;numeric.inv;var v,b,_,w,k,M,$,T=numeric.sub,A=numeric.add,j=numeric.tensor,S=numeric.div,q=numeric.mul,P=numeric.all,E=numeric.isFinite,L=numeric.neg,N=0,C="";for(p=r(t);N<i;){if("function"==typeof o&&o(N,t,f,p,y)){C="Callback returned true";break}if(!P(E(p))){C="Gradient has Infinity or NaN";break}if(!P(E(d=L(x(y,p))))){C="Search direction has Infinity or NaN";break}if(($=h(d))<n){C="Newton step smaller than tol";break}for(M=1,s=x(p,d),b=t;N<i&&!(M*$<n)&&(b=A(t,v=q(d,M)),(u=e(b))-f>=.1*M*s||isNaN(u));)M*=.5,++N;if(M*$<n){C="Line search step size smaller than tol";break}if(N===i){C="maxit reached during line search";break}k=x(_=T(g=r(b),p),v),w=x(y,_),y=T(A(y,q((k+x(_,w))/(k*k),j(v,v))),S(A(j(w,v),j(v,w)),k)),t=b,f=u,p=g,++N}return{solution:t,f:f,gradient:p,invHessian:y,iterations:N,message:C}},numeric.Dopri=function(e,t,n,r,i,o,a){this.x=e,this.y=t,this.f=n,this.ymid=r,this.iterations=i,this.events=a,this.message=o},numeric.Dopri.prototype._at=function(e,t){function n(e){return e*e}var r,i,o,a,c,u,s=this,l=s.x,f=s.y,m=s.f,h=s.ymid;l.length;var d,p,g,y=numeric.add,x=numeric.mul,v=numeric.sub;return r=l[t],i=l[t+1],a=f[t],c=f[t+1],o=r+.5*(i-r),u=h[t],d=v(m[t],x(a,1/(r-o)+2/(r-i))),p=v(m[t+1],x(c,1/(i-o)+2/(i-r))),y(y(y(y(x(a,(g=[n(e-i)*(e-o)/n(r-i)/(r-o),n(e-r)*n(e-i)/n(r-o)/n(i-o),n(e-r)*(e-o)/n(i-r)/(i-o),(e-r)*n(e-i)*(e-o)/n(r-i)/(r-o),(e-i)*n(e-r)*(e-o)/n(r-i)/(i-o)])[0]),x(u,g[1])),x(c,g[2])),x(d,g[3])),x(p,g[4]))},numeric.Dopri.prototype.at=function(e){var t,n,r,i=Math.floor;if("number"!=typeof e){var o=e.length,a=Array(o);for(t=o-1;-1!==t;--t)a[t]=this.at(e[t]);return a}var c=this.x;for(t=0,n=c.length-1;n-t>1;)c[r=i(.5*(t+n))]<=e?t=r:n=r;return this._at(e,t)},numeric.dopri=function(e,t,n,r,i,o,a){void 0===i&&(i=1e-6),void 0===o&&(o=1e3);var c,u,s,l,f,m,h,d,p,g,y,x,v,b=[e],_=[n],w=[r(e,n)],k=[],M=[3/40,9/40],$=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],A=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],j=[35/384,0,500/1113,125/192,-2187/6784,11/84],S=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],q=[.2,.3,.8,8/9,1,1],P=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],E=0,L=(t-e)/10,N=0,C=numeric.add,V=numeric.mul,O=Math.min,R=Math.abs,B=numeric.norminf,F=Math.pow,D=numeric.any,I=numeric.lt,z=numeric.and;numeric.sub;var U=new numeric.Dopri(b,_,w,k,-1,"");for("function"==typeof a&&(y=a(e,n));e<t&&N<o;)if(++N,e+L>t&&(L=t-e),c=r(e+q[0]*L,C(n,V(.2*L,w[E]))),u=r(e+q[1]*L,C(C(n,V(M[0]*L,w[E])),V(M[1]*L,c))),s=r(e+q[2]*L,C(C(C(n,V($[0]*L,w[E])),V($[1]*L,c)),V($[2]*L,u))),l=r(e+q[3]*L,C(C(C(C(n,V(T[0]*L,w[E])),V(T[1]*L,c)),V(T[2]*L,u)),V(T[3]*L,s))),f=r(e+q[4]*L,C(C(C(C(C(n,V(A[0]*L,w[E])),V(A[1]*L,c)),V(A[2]*L,u)),V(A[3]*L,s)),V(A[4]*L,l))),m=r(e+L,p=C(C(C(C(C(n,V(w[E],L*j[0])),V(u,L*j[2])),V(s,L*j[3])),V(l,L*j[4])),V(f,L*j[5]))),(g="number"==typeof(h=C(C(C(C(C(V(w[E],L*P[0]),V(u,L*P[2])),V(s,L*P[3])),V(l,L*P[4])),V(f,L*P[5])),V(m,L*P[6])))?R(h):B(h))>i){if(e+(L=.2*L*F(i/g,.25))===e){U.msg="Step size became too small";break}}else{if(k[E]=C(C(C(C(C(C(n,V(w[E],L*S[0])),V(u,L*S[2])),V(s,L*S[3])),V(l,L*S[4])),V(f,L*S[5])),V(m,L*S[6])),b[++E]=e+L,_[E]=p,w[E]=m,"function"==typeof a){var X,Y,H=e,Q=e+.5*L;if(x=a(Q,k[E-1]),D(v=z(I(y,0),I(0,x)))||(H=Q,y=x,x=a(Q=e+L,p),v=z(I(y,0),I(0,x))),D(v)){for(var Z,J,G=0,W=1,K=1;;){if("number"==typeof y)Y=(K*x*H-W*y*Q)/(K*x-W*y);else for(Y=Q,d=y.length-1;-1!==d;--d)y[d]<0&&x[d]>0&&(Y=O(Y,(K*x[d]*H-W*y[d]*Q)/(K*x[d]-W*y[d])));if(Y<=H||Y>=Q)break;J=a(Y,X=U._at(Y,E-1)),D(Z=z(I(y,0),I(0,J)))?(Q=Y,x=J,v=Z,K=1,-1===G?W*=.5:W=1,G=-1):(H=Y,y=J,W=1,1===G?K*=.5:K=1,G=1)}return p=U._at(.5*(e+Y),E-1),U.f[E]=r(Y,X),U.x[E]=Y,U.y[E]=X,U.ymid[E-1]=p,U.events=v,U.iterations=N,U}}e+=L,n=p,y=x,L=O(.8*L*F(i/g,.25),4*L)}return U.iterations=N,U},numeric.LU=function(e,t){t=t||!1;var n,r,i,o,a,c,u,s,l,f=Math.abs,m=e.length,h=m-1,d=new Array(m);for(t||(e=numeric.clone(e)),i=0;i<m;++i){for(u=i,l=f((c=e[i])[i]),r=i+1;r<m;++r)l<(o=f(e[r][i]))&&(l=o,u=r);for(d[i]=u,u!=i&&(e[i]=e[u],e[u]=c,c=e[i]),a=c[i],n=i+1;n<m;++n)e[n][i]/=a;for(n=i+1;n<m;++n){for(s=e[n],r=i+1;r<h;++r)s[r]-=s[i]*c[r],s[++r]-=s[i]*c[r];r===h&&(s[r]-=s[i]*c[r])}}return{LU:e,P:d}},numeric.LUsolve=function(e,t){var n,r,i,o,a,c=e.LU,u=c.length,s=numeric.clone(t),l=e.P;for(n=u-1;-1!==n;--n)s[n]=t[n];for(n=0;n<u;++n)for(i=l[n],l[n]!==n&&(a=s[n],s[n]=s[i],s[i]=a),o=c[n],r=0;r<n;++r)s[n]-=s[r]*o[r];for(n=u-1;n>=0;--n){for(o=c[n],r=n+1;r<u;++r)s[n]-=s[r]*o[r];s[n]/=o[n]}return s},numeric.solve=function(e,t,n){return numeric.LUsolve(numeric.LU(e,n),t)},numeric.echelonize=function(e){var t,n,r,i,o,a,c,u,s=numeric.dim(e),l=s[0],f=s[1],m=numeric.identity(l),h=Array(l),d=Math.abs,p=numeric.diveq;for(e=numeric.clone(e),t=0;t<l;++t){for(r=0,o=e[t],a=m[t],n=1;n<f;++n)d(o[r])<d(o[n])&&(r=n);for(h[t]=r,p(a,o[r]),p(o,o[r]),n=0;n<l;++n)if(n!==t){for(u=(c=e[n])[r],i=f-1;-1!==i;--i)c[i]-=o[i]*u;for(c=m[n],i=l-1;-1!==i;--i)c[i]-=a[i]*u}}return{I:m,A:e,P:h}},numeric.__solveLP=function(e,t,n,r,i,o,a){var c=numeric.sum;numeric.log;var u,s=numeric.mul,l=numeric.sub,f=numeric.dot,m=numeric.div,h=numeric.add,d=e.length,p=n.length,g=!1,y=1;numeric.transpose(t),numeric.svd;var x=numeric.transpose;numeric.leq;var v=Math.sqrt,b=Math.abs;numeric.muleq,numeric.norminf,numeric.any;var _,w=Math.min,k=numeric.all,M=numeric.gt,$=Array(d),T=Array(p);numeric.rep([p],1);var A,j,S=numeric.solve,q=l(n,f(t,o)),P=f(e,e);for(A=0;A<i;++A){var E,L;for(E=p-1;-1!==E;--E)T[E]=m(t[E],q[E]);var N=x(T);for(E=d-1;-1!==E;--E)$[E]=c(N[E]);y=.25*b(P/f(e,$));var C=100*v(P/f($,$));for((!isFinite(y)||y>C)&&(y=C),j=h(e,s(y,$)),_=f(N,T),E=d-1;-1!==E;--E)_[E][E]+=1;L=S(_,m(j,y),!0);var V=m(q,f(t,L)),O=1;for(E=p-1;-1!==E;--E)V[E]<0&&(O=w(O,-.999*V[E]));if(u=l(o,s(L,O)),!k(M(q=l(n,f(t,u)),0)))return{solution:o,message:"",iterations:A};if(o=u,y<r)return{solution:u,message:"",iterations:A};if(a){var R=f(e,j),B=f(t,j);for(g=!0,E=p-1;-1!==E;--E)if(R*B[E]<0){g=!1;break}}else g=!(o[d-1]>=0);if(g)return{solution:u,message:"Unbounded",iterations:A}}return{solution:o,message:"maximum iteration count exceeded",iterations:A}},numeric._solveLP=function(e,t,n,r,i){var o=e.length,a=n.length;numeric.sum,numeric.log,numeric.mul;var c=numeric.sub,u=numeric.dot;numeric.div,numeric.add;var s=numeric.rep([o],0).concat([1]),l=numeric.rep([a,1],-1),f=numeric.blockMatrix([[t,l]]),m=n,h=numeric.rep([o],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),d=numeric.__solveLP(s,f,m,r,i,h,!1),p=numeric.clone(d.solution);if(p.length=o,numeric.inf(c(n,u(t,p)))<0)return{solution:NaN,message:"Infeasible",iterations:d.iterations};var g=numeric.__solveLP(e,t,n,r,i-d.iterations,p,!0);return g.iterations+=d.iterations,g},numeric.solveLP=function(e,t,n,r,i,o,a){if(void 0===a&&(a=1e3),void 0===o&&(o=numeric.epsilon),void 0===r)return numeric._solveLP(e,t,n,o,a);var c,u=r.length,s=r[0].length,l=t.length,f=numeric.echelonize(r),m=numeric.rep([s],0),h=f.P,d=[];for(c=h.length-1;-1!==c;--c)m[h[c]]=1;for(c=s-1;-1!==c;--c)0===m[c]&&d.push(c);var p=numeric.getRange,g=numeric.linspace(0,u-1),y=numeric.linspace(0,l-1),x=p(r,g,d),v=p(t,y,h),b=p(t,y,d),_=numeric.dot,w=numeric.sub,k=_(v,f.I),M=w(b,_(k,x)),$=w(n,_(k,i)),T=Array(h.length),A=Array(d.length);for(c=h.length-1;-1!==c;--c)T[c]=e[h[c]];for(c=d.length-1;-1!==c;--c)A[c]=e[d[c]];var j=w(A,_(T,_(f.I,x))),S=numeric._solveLP(j,M,$,o,a),q=S.solution;if(q!=q)return S;var P=_(f.I,w(i,_(x,q))),E=Array(e.length);for(c=h.length-1;-1!==c;--c)E[h[c]]=P[c];for(c=d.length-1;-1!==c;--c)E[d[c]]=q[c];return{solution:E,message:S.message,iterations:S.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var t,n,r,i,o=0,a=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],c=e.length,u=0,s={},l=[],f=0,m={},h=0,d=[],p=[],g=[];function y(n){throw new Error("MPStoLP: "+n+"\nLine "+t+": "+e[t]+"\nCurrent state: "+a[o]+"\n")}for(t=0;t<c;++t){var x=(r=e[t]).match(/\S*/g),v=[];for(n=0;n<x.length;++n)""!==x[n]&&v.push(x[n]);if(0!==v.length){for(n=0;n<a.length&&r.substr(0,a[n].length)!==a[n];++n);if(n<a.length){if(o=n,1===n&&(i=v[1]),6===n)return{name:i,c:d,A:numeric.transpose(p),b:g,rows:s,vars:m}}else switch(o){case 0:case 1:y("Unexpected line");case 2:switch(v[0]){case"N":0===u?u=v[1]:y("Two or more N rows");break;case"L":s[v[1]]=f,l[f]=1,g[f]=0,++f;break;case"G":s[v[1]]=f,l[f]=-1,g[f]=0,++f;break;case"E":s[v[1]]=f,l[f]=0,g[f]=0,++f;break;default:y("Parse error "+numeric.prettyPrint(v))}break;case 3:m.hasOwnProperty(v[0])||(m[v[0]]=h,d[h]=0,p[h]=numeric.rep([f],0),++h);var b=m[v[0]];for(n=1;n<v.length;n+=2)if(v[n]!==u){var _=s[v[n]];p[b][_]=(l[_]<0?-1:1)*parseFloat(v[n+1])}else d[b]=parseFloat(v[n+1]);break;case 4:for(n=1;n<v.length;n+=2)g[s[v[n]]]=(l[s[v[n]]]<0?-1:1)*parseFloat(v[n+1]);break;case 5:break;case 6:y("Internal error")}}}y("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,n,r,i,o,a){function c(e){var t,r,i=this,o=e.length,a=0,c=i.i=i.j=i.m=0;for(i.S=[],i.c=[],o||(e=[o++]);a<n;)i.S[a]=a++;for(a=0;a<n;a++)c=l(c+(t=i.S[a])+e[a%o]),r=i.S[c],i.S[a]=r,i.S[c]=t;i.g=function(e){var t=i.S,r=l(i.i+1),o=t[r],a=l(i.j+o),c=t[a];t[r]=c,t[a]=o;for(var u=t[l(o+c)];--e;)r=l(r+1),c=t[a=l(a+(o=t[r]))],t[r]=c,t[a]=o,u=u*n+t[l(o+c)];return i.i=r,i.j=a,u},i.g(n)}function u(e,t,n,r,i){if(n=[],i=typeof e,t&&"object"==i)for(r in e)if(r.indexOf("S")<5)try{n.push(u(e[r],t-1))}catch(e){}return n.length?n:e+("string"!=i?"\0":"")}function s(e,t,n,r){for(e+="",n=0,r=0;r<e.length;r++)t[l(r)]=l((n^=19*t[l(r)])+e.charCodeAt(r));for(r in e="",t)e+=String.fromCharCode(t[r]);return e}function l(e){return 255&e}t.seedrandom=function(r,l){var f,m=[];return r=s(u(l?[r,e]:arguments.length?r:[(new Date).getTime(),e,window],3),m),s((f=new c(m)).S,e),t.random=function(){for(var e=f.g(6),t=a,r=0;e<i;)e=(e+r)*n,t*=n,r=f.g(1);for(;e>=o;)e/=2,t/=2,r>>>=1;return(e+r)/t},r},a=t.pow(n,6),i=t.pow(2,i),o=2*i,s(t.random(),e)}([],numeric.seedrandom,256,0,52),function(e){function t(e){if("object"!=typeof e)return e;var n,r=[],i=e.length;for(n=0;n<i;n++)r[n+1]=t(e[n]);return r}function n(e){if("object"!=typeof e)return e;var t,r=[],i=e.length;for(t=1;t<i;t++)r[t-1]=n(e[t]);return r}function r(e,t,n,r,i,o,a,c,u,s,l,f,m,h,d,p){var g,y,x,v,b,_,w,k,M,$,T,A,j,S,q,P,E,L,N,C,V,O,R,B,F,D,I;j=Math.min(r,s),x=2*r+j*(j+5)/2+2*s+1,B=1e-60;do{F=1+.1*(B+=B),D=1+.2*B}while(F<=1||D<=1);for(g=1;g<=r;g+=1)d[g]=t[g];for(g=r+1;g<=x;g+=1)d[g]=0;for(g=1;g<=s;g+=1)f[g]=0;if(b=[],0===p[1]){if(function(e,t,n,r){var i,o,a,c,u,s;for(o=1;o<=n;o+=1){if(r[1]=o,s=0,(a=o-1)<1){if((s=e[o][o]-s)<=0)break;e[o][o]=Math.sqrt(s)}else{for(c=1;c<=a;c+=1){for(u=e[c][o],i=1;i<c;i+=1)u-=e[i][o]*e[i][c];u/=e[c][c],e[c][o]=u,s+=u*u}if((s=e[o][o]-s)<=0)break;e[o][o]=Math.sqrt(s)}r[1]=0}}(e,0,r,b),0!==b[1])return void(p[1]=2);!function(e,t,n,r){var i,o,a,c;for(o=1;o<=n;o+=1){for(c=0,i=1;i<o;i+=1)c+=e[i][o]*r[i];r[o]=(r[o]-c)/e[o][o]}for(a=1;a<=n;a+=1)for(r[o=n+1-a]=r[o]/e[o][o],c=-r[o],i=1;i<o;i+=1)r[i]=r[i]+c*e[i][o]}(e,0,r,t),function(e,t,n){var r,i,o,a,c;for(o=1;o<=n;o+=1){for(e[o][o]=1/e[o][o],c=-e[o][o],r=1;r<o;r+=1)e[r][o]=c*e[r][o];if(n<(a=o+1))break;for(i=a;i<=n;i+=1)for(c=e[o][i],e[o][i]=0,r=1;r<=o;r+=1)e[r][i]=e[r][i]+c*e[r][o]}}(e,0,r)}else{for(y=1;y<=r;y+=1)for(i[y]=0,g=1;g<=y;g+=1)i[y]=i[y]+e[g][y]*t[g];for(y=1;y<=r;y+=1)for(t[y]=0,g=y;g<=r;g+=1)t[y]=t[y]+e[y][g]*i[g]}for(o[1]=0,y=1;y<=r;y+=1)for(i[y]=t[y],o[1]=o[1]+d[y]*i[y],d[y]=0,g=y+1;g<=r;g+=1)e[g][y]=0;for(o[1]=-o[1]/2,p[1]=0,S=($=(M=(T=(k=(w=r)+r)+j)+j+1)+j*(j+1)/2)+s,g=1;g<=s;g+=1){for(P=0,y=1;y<=r;y+=1)P+=a[y][g]*a[y][g];d[S+g]=Math.sqrt(P)}function z(){for(h[1]=h[1]+1,x=$,g=1;g<=s;g+=1){for(x+=1,P=-c[g],y=1;y<=r;y+=1)P+=a[y][g]*i[y];if(Math.abs(P)<B&&(P=0),g>l)d[x]=P;else if(d[x]=-Math.abs(P),P>0){for(y=1;y<=r;y+=1)a[y][g]=-a[y][g];c[g]=-c[g]}}for(g=1;g<=m;g+=1)d[$+f[g]]=0;for(A=0,q=0,g=1;g<=s;g+=1)d[$+g]<q*d[S+g]&&(A=g,q=d[$+g]/d[S+g]);return 0===A?999:0}function U(){for(g=1;g<=r;g+=1){for(P=0,y=1;y<=r;y+=1)P+=e[y][g]*a[y][A];d[g]=P}for(v=w,g=1;g<=r;g+=1)d[v+g]=0;for(y=m+1;y<=r;y+=1)for(g=1;g<=r;g+=1)d[v+g]=d[v+g]+e[g][y]*d[y];for(O=!0,g=m;g>=1;g-=1){for(P=d[g],v=(x=M+g*(g+3)/2)-g,y=g+1;y<=m;y+=1)P-=d[x]*d[k+y],x+=y;if(P/=d[v],d[k+g]=P,f[g]<l)break;if(P<0)break;O=!1,_=g}if(!O)for(E=d[T+_]/d[k+_],g=1;g<=m&&!(f[g]<l)&&!(d[k+g]<0);g+=1)(q=d[T+g]/d[k+g])<E&&(E=q,_=g);for(P=0,g=w+1;g<=w+r;g+=1)P+=d[g]*d[g];if(Math.abs(P)<=B){if(O)return p[1]=1,999;for(g=1;g<=m;g+=1)d[T+g]=d[T+g]-E*d[k+g];return d[T+m+1]=d[T+m+1]+E,700}for(P=0,g=1;g<=r;g+=1)P+=d[w+g]*a[g][A];for(L=-d[$+A]/P,R=!0,O||E<L&&(L=E,R=!1),g=1;g<=r;g+=1)i[g]=i[g]+L*d[w+g],Math.abs(i[g])<B&&(i[g]=0);for(o[1]=o[1]+L*P*(L/2+d[T+m+1]),g=1;g<=m;g+=1)d[T+g]=d[T+g]-L*d[k+g];if(d[T+m+1]=d[T+m+1]+L,!R){for(P=-c[A],y=1;y<=r;y+=1)P+=i[y]*a[y][A];if(A>l)d[$+A]=P;else if(d[$+A]=-Math.abs(P),P>0){for(y=1;y<=r;y+=1)a[y][A]=-a[y][A];c[A]=-c[A]}return 700}for(f[m+=1]=A,x=M+(m-1)*m/2+1,g=1;g<=m-1;g+=1)d[x]=d[g],x+=1;if(m===r)d[x]=d[r];else{for(g=r;g>=m+1&&0!==d[g]&&(N=Math.max(Math.abs(d[g-1]),Math.abs(d[g])),C=Math.min(Math.abs(d[g-1]),Math.abs(d[g])),q=d[g-1]>=0?Math.abs(N*Math.sqrt(1+C*C/(N*N))):-Math.abs(N*Math.sqrt(1+C*C/(N*N))),N=d[g-1]/q,C=d[g]/q,1!==N);g-=1)if(0===N)for(d[g-1]=C*q,y=1;y<=r;y+=1)q=e[y][g-1],e[y][g-1]=e[y][g],e[y][g]=q;else for(d[g-1]=q,V=C/(1+N),y=1;y<=r;y+=1)q=N*e[y][g-1]+C*e[y][g],e[y][g]=V*(e[y][g-1]+q)-e[y][g],e[y][g-1]=q;d[x]=d[m]}return 0}function X(){if(0===d[v=(x=M+_*(_+1)/2+1)+_])return 798;if(N=Math.max(Math.abs(d[v-1]),Math.abs(d[v])),C=Math.min(Math.abs(d[v-1]),Math.abs(d[v])),q=d[v-1]>=0?Math.abs(N*Math.sqrt(1+C*C/(N*N))):-Math.abs(N*Math.sqrt(1+C*C/(N*N))),N=d[v-1]/q,C=d[v]/q,1===N)return 798;if(0===N){for(g=_+1;g<=m;g+=1)q=d[v-1],d[v-1]=d[v],d[v]=q,v+=g;for(g=1;g<=r;g+=1)q=e[g][_],e[g][_]=e[g][_+1],e[g][_+1]=q}else{for(V=C/(1+N),g=_+1;g<=m;g+=1)q=N*d[v-1]+C*d[v],d[v]=V*(d[v-1]+q)-d[v],d[v-1]=q,v+=g;for(g=1;g<=r;g+=1)q=N*e[g][_]+C*e[g][_+1],e[g][_+1]=V*(e[g][_]+q)-e[g][_+1],e[g][_]=q}return 0}function Y(){for(v=x-_,g=1;g<=_;g+=1)d[v]=d[x],x+=1,v+=1;return d[T+_]=d[T+_+1],f[_]=f[_+1],(_+=1)<m?797:0}function H(){return d[T+m]=d[T+m+1],d[T+m+1]=0,f[m]=0,m-=1,h[2]=h[2]+1,0}for(m=0,h[1]=0,h[2]=0,I=0;;){if(999===(I=z()))return;for(;0!==(I=U());){if(999===I)return;if(700===I)if(_===m)H();else{for(;X(),797===(I=Y()););H()}}}}e.solveQP=function(e,i,o,a,c,u){e=t(e),i=t(i),o=t(o);var s,l,f,m,h,d=[],p=[],g=[],y=[],x=[];if(c=c||0,u=u?t(u):[void 0,0],a=a?t(a):[],l=e.length-1,f=o[1].length-1,!a)for(s=1;s<=f;s+=1)a[s]=0;for(s=1;s<=f;s+=1)p[s]=0;for(m=Math.min(l,f),s=1;s<=l;s+=1)g[s]=0;for(d[1]=0,s=1;s<=2*l+m*(m+5)/2+2*f+1;s+=1)y[s]=0;for(s=1;s<=2;s+=1)x[s]=0;return r(e,i,0,l,g,d,o,a,0,f,c,p,0,x,y,u),h="",1===u[1]&&(h="constraints are inconsistent, no solution!"),2===u[1]&&(h="matrix D in quadratic function is not positive definite!"),{solution:n(g),value:n(d),unconstrained_solution:n(i),iterations:n(x),iact:n(p),message:h}}}(numeric),numeric.svd=function(e){var t,n=numeric.epsilon,r=1e-64/n,i=0,o=0,a=0,c=0,u=0,s=numeric.clone(e),l=s.length,f=s[0].length;if(l<f)throw"Need more rows than columns";var m=new Array(f),h=new Array(f);for(o=0;o<f;o++)m[o]=h[o]=0;var d=numeric.rep([f,f],0);function p(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var g=0,y=0,x=0,v=0,b=0,_=0,w=0;for(o=0;o<f;o++){for(m[o]=y,w=0,u=o+1,a=o;a<l;a++)w+=s[a][o]*s[a][o];if(w<=r)y=0;else for(g=s[o][o],y=Math.sqrt(w),g>=0&&(y=-y),x=g*y-w,s[o][o]=g-y,a=u;a<f;a++){for(w=0,c=o;c<l;c++)w+=s[c][o]*s[c][a];for(g=w/x,c=o;c<l;c++)s[c][a]+=g*s[c][o]}for(h[o]=y,w=0,a=u;a<f;a++)w+=s[o][a]*s[o][a];if(w<=r)y=0;else{for(g=s[o][o+1],y=Math.sqrt(w),g>=0&&(y=-y),x=g*y-w,s[o][o+1]=g-y,a=u;a<f;a++)m[a]=s[o][a]/x;for(a=u;a<l;a++){for(w=0,c=u;c<f;c++)w+=s[a][c]*s[o][c];for(c=u;c<f;c++)s[a][c]+=w*m[c]}}(b=Math.abs(h[o])+Math.abs(m[o]))>v&&(v=b)}for(o=f-1;-1!=o;o+=-1){if(0!=y){for(x=y*s[o][o+1],a=u;a<f;a++)d[a][o]=s[o][a]/x;for(a=u;a<f;a++){for(w=0,c=u;c<f;c++)w+=s[o][c]*d[c][a];for(c=u;c<f;c++)d[c][a]+=w*d[c][o]}}for(a=u;a<f;a++)d[o][a]=0,d[a][o]=0;d[o][o]=1,y=m[o],u=o}for(o=f-1;-1!=o;o+=-1){for(u=o+1,y=h[o],a=u;a<f;a++)s[o][a]=0;if(0!=y){for(x=s[o][o]*y,a=u;a<f;a++){for(w=0,c=u;c<l;c++)w+=s[c][o]*s[c][a];for(g=w/x,c=o;c<l;c++)s[c][a]+=g*s[c][o]}for(a=o;a<l;a++)s[a][o]=s[a][o]/y}else for(a=o;a<l;a++)s[a][o]=0;s[o][o]+=1}for(n*=v,c=f-1;-1!=c;c+=-1)for(var k=0;k<50;k++){var M=!1;for(u=c;-1!=u;u+=-1){if(Math.abs(m[u])<=n){M=!0;break}if(Math.abs(h[u-1])<=n)break}if(!M){i=0,w=1;var $=u-1;for(o=u;o<c+1&&(g=w*m[o],m[o]=i*m[o],!(Math.abs(g)<=n));o++)for(x=p(g,y=h[o]),h[o]=x,i=y/x,w=-g/x,a=0;a<l;a++)b=s[a][$],_=s[a][o],s[a][$]=b*i+_*w,s[a][o]=-b*w+_*i}if(_=h[c],u==c){if(_<0)for(h[c]=-_,a=0;a<f;a++)d[a][c]=-d[a][c];break}if(k>=49)throw"Error: no convergence.";for(v=h[u],y=p(g=(((b=h[c-1])-_)*(b+_)+((y=m[c-1])-(x=m[c]))*(y+x))/(2*x*b),1),g=g<0?((v-_)*(v+_)+x*(b/(g-y)-x))/v:((v-_)*(v+_)+x*(b/(g+y)-x))/v,i=1,w=1,o=u+1;o<c+1;o++){for(y=m[o],b=h[o],x=w*y,y*=i,_=p(g,x),m[o-1]=_,g=v*(i=g/_)+y*(w=x/_),y=-v*w+y*i,x=b*w,b*=i,a=0;a<f;a++)v=d[a][o-1],_=d[a][o],d[a][o-1]=v*i+_*w,d[a][o]=-v*w+_*i;for(_=p(g,x),h[o-1]=_,g=(i=g/_)*y+(w=x/_)*b,v=-w*y+i*b,a=0;a<l;a++)b=s[a][o-1],_=s[a][o],s[a][o-1]=b*i+_*w,s[a][o]=-b*w+_*i}m[u]=0,m[c]=g,h[c]=v}for(o=0;o<h.length;o++)h[o]<n&&(h[o]=0);for(o=0;o<f;o++)for(a=o-1;a>=0;a--)if(h[a]<h[o]){for(i=h[a],h[a]=h[o],h[o]=i,c=0;c<s.length;c++)t=s[c][o],s[c][o]=s[c][a],s[c][a]=t;for(c=0;c<d.length;c++)t=d[c][o],d[c][o]=d[c][a],d[c][a]=t;o=a}return{U:s,S:h,V:d}}}));function get_each_context$1(e,t,n){const r=e.slice();return r[15]=t[n].x,r[16]=t[n].y,r[18]=n,r}function create_each_block$1(e){let t,n,r;function i(){return e[7](e[18])}return{c(){t=element("div"),attr(t,"class","corner"),set_style(t,"left",e[15]-5+"px"),set_style(t,"top",e[16]-5+"px")},m(e,o){insert(e,t,o),n||(r=listen(t,"mousedown",i),n=!0)},p(n,r){e=n,2&r&&set_style(t,"left",e[15]-5+"px"),2&r&&set_style(t,"top",e[16]-5+"px")},d(e){e&&detach(t),n=!1,r()}}}function create_fragment$2(e){let t,n,r,i,o,a,c,u,s=e[1],l=[];for(let t=0;t<s.length;t+=1)l[t]=create_each_block$1(get_each_context$1(e,s,t));return{c(){t=element("div"),n=element("img"),i=space();for(let e=0;e<l.length;e+=1)l[e].c();o=space(),a=element("input"),this.c=noop,src_url_equal(n.src,r="example.webp")||attr(n,"src","example.webp"),attr(n,"alt","Distorted Image"),set_style(n,"transform",e[3]),attr(t,"class","container"),attr(a,"type","range"),attr(a,"min","0"),attr(a,"max","360"),set_style(a,"margin-top","200px")},m(r,s){insert(r,t,s),append(t,n),append(t,i);for(let e=0;e<l.length;e+=1)l[e]&&l[e].m(t,null);e[8](t),insert(r,o,s),insert(r,a,s),set_input_value(a,e[0]),c||(u=[listen(t,"mousemove",e[6]),listen(t,"mouseup",e[5]),listen(a,"change",e[9]),listen(a,"input",e[9])],c=!0)},p(e,[r]){if(8&r&&set_style(n,"transform",e[3]),18&r){let n;for(s=e[1],n=0;n<s.length;n+=1){const i=get_each_context$1(e,s,n);l[n]?l[n].p(i,r):(l[n]=create_each_block$1(i),l[n].c(),l[n].m(t,null))}for(;n<l.length;n+=1)l[n].d(1);l.length=s.length}1&r&&set_input_value(a,e[0])},i:noop,o:noop,d(n){n&&detach(t),destroy_each(l,n),e[8](null),n&&detach(o),n&&detach(a),c=!1,run_all(u)}}}function instance$2(e,t,n){let r,i=0,o=[{x:0,y:0},{x:400,y:0},{x:400,y:300},{x:0,y:300}],a=[...o],c=!1,u=null,s="";function l(e,t){c=!0,u=e}function f(){const e=function(e,t,n){const r=Math.PI/180*n,i=Math.cos(r),o=Math.sin(r),a=e.map((({x:e,y:t})=>{const n=e-200,r=t-150;return{x:n*i-r*o+200,y:n*o+r*i+150}})),c=[];for(let e=0;e<8;e++)c[e]=[];for(let e=0;e<4;e++)c[e][0]=c[e+4][3]=a[e].x,c[e][1]=c[e+4][4]=a[e].y,c[e][2]=c[e+4][5]=1,c[e][3]=c[e][4]=c[e][5]=0,c[e+4][0]=c[e+4][1]=c[e+4][2]=0,c[e][6]=-a[e].x*t[e].x,c[e][7]=-a[e].y*t[e].x,c[e+4][6]=-a[e].x*t[e].y,c[e+4][7]=-a[e].y*t[e].y;const u=[t[0].x,t[1].x,t[2].x,t[3].x,t[0].y,t[1].y,t[2].y,t[3].y],s=numeric1_2_6.solve(c,u).concat(1);return`matrix3d(${s[0]}, ${s[3]}, 0, ${s[6]}, ${s[1]}, ${s[4]}, 0, ${s[7]}, 0, 0, 1, 0, ${s[2]}, ${s[5]}, 0, 1)`}(o,a,i);n(3,s=e)}return e.$$.update=()=>{1&e.$$.dirty&&i&&f()},[i,a,r,s,l,function(){c=!1,u=null},function(e){if(!c||null===u)return;const t=r.getBoundingClientRect(),i=e.clientX-t.left,o=e.clientY-t.top;n(1,a=a.map(((e,t)=>t===u?{x:i,y:o}:e))),f()},e=>l(e),function(e){binding_callbacks[e?"unshift":"push"]((()=>{r=e,n(2,r)}))},function(){i=to_number(this.value),n(0,i)}]}class Test2 extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent=".container{position:relative;width:400px;height:300px;perspective:1000px;border:2px solid black;user-select:none}img{position:absolute;top:0;left:0;width:100%;height:100%;transform-origin:top left;user-select:none}.corner{position:absolute;width:10px;height:10px;background-color:red;border-radius:50%;cursor:pointer;user-select:none}",this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$2,create_fragment$2,safe_not_equal,{},null),e&&e.target&&insert(e.target,this,e.anchor)}}function clickOutside(e){const t=t=>{!e||e.contains(t.target)||t.defaultPrevented||e.dispatchEvent(new CustomEvent("click_outside",e))};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function create_if_block_1$1(e){let t,n,r,i;return{c(){t=element("div"),n=element("fds-image-editor-button"),n.textContent="Coordinates",set_custom_element_data(n,"type","button"),set_style(t,"display","flex"),set_style(t,"align-items","center")},m(o,a){insert(o,t,a),append(t,n),r||(i=listen(n,"click",e[4]),r=!0)},p:noop,d(e){e&&detach(t),r=!1,i()}}}function create_if_block$1(e){let t,n,r,i,o,a,c,u,s,l,f,m,h,d,p,g,y,x,v,b,_,w,k,M,$,T,A,j,S,q,P,E,L;return{c(){t=element("div"),n=element("div"),r=element("div"),i=element("label"),i.textContent="x:",o=space(),a=element("input"),u=space(),s=element("div"),l=element("label"),l.textContent="y:",f=space(),m=element("input"),d=space(),p=element("div"),g=element("label"),g.textContent="width:",y=space(),x=element("input"),b=space(),_=element("div"),w=element("label"),w.textContent="height:",k=space(),M=element("input"),T=space(),A=element("div"),j=element("label"),j.textContent="rotation:",S=space(),q=element("input"),attr(i,"for","x"),attr(i,"class","more-label svelte-135lqg4"),a.value=c=e[0].x,attr(a,"type","text"),attr(a,"class","formInput svelte-135lqg4"),attr(a,"placeholder",""),set_style(a,"font-size","12px"),set_style(a,"width","220px"),set_style(a,"display","inline-block"),attr(r,"class","formLine svelte-135lqg4"),attr(l,"for","y"),attr(l,"class","more-label svelte-135lqg4"),m.value=h=e[0].y,attr(m,"type","text"),attr(m,"class","formInput svelte-135lqg4"),attr(m,"placeholder",""),set_style(m,"font-size","12px"),set_style(m,"width","220px"),set_style(m,"display","inline-block"),attr(s,"class","formLine svelte-135lqg4"),attr(g,"for","width"),attr(g,"class","more-label svelte-135lqg4"),x.value=v=e[0].width,attr(x,"type","text"),attr(x,"class","formInput svelte-135lqg4"),attr(x,"placeholder",""),set_style(x,"font-size","12px"),set_style(x,"width","220px"),set_style(x,"display","inline-block"),attr(p,"class","formLine svelte-135lqg4"),attr(w,"for","height"),attr(w,"class","more-label svelte-135lqg4"),M.value=$=e[0].height,attr(M,"type","text"),attr(M,"class","formInput svelte-135lqg4"),attr(M,"placeholder",""),set_style(M,"font-size","12px"),set_style(M,"width","220px"),set_style(M,"display","inline-block"),attr(_,"class","formLine svelte-135lqg4"),attr(j,"for","rotation"),attr(j,"class","more-label svelte-135lqg4"),q.value=P=180*e[0].rotation/Math.PI,attr(q,"type","text"),attr(q,"class","formInput svelte-135lqg4"),attr(q,"placeholder",""),set_style(q,"font-size","12px"),set_style(q,"width","220px"),set_style(q,"display","inline-block"),attr(A,"class","formLine svelte-135lqg4"),attr(n,"class","formLine"),attr(t,"class","editcoord")},m(c,h){insert(c,t,h),append(t,n),append(n,r),append(r,i),append(r,o),append(r,a),append(n,u),append(n,s),append(s,l),append(s,f),append(s,m),append(n,d),append(n,p),append(p,g),append(p,y),append(p,x),append(n,b),append(n,_),append(_,w),append(_,k),append(_,M),append(n,T),append(n,A),append(A,j),append(A,S),append(A,q),E||(L=[listen(a,"change",e[5]),listen(m,"change",e[6]),listen(x,"change",e[7]),listen(M,"change",e[8]),listen(q,"change",e[9]),action_destroyer(clickOutside.call(null,t)),listen(t,"click_outside",handleClickOutside)],E=!0)},p(e,t){1&t&&c!==(c=e[0].x)&&a.value!==c&&(a.value=c),1&t&&h!==(h=e[0].y)&&m.value!==h&&(m.value=h),1&t&&v!==(v=e[0].width)&&x.value!==v&&(x.value=v),1&t&&$!==($=e[0].height)&&M.value!==$&&(M.value=$),1&t&&P!==(P=180*e[0].rotation/Math.PI)&&q.value!==P&&(q.value=P)},d(e){e&&detach(t),E=!1,run_all(L)}}}function create_fragment$1(e){let t,n,r=e[0]&&create_if_block_1$1(e),i=e[1]&&e[0]&&create_if_block$1(e);return{c(){t=element("div"),r&&r.c(),n=space(),i&&i.c(),this.c=noop,attr(t,"class","show"),set_style(t,"display","inline-block")},m(e,o){insert(e,t,o),r&&r.m(t,null),append(t,n),i&&i.m(t,null)},p(e,[o]){e[0]?r?r.p(e,o):(r=create_if_block_1$1(e),r.c(),r.m(t,n)):r&&(r.d(1),r=null),e[1]&&e[0]?i?i.p(e,o):(i=create_if_block$1(e),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i:noop,o:noop,d(e){e&&detach(t),r&&r.d(),i&&i.d()}}}function handleClickOutside(){}function instance$1(e,t,n){let r=get_current_component().$$.root.host,{coordinates:i={x:0,y:0,width:0,height:0,rotation:0}}=t;function o(e,t){r.dispatchEvent(new CustomEvent("change",{detail:{name:e,value:t}}))}let{editcoord:a}=t;return e.$$set=e=>{"coordinates"in e&&n(0,i=e.coordinates),"editcoord"in e&&n(1,a=e.editcoord)},[i,a,o,function(){n(0,i)},()=>{n(1,a=!a),o("editcoord",a)},e=>{n(0,i.x=e.target.value,i),n(0,i),o("x",e.target.value)},e=>{n(0,i.y=e.target.value,i),n(0,i),o("y",e.target.value)},e=>{n(0,i.width=e.target.value,i),n(0,i),o("width",e.target.value)},e=>{n(0,i.height=e.target.value,i),n(0,i),o("height",e.target.value)},e=>{n(0,i.rotation=e.target.value,i),n(0,i),o("rotation",parseInt(e.target.value)*(Math.PI/180))}]}customElements.define("fds-image-transform-test2",Test2);class Dialog extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent='*{box-sizing:border-box}.editcoord{min-width:330px;min-height:100px;box-shadow:0 0 1rem 0 rgba(255, 255, 255, .2);border-radius:8px;background-color:rgba(0, 0, 0, .65);backdrop-filter:blur(10px);color:rgba(255, 255, 255, 0.6);position:absolute;left:0px;top:50px;padding:14px;font-family:"Segoe UI", Roboto, system-ui;z-index:2000}.formLine{displaY:block;margin-bottom:20px}.formInput{width:100%;outline:0;border:0;border-bottom:2px solid rgba(255, 255, 255, 0.2);padding:5px;font-size:14px;font-weight:normal;border-radius:3px;color:rgba(255, 255, 255, 0.9);margin-bottom:10px;display:block;background:none;font-family:system-ui, "Segoe UI", Roboto}.formInput::placeholder{font-weight:normal;opacity:0.5;color:rgba(255, 255, 255, 0.7)}.formLine{margin-bottom:5px}.show{display:block}',this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$1,create_fragment$1,safe_not_equal,{coordinates:0,editcoord:1,refresh:3},null),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["coordinates","editcoord","refresh"]}get coordinates(){return this.$$.ctx[0]}set coordinates(e){this.$$set({coordinates:e}),flush()}get editcoord(){return this.$$.ctx[1]}set editcoord(e){this.$$set({editcoord:e}),flush()}get refresh(){return this.$$.ctx[3]}}customElements.define("fds-coord-dialog",Dialog);const{window:window_1}=globals;function get_each_context(e,t,n){const r=e.slice();return r[77]=t[n],r}function create_if_block(e){let t,n,r,i,o,a,c,u,s,l,f,m,h,d,p,g,y,x,v,b,_,w;function k(e,t){return e[2]?create_if_block_4:create_else_block}let M=k(e),$=M(e),T=e[5]&&create_if_block_2(e),A=e[4]&&create_if_block_1(),j=e[11],S=[];for(let t=0;t<j.length;t+=1)S[t]=create_each_block(get_each_context(e,j,t));return{c(){t=element("div"),n=element("div"),r=element("div"),$.c(),i=space(),o=element("div"),o.innerHTML="<slot></slot>",a=space(),c=element("div"),u=element("div"),u.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',s=space(),l=element("div"),l.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',f=space(),m=element("div"),m.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',h=space(),d=element("div"),d.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',p=space(),T&&T.c(),y=space(),x=element("div"),v=space(),A&&A.c(),b=space();for(let e=0;e<S.length;e+=1)S[e].c();attr(r,"class","contents"),set_style(r,"opacity",e[0].opacity/100),set_style(o,"width","80px"),set_style(o,"height","50px"),set_style(o,"position","sticky"),set_style(o,"z-index","5"),set_style(o,"bottom","0px"),set_style(o,"left","0px"),set_style(o,"align-self","flex-end"),attr(u,"class","handle corner top right"),attr(l,"class","handle corner bottom right"),attr(m,"class","handle corner bottom left"),attr(d,"class","handle corner top left"),attr(c,"class","frame"),attr(n,"class","free-transform"),attr(n,"style",g=e[12]?e[1].style:null),toggle_class(n,"noclicks",!e[7]),attr(x,"class","fullwidthheight"),set_style(x,"display","none"),attr(t,"class","faded transform-area")},m(g,k){insert(g,t,k),append(t,n),append(n,r),$.m(r,null),append(n,i),append(n,o),append(n,a),append(n,c),append(c,u),e[39](u),append(c,s),append(c,l),e[40](l),append(c,f),append(c,m),e[41](m),append(c,h),append(c,d),e[42](d),append(c,p),T&&T.m(c,null),e[44](n),append(t,y),append(t,x),append(t,v),A&&A.m(t,null),append(t,b);for(let e=0;e<S.length;e+=1)S[e]&&S[e].m(t,null);e[45](t),_||(w=[listen(n,"pointerdown",e[20]),listen(t,"pointerup",e[22]),listen(t,"click",e[24])],_=!0)},p(e,i){if(M===(M=k(e))&&$?$.p(e,i):($.d(1),$=M(e),$&&($.c(),$.m(r,null))),1&i[0]&&set_style(r,"opacity",e[0].opacity/100),e[5]?T?T.p(e,i):(T=create_if_block_2(e),T.c(),T.m(c,null)):T&&(T.d(1),T=null),4098&i[0]&&g!==(g=e[12]?e[1].style:null)&&attr(n,"style",g),128&i[0]&&toggle_class(n,"noclicks",!e[7]),e[4]?A||(A=create_if_block_1(),A.c(),A.m(t,b)):A&&(A.d(1),A=null),2048&i[0]){let n;for(j=e[11],n=0;n<j.length;n+=1){const r=get_each_context(e,j,n);S[n]?S[n].p(r,i):(S[n]=create_each_block(r),S[n].c(),S[n].m(t,null))}for(;n<S.length;n+=1)S[n].d(1);S.length=j.length}},d(n){n&&detach(t),$.d(),e[39](null),e[40](null),e[41](null),e[42](null),T&&T.d(),e[44](null),A&&A.d(),destroy_each(S,n),e[45](null),_=!1,run_all(w)}}}function create_else_block(e){let t,n;return{c(){t=element("img"),set_style(t,"width","100%"),set_style(t,"height","100%"),src_url_equal(t.src,n=e[3]||e[0].url)||attr(t,"src",n)},m(n,r){insert(n,t,r),e[38](t)},p(e,r){9&r[0]&&!src_url_equal(t.src,n=e[3]||e[0].url)&&attr(t,"src",n)},d(n){n&&detach(t),e[38](null)}}}function create_if_block_4(e){let t,n;return{c(){t=new HtmlTag(!1),n=empty(),t.a=n},m(r,i){t.m(e[2],r,i),insert(r,n,i)},p(e,n){4&n[0]&&t.p(e[2])},d(e){e&&detach(n),e&&t.d()}}}function create_if_block_2(e){let t,n,r,i=e[6]&&create_if_block_3();return{c(){t=element("div"),n=element("slot"),n.innerHTML='<div class="handle-shape"></div>',r=space(),i&&i.c(),attr(n,"name","rotator"),attr(t,"class","handle rotator")},m(o,a){insert(o,t,a),append(t,n),append(t,r),i&&i.m(t,null),e[43](t)},p(e,n){e[6]?i||(i=create_if_block_3(),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},d(n){n&&detach(t),i&&i.d(),e[43](null)}}}function create_if_block_3(e){let t;return{c(){t=element("div"),attr(t,"class","rotator-bar")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_if_block_1(e){let t;return{c(){t=element("div"),set_style(t,"position","absolute"),set_style(t,"top","100px"),set_style(t,"left","100px"),set_style(t,"width","400px"),set_style(t,"height","400px"),set_style(t,"border","1px solid grey"),set_style(t,"transform","rotate(-45deg)"),set_style(t,"transform-origin","center center")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_each_block(e){let t;return{c(){t=element("div"),attr(t,"class","line"),set_style(t,"--x-line",e[77].x_line+"px"),set_style(t,"--y-line",e[77].y_line+"px"),set_style(t,"--line-length",e[77].lineLength+"px"),set_style(t,"--theta-line",e[77].theta_line+"rad")},m(e,n){insert(e,t,n)},p(e,n){2048&n[0]&&set_style(t,"--x-line",e[77].x_line+"px"),2048&n[0]&&set_style(t,"--y-line",e[77].y_line+"px"),2048&n[0]&&set_style(t,"--line-length",e[77].lineLength+"px"),2048&n[0]&&set_style(t,"--theta-line",e[77].theta_line+"rad")},d(e){e&&detach(t)}}}function create_fragment(e){let t,n,r,i=(e[3]||e[0].url)&&create_if_block(e);return{c(){i&&i.c(),t=empty(),this.c=noop},m(o,a){i&&i.m(o,a),insert(o,t,a),n||(r=[listen(window_1,"pointermove",e[21]),listen(window_1,"pointerup",e[23]),listen(window_1,"keyup",e[18]),listen(window_1,"keydown",e[19])],n=!0)},p(e,n){e[3]||e[0].url?i?i.p(e,n):(i=create_if_block(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:noop,o:noop,d(e){i&&i.d(e),e&&detach(t),n=!1,run_all(r)}}}const magneticTolerance=10;function isResizing(e){return e&&e.target&&"handle"===e.target.type}function getFullBounds(e){const t=e.getBoundingClientRect();return t.x=t.left,t.y=t.top,t.center={x:(t.left+t.right)/2,y:(t.top+t.bottom)/2},t}function instance(e,t,n){let r=!1,i=get_current_component();const o=createEventDispatcher(),a=(e,t)=>{(t=d).endDrag=!!r,r&&(r=!r),o(e="transformchange",t),i.dispatchEvent&&i.dispatchEvent(new CustomEvent(e,{detail:t}))};let c={x:null,y:null,width:null,height:null,rotation:null},{layers:u=[]}=t;u=[{x:100,y:100,width:400,height:400,rotation:.785398}];let s,l,f,{demo:m=!1}=t,{layerimagedata:h={}}=t,{position:d=c}=t,{target:p=null}=t,{container:g=null}=t,{rotatorEnabled:y=!0}=t,{rotatorBar:x=!1}=t,{handleMode:v="resize"}=t,{lockAspect:b=!1}=t,{lockTouchResize:_=!1}=t,{captureClicks:w=!0}=t,{zoom:k=100}=t,{ratio:M=window.devicePixelRatio}=t,{imageurl:$}=t,{imagesvg:T}=t,{svgcolor:A}=t,{type:j}=t,S=!1,q=[];function P(e,t,n,r){let i=(new magneticLines).calcMagneticLine(e,t,n,r);q.push(i)}function E(e,t,n){let r={...t};return e.forEach((e=>{e!==d&&(Math.abs(t.x-e.x)<n?(P("left","side","vertical",e.originalData),r.x=e.x):Math.abs(t.x+t.width-(e.x+e.width))<n?(P("right","side","vertical",e.originalData),r.x=e.x+e.width-t.width):Math.abs(t.x+t.width/2-(e.x+e.width/2))<n?(P("","center","vertical",e.originalData),r.x=e.x+e.width/2-t.width/2):Math.abs(t.x-(e.x+e.width))<n?(r.x=e.x+e.width,P("right","side","vertical",e.originalData)):Math.abs(t.x+t.width-e.x)<n&&(r.x=e.x-t.width,P("left","side","",e.originalData)),Math.abs(t.y-e.y)<n?(r.y=e.y,P("top","side","",e.originalData)):Math.abs(t.y+t.height-(e.y+e.height))<n?(r.y=e.y+e.height-t.height,P("bottom","side","",e.originalData)):Math.abs(t.y+t.height/2-(e.y+e.height/2))<n?(r.y=e.y+e.height/2-t.height/2,P("","center","horizontal",e.originalData)):Math.abs(t.y-(e.y+e.height))<n?(r.y=e.y+e.height,P("bottom","side","",e.originalData)):Math.abs(t.y+t.height-e.y)<n&&(r.y=e.y-t.height,P("top","side","",e.originalData)))})),r}let L,N,C=!1;const V={};let O,R,B,F,D,I,z,U,X=0;function Y(){z||(z=!0,n(8,l.onload=()=>{n(1,d={x:l.x,y:l.y,width:l.naturalWidth,height:l.naturalHeight,rotation:0}),H(),async function(){await tick(),O&&(O.getBoundingClientRect(),a("boundsChanged",d),f.classList.contains("fade-in-div")||(f.classList.remove("faded"),f.classList.add("fade-in-div")))}()},l),p||n(25,p=O),g||n(26,g=p.parentNode))}function H(){(h?._x||0==h?._x)&&n(1,d.x=h._x,d),(h?._y||0==h?._y)&&n(1,d.y=h._y,d),h?._width&&n(1,d.width=h._width,d),h?._height&&n(1,d.height=h._height,d),(h?.x||0==h?.x)&&n(1,d.x=Q(h.x),d),(h?.y||0==h?.y)&&n(1,d.y=Q(h.y),d),h?.width&&n(1,d.width=Q(h.width),d),h?.height&&n(1,d.height=Q(h.height),d),h?.rotation&&n(1,d.rotation=h.rotation,d),h?.rotation&&n(1,d.r=h.rotation,d),(h?._x||0==h?._x)&&h._imgwidth&&(n(1,d.x=Q(h._imgx),d),n(1,d.y=Q(h._imgy),d),n(1,d.width=Q(h._imgwidth),d),n(1,d.height=Q(h._imgheight),d),delete h._imgx,delete h._imgy,delete h._imgwidth,delete h._imgheight)}function Q(e){return e*(parseFloat(k)/100/M)}onMount((()=>{n(37,U=!0),l&&Y()}));const Z={x:"left",y:"top",width:"width",height:"height"};function J(e){return"position: absolute; "+["x","y","width","height"].map((t=>null!=e[t]?`${Z[t]}: ${e[t]}px; `:"")).join(" ")+`; transform: rotate(${e.rotation}rad)`}function G(e){n(1,d.y=c.y+(e.end.y-e.start.y),d),n(1,d.x=c.x+(e.end.x-e.start.x),d);let t={x:c.x+(e.end.x-e.start.x),y:c.y+(e.end.y-e.start.y),width:d.width,height:d.height};n(11,q=[]);const r=function(e,t,n){let r={...t},i=[],o=[];if(e.forEach((e=>{if(e!==d&&(e.rotation!==d.rotation||0===e.rotation)){let t=JSON.parse(JSON.stringify(e));t.originalData=JSON.parse(JSON.stringify(e)),i.push(t)}})),r=E(i,t,n),e.forEach((e=>{if(e!==d&&e.rotation===d.rotation&&0!==e.rotation){let t=JSON.parse(JSON.stringify(e));t.originalData=JSON.parse(JSON.stringify(e)),o.push(t)}})),o.length>0){let e=o[0].rotation;o.push(JSON.parse(JSON.stringify(t)));let i=new magneticLines;i.rotateBoxesToZero(o,e);let a=o.pop(),c=E(o,a,n);q.length&&(r=i.rotatePositionBackToOriginal(c,e))}return r}(u,t,magneticTolerance);n(1,d.x=r.x,d),n(1,d.y=r.y,d)}function W(e,t){const r=function(e,t){const n=c.rotation,r=N.center,i=vector.sub(r,{x:c.width/2,y:c.height/2}),o=vector.rotate(e.end,-n,t),a=o.x-t.x,u=o.y-t.y,s=vector.add(i,{x:Math.abs(a/2),y:Math.abs(u/2)}),l=vector.add(s,{x:-a/2,y:-u/2}),f=vector.rotate(l,n,s);return{width:a,height:u,translate:vector.sub(t,f)}}(e,t,N.center);n(1,d.x=c.x+r.translate.x,d),n(1,d.y=c.y+r.translate.y,d),n(1,d.width=Math.abs(r.width),d),n(1,d.height=Math.abs(r.height),d)}function K(e,t,r,i){const o=function(e,t,n,r,i){const o=t.start?t.start:t,a=t.end?t.end:t,c=vector.sub(o,e.start),u=vector.sub(a,e.end),s=vector.length(u)/vector.length(c),l=r?0:vector.direction(c)-vector.direction(u),f=vector.add(vector.rotate(vector.scale(vector.sub(n,o),s),l,{x:0,y:0}),a);return{scale:i?1:s,rotate:l,translate:vector.sub(f,n),center:f}}(e,t,N.center,r,i);n(1,d.width=c.width*o.scale,d),n(1,d.height=c.height*o.scale,d);const a=vector.sub(N.center,c),u=vector.add(vector.add(a,o.translate),{x:-d.width/2,y:-d.height/2});n(1,d.x=c.x+u.x-L.left,d),n(1,d.y=c.y+u.y-L.top,d),n(1,d.rotation=c.rotation+o.rotate,d)}async function ee(){await tick(),O&&O.getBoundingClientRect(),a("positionChanged",d)}return e.$$set=e=>{"layers"in e&&n(28,u=e.layers),"demo"in e&&n(4,m=e.demo),"layerimagedata"in e&&n(0,h=e.layerimagedata),"position"in e&&n(1,d=e.position),"target"in e&&n(25,p=e.target),"container"in e&&n(26,g=e.container),"rotatorEnabled"in e&&n(5,y=e.rotatorEnabled),"rotatorBar"in e&&n(6,x=e.rotatorBar),"handleMode"in e&&n(29,v=e.handleMode),"lockAspect"in e&&n(27,b=e.lockAspect),"lockTouchResize"in e&&n(30,_=e.lockTouchResize),"captureClicks"in e&&n(7,w=e.captureClicks),"zoom"in e&&n(31,k=e.zoom),"ratio"in e&&n(32,M=e.ratio),"imageurl"in e&&n(3,$=e.imageurl),"imagesvg"in e&&n(2,T=e.imagesvg),"svgcolor"in e&&n(33,A=e.svgcolor),"type"in e&&n(34,j=e.type)},e.$$.update=()=>{4&e.$$.dirty[0]|4&e.$$.dirty[1]&&T&&A&&(n(2,T=T.replace("<svg ",`<svg style="fill:${A}" `)),n(0,h.url=n(3,$="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(T)))),h)),134217732&e.$$.dirty[0]&&T&&b&&(n(2,T=T.replace('preserveAspectRatio="none"'," ")),n(2,T=T.replace('class="fullwidthheight"'," ")),n(0,h.url=n(3,$="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(T)))),h)),134217732&e.$$.dirty[0]&&T&&!b&&(n(2,T=T.replace("<svg ",'<svg preserveAspectRatio="none" class="fullwidthheight" ')),n(0,h.url=n(3,$="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(T)))),h)),100664065&e.$$.dirty[0]|64&e.$$.dirty[1]&&U&&l&&O&&h&&h.url&&(p||n(25,p=O),g||n(26,g=p.parentNode),Y()),33554944&e.$$.dirty[0]&&n(12,C=p===O),2&e.$$.dirty[0]&&n(1,d.style=J(d),d),2&e.$$.dirty[0]|33&e.$$.dirty[1]&&k&&k!=s&&(n(36,s=k),H(),n(1,d.style=J(d),d))},[h,d,T,$,m,y,x,w,l,O,f,q,C,R,B,F,D,I,function(e){16===e.keyCode&&n(27,b=!1)},function(e){16===e.keyCode&&n(27,b=!0)},function(e){let t=function(e){return R.contains(e.target)?{type:"handle",top:!0,right:!0}:B.contains(e.target)?{type:"handle",top:!0,left:!0}:F.contains(e.target)?{type:"handle",bottom:!0,right:!0}:D.contains(e.target)?{type:"handle",bottom:!0,left:!0}:I&&I.contains(e.target)?{type:"rotate"}:{type:"body"}}(e),n=V[e.pointerId];if(n?(n.end.x=e.pageX,n.end.y=e.pageY,n.target=t):(X++,n={id:e.pointerId,priority:X-1,start:{x:e.pageX,y:e.pageY},end:{x:e.pageX,y:e.pageY},target:t},V[e.pointerId]=n),S=!1,n.priority<2)if(N=getFullBounds(p),L=getFullBounds(g),X>1&&Object.values(V).forEach((e=>{e.id!==e&&(e.start.x=e.end.x),e.start.y=e.end.y})),c.x=d.x,c.y=d.y,c.width=d.width,c.height=d.height,c.rotation=d.rotation,"handle"===t.type){let e;e=t.top?t.right?D:F:t.right?B:R;const n=e.getBoundingClientRect(),r={x:(n.left+n.right)/2,y:(n.top+n.bottom)/2};V.anchor=r}else delete V.anchor;ee()},function(e){r=!1;let t=V[e.pointerId];if(t&&t.priority<2){if(S=!0,t.end.x=e.pageX,t.end.y=e.pageY,function(e){return e&&e.target&&"body"===e.target.type&&1===X}(t))G(t);else if(function(e){return e&&e.target&&("rotate"===e.target.type||"handle"===e.target.type&&"rotate"===v)}(t))K(t,N.center,!1,!0);else if(isResizing(t)&&!b)W(t,V.anchor);else if(isResizing(t)&&b)K(t,V.anchor,!0);else if(function(e){return e&&e.target&&"handle"!==e.target.type&&X>1}(t)){let e,n=X>1;e=n?Object.values(V).find((e=>e.id!==t.id)):V.anchor?V.anchor:N.center,K(t,e,!1,n&&_)}ee()}},function(e){S&&(r=!0,n(27,b=!1),S=!1,a("positionChanged",d))},function(e){let t=1/0;V[e.pointerId]&&(X--,t=V[e.pointerId].priority),delete V[e.pointerId],X&&(c.y=d.y,c.x=d.x,c.width=d.width,c.height=d.height,c.rotation=d.rotation,Object.values(V).forEach((e=>{e.id&&(e.priority>t&&e.priority--,e.start.x=e.end.x,e.start.y=e.end.y)})))},function(e){S||a("click",e.detail)},p,g,b,u,v,_,k,M,A,j,function(){null!=d.opacity&&n(0,h.opacity=d.opacity,h),n(1,d.style=J(d),d),a("positionChanged",d)},s,U,function(e){binding_callbacks[e?"unshift":"push"]((()=>{l=e,n(8,l)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{R=e,n(13,R)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{F=e,n(15,F)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{D=e,n(16,D)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{B=e,n(14,B)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{I=e,n(17,I)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{O=e,n(9,O)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{f=e,n(10,f)}))}]}class App extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent=':root{--frameBorder:solid 1px cyan}*{box-sizing:border-box}.free-transform{position:absolute;top:0;left:0;right:0;bottom:0;transform-origin:center;touch-action:none;display:flex}.free-transform.noclicks{pointer-events:none}.contents{position:absolute;top:0;left:0;right:0;bottom:0}.contents:before{content:"";position:absolute;top:0px;left:0px;width:100%;height:100%;border:var(--frameBorder,2px solid #3965c7);box-sizing:border-box}.free-transform.noclicks .contents{pointer-events:none}.frame{position:absolute;top:0;left:0;right:0;bottom:0;cursor:move}.free-transform.noclicks .frame{pointer-events:none}.handle{position:absolute;user-select:none;touch-action:none;cursor:grab;pointer-events:auto}.handle:active{cursor:grabbing}.handle-shape{width:12px;height:12px;border-radius:50%;background:white;border:var(--frameBorder)}.handle.top{top:0px}.handle.right{right:0px}.handle.bottom{bottom:0px}.handle.left{left:0px}.handle.top.left{transform:translate(-50%,-50%) rotate(-45deg)}.handle.top.right{transform:translate(50%,-50%) rotate(45deg)}.handle.bottom.left{transform:translate(-50%,50%) rotate(-135deg)}.handle.bottom.right{transform:translate(50%,50%) rotate(135deg)}.handle.rotator{left:50%;top:-30px;transform:translateX(-50%)}.rotator-bar{position:absolute;top:100%;right:50%;width:1px;height:calc(30px - 100%);border-right:var(--frameBorder)}.fullwidthheight{width:100%;height:100%}.transform-area{position:relative;width:100%;height:100%;flex-grow:1}.faded{opacity:0.01}@keyframes fadeIn{to{opacity:1}}.line{position:absolute;width:var(--line-length);height:1px;left:var(--x-line);top:var(--y-line);transform:translate(-50%, -50%) rotate(var(--theta-line));transform-origin:center center;background-color:red}',this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance,create_fragment,safe_not_equal,{layers:28,demo:4,layerimagedata:0,position:1,target:25,container:26,rotatorEnabled:5,rotatorBar:6,handleMode:29,lockAspect:27,lockTouchResize:30,captureClicks:7,zoom:31,ratio:32,imageurl:3,imagesvg:2,svgcolor:33,type:34,changePosition:35},null,[-1,-1,-1]),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["layers","demo","layerimagedata","position","target","container","rotatorEnabled","rotatorBar","handleMode","lockAspect","lockTouchResize","captureClicks","zoom","ratio","imageurl","imagesvg","svgcolor","type","changePosition"]}get layers(){return this.$$.ctx[28]}set layers(e){this.$$set({layers:e}),flush()}get demo(){return this.$$.ctx[4]}set demo(e){this.$$set({demo:e}),flush()}get layerimagedata(){return this.$$.ctx[0]}set layerimagedata(e){this.$$set({layerimagedata:e}),flush()}get position(){return this.$$.ctx[1]}set position(e){this.$$set({position:e}),flush()}get target(){return this.$$.ctx[25]}set target(e){this.$$set({target:e}),flush()}get container(){return this.$$.ctx[26]}set container(e){this.$$set({container:e}),flush()}get rotatorEnabled(){return this.$$.ctx[5]}set rotatorEnabled(e){this.$$set({rotatorEnabled:e}),flush()}get rotatorBar(){return this.$$.ctx[6]}set rotatorBar(e){this.$$set({rotatorBar:e}),flush()}get handleMode(){return this.$$.ctx[29]}set handleMode(e){this.$$set({handleMode:e}),flush()}get lockAspect(){return this.$$.ctx[27]}set lockAspect(e){this.$$set({lockAspect:e}),flush()}get lockTouchResize(){return this.$$.ctx[30]}set lockTouchResize(e){this.$$set({lockTouchResize:e}),flush()}get captureClicks(){return this.$$.ctx[7]}set captureClicks(e){this.$$set({captureClicks:e}),flush()}get zoom(){return this.$$.ctx[31]}set zoom(e){this.$$set({zoom:e}),flush()}get ratio(){return this.$$.ctx[32]}set ratio(e){this.$$set({ratio:e}),flush()}get imageurl(){return this.$$.ctx[3]}set imageurl(e){this.$$set({imageurl:e}),flush()}get imagesvg(){return this.$$.ctx[2]}set imagesvg(e){this.$$set({imagesvg:e}),flush()}get svgcolor(){return this.$$.ctx[33]}set svgcolor(e){this.$$set({svgcolor:e}),flush()}get type(){return this.$$.ctx[34]}set type(e){this.$$set({type:e}),flush()}get changePosition(){return this.$$.ctx[35]}}return customElements.define("fds-image-transform",App),App}();
//# sourceMappingURL=fds-image-transform.js.map
