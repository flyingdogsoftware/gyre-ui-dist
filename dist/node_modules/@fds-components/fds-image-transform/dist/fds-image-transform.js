var app=function(){"use strict";function noop(){}function run(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run)}function is_function(e){return"function"==typeof e}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let src_url_equal_anchor;function src_url_equal(e,t){return src_url_equal_anchor||(src_url_equal_anchor=document.createElement("a")),src_url_equal_anchor.href=t,e===src_url_equal_anchor.href}function is_empty(e){return 0===Object.keys(e).length}function subscribe(e,...t){if(null==e)return noop;const r=e.subscribe(...t);return r.unsubscribe?()=>r.unsubscribe():r}function component_subscribe(e,t,r){e.$$.on_destroy.push(subscribe(t,r))}function set_store_value(e,t,r){return e.set(r),t}function action_destroyer(e){return e&&is_function(e.destroy)?e.destroy:noop}const globals="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function append(e,t){e.appendChild(t)}function insert(e,t,r){e.insertBefore(t,r||null)}function detach(e){e.parentNode&&e.parentNode.removeChild(e)}function destroy_each(e,t){for(let r=0;r<e.length;r+=1)e[r]&&e[r].d(t)}function element(e){return document.createElement(e)}function svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function text(e){return document.createTextNode(e)}function space(){return text(" ")}function empty(){return text("")}function listen(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}function attr(e,t,r){null==r?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function set_custom_element_data(e,t,r){t in e?e[t]="boolean"==typeof e[t]&&""===r||r:attr(e,t,r)}function children(e){return Array.from(e.childNodes)}function set_style(e,t,r,n){null==r?e.style.removeProperty(t):e.style.setProperty(t,r,n?"important":"")}function toggle_class(e,t,r){e.classList[r?"add":"remove"](t)}function custom_event(e,t,{bubbles:r=!1,cancelable:n=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,r,n,t),i}class HtmlTag{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=svg_element(t.nodeName):this.e=element(11===t.nodeType?"TEMPLATE":t.nodeName),this.t="TEMPLATE"!==t.tagName?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)insert(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(detach)}}function attribute_to_object(e){const t={};for(const r of e)t[r.name]=r.value;return t}let current_component;function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(e){get_current_component().$$.on_mount.push(e)}function createEventDispatcher(){const e=get_current_component();return(t,r,{cancelable:n=!1}={})=>{const i=e.$$.callbacks[t];if(i){const o=custom_event(t,r,{cancelable:n});return i.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}const dirty_components=[],binding_callbacks=[];let render_callbacks=[];const flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function tick(){return schedule_update(),resolved_promise}function add_render_callback(e){render_callbacks.push(e)}const seen_callbacks=new Set;let flushidx=0;function flush(){if(0!==flushidx)return;const e=current_component;do{try{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}}catch(e){throw dirty_components.length=0,flushidx=0,e}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(e)}function update(e){if(null!==e.fragment){e.update(),run_all(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(add_render_callback)}}function flush_render_callbacks(e){const t=[],r=[];render_callbacks.forEach((n=>-1===e.indexOf(n)?t.push(n):r.push(n))),r.forEach((e=>e())),render_callbacks=t}const outroing=new Set;function transition_in(e,t){e&&e.i&&(outroing.delete(e),e.i(t))}function mount_component(e,t,r,n){const{fragment:i,after_update:o}=e.$$;i&&i.m(t,r),n||add_render_callback((()=>{const t=e.$$.on_mount.map(run).filter(is_function);e.$$.on_destroy?e.$$.on_destroy.push(...t):run_all(t),e.$$.on_mount=[]})),o.forEach(add_render_callback)}function destroy_component(e,t){const r=e.$$;null!==r.fragment&&(flush_render_callbacks(r.after_update),run_all(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function make_dirty(e,t){-1===e.$$.dirty[0]&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function init(e,t,r,n,i,o,a,c=[-1]){const s=current_component;set_current_component(e);const u=e.$$={fragment:null,ctx:[],props:o,update:noop,not_equal:i,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(s?s.$$.context:[])),callbacks:blank_object(),dirty:c,skip_bound:!1,root:t.target||s.$$.root};a&&a(u.root);let l=!1;if(u.ctx=r?r(e,t.props||{},((t,r,...n)=>{const o=n.length?n[0]:r;return u.ctx&&i(u.ctx[t],u.ctx[t]=o)&&(!u.skip_bound&&u.bound[t]&&u.bound[t](o),l&&make_dirty(e,t)),r})):[],u.update(),l=!0,run_all(u.before_update),u.fragment=!!n&&n(u.ctx),t.target){if(t.hydrate){const e=children(t.target);u.fragment&&u.fragment.l(e),e.forEach(detach)}else u.fragment&&u.fragment.c();t.intro&&transition_in(e.$$.fragment),mount_component(e,t.target,t.anchor,t.customElement),flush()}set_current_component(s)}let SvelteElement;function add(e,t){return{x:e.x+t.x,y:e.y+t.y}}function subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}}function scale(e,t){return{x:e.x*t,y:e.y*t}}function rotate(e,t,r={x:0,y:0}){const n=e.x-r.x,i=e.y-r.y;return{x:r.x+n*Math.cos(t)-i*Math.sin(t),y:r.y+i*Math.cos(t)+n*Math.sin(t)}}function direction(e){const t=Math.atan(e.x/e.y);return e.y>0?t+Math.PI:t}function length(e){return Math.sqrt(e.x*e.x+e.y*e.y)}"function"==typeof HTMLElement&&(SvelteElement=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(run).filter(is_function);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,r){this[e]=r}disconnectedCallback(){run_all(this.$$.on_disconnect)}$destroy(){destroy_component(this,1),this.$destroy=noop}$on(e,t){if(!is_function(t))return noop;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});var vector={add:add,subtract:subtract,sub:subtract,scale:scale,rotate:rotate,direction:direction,length:length,len:length};const subscriber_queue=[];function writable(e,t=noop){let r;const n=new Set;function i(t){if(safe_not_equal(e,t)&&(e=t,r)){const t=!subscriber_queue.length;for(const t of n)t[1](),subscriber_queue.push(t,e);if(t){for(let e=0;e<subscriber_queue.length;e+=2)subscriber_queue[e][0](subscriber_queue[e+1]);subscriber_queue.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(o,a=noop){const c=[o,a];return n.add(c),1===n.size&&(r=t(i)||noop),o(e),()=>{n.delete(c),0===n.size&&r&&(r(),r=null)}}}}let toollayer=writable(0);class magneticLines{rotatePoint(e,t,r){const n=Math.cos(r),i=Math.sin(r);return{x:e*n-t*i,y:e*i+t*n}}calcMagneticLine(e,t,r,n){let i,o,a,c,s,u=n.x,l=n.y,f=n.width,h=n.height,m=n.rotation,p=u+f/2,d=l+h/2;if("side"===t)"top"===e?(i=this.rotatePoint(0,-h/2,m),o=m,s=f+1e3):"right"===e?(i=this.rotatePoint(f/2,0,m),o=m+Math.PI/2,s=h+1e3):"bottom"===e?(i=this.rotatePoint(0,h/2,m),o=m+Math.PI,s=f+1e3):"left"===e&&(i=this.rotatePoint(-f/2,0,m),o=m-Math.PI/2,s=h+1e3),a=p+i.x,c=d+i.y;else if("center"===t){a=p,c=d,"horizontal"===r?o=m:"vertical"===r?o=m+Math.PI/2:"aligned"===r&&(o=m);s=Math.hypot(f,h)+1e3}return{x_line:a,y_line:c,lineLength:s,theta_line:o}}rotatePositionBackToOriginal(e,t){let r=this.centerX,n=this.centerY;const i=e.x,o=e.y,a=e.width,c=e.height,s=i+a/2,u=o+c/2;return{x:r+(s-r)*Math.cos(t)-(u-n)*Math.sin(t)-a/2,y:n+(s-r)*Math.sin(t)+(u-n)*Math.cos(t)-c/2,width:a,height:c,rotation:t}}rotateBoxesToZero(e,t){let r=0,n=0;return e.forEach((e=>{r+=e.x+e.width/2,n+=e.y+e.height/2})),r/=e.length,n/=e.length,this.centerX=r,this.centerY=n,e.forEach((e=>{let i=e.x+e.width/2,o=e.y+e.height/2,a=r+(i-r)*Math.cos(-t)-(o-n)*Math.sin(-t),c=n+(i-r)*Math.sin(-t)+(o-n)*Math.cos(-t);e.x=a-e.width/2,e.y=c-e.height/2,e.rotation=0})),e}}function warpImage(e,t,r,n){var i=e.naturalWidth,o=e.naturalHeight,a=[{x:0,y:0},{x:i,y:0},{x:i,y:o},{x:0,y:o}];const c=-n,s=Math.cos(c),u=Math.sin(c);let[l,f]=getCenterFromCorners$1(a);n&&(a=a.map((({x:e,y:t})=>{const r=e-l,n=t-f;return{x:r*s-n*u+l,y:r*u+n*s+f}})));var h=computeHomography(a,t),m=Math.min(...t.map((e=>e.x))),p=Math.max(...t.map((e=>e.x))),d=Math.min(...t.map((e=>e.y)));let g=p-m,y=Math.max(...t.map((e=>e.y)))-d;r.width=Math.ceil(g),r.height=Math.ceil(y);var x=invertHomography(h),v=document.createElement("canvas");v.width=i,v.height=o;var b=v.getContext("2d");b.drawImage(e,0,0,i,o);for(var _=b.getImageData(0,0,i,o).data,w=r.getContext("2d"),k=w.createImageData(r.width,r.height),$=k.data,M=0;M<r.height;M++)for(var T=0;T<r.width;T++){var A=applyHomography(x,T+m,M+d),j=A.x,S=A.y;if(j>=0&&j<i&&S>=0&&S<o){var E=sampleBilinear(_,i,o,j,S),C=4*(M*r.width+T);$[C]=E[0],$[C+1]=E[1],$[C+2]=E[2],$[C+3]=E[3]}}w.putImageData(k,0,0)}function getCenterFromCorners$1(e){const t=e[0],r=e[2];return[(t.x+r.x)/2,(t.y+r.y)/2]}function computeHomography(e,t){for(var r=[],n=0;n<4;n++){var i=e[n].x,o=e[n].y,a=t[n].x,c=t[n].y;r.push([-i,-o,-1,0,0,0,i*a,o*a,a]),r.push([0,0,0,-i,-o,-1,i*c,o*c,c])}var s=solveHomography(r);return[[s[0],s[1],s[2]],[s[3],s[4],s[5]],[s[6],s[7],s[8]]]}function solveHomography(e){for(var t=[],r=[],n=0;n<e.length;n++)t.push(e[n].slice(0,8)),r.push(-e[n][8]);var i=solveLinearSystem(t,r);return i.push(1),i}function solveLinearSystem(e,t){for(var r=e.length,n=e[0].length,i=0;i<r;i++)e[i].push(t[i]);for(var o=0;o<n;o++){var a=o,c=Math.abs(e[o][o]);for(i=o+1;i<r;i++)Math.abs(e[i][o])>c&&(c=Math.abs(e[i][o]),a=i);if(a!==o){var s=e[o];e[o]=e[a],e[a]=s}for(i=o+1;i<r;i++)for(var u=e[i][o]/e[o][o],l=o;l<=n;l++)e[i][l]-=u*e[o][l]}var f=new Array(n);for(i=n-1;i>=0;i--){f[i]=e[i][n]/e[i][i];for(o=i-1;o>=0;o--)e[o][n]-=e[o][i]*f[i]}return f}function invertHomography(e){var t=e[0][0]*(e[1][1]*e[2][2]-e[2][1]*e[1][2])-e[0][1]*(e[1][0]*e[2][2]-e[2][0]*e[1][2])+e[0][2]*(e[1][0]*e[2][1]-e[2][0]*e[1][1]);if(0===t)throw new Error("Homography matrix is singular and cannot be inverted.");var r=1/t;return[[(e[1][1]*e[2][2]-e[2][1]*e[1][2])*r,(e[0][2]*e[2][1]-e[0][1]*e[2][2])*r,(e[0][1]*e[1][2]-e[0][2]*e[1][1])*r],[(e[1][2]*e[2][0]-e[1][0]*e[2][2])*r,(e[0][0]*e[2][2]-e[0][2]*e[2][0])*r,(e[1][0]*e[0][2]-e[0][0]*e[1][2])*r],[(e[1][0]*e[2][1]-e[2][0]*e[1][1])*r,(e[2][0]*e[0][1]-e[0][0]*e[2][1])*r,(e[0][0]*e[1][1]-e[1][0]*e[0][1])*r]]}function applyHomography(e,t,r){var n=e[2][0]*t+e[2][1]*r+e[2][2];return{x:(e[0][0]*t+e[0][1]*r+e[0][2])/n,y:(e[1][0]*t+e[1][1]*r+e[1][2])/n}}function sampleBilinear(e,t,r,n,i){var o=Math.floor(n),a=Math.floor(i),c=o+1,s=a+1,u=n-o,l=i-a,f=function(e,n){return e=Math.max(0,Math.min(t-1,e)),4*((n=Math.max(0,Math.min(r-1,n)))*t+e)},h=getPixel(e,f(o,a)),m=getPixel(e,f(c,a)),p=getPixel(e,f(o,s)),d=getPixel(e,f(c,s)),g=interpolateColor(h,m,u),y=interpolateColor(p,d,u);return interpolateColor(g,y,l)}function getPixel(e,t){return[e[t],e[t+1],e[t+2],e[t+3]]}function interpolateColor(e,t,r){for(var n=[],i=0;i<4;i++)n[i]=e[i]*(1-r)+t[i]*r;return n}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var numeric1_2_6=createCommonjsModule((function(module,exports){var numeric=exports;void 0!==commonjsGlobal&&(commonjsGlobal.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var r,n,i;for(void 0===t&&(t=15),n=.5,r=new Date;;){for(i=n*=2;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;if(new Date-r>t)break}for(i=n;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;return 1e3*(3*n-1)/(new Date-r)},numeric._myIndexOf=function(e){var t,r=this.length;for(t=0;t<r;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var r=Math.floor(Math.log(e)/Math.log(10)),n=e/Math.pow(10,r),i=n.toPrecision(numeric.precision);return 10===parseFloat(i)&&(r++,i=(n=1).toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+r.toString()}return"Infinity"}var r=[];return function e(n){var i;if(void 0===n)return r.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof n)return r.push('"'+n+'"'),!1;if("boolean"==typeof n)return r.push(n.toString()),!1;if("number"==typeof n){var o=t(n),a=n.toPrecision(numeric.precision),c=parseFloat(n.toString()).toString(),s=[o,a,c,parseFloat(a).toString(),parseFloat(c).toString()];for(i=1;i<s.length;i++)s[i].length<o.length&&(o=s[i]);return r.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===n)return r.push("null"),!1;if("function"==typeof n){r.push(n.toString());var u=!1;for(i in n)n.hasOwnProperty(i)&&(u?r.push(",\n"):r.push("\n{"),u=!0,r.push(i),r.push(": \n"),e(n[i]));return u&&r.push("}\n"),!0}if(n instanceof Array){if(n.length>numeric.largeArray)return r.push("...Large Array..."),!0;u=!1;for(r.push("["),i=0;i<n.length;i++)i>0&&(r.push(","),u&&r.push("\n ")),u=e(n[i]);return r.push("]"),!0}for(i in r.push("{"),u=!1,n)n.hasOwnProperty(i)&&(u&&r.push(",\n"),u=!0,r.push(i),r.push(": \n"),e(n[i]));return r.push("}"),!0}(e),r.join("")},numeric.parseDate=function(e){return function e(t){if("string"==typeof t)return Date.parse(t.replace(/-/g,"/"));if(!(t instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var r,n=[];for(r=0;r<t.length;r++)n[r]=e(t[r]);return n}(e)},numeric.parseFloat=function(e){return function e(t){if("string"==typeof t)return parseFloat(t);if(!(t instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var r,n=[];for(r=0;r<t.length;r++)n[r]=e(t[r]);return n}(e)},numeric.parseCSV=function(e){var t,r,n,i=e.split("\n"),o=[],a=/(([^'",]*)|('[^']*')|("[^"]*")),/g,c=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,s=0;for(r=0;r<i.length;r++){var u,l=(i[r]+",").match(a);if(l.length>0){for(o[s]=[],t=0;t<l.length;t++)u=(n=l[t]).substr(0,n.length-1),c.test(u)?o[s][t]=parseFloat(u):o[s][t]=u;s++}}return o},numeric.toCSV=function(e){var t,r,n,i,o,a=numeric.dim(e);for(n=a[0],a[1],o=[],t=0;t<n;t++){for(i=[],r=0;r<n;r++)i[r]=e[t][r].toString();o[t]=i.join(", ")}return o.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var n,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1;for(e.length,n=t;n<r;n++)o=o>>>8^i[255&(o^e[n])];return~o}var r,n,i,o,a,c,s,u,l,f,h=e[0].length,m=e[0][0].length,p=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,m>>24&255,m>>16&255,m>>8&255,255&m,h>>24&255,h>>16&255,h>>8&255,255&h,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(f=t(p,12,29),p[29]=f>>24&255,p[30]=f>>16&255,p[31]=f>>8&255,p[32]=255&f,r=1,n=0,s=0;s<h;s++){for(s<h-1?p.push(0):p.push(1),a=3*m+1+(0===s)&255,c=3*m+1+(0===s)>>8&255,p.push(a),p.push(c),p.push(255&~a),p.push(255&~c),0===s&&p.push(0),u=0;u<m;u++)for(i=0;i<3;i++)n=(n+(r=(r+(a=(a=e[i][s][u])>255?255:a<0?0:Math.round(a)))%65521))%65521,p.push(a);p.push(0)}return l=(n<<16)+r,p.push(l>>24&255),p.push(l>>16&255),p.push(l>>8&255),p.push(255&l),o=p.length-41,p[33]=o>>24&255,p[34]=o>>16&255,p[35]=o>>8&255,p[36]=255&o,f=t(p,37),p.push(f>>24&255),p.push(f>>16&255),p.push(f>>8&255),p.push(255&f),p.push(0),p.push(0),p.push(0),p.push(0),p.push(73),p.push(69),p.push(78),p.push(68),p.push(174),p.push(66),p.push(96),p.push(130),"data:image/png;base64,"+function(e){var t,r,n,i,o,a,c,s=e.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="";for(t=0;t<s;t+=3)o=((3&(r=e[t]))<<4)+((n=e[t+1])>>4),a=((15&n)<<2)+((i=e[t+2])>>6),c=63&i,t+1>=s?a=c=64:t+2>=s&&(c=64),l+=u.charAt(r>>2)+u.charAt(o)+u.charAt(a)+u.charAt(c);return l}(p)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t;return"object"==typeof e?"object"==typeof(t=e[0])?"object"==typeof t[0]?numeric._dim(e):[e.length,t.length]:[e.length]:[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,r){var n,i;if(!(t instanceof Array&&r instanceof Array))return!1;if((i=t.length)!==r.length)return!1;for(n=0;n<i;n++)if(t[n]!==r[n]){if("object"!=typeof t[n])return!1;if(!e(t[n],r[n]))return!1}return!0},numeric.rep=function(e,t,r){void 0===r&&(r=0);var n,i=e[r],o=Array(i);if(r===e.length-1){for(n=i-2;n>=0;n-=2)o[n+1]=t,o[n]=t;return-1===n&&(o[0]=t),o}for(n=i-1;n>=0;n--)o[n]=numeric.rep(e,t,r+1);return o},numeric.dotMMsmall=function(e,t){var r,n,i,o,a,c,s,u,l,f,h;for(o=e.length,a=t.length,c=t[0].length,s=Array(o),r=o-1;r>=0;r--){for(u=Array(c),l=e[r],i=c-1;i>=0;i--){for(f=l[a-1]*t[a-1][i],n=a-2;n>=1;n-=2)h=n-1,f+=l[n]*t[n][i]+l[h]*t[h][i];0===n&&(f+=l[0]*t[0][i]),u[i]=f}s[r]=u}return s},numeric._getCol=function(e,t,r){var n;for(n=e.length-1;n>0;--n)r[n]=e[n][t],r[--n]=e[n][t];0===n&&(r[0]=e[0][t])},numeric.dotMMbig=function(e,t){var r,n,i,o=numeric._getCol,a=t.length,c=Array(a),s=e.length,u=t[0].length,l=new Array(s),f=numeric.dotVV;for(--a,n=--s;-1!==n;--n)l[n]=Array(u);for(n=--u;-1!==n;--n)for(o(t,n,c),i=s;-1!==i;--i)r=e[i],l[i][n]=f(r,c);return l},numeric.dotMV=function(e,t){var r,n=e.length;t.length;var i=Array(n),o=numeric.dotVV;for(r=n-1;r>=0;r--)i[r]=o(e[r],t);return i},numeric.dotVM=function(e,t){var r,n,i,o,a,c,s;for(i=e.length,o=t[0].length,a=Array(o),n=o-1;n>=0;n--){for(c=e[i-1]*t[i-1][n],r=i-2;r>=1;r-=2)s=r-1,c+=e[r]*t[r][n]+e[s]*t[s][n];0===r&&(c+=e[0]*t[0][n]),a[n]=c}return a},numeric.dotVV=function(e,t){var r,n,i=e.length,o=e[i-1]*t[i-1];for(r=i-2;r>=1;r-=2)n=r-1,o+=e[r]*t[r]+e[n]*t[n];return 0===r&&(o+=e[0]*t[0]),o},numeric.dot=function(e,t){var r=numeric.dim;switch(1e3*r(e).length+r(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,r,n,i,o=e.length,a=Array(o);for(t=o-1;t>=0;t--){for(i=Array(o),r=t+2,n=o-1;n>=r;n-=2)i[n]=0,i[n-1]=0;for(n>t&&(i[n]=0),i[t]=e[t],n=t-1;n>=1;n-=2)i[n]=0,i[n-1]=0;0===n&&(i[0]=0),a[t]=i}return a},numeric.getDiag=function(e){var t,r=Math.min(e.length,e[0].length),n=Array(r);for(t=r-1;t>=1;--t)n[t]=e[t][t],n[--t]=e[t][t];return 0===t&&(n[0]=e[0][0]),n},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,r){void 0===r&&(r="");var n,i,o=[],a=/\[i\]$/,c="",s=!1;for(n=0;n<e.length;n++)a.test(e[n])?c=i=e[n].substring(0,e[n].length-3):i=e[n],"ret"===i&&(s=!0),o.push(i);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+c+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(s?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,t,r){void 0===r&&(r="");var n,i,o=[],a=/\[i\]$/,c="",s=!1;for(n=0;n<e.length;n++)a.test(e[n])?c=i=e[n].substring(0,e[n].length-3):i=e[n],"ret"===i&&(s=!0),o.push(i);return o[e.length]="var _n = "+c+".length;\nvar i"+(s?"":", ret = Array(_n)")+";\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function e(t,r,n,i,o){var a;if(i!==n.length-1)for(a=n[i]-1;a>=0;a--)e("object"==typeof t?t[a]:t,"object"==typeof r?r[a]:r,n,i+1,o);else o(t,r)},numeric._biforeach2=function e(t,r,n,i,o){if(i===n.length-1)return o(t,r);var a,c=n[i],s=Array(c);for(a=c-1;a>=0;--a)s[a]=e("object"==typeof t?t[a]:t,"object"==typeof r?r[a]:r,n,i+1,o);return s},numeric._foreach=function e(t,r,n,i){var o;if(n!==r.length-1)for(o=r[n]-1;o>=0;o--)e(t[o],r,n+1,i);else i(t)},numeric._foreach2=function e(t,r,n,i){if(n===r.length-1)return i(t);var o,a=r[n],c=Array(a);for(o=a-1;o>=0;o--)c[o]=e(t[o],r,n+1,i);return c},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var r,n,i="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(i="var "+t+" = Math."+t+";\n",r=function(e,r,n){return e+" = "+t+"("+r+","+n+")"},n=function(e,r){return e+" = "+t+"("+e+","+r+")"}):(r=function(e,r,n){return e+" = "+r+" "+t+" "+n},n=numeric.opseq.hasOwnProperty(e+"eq")?function(e,r){return e+" "+t+"= "+r}:function(e,r){return e+" = "+e+" "+t+" "+r}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],r("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],r("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],r("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+n("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],n("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],n("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,r,n,i,o,a,c,s=numeric.dim(e),u=Math.abs,l=s[0],f=s[1],h=numeric.clone(e),m=numeric.identity(l);for(a=0;a<f;++a){var p=-1,d=-1;for(o=a;o!==l;++o)(c=u(h[o][a]))>d&&(p=o,d=c);for(r=h[p],h[p]=h[a],h[a]=r,i=m[p],m[p]=m[a],m[a]=i,e=r[a],c=a;c!==f;++c)r[c]/=e;for(c=f-1;-1!==c;--c)i[c]/=e;for(o=l-1;-1!==o;--o)if(o!==a){for(t=h[o],n=m[o],e=t[a],c=a+1;c!==f;++c)t[c]-=r[c]*e;for(c=f-1;c>0;--c)n[c]-=i[c]*e,n[--c]-=i[c]*e;0===c&&(n[0]-=i[0]*e)}}return m},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var r,n,i,o,a,c,s,u,l=t[0],f=1,h=numeric.clone(e);for(n=0;n<l-1;n++){for(i=n,r=n+1;r<l;r++)Math.abs(h[r][n])>Math.abs(h[i][n])&&(i=r);for(i!==n&&(s=h[i],h[i]=h[n],h[n]=s,f*=-1),o=h[n],r=n+1;r<l;r++){for(c=(a=h[r])[n]/o[n],i=n+1;i<l-1;i+=2)u=i+1,a[i]-=o[i]*c,a[u]-=o[u]*c;i!==l&&(a[i]-=o[i]*c)}if(0===o[n])return 0;f*=o[n]}return f*h[n][n]},numeric.transpose=function(e){var t,r,n,i,o,a=e.length,c=e[0].length,s=Array(c);for(r=0;r<c;r++)s[r]=Array(a);for(t=a-1;t>=1;t-=2){for(i=e[t],n=e[t-1],r=c-1;r>=1;--r)(o=s[r])[t]=i[r],o[t-1]=n[r],(o=s[--r])[t]=i[r],o[t-1]=n[r];0===r&&((o=s[0])[t]=i[0],o[t-1]=n[0])}if(0===t){for(n=e[0],r=c-1;r>=1;--r)s[r][0]=n[r],s[--r][0]=n[r];0===r&&(s[0][0]=n[0])}return s},numeric.negtranspose=function(e){var t,r,n,i,o,a=e.length,c=e[0].length,s=Array(c);for(r=0;r<c;r++)s[r]=Array(a);for(t=a-1;t>=1;t-=2){for(i=e[t],n=e[t-1],r=c-1;r>=1;--r)(o=s[r])[t]=-i[r],o[t-1]=-n[r],(o=s[--r])[t]=-i[r],o[t-1]=-n[r];0===r&&((o=s[0])[t]=-i[0],o[t-1]=-n[0])}if(0===t){for(n=e[0],r=c-1;r>=1;--r)s[r][0]=-n[r],s[--r][0]=-n[r];0===r&&(s[0][0]=-n[0])}return s},numeric._random=function e(t,r){var n,i,o=t[r],a=Array(o);if(r===t.length-1){for(i=Math.random,n=o-1;n>=1;n-=2)a[n]=i(),a[n-1]=i();return 0===n&&(a[0]=i()),a}for(n=o-1;n>=0;n--)a[n]=e(t,r+1);return a},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,r){if(void 0===r&&(r=Math.max(Math.round(t-e)+1,1)),r<2)return 1===r?[e]:[];var n,i=Array(r);for(n=--r;n>=0;n--)i[n]=(n*t+(r-n)*e)/r;return i},numeric.getBlock=function(e,t,r){var n=numeric.dim(e);return function e(i,o){var a,c=t[o],s=r[o]-c,u=Array(s);if(o===n.length-1){for(a=s;a>=0;a--)u[a]=i[a+c];return u}for(a=s;a>=0;a--)u[a]=e(i[a+c],o+1);return u}(e,0)},numeric.setBlock=function(e,t,r,n){var i=numeric.dim(e);return function e(n,o,a){var c,s=t[a],u=r[a]-s;if(a===i.length-1)for(c=u;c>=0;c--)n[c+s]=o[c];for(c=u;c>=0;c--)e(n[c+s],o[c],a+1)}(e,n,0),e},numeric.getRange=function(e,t,r){var n,i,o,a,c=t.length,s=r.length,u=Array(c);for(n=c-1;-1!==n;--n)for(u[n]=Array(s),o=u[n],a=e[t[n]],i=s-1;-1!==i;--i)o[i]=a[r[i]];return u},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var r,n,i,o,a,c=t[0],s=t[1];for(r=0,n=0,i=0;i<c;++i)r+=e[i][0].length;for(o=0;o<s;++o)n+=e[0][o][0].length;var u=Array(r);for(i=0;i<r;++i)u[i]=Array(n);var l,f,h,m,p,d=0;for(i=0;i<c;++i){for(l=n,o=s-1;-1!==o;--o)for(l-=(a=e[i][o])[0].length,h=a.length-1;-1!==h;--h)for(p=a[h],f=u[d+h],m=p.length-1;-1!==m;--m)f[l+m]=p[m];d+=e[i][0].length}return u},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var r=numeric.dim(e),n=numeric.dim(t);if(1!==r.length||1!==n.length)throw new Error("numeric: tensor product is only defined for vectors");var i,o,a,c,s=r[0],u=n[0],l=Array(s);for(o=s-1;o>=0;o--){for(i=Array(u),c=e[o],a=u-1;a>=3;--a)i[a]=c*t[a],i[--a]=c*t[a],i[--a]=c*t[a],i[--a]=c*t[a];for(;a>=0;)i[a]=c*t[a],--a;l[o]=i}return l},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,r,n,i){var o;if(numeric.indexOf,"string"!=typeof i)for(o in i="",numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||t.indexOf(o)>=0||r.indexOf(o)>=0||n.indexOf(o)>=0)&&o.length>1&&(i+="var "+o+" = numeric."+o+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+n+");\n  }\n  return new numeric.T("+r+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var r=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,r),t(numeric.neg(this.y),r))}return new T(t(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var t=numeric.div;return this.y?new numeric.T(t(this.x,e.x),t(this.y,e.x)):new numeric.T(t(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,r=this.y;return r?new numeric.T(e(t),e(r)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,r=this.y;return r?new numeric.T(e(t),numeric.negtranspose(r)):new numeric.T(e(t))},numeric.Tunop=function(e,t,r){return"string"!=typeof r&&(r=""),Function("var x = this;\n"+r+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if(void 0===e.y)return new numeric.T(numeric.inv(e.x));var t,r,n,i,o,a,c,s,u,l,f,h,m,p,d,g,y,x,v=e.x.length,b=numeric.identity(v),_=numeric.rep([v,v],0),w=numeric.clone(e.x),k=numeric.clone(e.y);for(u=0;u<v;u++){for(h=(p=w[u][u])*p+(d=k[u][u])*d,f=u,l=u+1;l<v;l++)(m=(p=w[l][u])*p+(d=k[l][u])*d)>h&&(f=l,h=m);for(f!==u&&(x=w[u],w[u]=w[f],w[f]=x,x=k[u],k[u]=k[f],k[f]=x,x=b[u],b[u]=b[f],b[f]=x,x=_[u],_[u]=_[f],_[f]=x),t=w[u],r=k[u],o=b[u],a=_[u],p=t[u],d=r[u],l=u+1;l<v;l++)g=t[l],y=r[l],t[l]=(g*p+y*d)/h,r[l]=(y*p-g*d)/h;for(l=0;l<v;l++)g=o[l],y=a[l],o[l]=(g*p+y*d)/h,a[l]=(y*p-g*d)/h;for(l=u+1;l<v;l++){for(n=w[l],i=k[l],c=b[l],s=_[l],p=n[u],d=i[u],f=u+1;f<v;f++)g=t[f],y=r[f],n[f]-=g*p-y*d,i[f]-=y*p+g*d;for(f=0;f<v;f++)g=o[f],y=a[f],c[f]-=g*p-y*d,s[f]-=y*p+g*d}}for(u=v-1;u>0;u--)for(o=b[u],a=_[u],l=u-1;l>=0;l--)for(c=b[l],s=_[l],p=w[l][u],d=k[l][u],f=v-1;f>=0;f--)g=o[f],y=a[f],c[f]-=p*g-d*y,s[f]-=p*y+d*g;return new numeric.T(b,_)},numeric.T.prototype.get=function(e){var t,r=this.x,n=this.y,i=0,o=e.length;if(n){for(;i<o;)r=r[t=e[i]],n=n[t],i++;return new numeric.T(r,n)}for(;i<o;)r=r[t=e[i]],i++;return new numeric.T(r)},numeric.T.prototype.set=function(e,t){var r,n=this.x,i=this.y,o=0,a=e.length,c=t.x,s=t.y;if(0===a)return s?this.y=s:i&&(this.y=void 0),this.x=n,this;if(s){for(i||(i=numeric.rep(numeric.dim(n),0),this.y=i);o<a-1;)n=n[r=e[o]],i=i[r],o++;return n[r=e[o]]=c,i[r]=s,this}if(i){for(;o<a-1;)n=n[r=e[o]],i=i[r],o++;return n[r=e[o]]=c,i[r]=c instanceof Array?numeric.rep(numeric.dim(c),0):0,this}for(;o<a-1;)n=n[r=e[o]],o++;return n[r=e[o]]=c,this},numeric.T.prototype.getRows=function(e,t){var r,n,i=t-e+1,o=Array(i),a=this.x,c=this.y;for(r=e;r<=t;r++)o[r-e]=a[r];if(c){for(n=Array(i),r=e;r<=t;r++)n[r-e]=c[r];return new numeric.T(o,n)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,t,r){var n,i=this.x,o=this.y,a=r.x,c=r.y;for(n=e;n<=t;n++)i[n]=a[n-e];if(c)for(o||(o=numeric.rep(numeric.dim(i),0),this.y=o),n=e;n<=t;n++)o[n]=c[n-e];else if(o)for(n=e;n<=t;n++)o[n]=numeric.rep([a[n-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,r=this.y;return r?new numeric.T(t[e],r[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var r=this.x,n=this.y,i=t.x,o=t.y;return r[e]=i,o?(n||(n=numeric.rep(numeric.dim(r),0),this.y=n),n[e]=o):n&&(n=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var r=this.x,n=this.y,i=numeric.getBlock;return n?new numeric.T(i(r,e,t),i(n,e,t)):new numeric.T(i(r,e,t))},numeric.T.prototype.setBlock=function(e,t,r){r instanceof numeric.T||(r=new numeric.T(r));var n=this.x,i=this.y,o=numeric.setBlock,a=r.x,c=r.y;if(c)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),o(n,e,t,a),o(i,e,t,c),this;o(n,e,t,a),i&&o(i,e,t,numeric.rep(numeric.dim(a),0))},numeric.T.rep=function(e,t){var r=numeric.T;t instanceof r||(t=new r(t));var n=t.x,i=t.y,o=numeric.rep;return i?new r(o(e,n),o(e,i)):new r(o(e,n))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,r=e.y,n=numeric.diag;return r?new numeric.T(n(t),n(r)):new numeric.T(n(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,r=this.y;return r?new e.T(e.getDiag(t),e.getDiag(r)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),r=(e[0]>=0?1:-1)*numeric.norm2(e);t[0]+=r;var n=numeric.norm2(t);if(0===n)throw new Error("eig: internal error");return numeric.div(t,n)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var r,n,i,o,a,c,s,u,l,f,h=t[0],m=numeric.clone(e),p=numeric.identity(h);for(n=0;n<h-2;n++){for(o=Array(h-n-1),r=n+1;r<h;r++)o[r-n-1]=m[r][n];if(numeric.norm2(o)>0){for(a=numeric.house(o),c=numeric.getBlock(m,[n+1,n],[h-1,h-1]),s=numeric.tensor(a,numeric.dot(a,c)),r=n+1;r<h;r++)for(u=m[r],l=s[r-n-1],i=n;i<h;i++)u[i]-=2*l[i-n];for(c=numeric.getBlock(m,[0,n+1],[h-1,h-1]),s=numeric.tensor(numeric.dot(c,a),a),r=0;r<h;r++)for(u=m[r],l=s[r],i=n+1;i<h;i++)u[i]-=2*l[i-n-1];for(c=Array(h-n-1),r=n+1;r<h;r++)c[r-n-1]=p[r];for(s=numeric.tensor(a,numeric.dot(a,c)),r=n+1;r<h;r++)for(f=p[r],l=s[r-n-1],i=0;i<h;i++)f[i]-=2*l[i]}}return{H:m,Q:p}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(e,t){void 0===t&&(t=1e4),e=numeric.clone(e),numeric.clone(e);var r,n,i,o,a,c,s,u,l,f,h,m,p,d,g,y,x,v,b=numeric.dim(e)[0],_=numeric.identity(b);if(b<3)return{Q:_,B:[[0,b-1]]};var w=numeric.epsilon;for(v=0;v<t;v++){for(y=0;y<b-1;y++)if(Math.abs(e[y+1][y])<w*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){var k=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),$=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[b-1,b-1]),t);for(m=Array(y+1),g=0;g<=y;g++)m[g]=_[g];for(p=numeric.dot(k.Q,m),g=0;g<=y;g++)_[g]=p[g];for(m=Array(b-y-1),g=y+1;g<b;g++)m[g-y-1]=_[g];for(p=numeric.dot($.Q,m),g=y+1;g<b;g++)_[g]=p[g-y-1];return{Q:_,B:k.B.concat(numeric.add($.B,y+1))}}var M,T,A;if(i=e[b-2][b-2],o=e[b-2][b-1],a=e[b-1][b-2],u=i+(c=e[b-1][b-1]),s=i*c-o*a,l=numeric.getBlock(e,[0,0],[2,2]),u*u>=4*s)M=.5*(u+Math.sqrt(u*u-4*s)),T=.5*(u-Math.sqrt(u*u-4*s)),l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,M+T)),numeric.diag(numeric.rep([3],M*T)));else l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,u)),numeric.diag(numeric.rep([3],s)));for(r=[l[0][0],l[1][0],l[2][0]],n=numeric.house(r),m=[e[0],e[1],e[2]],p=numeric.tensor(n,numeric.dot(n,m)),g=0;g<3;g++)for(h=e[g],d=p[g],x=0;x<b;x++)h[x]-=2*d[x];for(m=numeric.getBlock(e,[0,0],[b-1,2]),p=numeric.tensor(numeric.dot(m,n),n),g=0;g<b;g++)for(h=e[g],d=p[g],x=0;x<3;x++)h[x]-=2*d[x];for(m=[_[0],_[1],_[2]],p=numeric.tensor(n,numeric.dot(n,m)),g=0;g<3;g++)for(f=_[g],d=p[g],x=0;x<b;x++)f[x]-=2*d[x];for(y=0;y<b-2;y++){for(x=y;x<=y+1;x++)if(Math.abs(e[x+1][x])<w*(Math.abs(e[x][x])+Math.abs(e[x+1][x+1]))){k=numeric.QRFrancis(numeric.getBlock(e,[0,0],[x,x]),t),$=numeric.QRFrancis(numeric.getBlock(e,[x+1,x+1],[b-1,b-1]),t);for(m=Array(x+1),g=0;g<=x;g++)m[g]=_[g];for(p=numeric.dot(k.Q,m),g=0;g<=x;g++)_[g]=p[g];for(m=Array(b-x-1),g=x+1;g<b;g++)m[g-x-1]=_[g];for(p=numeric.dot($.Q,m),g=x+1;g<b;g++)_[g]=p[g-x-1];return{Q:_,B:k.B.concat(numeric.add($.B,x+1))}}for(A=Math.min(b-1,y+3),r=Array(A-y),g=y+1;g<=A;g++)r[g-y-1]=e[g][y];for(n=numeric.house(r),m=numeric.getBlock(e,[y+1,y],[A,b-1]),p=numeric.tensor(n,numeric.dot(n,m)),g=y+1;g<=A;g++)for(h=e[g],d=p[g-y-1],x=y;x<b;x++)h[x]-=2*d[x-y];for(m=numeric.getBlock(e,[0,y+1],[b-1,A]),p=numeric.tensor(numeric.dot(m,n),n),g=0;g<b;g++)for(h=e[g],d=p[g],x=y+1;x<=A;x++)h[x]-=2*d[x-y-1];for(m=Array(A-y),g=y+1;g<=A;g++)m[g-y-1]=_[g];for(p=numeric.tensor(n,numeric.dot(n,m)),g=y+1;g<=A;g++)for(f=_[g],d=p[g-y-1],x=0;x<b;x++)f[x]-=2*d[x]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var r,n,i,o,a,c,s,u,l,f,h,m,p,d,g,y,x=numeric.toUpperHessenberg(e),v=numeric.QRFrancis(x.H,t),b=numeric.T,_=e.length,w=v.B,k=numeric.dot(v.Q,numeric.dot(x.H,numeric.transpose(v.Q))),$=new b(numeric.dot(v.Q,x.Q)),M=w.length,T=Math.sqrt;for(n=0;n<M;n++)if((r=w[n][0])===w[n][1]);else{if(o=r+1,a=k[r][r],c=k[r][o],s=k[o][r],u=k[o][o],0===c&&0===s)continue;(f=(l=-a-u)*l-4*(a*u-c*s))>=0?((g=(a-(h=l<0?-.5*(l-T(f)):-.5*(l+T(f))))*(a-h)+c*c)>(y=s*s+(u-h)*(u-h))?(p=(a-h)/(g=T(g)),d=c/g):(p=s/(y=T(y)),d=(u-h)/y),i=new b([[d,-p],[p,d]]),$.setRows(r,o,i.dot($.getRows(r,o)))):(h=-.5*l,m=.5*T(-f),(g=(a-h)*(a-h)+c*c)>(y=s*s+(u-h)*(u-h))?(p=(a-h)/(g=T(g+m*m)),d=c/g,h=0,m/=g):(p=s/(y=T(y+m*m)),d=(u-h)/y,h=m/y,m=0),i=new b([[d,-p],[p,d]],[[h,m],[m,-h]]),$.setRows(r,o,i.dot($.getRows(r,o))))}var A=$.dot(e).dot($.transjugate()),j=(_=e.length,numeric.T.identity(_));for(o=0;o<_;o++)if(o>0)for(n=o-1;n>=0;n--){var S=A.get([n,n]),E=A.get([o,o]);numeric.neq(S.x,E.x)||numeric.neq(S.y,E.y)?(h=A.getRow(n).getBlock([n],[o-1]),m=j.getRow(o).getBlock([n],[o-1]),j.set([o,n],A.get([n,o]).neg().sub(h.dot(m)).div(S.sub(E)))):j.setRow(o,j.getRow(n))}for(o=0;o<_;o++)h=j.getRow(o),j.setRow(o,h.div(h.norm2()));return j=j.transpose(),j=$.transjugate().dot(j),{lambda:A.getDiag(),E:j}},numeric.ccsSparse=function(e){var t,r,n,i=e.length,o=[];for(r=i-1;-1!==r;--r)for(n in t=e[r]){for(n=parseInt(n);n>=o.length;)o[o.length]=0;0!==t[n]&&o[n]++}var a=o.length,c=Array(a+1);for(c[0]=0,r=0;r<a;++r)c[r+1]=c[r]+o[r];var s=Array(c[a]),u=Array(c[a]);for(r=i-1;-1!==r;--r)for(n in t=e[r])0!==t[n]&&(o[n]--,s[c[n]+o[n]]=r,u[c[n]+o[n]]=t[n]);return[c,s,u]},numeric.ccsFull=function(e){var t,r,n,i,o=e[0],a=e[1],c=e[2],s=numeric.ccsDim(e),u=s[0],l=s[1],f=numeric.rep([u,l],0);for(t=0;t<l;t++)for(n=o[t],i=o[t+1],r=n;r<i;++r)f[a[r]][t]=c[r];return f},numeric.ccsTSolve=function(e,t,r,n,i){var o,a,c,s,u,l,f,h=e[0],m=e[1],p=e[2],d=h.length-1,g=Math.max,y=0;function x(e){var t;if(0===r[e]){for(r[e]=1,t=h[e];t<h[e+1];++t)x(m[t]);i[y]=e,++y}}for(void 0===n&&(r=numeric.rep([d],0)),void 0===n&&(n=numeric.linspace(0,r.length-1)),void 0===i&&(i=[]),o=n.length-1;-1!==o;--o)x(n[o]);for(i.length=y,o=i.length-1;-1!==o;--o)r[i[o]]=0;for(o=n.length-1;-1!==o;--o)a=n[o],r[a]=t[a];for(o=i.length-1;-1!==o;--o){for(a=i[o],c=h[a],s=g(h[a+1],c),u=c;u!==s;++u)if(m[u]===a){r[a]/=p[u];break}for(f=r[a],u=c;u!==s;++u)(l=m[u])!==a&&(r[l]-=f*p[u])}return r},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,r,n,i,o){var a,c,s,u=0,l=i.length,f=this.k,h=this.k1,m=this.j;if(0===n[e])for(n[e]=1,m[0]=e,f[0]=c=t[e],h[0]=s=t[e+1];;)if(c>=s){if(i[l]=m[u],0===u)return;++l,c=f[--u],s=h[u]}else 0===n[a=o[r[c]]]?(n[a]=1,f[u]=c,m[++u]=a,c=t[a],h[u]=s=t[a+1]):++c},numeric.ccsLPSolve=function(e,t,r,n,i,o,a){var c=e[0],s=e[1],u=e[2];c.length;var l,f,h,m,p,d,g,y,x,v=t[0],b=t[1],_=t[2];for(f=v[i],h=v[i+1],n.length=0,l=f;l<h;++l)a.dfs(o[b[l]],c,s,r,n,o);for(l=n.length-1;-1!==l;--l)r[n[l]]=0;for(l=f;l!==h;++l)r[m=o[b[l]]]=_[l];for(l=n.length-1;-1!==l;--l){for(p=c[m=n[l]],d=c[m+1],g=p;g<d;++g)if(o[s[g]]===m){r[m]/=u[g];break}for(x=r[m],g=p;g<d;++g)(y=o[s[g]])!==m&&(r[y]-=x*u[g])}return r},numeric.ccsLUP1=function(e,t){var r,n,i,o,a,c,s,u=e[0].length-1,l=[numeric.rep([u+1],0),[],[]],f=[numeric.rep([u+1],0),[],[]],h=l[0],m=l[1],p=l[2],d=f[0],g=f[1],y=f[2],x=numeric.rep([u],0),v=numeric.rep([u],0),b=numeric.ccsLPSolve,_=Math.abs,w=numeric.linspace(0,u-1),k=numeric.linspace(0,u-1),$=new numeric.ccsDFS(u);for(void 0===t&&(t=1),r=0;r<u;++r){for(b(l,e,x,v,r,k,$),o=-1,a=-1,n=v.length-1;-1!==n;--n)(i=v[n])<=r||(c=_(x[i]))>o&&(a=i,o=c);for(_(x[r])<t*o&&(n=w[r],o=w[a],w[r]=o,k[o]=r,w[a]=n,k[n]=a,o=x[r],x[r]=x[a],x[a]=o),o=h[r],a=d[r],s=x[r],m[o]=w[r],p[o]=1,++o,n=v.length-1;-1!==n;--n)c=x[i=v[n]],v[n]=0,x[i]=0,i<=r?(g[a]=i,y[a]=c,++a):(m[o]=w[i],p[o]=c/s,++o);h[r+1]=o,d[r+1]=a}for(n=m.length-1;-1!==n;--n)m[n]=k[m[n]];return{L:l,U:f,P:w,Pinv:k}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,r,n,i,o,a){var c,s,u,l=0,f=i.length,h=this.k,m=this.k1,p=this.j;if(0===n[e])for(n[e]=1,p[0]=e,h[0]=s=t[o[e]],m[0]=u=t[o[e]+1];;){if(isNaN(s))throw new Error("Ow!");if(s>=u){if(i[f]=o[p[l]],0===l)return;++f,s=h[--l],u=m[l]}else 0===n[c=r[s]]?(n[c]=1,h[l]=s,p[++l]=c,s=t[c=o[c]],m[l]=u=t[c+1]):++s}},numeric.ccsLPSolve0=function(e,t,r,n,i,o,a,c){var s=e[0],u=e[1],l=e[2];s.length;var f,h,m,p,d,g,y,x,v,b=t[0],_=t[1],w=t[2];for(h=b[i],m=b[i+1],n.length=0,f=h;f<m;++f)c.dfs(_[f],s,u,r,n,o,a);for(f=n.length-1;-1!==f;--f)r[a[p=n[f]]]=0;for(f=h;f!==m;++f)r[p=_[f]]=w[f];for(f=n.length-1;-1!==f;--f){for(x=a[p=n[f]],d=s[p],g=s[p+1],y=d;y<g;++y)if(u[y]===x){r[x]/=l[y];break}for(v=r[x],y=d;y<g;++y)r[u[y]]-=v*l[y];r[x]=v}},numeric.ccsLUP0=function(e,t){var r,n,i,o,a,c,s,u=e[0].length-1,l=[numeric.rep([u+1],0),[],[]],f=[numeric.rep([u+1],0),[],[]],h=l[0],m=l[1],p=l[2],d=f[0],g=f[1],y=f[2],x=numeric.rep([u],0),v=numeric.rep([u],0),b=numeric.ccsLPSolve0,_=Math.abs,w=numeric.linspace(0,u-1),k=numeric.linspace(0,u-1),$=new numeric.ccsDFS0(u);for(void 0===t&&(t=1),r=0;r<u;++r){for(b(l,e,x,v,r,k,w,$),o=-1,a=-1,n=v.length-1;-1!==n;--n)(i=v[n])<=r||(c=_(x[w[i]]))>o&&(a=i,o=c);for(_(x[w[r]])<t*o&&(n=w[r],o=w[a],w[r]=o,k[o]=r,w[a]=n,k[n]=a),o=h[r],a=d[r],s=x[w[r]],m[o]=w[r],p[o]=1,++o,n=v.length-1;-1!==n;--n)c=x[w[i=v[n]]],v[n]=0,x[w[i]]=0,i<=r?(g[a]=i,y[a]=c,++a):(m[o]=w[i],p[o]=c/s,++o);h[r+1]=o,d[r+1]=a}for(n=m.length-1;-1!==n;--n)m[n]=k[m[n]];return{L:l,U:f,P:w,Pinv:k}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,r){var n=numeric.ccsDim(e),i=n[0],o=n[1];void 0===t?t=numeric.linspace(0,i-1):"number"==typeof t&&(t=[t]),void 0===r?r=numeric.linspace(0,o-1):"number"==typeof r&&(r=[r]);var a,c,s,u,l=t.length,f=r.length,h=numeric.rep([o],0),m=[],p=[],d=[h,m,p],g=e[0],y=e[1],x=e[2],v=numeric.rep([i],0),b=0,_=numeric.rep([i],0);for(c=0;c<f;++c){var w=g[u=r[c]],k=g[u+1];for(a=w;a<k;++a)_[s=y[a]]=1,v[s]=x[a];for(a=0;a<l;++a)_[t[a]]&&(m[b]=a,p[b]=v[t[a]],++b);for(a=w;a<k;++a)_[s=y[a]]=0;h[c+1]=b}return d},numeric.ccsDot=function(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],a=t[1],c=t[2],s=numeric.ccsDim(e),u=numeric.ccsDim(t),l=s[0];s[1];var f,h,m,p,d,g,y,x,v,b,_,w=u[1],k=numeric.rep([l],0),$=numeric.rep([l],0),M=Array(l),T=numeric.rep([w],0),A=[],j=[],S=[T,A,j];for(m=0;m!==w;++m){for(p=o[m],d=o[m+1],v=0,h=p;h<d;++h)for(b=a[h],_=c[h],g=r[b],y=r[b+1],f=g;f<y;++f)0===$[x=n[f]]&&(M[v]=x,$[x]=1,v+=1),k[x]=k[x]+i[f]*_;for(d=(p=T[m])+v,T[m+1]=d,h=v-1;-1!==h;--h)_=p+h,f=M[h],A[_]=f,j[_]=k[f],$[f]=0,k[f]=0;T[m+1]=T[m]+v}return S},numeric.ccsLUPSolve=function(e,t){var r=e.L,n=e.U;e.P;var i=t[0],o=!1;"object"!=typeof i&&(i=(t=[[0,t.length],numeric.linspace(0,t.length-1),t])[0],o=!0);var a,c,s,u,l,f,h=t[1],m=t[2],p=r[0].length-1,d=i.length-1,g=numeric.rep([p],0),y=Array(p),x=numeric.rep([p],0),v=Array(p),b=numeric.rep([d+1],0),_=[],w=[],k=numeric.ccsTSolve,$=0;for(a=0;a<d;++a){for(l=0,s=i[a],u=i[a+1],c=s;c<u;++c)f=e.Pinv[h[c]],v[l]=f,x[f]=m[c],++l;for(v.length=l,k(r,x,g,v,y),c=v.length-1;-1!==c;--c)x[v[c]]=0;if(k(n,g,x,y,v),o)return x;for(c=y.length-1;-1!==c;--c)g[y[c]]=0;for(c=v.length-1;-1!==c;--c)f=v[c],_[$]=f,w[$]=x[f],x[f]=0,++$;b[a+1]=$}return[b,_,w]},numeric.ccsbinop=function(e,t){return void 0===t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,r=e[0],n=e[1],i=e[2],o=numeric.sup(n)+1,a=r.length,c=numeric.rep([o],0),s=Array(a),u=Array(a),l=numeric.rep([o],0);for(t=0;t<a;++t)l[n[t]]++;for(t=0;t<o;++t)c[t+1]=c[t]+l[t];var f,h,m=c.slice(0);for(t=0;t<a;++t)s[f=m[h=n[t]]]=r[t],u[f]=i[t],m[h]=m[h]+1;return[c,s,u]},numeric.ccsGather=function(e){var t,r,n,i,o,a=e[0],c=e[1],s=e[2],u=a.length-1,l=c.length,f=Array(l),h=Array(l),m=Array(l);for(o=0,t=0;t<u;++t)for(n=a[t],i=a[t+1],r=n;r!==i;++r)h[o]=t,f[o]=c[r],m[o]=s[r],++o;return[f,h,m]},numeric.sdim=function e(t,r,n){if(void 0===r&&(r=[]),"object"!=typeof t)return r;var i;for(i in void 0===n&&(n=0),n in r||(r[n]=0),t.length>r[n]&&(r[n]=t.length),t)t.hasOwnProperty(i)&&e(t[i],r,n+1);return r},numeric.sclone=function e(t,r,n){void 0===r&&(r=0),void 0===n&&(n=numeric.sdim(t).length);var i,o=Array(t.length);if(r===n-1){for(i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);return o}for(i in t)t.hasOwnProperty(i)&&(o[i]=e(t[i],r+1,n));return o},numeric.sdiag=function(e){var t,r,n=e.length,i=Array(n);for(t=n-1;t>=1;t-=2)r=t-1,i[t]=[],i[t][t]=e[t],i[r]=[],i[r][r]=e[r];return 0===t&&(i[0]=[],i[0][0]=e[t]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,r,n,i=[];for(t in e.length,e)if(e.hasOwnProperty(t))for(r in n=e[t])n.hasOwnProperty(r)&&("object"!=typeof i[r]&&(i[r]=[]),i[r][t]=n[r]);return i},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var r=e.length;t.length;var n,i,o,a,c,s,u,l=numeric.stranspose(t),f=l.length,h=Array(r);for(o=r-1;o>=0;o--){for(u=[],n=e[o],c=f-1;c>=0;c--){for(a in s=0,i=l[c],n)n.hasOwnProperty(a)&&a in i&&(s+=n[a]*i[a]);s&&(u[c]=s)}h[o]=u}return h},numeric.sdotMV=function(e,t){var r,n,i,o,a=e.length,c=Array(a);for(n=a-1;n>=0;n--){for(i in o=0,r=e[n])r.hasOwnProperty(i)&&t[i]&&(o+=r[i]*t[i]);o&&(c[n]=o)}return c},numeric.sdotVM=function(e,t){var r,n,i,o,a=[];for(r in e)if(e.hasOwnProperty(r))for(n in i=t[r],o=e[r],i)i.hasOwnProperty(n)&&(a[n]||(a[n]=0),a[n]+=o*i[n]);return a},numeric.sdotVV=function(e,t){var r,n=0;for(r in e)e[r]&&t[r]&&(n+=e[r]*t[r]);return n},numeric.sdot=function(e,t){var r=numeric.sdim(e).length,n=numeric.sdim(t).length;switch(1e3*r+n){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+r+" and "+n)}},numeric.sscatter=function(e){var t,r,n,i,o=e[0].length,a=e.length,c=[];for(r=o-1;r>=0;--r)if(e[a-1][r]){for(i=c,n=0;n<a-2;n++)i[t=e[n][r]]||(i[t]=[]),i=i[t];i[e[n][r]]=e[n+1][r]}return c},numeric.sgather=function e(t,r,n){var i,o,a;for(o in void 0===r&&(r=[]),void 0===n&&(n=[]),i=n.length,t)if(t.hasOwnProperty(o))if(n[i]=parseInt(o),"number"==typeof(a=t[o])){if(a){if(0===r.length)for(o=i+1;o>=0;--o)r[o]=[];for(o=i;o>=0;--o)r[o].push(n[o]);r[i+1].push(a)}}else e(a,r,n);return n.length>i&&n.pop(),r},numeric.cLU=function(e){var t,r,n,i,o,a,c=e[0],s=e[1],u=e[2],l=c.length,f=0;for(t=0;t<l;t++)c[t]>f&&(f=c[t]);f++;var h,m=Array(f),p=Array(f),d=numeric.rep([f],1/0),g=numeric.rep([f],-1/0);for(n=0;n<l;n++)t=c[n],(r=s[n])<d[t]&&(d[t]=r),r>g[t]&&(g[t]=r);for(t=0;t<f-1;t++)g[t]>g[t+1]&&(g[t+1]=g[t]);for(t=f-1;t>=1;t--)d[t]<d[t-1]&&(d[t-1]=d[t]);for(t=0;t<f;t++)p[t]=numeric.rep([g[t]-d[t]+1],0),m[t]=numeric.rep([t-d[t]],0),t-d[t]+1,g[t]-t+1;for(n=0;n<l;n++)p[t=c[n]][s[n]-d[t]]=u[n];for(t=0;t<f-1;t++)for(i=t-d[t],v=p[t],r=t+1;d[r]<=t&&r<f;r++)if(o=t-d[r],a=g[t]-t,h=(b=p[r])[o]/v[i]){for(n=1;n<=a;n++)b[n+o]-=h*v[n+i];m[r][t-d[r]]=h}var y,x,v=[],b=[],_=[],w=[],k=[],$=[];for(l=0,y=0,t=0;t<f;t++){for(i=d[t],o=g[t],x=p[t],r=t;r<=o;r++)x[r-i]&&(v[l]=t,b[l]=r,_[l]=x[r-i],l++);for(x=m[t],r=i;r<t;r++)x[r-i]&&(w[y]=t,k[y]=r,$[y]=x[r-i],y++);w[y]=t,k[y]=t,$[y]=1,y++}return{U:[v,b,_],L:[w,k,$]}},numeric.cLUsolve=function(e,t){var r=e.L,n=e.U,i=numeric.clone(t),o=r[0],a=r[1],c=r[2],s=n[0],u=n[1],l=n[2],f=s.length;o.length;var h,m,p=i.length;for(m=0,h=0;h<p;h++){for(;a[m]<h;)i[h]-=c[m]*i[a[m]],m++;m++}for(m=f-1,h=p-1;h>=0;h--){for(;u[m]>h;)i[h]-=l[m]*i[u[m]],m--;i[h]/=l[m],m--}return i},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var r,n,i,o=numeric.rep(e,-1);if("function"!=typeof t)if("L"===t)t=function(t,r){return t>=e[0]/2||r<e[1]/2};else t=function(e,t){return!0};for(i=0,r=1;r<e[0]-1;r++)for(n=1;n<e[1]-1;n++)t(r,n)&&(o[r][n]=i,i++);return o},numeric.cdelsq=function(e){var t,r,n,i,o,a=[[-1,0],[0,-1],[0,1],[1,0]],c=numeric.dim(e),s=c[0],u=c[1],l=[],f=[],h=[];for(t=1;t<s-1;t++)for(r=1;r<u-1;r++)if(!(e[t][r]<0)){for(n=0;n<4;n++)i=t+a[n][0],o=r+a[n][1],e[i][o]<0||(l.push(e[t][r]),f.push(e[i][o]),h.push(-1));l.push(e[t][r]),f.push(e[t][r]),h.push(4)}return[l,f,h]},numeric.cdotMV=function(e,t){var r,n,i,o=e[0],a=e[1],c=e[2],s=o.length;for(i=0,n=0;n<s;n++)o[n]>i&&(i=o[n]);for(i++,r=numeric.rep([i],0),n=0;n<s;n++)r[o[n]]+=c[n]*t[a[n]];return r},numeric.Spline=function(e,t,r,n,i){this.x=e,this.yl=t,this.yr=r,this.kl=n,this.kr=i},numeric.Spline.prototype._at=function(e,t){var r,n,i,o=this.x,a=this.yl,c=this.yr,s=this.kl,u=this.kr,l=numeric.add,f=numeric.sub,h=numeric.mul;r=f(h(s[t],o[t+1]-o[t]),f(c[t+1],a[t])),n=l(h(u[t+1],o[t]-o[t+1]),f(c[t+1],a[t]));var m=(i=(e-o[t])/(o[t+1]-o[t]))*(1-i);return l(l(l(h(1-i,a[t]),h(i,c[t+1])),h(r,m*(1-i))),h(n,m*i))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,r,n,i=this.x,o=i.length,a=Math.floor;for(t=0,r=o-1;r-t>1;)i[n=a((t+r)/2)]<=e?t=n:r=n;return this._at(e,t)}o=e.length;var c,s=Array(o);for(c=o-1;-1!==c;--c)s[c]=this.at(e[c]);return s},numeric.Spline.prototype.diff=function(){var e,t,r,n=this.x,i=this.yl,o=this.yr,a=this.kl,c=this.kr,s=i.length,u=a,l=c,f=Array(s),h=Array(s),m=numeric.add,p=numeric.mul,d=numeric.div,g=numeric.sub;for(e=s-1;-1!==e;--e)t=n[e+1]-n[e],r=g(o[e+1],i[e]),f[e]=d(m(p(r,6),p(a[e],-4*t),p(c[e+1],-2*t)),t*t),h[e+1]=d(m(p(r,-6),p(a[e],2*t),p(c[e+1],4*t)),t*t);return new numeric.Spline(n,u,l,f,h)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],r=this.x,n=this.yl,i=this.yr,o=this.kl,a=this.kr;"number"==typeof n[0]&&(n=[n],i=[i],o=[o],a=[a]);var c,s,u,l,f,h,m,p,d,g,y,x,v,b,_,w,k,$,M,T,A,j,S,E=n.length,C=r.length-1,P=(t=Array(E),Math.sqrt);for(c=0;c!==E;++c){for(l=n[c],f=i[c],h=o[c],m=a[c],p=[],s=0;s!==C;s++){for(s>0&&f[s]*l[s]<0&&p.push(r[s]),w=r[s+1]-r[s],r[s],y=l[s],x=f[s+1],d=h[s]/w,v=(g=m[s+1]/w)+3*y+2*d-3*x,b=3*(g+d+2*(y-x)),(_=e(d-g+3*(y-x))+12*g*y)<=0?k=($=v/b)>r[s]&&$<r[s+1]?[r[s],$,r[s+1]]:[r[s],r[s+1]]:($=(v-P(_))/b,M=(v+P(_))/b,k=[r[s]],$>r[s]&&$<r[s+1]&&k.push($),M>r[s]&&M<r[s+1]&&k.push(M),k.push(r[s+1])),A=k[0],$=this._at(A,s),u=0;u<k.length-1;u++)if(j=k[u+1],M=this._at(j,s),0!==$)if(0===M||$*M>0)A=j,$=M;else{for(var L=0;!((S=($*j-M*A)/($-M))<=A||S>=j);)if((T=this._at(S,s))*M>0)j=S,M=T,-1===L&&($*=.5),L=-1;else{if(!(T*$>0))break;A=S,$=T,1===L&&(M*=.5),L=1}p.push(S),A=k[u+1],$=this._at(A,s)}else p.push(A),A=j,$=M;0===M&&p.push(j)}t[c]=p}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,r,n){var i,o=e.length,a=[],c=[],s=[],u=numeric.sub,l=numeric.mul,f=numeric.add;for(i=o-2;i>=0;i--)c[i]=e[i+1]-e[i],s[i]=u(t[i+1],t[i]);"string"!=typeof r&&"string"!=typeof n||(r=n="periodic");var h=[[],[],[]];switch(typeof r){case"undefined":a[0]=l(3/(c[0]*c[0]),s[0]),h[0].push(0,0),h[1].push(0,1),h[2].push(2/c[0],1/c[0]);break;case"string":a[0]=f(l(3/(c[o-2]*c[o-2]),s[o-2]),l(3/(c[0]*c[0]),s[0])),h[0].push(0,0,0),h[1].push(o-2,0,1),h[2].push(1/c[o-2],2/c[o-2]+2/c[0],1/c[0]);break;default:a[0]=r,h[0].push(0),h[1].push(0),h[2].push(1)}for(i=1;i<o-1;i++)a[i]=f(l(3/(c[i-1]*c[i-1]),s[i-1]),l(3/(c[i]*c[i]),s[i])),h[0].push(i,i,i),h[1].push(i-1,i,i+1),h[2].push(1/c[i-1],2/c[i-1]+2/c[i],1/c[i]);switch(typeof n){case"undefined":a[o-1]=l(3/(c[o-2]*c[o-2]),s[o-2]),h[0].push(o-1,o-1),h[1].push(o-2,o-1),h[2].push(1/c[o-2],2/c[o-2]);break;case"string":h[1][h[1].length-1]=0;break;default:a[o-1]=n,h[0].push(o-1),h[1].push(o-1),h[2].push(1)}a="number"!=typeof a[0]?numeric.transpose(a):[a];var m=Array(a.length);if("string"==typeof r)for(i=m.length-1;-1!==i;--i)m[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(h)),a[i]),m[i][o-1]=m[i][0];else for(i=m.length-1;-1!==i;--i)m[i]=numeric.cLUsolve(numeric.cLU(h),a[i]);return m="number"==typeof t[0]?m[0]:numeric.transpose(m),new numeric.Spline(e,t,t,m,m)},numeric.fftpow2=function e(t,r){var n=t.length;if(1!==n){var i,o,a=Math.cos,c=Math.sin,s=Array(n/2),u=Array(n/2),l=Array(n/2),f=Array(n/2);for(o=n/2,i=n-1;-1!==i;--i)l[--o]=t[i],f[o]=r[i],--i,s[o]=t[i],u[o]=r[i];e(s,u),e(l,f),o=n/2;var h,m,p,d=-6.283185307179586/n;for(i=n-1;-1!==i;--i)-1===--o&&(o=n/2-1),m=a(h=d*i),p=c(h),t[i]=s[o]+m*l[o]-p*f[o],r[i]=u[o]+m*f[o]+p*l[o]}},numeric._ifftpow2=function e(t,r){var n=t.length;if(1!==n){var i,o,a=Math.cos,c=Math.sin,s=Array(n/2),u=Array(n/2),l=Array(n/2),f=Array(n/2);for(o=n/2,i=n-1;-1!==i;--i)l[--o]=t[i],f[o]=r[i],--i,s[o]=t[i],u[o]=r[i];e(s,u),e(l,f),o=n/2;var h,m,p,d=6.283185307179586/n;for(i=n-1;-1!==i;--i)-1===--o&&(o=n/2-1),m=a(h=d*i),p=c(h),t[i]=s[o]+m*l[o]-p*f[o],r[i]=u[o]+m*f[o]+p*l[o]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,r,n){var i,o,a,c,s;for(numeric.fftpow2(e,t),numeric.fftpow2(r,n),i=e.length-1;-1!==i;--i)o=e[i],c=t[i],a=r[i],s=n[i],e[i]=o*a-c*s,t[i]=o*s+c*a;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,r=this.x,n=this.y,i=r.length,o=Math.log,a=o(2),c=Math.ceil(o(2*i-1)/a),s=Math.pow(2,c),u=numeric.rep([s],0),l=numeric.rep([s],0),f=Math.cos,h=Math.sin,m=-3.141592653589793/i,p=numeric.rep([s],0),d=numeric.rep([s],0);for(e=0;e<i;e++)p[e]=r[e];if(void 0!==n)for(e=0;e<i;e++)d[e]=n[e];for(u[0]=1,e=1;e<=s/2;e++)t=m*e*e,u[e]=f(t),l[e]=h(t),u[s-e]=f(t),l[s-e]=h(t);var g=new numeric.T(p,d),y=new numeric.T(u,l);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),(g=g.mul(y)).x.length=i,g.y.length=i,g},numeric.T.prototype.ifft=function(){var e,t,r=this.x,n=this.y,i=r.length,o=Math.log,a=o(2),c=Math.ceil(o(2*i-1)/a),s=Math.pow(2,c),u=numeric.rep([s],0),l=numeric.rep([s],0),f=Math.cos,h=Math.sin,m=3.141592653589793/i,p=numeric.rep([s],0),d=numeric.rep([s],0);for(e=0;e<i;e++)p[e]=r[e];if(void 0!==n)for(e=0;e<i;e++)d[e]=n[e];for(u[0]=1,e=1;e<=s/2;e++)t=m*e*e,u[e]=f(t),l[e]=h(t),u[s-e]=f(t),l[s-e]=h(t);var g=new numeric.T(p,d),y=new numeric.T(u,l);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),(g=g.mul(y)).x.length=i,g.y.length=i,g.div(i)},numeric.gradient=function(e,t){var r=t.length,n=e(t);if(isNaN(n))throw new Error("gradient: f(x) is a NaN!");var i,o,a,c=Math.max,s=numeric.clone(t),u=Array(r);numeric.div,numeric.sub;c=Math.max;var l,f,h,m,p,d,g=Math.abs,y=Math.min,x=0;for(i=0;i<r;i++)for(var v=c(1e-6*n,1e-8);;){if(++x>20)throw new Error("Numerical gradient fails");if(s[i]=t[i]+v,o=e(s),s[i]=t[i]-v,a=e(s),s[i]=t[i],isNaN(o)||isNaN(a))v/=16;else{if(u[i]=(o-a)/(2*v),l=t[i]-v,f=t[i],h=t[i]+v,m=(o-n)/v,p=(n-a)/v,d=c(g(u[i]),g(n),g(o),g(a),g(l),g(f),g(h),1e-8),!(y(c(g(m-u[i]),g(p-u[i]),g(m-p))/d,v/d)>.001))break;v/=16}}return u},numeric.uncmin=function(e,t,r,n,i,o,a){var c=numeric.gradient;void 0===a&&(a={}),void 0===r&&(r=1e-8),void 0===n&&(n=function(t){return c(e,t)}),void 0===i&&(i=1e3);var s,u,l=(t=numeric.clone(t)).length,f=e(t);if(isNaN(f))throw new Error("uncmin: f(x0) is a NaN!");var h=Math.max,m=numeric.norm2;r=h(r,numeric.epsilon);var p,d,g,y=a.Hinv||numeric.identity(l),x=numeric.dot;numeric.inv;var v,b,_,w,k,$,M,T=numeric.sub,A=numeric.add,j=numeric.tensor,S=numeric.div,E=numeric.mul,C=numeric.all,P=numeric.isFinite,L=numeric.neg,q=0,V="";for(d=n(t);q<i;){if("function"==typeof o&&o(q,t,f,d,y)){V="Callback returned true";break}if(!C(P(d))){V="Gradient has Infinity or NaN";break}if(!C(P(p=L(x(y,d))))){V="Search direction has Infinity or NaN";break}if((M=m(p))<r){V="Newton step smaller than tol";break}for($=1,u=x(d,p),b=t;q<i&&!($*M<r)&&(b=A(t,v=E(p,$)),(s=e(b))-f>=.1*$*u||isNaN(s));)$*=.5,++q;if($*M<r){V="Line search step size smaller than tol";break}if(q===i){V="maxit reached during line search";break}k=x(_=T(g=n(b),d),v),w=x(y,_),y=T(A(y,E((k+x(_,w))/(k*k),j(v,v))),S(A(j(w,v),j(v,w)),k)),t=b,f=s,d=g,++q}return{solution:t,f:f,gradient:d,invHessian:y,iterations:q,message:V}},numeric.Dopri=function(e,t,r,n,i,o,a){this.x=e,this.y=t,this.f=r,this.ymid=n,this.iterations=i,this.events=a,this.message=o},numeric.Dopri.prototype._at=function(e,t){function r(e){return e*e}var n,i,o,a,c,s,u=this,l=u.x,f=u.y,h=u.f,m=u.ymid;l.length;var p,d,g,y=numeric.add,x=numeric.mul,v=numeric.sub;return n=l[t],i=l[t+1],a=f[t],c=f[t+1],o=n+.5*(i-n),s=m[t],p=v(h[t],x(a,1/(n-o)+2/(n-i))),d=v(h[t+1],x(c,1/(i-o)+2/(i-n))),y(y(y(y(x(a,(g=[r(e-i)*(e-o)/r(n-i)/(n-o),r(e-n)*r(e-i)/r(n-o)/r(i-o),r(e-n)*(e-o)/r(i-n)/(i-o),(e-n)*r(e-i)*(e-o)/r(n-i)/(n-o),(e-i)*r(e-n)*(e-o)/r(n-i)/(i-o)])[0]),x(s,g[1])),x(c,g[2])),x(p,g[3])),x(d,g[4]))},numeric.Dopri.prototype.at=function(e){var t,r,n,i=Math.floor;if("number"!=typeof e){var o=e.length,a=Array(o);for(t=o-1;-1!==t;--t)a[t]=this.at(e[t]);return a}var c=this.x;for(t=0,r=c.length-1;r-t>1;)c[n=i(.5*(t+r))]<=e?t=n:r=n;return this._at(e,t)},numeric.dopri=function(e,t,r,n,i,o,a){void 0===i&&(i=1e-6),void 0===o&&(o=1e3);var c,s,u,l,f,h,m,p,d,g,y,x,v,b=[e],_=[r],w=[n(e,r)],k=[],$=[3/40,9/40],M=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],A=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],j=[35/384,0,500/1113,125/192,-2187/6784,11/84],S=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],E=[.2,.3,.8,8/9,1,1],C=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],P=0,L=(t-e)/10,q=0,V=numeric.add,N=numeric.mul,F=Math.min,R=Math.abs,z=numeric.norminf,O=Math.pow,B=numeric.any,I=numeric.lt,D=numeric.and;numeric.sub;var U=new numeric.Dopri(b,_,w,k,-1,"");for("function"==typeof a&&(y=a(e,r));e<t&&q<o;)if(++q,e+L>t&&(L=t-e),c=n(e+E[0]*L,V(r,N(.2*L,w[P]))),s=n(e+E[1]*L,V(V(r,N($[0]*L,w[P])),N($[1]*L,c))),u=n(e+E[2]*L,V(V(V(r,N(M[0]*L,w[P])),N(M[1]*L,c)),N(M[2]*L,s))),l=n(e+E[3]*L,V(V(V(V(r,N(T[0]*L,w[P])),N(T[1]*L,c)),N(T[2]*L,s)),N(T[3]*L,u))),f=n(e+E[4]*L,V(V(V(V(V(r,N(A[0]*L,w[P])),N(A[1]*L,c)),N(A[2]*L,s)),N(A[3]*L,u)),N(A[4]*L,l))),h=n(e+L,d=V(V(V(V(V(r,N(w[P],L*j[0])),N(s,L*j[2])),N(u,L*j[3])),N(l,L*j[4])),N(f,L*j[5]))),(g="number"==typeof(m=V(V(V(V(V(N(w[P],L*C[0]),N(s,L*C[2])),N(u,L*C[3])),N(l,L*C[4])),N(f,L*C[5])),N(h,L*C[6])))?R(m):z(m))>i){if(e+(L=.2*L*O(i/g,.25))===e){U.msg="Step size became too small";break}}else{if(k[P]=V(V(V(V(V(V(r,N(w[P],L*S[0])),N(s,L*S[2])),N(u,L*S[3])),N(l,L*S[4])),N(f,L*S[5])),N(h,L*S[6])),b[++P]=e+L,_[P]=d,w[P]=h,"function"==typeof a){var H,X,Y=e,Q=e+.5*L;if(x=a(Q,k[P-1]),B(v=D(I(y,0),I(0,x)))||(Y=Q,y=x,x=a(Q=e+L,d),v=D(I(y,0),I(0,x))),B(v)){for(var Z,J,G=0,W=1,K=1;;){if("number"==typeof y)X=(K*x*Y-W*y*Q)/(K*x-W*y);else for(X=Q,p=y.length-1;-1!==p;--p)y[p]<0&&x[p]>0&&(X=F(X,(K*x[p]*Y-W*y[p]*Q)/(K*x[p]-W*y[p])));if(X<=Y||X>=Q)break;J=a(X,H=U._at(X,P-1)),B(Z=D(I(y,0),I(0,J)))?(Q=X,x=J,v=Z,K=1,-1===G?W*=.5:W=1,G=-1):(Y=X,y=J,W=1,1===G?K*=.5:K=1,G=1)}return d=U._at(.5*(e+X),P-1),U.f[P]=n(X,H),U.x[P]=X,U.y[P]=H,U.ymid[P-1]=d,U.events=v,U.iterations=q,U}}e+=L,r=d,y=x,L=F(.8*L*O(i/g,.25),4*L)}return U.iterations=q,U},numeric.LU=function(e,t){t=t||!1;var r,n,i,o,a,c,s,u,l,f=Math.abs,h=e.length,m=h-1,p=new Array(h);for(t||(e=numeric.clone(e)),i=0;i<h;++i){for(s=i,l=f((c=e[i])[i]),n=i+1;n<h;++n)l<(o=f(e[n][i]))&&(l=o,s=n);for(p[i]=s,s!=i&&(e[i]=e[s],e[s]=c,c=e[i]),a=c[i],r=i+1;r<h;++r)e[r][i]/=a;for(r=i+1;r<h;++r){for(u=e[r],n=i+1;n<m;++n)u[n]-=u[i]*c[n],u[++n]-=u[i]*c[n];n===m&&(u[n]-=u[i]*c[n])}}return{LU:e,P:p}},numeric.LUsolve=function(e,t){var r,n,i,o,a,c=e.LU,s=c.length,u=numeric.clone(t),l=e.P;for(r=s-1;-1!==r;--r)u[r]=t[r];for(r=0;r<s;++r)for(i=l[r],l[r]!==r&&(a=u[r],u[r]=u[i],u[i]=a),o=c[r],n=0;n<r;++n)u[r]-=u[n]*o[n];for(r=s-1;r>=0;--r){for(o=c[r],n=r+1;n<s;++n)u[r]-=u[n]*o[n];u[r]/=o[r]}return u},numeric.solve=function(e,t,r){return numeric.LUsolve(numeric.LU(e,r),t)},numeric.echelonize=function(e){var t,r,n,i,o,a,c,s,u=numeric.dim(e),l=u[0],f=u[1],h=numeric.identity(l),m=Array(l),p=Math.abs,d=numeric.diveq;for(e=numeric.clone(e),t=0;t<l;++t){for(n=0,o=e[t],a=h[t],r=1;r<f;++r)p(o[n])<p(o[r])&&(n=r);for(m[t]=n,d(a,o[n]),d(o,o[n]),r=0;r<l;++r)if(r!==t){for(s=(c=e[r])[n],i=f-1;-1!==i;--i)c[i]-=o[i]*s;for(c=h[r],i=l-1;-1!==i;--i)c[i]-=a[i]*s}}return{I:h,A:e,P:m}},numeric.__solveLP=function(e,t,r,n,i,o,a){var c=numeric.sum;numeric.log;var s,u=numeric.mul,l=numeric.sub,f=numeric.dot,h=numeric.div,m=numeric.add,p=e.length,d=r.length,g=!1,y=1;numeric.transpose(t),numeric.svd;var x=numeric.transpose;numeric.leq;var v=Math.sqrt,b=Math.abs;numeric.muleq,numeric.norminf,numeric.any;var _,w=Math.min,k=numeric.all,$=numeric.gt,M=Array(p),T=Array(d);numeric.rep([d],1);var A,j,S=numeric.solve,E=l(r,f(t,o)),C=f(e,e);for(A=0;A<i;++A){var P,L;for(P=d-1;-1!==P;--P)T[P]=h(t[P],E[P]);var q=x(T);for(P=p-1;-1!==P;--P)M[P]=c(q[P]);y=.25*b(C/f(e,M));var V=100*v(C/f(M,M));for((!isFinite(y)||y>V)&&(y=V),j=m(e,u(y,M)),_=f(q,T),P=p-1;-1!==P;--P)_[P][P]+=1;L=S(_,h(j,y),!0);var N=h(E,f(t,L)),F=1;for(P=d-1;-1!==P;--P)N[P]<0&&(F=w(F,-.999*N[P]));if(s=l(o,u(L,F)),!k($(E=l(r,f(t,s)),0)))return{solution:o,message:"",iterations:A};if(o=s,y<n)return{solution:s,message:"",iterations:A};if(a){var R=f(e,j),z=f(t,j);for(g=!0,P=d-1;-1!==P;--P)if(R*z[P]<0){g=!1;break}}else g=!(o[p-1]>=0);if(g)return{solution:s,message:"Unbounded",iterations:A}}return{solution:o,message:"maximum iteration count exceeded",iterations:A}},numeric._solveLP=function(e,t,r,n,i){var o=e.length,a=r.length;numeric.sum,numeric.log,numeric.mul;var c=numeric.sub,s=numeric.dot;numeric.div,numeric.add;var u=numeric.rep([o],0).concat([1]),l=numeric.rep([a,1],-1),f=numeric.blockMatrix([[t,l]]),h=r,m=numeric.rep([o],0).concat(Math.max(0,numeric.sup(numeric.neg(r)))+1),p=numeric.__solveLP(u,f,h,n,i,m,!1),d=numeric.clone(p.solution);if(d.length=o,numeric.inf(c(r,s(t,d)))<0)return{solution:NaN,message:"Infeasible",iterations:p.iterations};var g=numeric.__solveLP(e,t,r,n,i-p.iterations,d,!0);return g.iterations+=p.iterations,g},numeric.solveLP=function(e,t,r,n,i,o,a){if(void 0===a&&(a=1e3),void 0===o&&(o=numeric.epsilon),void 0===n)return numeric._solveLP(e,t,r,o,a);var c,s=n.length,u=n[0].length,l=t.length,f=numeric.echelonize(n),h=numeric.rep([u],0),m=f.P,p=[];for(c=m.length-1;-1!==c;--c)h[m[c]]=1;for(c=u-1;-1!==c;--c)0===h[c]&&p.push(c);var d=numeric.getRange,g=numeric.linspace(0,s-1),y=numeric.linspace(0,l-1),x=d(n,g,p),v=d(t,y,m),b=d(t,y,p),_=numeric.dot,w=numeric.sub,k=_(v,f.I),$=w(b,_(k,x)),M=w(r,_(k,i)),T=Array(m.length),A=Array(p.length);for(c=m.length-1;-1!==c;--c)T[c]=e[m[c]];for(c=p.length-1;-1!==c;--c)A[c]=e[p[c]];var j=w(A,_(T,_(f.I,x))),S=numeric._solveLP(j,$,M,o,a),E=S.solution;if(E!=E)return S;var C=_(f.I,w(i,_(x,E))),P=Array(e.length);for(c=m.length-1;-1!==c;--c)P[m[c]]=C[c];for(c=p.length-1;-1!==c;--c)P[p[c]]=E[c];return{solution:P,message:S.message,iterations:S.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var t,r,n,i,o=0,a=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],c=e.length,s=0,u={},l=[],f=0,h={},m=0,p=[],d=[],g=[];function y(r){throw new Error("MPStoLP: "+r+"\nLine "+t+": "+e[t]+"\nCurrent state: "+a[o]+"\n")}for(t=0;t<c;++t){var x=(n=e[t]).match(/\S*/g),v=[];for(r=0;r<x.length;++r)""!==x[r]&&v.push(x[r]);if(0!==v.length){for(r=0;r<a.length&&n.substr(0,a[r].length)!==a[r];++r);if(r<a.length){if(o=r,1===r&&(i=v[1]),6===r)return{name:i,c:p,A:numeric.transpose(d),b:g,rows:u,vars:h}}else switch(o){case 0:case 1:y("Unexpected line");case 2:switch(v[0]){case"N":0===s?s=v[1]:y("Two or more N rows");break;case"L":u[v[1]]=f,l[f]=1,g[f]=0,++f;break;case"G":u[v[1]]=f,l[f]=-1,g[f]=0,++f;break;case"E":u[v[1]]=f,l[f]=0,g[f]=0,++f;break;default:y("Parse error "+numeric.prettyPrint(v))}break;case 3:h.hasOwnProperty(v[0])||(h[v[0]]=m,p[m]=0,d[m]=numeric.rep([f],0),++m);var b=h[v[0]];for(r=1;r<v.length;r+=2)if(v[r]!==s){var _=u[v[r]];d[b][_]=(l[_]<0?-1:1)*parseFloat(v[r+1])}else p[b]=parseFloat(v[r+1]);break;case 4:for(r=1;r<v.length;r+=2)g[u[v[r]]]=(l[u[v[r]]]<0?-1:1)*parseFloat(v[r+1]);break;case 5:break;case 6:y("Internal error")}}}y("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,r,n,i,o,a){function c(e){var t,n,i=this,o=e.length,a=0,c=i.i=i.j=i.m=0;for(i.S=[],i.c=[],o||(e=[o++]);a<r;)i.S[a]=a++;for(a=0;a<r;a++)c=l(c+(t=i.S[a])+e[a%o]),n=i.S[c],i.S[a]=n,i.S[c]=t;i.g=function(e){var t=i.S,n=l(i.i+1),o=t[n],a=l(i.j+o),c=t[a];t[n]=c,t[a]=o;for(var s=t[l(o+c)];--e;)n=l(n+1),c=t[a=l(a+(o=t[n]))],t[n]=c,t[a]=o,s=s*r+t[l(o+c)];return i.i=n,i.j=a,s},i.g(r)}function s(e,t,r,n,i){if(r=[],i=typeof e,t&&"object"==i)for(n in e)if(n.indexOf("S")<5)try{r.push(s(e[n],t-1))}catch(e){}return r.length?r:e+("string"!=i?"\0":"")}function u(e,t,r,n){for(e+="",r=0,n=0;n<e.length;n++)t[l(n)]=l((r^=19*t[l(n)])+e.charCodeAt(n));for(n in e="",t)e+=String.fromCharCode(t[n]);return e}function l(e){return 255&e}t.seedrandom=function(n,l){var f,h=[];return n=u(s(l?[n,e]:arguments.length?n:[(new Date).getTime(),e,window],3),h),u((f=new c(h)).S,e),t.random=function(){for(var e=f.g(6),t=a,n=0;e<i;)e=(e+n)*r,t*=r,n=f.g(1);for(;e>=o;)e/=2,t/=2,n>>>=1;return(e+n)/t},n},a=t.pow(r,6),i=t.pow(2,i),o=2*i,u(t.random(),e)}([],numeric.seedrandom,256,0,52),function(e){function t(e){if("object"!=typeof e)return e;var r,n=[],i=e.length;for(r=0;r<i;r++)n[r+1]=t(e[r]);return n}function r(e){if("object"!=typeof e)return e;var t,n=[],i=e.length;for(t=1;t<i;t++)n[t-1]=r(e[t]);return n}function n(e,t,r,n,i,o,a,c,s,u,l,f,h,m,p,d){var g,y,x,v,b,_,w,k,$,M,T,A,j,S,E,C,P,L,q,V,N,F,R,z,O,B,I;j=Math.min(n,u),x=2*n+j*(j+5)/2+2*u+1,z=1e-60;do{O=1+.1*(z+=z),B=1+.2*z}while(O<=1||B<=1);for(g=1;g<=n;g+=1)p[g]=t[g];for(g=n+1;g<=x;g+=1)p[g]=0;for(g=1;g<=u;g+=1)f[g]=0;if(b=[],0===d[1]){if(function(e,t,r,n){var i,o,a,c,s,u;for(o=1;o<=r;o+=1){if(n[1]=o,u=0,(a=o-1)<1){if((u=e[o][o]-u)<=0)break;e[o][o]=Math.sqrt(u)}else{for(c=1;c<=a;c+=1){for(s=e[c][o],i=1;i<c;i+=1)s-=e[i][o]*e[i][c];s/=e[c][c],e[c][o]=s,u+=s*s}if((u=e[o][o]-u)<=0)break;e[o][o]=Math.sqrt(u)}n[1]=0}}(e,0,n,b),0!==b[1])return void(d[1]=2);!function(e,t,r,n){var i,o,a,c;for(o=1;o<=r;o+=1){for(c=0,i=1;i<o;i+=1)c+=e[i][o]*n[i];n[o]=(n[o]-c)/e[o][o]}for(a=1;a<=r;a+=1)for(n[o=r+1-a]=n[o]/e[o][o],c=-n[o],i=1;i<o;i+=1)n[i]=n[i]+c*e[i][o]}(e,0,n,t),function(e,t,r){var n,i,o,a,c;for(o=1;o<=r;o+=1){for(e[o][o]=1/e[o][o],c=-e[o][o],n=1;n<o;n+=1)e[n][o]=c*e[n][o];if(r<(a=o+1))break;for(i=a;i<=r;i+=1)for(c=e[o][i],e[o][i]=0,n=1;n<=o;n+=1)e[n][i]=e[n][i]+c*e[n][o]}}(e,0,n)}else{for(y=1;y<=n;y+=1)for(i[y]=0,g=1;g<=y;g+=1)i[y]=i[y]+e[g][y]*t[g];for(y=1;y<=n;y+=1)for(t[y]=0,g=y;g<=n;g+=1)t[y]=t[y]+e[y][g]*i[g]}for(o[1]=0,y=1;y<=n;y+=1)for(i[y]=t[y],o[1]=o[1]+p[y]*i[y],p[y]=0,g=y+1;g<=n;g+=1)e[g][y]=0;for(o[1]=-o[1]/2,d[1]=0,S=(M=($=(T=(k=(w=n)+n)+j)+j+1)+j*(j+1)/2)+u,g=1;g<=u;g+=1){for(C=0,y=1;y<=n;y+=1)C+=a[y][g]*a[y][g];p[S+g]=Math.sqrt(C)}function D(){for(m[1]=m[1]+1,x=M,g=1;g<=u;g+=1){for(x+=1,C=-c[g],y=1;y<=n;y+=1)C+=a[y][g]*i[y];if(Math.abs(C)<z&&(C=0),g>l)p[x]=C;else if(p[x]=-Math.abs(C),C>0){for(y=1;y<=n;y+=1)a[y][g]=-a[y][g];c[g]=-c[g]}}for(g=1;g<=h;g+=1)p[M+f[g]]=0;for(A=0,E=0,g=1;g<=u;g+=1)p[M+g]<E*p[S+g]&&(A=g,E=p[M+g]/p[S+g]);return 0===A?999:0}function U(){for(g=1;g<=n;g+=1){for(C=0,y=1;y<=n;y+=1)C+=e[y][g]*a[y][A];p[g]=C}for(v=w,g=1;g<=n;g+=1)p[v+g]=0;for(y=h+1;y<=n;y+=1)for(g=1;g<=n;g+=1)p[v+g]=p[v+g]+e[g][y]*p[y];for(F=!0,g=h;g>=1;g-=1){for(C=p[g],v=(x=$+g*(g+3)/2)-g,y=g+1;y<=h;y+=1)C-=p[x]*p[k+y],x+=y;if(C/=p[v],p[k+g]=C,f[g]<l)break;if(C<0)break;F=!1,_=g}if(!F)for(P=p[T+_]/p[k+_],g=1;g<=h&&!(f[g]<l)&&!(p[k+g]<0);g+=1)(E=p[T+g]/p[k+g])<P&&(P=E,_=g);for(C=0,g=w+1;g<=w+n;g+=1)C+=p[g]*p[g];if(Math.abs(C)<=z){if(F)return d[1]=1,999;for(g=1;g<=h;g+=1)p[T+g]=p[T+g]-P*p[k+g];return p[T+h+1]=p[T+h+1]+P,700}for(C=0,g=1;g<=n;g+=1)C+=p[w+g]*a[g][A];for(L=-p[M+A]/C,R=!0,F||P<L&&(L=P,R=!1),g=1;g<=n;g+=1)i[g]=i[g]+L*p[w+g],Math.abs(i[g])<z&&(i[g]=0);for(o[1]=o[1]+L*C*(L/2+p[T+h+1]),g=1;g<=h;g+=1)p[T+g]=p[T+g]-L*p[k+g];if(p[T+h+1]=p[T+h+1]+L,!R){for(C=-c[A],y=1;y<=n;y+=1)C+=i[y]*a[y][A];if(A>l)p[M+A]=C;else if(p[M+A]=-Math.abs(C),C>0){for(y=1;y<=n;y+=1)a[y][A]=-a[y][A];c[A]=-c[A]}return 700}for(f[h+=1]=A,x=$+(h-1)*h/2+1,g=1;g<=h-1;g+=1)p[x]=p[g],x+=1;if(h===n)p[x]=p[n];else{for(g=n;g>=h+1&&0!==p[g]&&(q=Math.max(Math.abs(p[g-1]),Math.abs(p[g])),V=Math.min(Math.abs(p[g-1]),Math.abs(p[g])),E=p[g-1]>=0?Math.abs(q*Math.sqrt(1+V*V/(q*q))):-Math.abs(q*Math.sqrt(1+V*V/(q*q))),q=p[g-1]/E,V=p[g]/E,1!==q);g-=1)if(0===q)for(p[g-1]=V*E,y=1;y<=n;y+=1)E=e[y][g-1],e[y][g-1]=e[y][g],e[y][g]=E;else for(p[g-1]=E,N=V/(1+q),y=1;y<=n;y+=1)E=q*e[y][g-1]+V*e[y][g],e[y][g]=N*(e[y][g-1]+E)-e[y][g],e[y][g-1]=E;p[x]=p[h]}return 0}function H(){if(0===p[v=(x=$+_*(_+1)/2+1)+_])return 798;if(q=Math.max(Math.abs(p[v-1]),Math.abs(p[v])),V=Math.min(Math.abs(p[v-1]),Math.abs(p[v])),E=p[v-1]>=0?Math.abs(q*Math.sqrt(1+V*V/(q*q))):-Math.abs(q*Math.sqrt(1+V*V/(q*q))),q=p[v-1]/E,V=p[v]/E,1===q)return 798;if(0===q){for(g=_+1;g<=h;g+=1)E=p[v-1],p[v-1]=p[v],p[v]=E,v+=g;for(g=1;g<=n;g+=1)E=e[g][_],e[g][_]=e[g][_+1],e[g][_+1]=E}else{for(N=V/(1+q),g=_+1;g<=h;g+=1)E=q*p[v-1]+V*p[v],p[v]=N*(p[v-1]+E)-p[v],p[v-1]=E,v+=g;for(g=1;g<=n;g+=1)E=q*e[g][_]+V*e[g][_+1],e[g][_+1]=N*(e[g][_]+E)-e[g][_+1],e[g][_]=E}return 0}function X(){for(v=x-_,g=1;g<=_;g+=1)p[v]=p[x],x+=1,v+=1;return p[T+_]=p[T+_+1],f[_]=f[_+1],(_+=1)<h?797:0}function Y(){return p[T+h]=p[T+h+1],p[T+h+1]=0,f[h]=0,h-=1,m[2]=m[2]+1,0}for(h=0,m[1]=0,m[2]=0,I=0;;){if(999===(I=D()))return;for(;0!==(I=U());){if(999===I)return;if(700===I)if(_===h)Y();else{for(;H(),797===(I=X()););Y()}}}}e.solveQP=function(e,i,o,a,c,s){e=t(e),i=t(i),o=t(o);var u,l,f,h,m,p=[],d=[],g=[],y=[],x=[];if(c=c||0,s=s?t(s):[void 0,0],a=a?t(a):[],l=e.length-1,f=o[1].length-1,!a)for(u=1;u<=f;u+=1)a[u]=0;for(u=1;u<=f;u+=1)d[u]=0;for(h=Math.min(l,f),u=1;u<=l;u+=1)g[u]=0;for(p[1]=0,u=1;u<=2*l+h*(h+5)/2+2*f+1;u+=1)y[u]=0;for(u=1;u<=2;u+=1)x[u]=0;return n(e,i,0,l,g,p,o,a,0,f,c,d,0,x,y,s),m="",1===s[1]&&(m="constraints are inconsistent, no solution!"),2===s[1]&&(m="matrix D in quadratic function is not positive definite!"),{solution:r(g),value:r(p),unconstrained_solution:r(i),iterations:r(x),iact:r(d),message:m}}}(numeric),numeric.svd=function(e){var t,r=numeric.epsilon,n=1e-64/r,i=0,o=0,a=0,c=0,s=0,u=numeric.clone(e),l=u.length,f=u[0].length;if(l<f)throw"Need more rows than columns";var h=new Array(f),m=new Array(f);for(o=0;o<f;o++)h[o]=m[o]=0;var p=numeric.rep([f,f],0);function d(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var g=0,y=0,x=0,v=0,b=0,_=0,w=0;for(o=0;o<f;o++){for(h[o]=y,w=0,s=o+1,a=o;a<l;a++)w+=u[a][o]*u[a][o];if(w<=n)y=0;else for(g=u[o][o],y=Math.sqrt(w),g>=0&&(y=-y),x=g*y-w,u[o][o]=g-y,a=s;a<f;a++){for(w=0,c=o;c<l;c++)w+=u[c][o]*u[c][a];for(g=w/x,c=o;c<l;c++)u[c][a]+=g*u[c][o]}for(m[o]=y,w=0,a=s;a<f;a++)w+=u[o][a]*u[o][a];if(w<=n)y=0;else{for(g=u[o][o+1],y=Math.sqrt(w),g>=0&&(y=-y),x=g*y-w,u[o][o+1]=g-y,a=s;a<f;a++)h[a]=u[o][a]/x;for(a=s;a<l;a++){for(w=0,c=s;c<f;c++)w+=u[a][c]*u[o][c];for(c=s;c<f;c++)u[a][c]+=w*h[c]}}(b=Math.abs(m[o])+Math.abs(h[o]))>v&&(v=b)}for(o=f-1;-1!=o;o+=-1){if(0!=y){for(x=y*u[o][o+1],a=s;a<f;a++)p[a][o]=u[o][a]/x;for(a=s;a<f;a++){for(w=0,c=s;c<f;c++)w+=u[o][c]*p[c][a];for(c=s;c<f;c++)p[c][a]+=w*p[c][o]}}for(a=s;a<f;a++)p[o][a]=0,p[a][o]=0;p[o][o]=1,y=h[o],s=o}for(o=f-1;-1!=o;o+=-1){for(s=o+1,y=m[o],a=s;a<f;a++)u[o][a]=0;if(0!=y){for(x=u[o][o]*y,a=s;a<f;a++){for(w=0,c=s;c<l;c++)w+=u[c][o]*u[c][a];for(g=w/x,c=o;c<l;c++)u[c][a]+=g*u[c][o]}for(a=o;a<l;a++)u[a][o]=u[a][o]/y}else for(a=o;a<l;a++)u[a][o]=0;u[o][o]+=1}for(r*=v,c=f-1;-1!=c;c+=-1)for(var k=0;k<50;k++){var $=!1;for(s=c;-1!=s;s+=-1){if(Math.abs(h[s])<=r){$=!0;break}if(Math.abs(m[s-1])<=r)break}if(!$){i=0,w=1;var M=s-1;for(o=s;o<c+1&&(g=w*h[o],h[o]=i*h[o],!(Math.abs(g)<=r));o++)for(x=d(g,y=m[o]),m[o]=x,i=y/x,w=-g/x,a=0;a<l;a++)b=u[a][M],_=u[a][o],u[a][M]=b*i+_*w,u[a][o]=-b*w+_*i}if(_=m[c],s==c){if(_<0)for(m[c]=-_,a=0;a<f;a++)p[a][c]=-p[a][c];break}if(k>=49)throw"Error: no convergence.";for(v=m[s],y=d(g=(((b=m[c-1])-_)*(b+_)+((y=h[c-1])-(x=h[c]))*(y+x))/(2*x*b),1),g=g<0?((v-_)*(v+_)+x*(b/(g-y)-x))/v:((v-_)*(v+_)+x*(b/(g+y)-x))/v,i=1,w=1,o=s+1;o<c+1;o++){for(y=h[o],b=m[o],x=w*y,y*=i,_=d(g,x),h[o-1]=_,g=v*(i=g/_)+y*(w=x/_),y=-v*w+y*i,x=b*w,b*=i,a=0;a<f;a++)v=p[a][o-1],_=p[a][o],p[a][o-1]=v*i+_*w,p[a][o]=-v*w+_*i;for(_=d(g,x),m[o-1]=_,g=(i=g/_)*y+(w=x/_)*b,v=-w*y+i*b,a=0;a<l;a++)b=u[a][o-1],_=u[a][o],u[a][o-1]=b*i+_*w,u[a][o]=-b*w+_*i}h[s]=0,h[c]=g,m[c]=v}for(o=0;o<m.length;o++)m[o]<r&&(m[o]=0);for(o=0;o<f;o++)for(a=o-1;a>=0;a--)if(m[a]<m[o]){for(i=m[a],m[a]=m[o],m[o]=i,c=0;c<u.length;c++)t=u[c][o],u[c][o]=u[c][a],u[c][a]=t;for(c=0;c<p.length;c++)t=p[c][o],p[c][o]=p[c][a],p[c][a]=t;o=a}return{U:u,S:m,V:p}}}));const{window:window_1$1}=globals;function get_each_context$1(e,t,r){const n=e.slice();return n[35]=t[r].x,n[36]=t[r].y,n[38]=r,n}function create_each_block$1(e){let t,r,n;function i(){return e[20](e[38])}return{c(){t=element("div"),attr(t,"class","corner"),set_style(t,"left",e[35]-5+"px"),set_style(t,"top",e[36]-5+"px")},m(e,o){insert(e,t,o),r||(n=listen(t,"mousedown",i),r=!0)},p(r,n){e=r,16&n[0]&&set_style(t,"left",e[35]-5+"px"),16&n[0]&&set_style(t,"top",e[36]-5+"px")},d(e){e&&detach(t),r=!1,n()}}}function create_fragment$3(e){let t,r,n,i,o,a,c,s,u,l,f=e[4],h=[];for(let t=0;t<f.length;t+=1)h[t]=create_each_block$1(get_each_context$1(e,f,t));return{c(){t=element("div"),r=element("div"),n=element("img"),o=space();for(let e=0;e<h.length;e+=1)h[e].c();a=space(),c=element("img"),this.c=noop,set_style(n,"opacity",e[1]/100),set_style(n,"transform",e[5]),src_url_equal(n.src,i=e[0])||attr(n,"src",i),set_style(r,"position","relative"),set_style(r,"width","100%"),set_style(r,"height","100% "),attr(t,"class","container"),src_url_equal(c.src,s=e[0])||attr(c,"src",s),set_style(c,"visibility","hidden")},m(i,s){insert(i,t,s),append(t,r),append(r,n),e[19](n),append(r,o);for(let e=0;e<h.length;e+=1)h[e]&&h[e].m(r,null);e[21](t),insert(i,a,s),insert(i,c,s),e[22](c),u||(l=[listen(window_1$1,"pointermove",e[9]),listen(window_1$1,"pointerup",e[8])],u=!0)},p(e,t){if(2&t[0]&&set_style(n,"opacity",e[1]/100),32&t[0]&&set_style(n,"transform",e[5]),1&t[0]&&!src_url_equal(n.src,i=e[0])&&attr(n,"src",i),144&t[0]){let n;for(f=e[4],n=0;n<f.length;n+=1){const i=get_each_context$1(e,f,n);h[n]?h[n].p(i,t):(h[n]=create_each_block$1(i),h[n].c(),h[n].m(r,null))}for(;n<h.length;n+=1)h[n].d(1);h.length=f.length}1&t[0]&&!src_url_equal(c.src,s=e[0])&&attr(c,"src",s)},i:noop,o:noop,d(r){r&&detach(t),e[19](null),destroy_each(h,r),e[21](null),r&&detach(a),r&&detach(c),e[22](null),u=!1,run_all(l)}}}function getCenterFromCorners(e){const t=e[0],r=e[2];return[(t.x+r.x)/2,(t.y+r.y)/2]}function instance$3(e,t,r){let n,{imageurl:i=""}=t,{position:o}=t,{resultCanvas:a}=t,{resultdim:c}=t,{layerimagedata:s}=t,{zoom:u=100}=t,{ratio:l=window.devicePixelRatio}=t,{opacity:f=100}=t;globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&(f=globalThis.gyre.paletteValues.selectedLayer.opacity),globalThis.gyre&&(s=globalThis.gyre.paletteValues.selectedLayer),globalThis.gyre&&(u=globalThis.gyre?.canvas.zoom),globalThis.gyre&&(i=s.url);let h,m,p=parseFloat(u)/100/l,d=0,g=[],y=[],x=[...g],v=!1,b=null,_="";function w(e){return e/p}function k(){r(10,o.x=s._x,o),r(10,o.y=s._y,o),r(10,o.width=s._width,o),r(10,o.height=s._height,o)}function $(){!function(){g=[{x:0,y:0},{x:o.width,y:0},{x:o.width,y:o.height},{x:0,y:o.height}],y.length?r(4,x=y.map((e=>({x:e.x*p,y:e.y*p})))):r(4,x=[...g]);y=[{x:0,y:0},{x:parseInt(o.width/p),y:0},{x:parseInt(o.width/p),y:parseInt(o.height/p)},{x:0,y:parseInt(o.height/p)}],r(18,d=o.rotation||0)}(),T(),r(2,h.style.top=s._y+"px",h),r(2,h.style.left=s._x+"px",h),r(2,h.style.width=s._width+"px",h),r(2,h.style.height=s._height+"px",h)}function M(e,t){v=!0,b=e}function T(){const e=function(e,t,r){const n=-r,i=Math.cos(n),o=Math.sin(n);let[a,c]=getCenterFromCorners(e);const s=e.map((({x:e,y:t})=>{const r=e-a,n=t-c;return{x:r*i-n*o+a,y:r*o+n*i+c}})),u=[];for(let e=0;e<8;e++)u[e]=[];for(let e=0;e<4;e++)u[e][0]=u[e+4][3]=s[e].x,u[e][1]=u[e+4][4]=s[e].y,u[e][2]=u[e+4][5]=1,u[e][3]=u[e][4]=u[e][5]=0,u[e+4][0]=u[e+4][1]=u[e+4][2]=0,u[e][6]=-s[e].x*t[e].x,u[e][7]=-s[e].y*t[e].x,u[e+4][6]=-s[e].x*t[e].y,u[e+4][7]=-s[e].y*t[e].y;const l=[t[0].x,t[1].x,t[2].x,t[3].x,t[0].y,t[1].y,t[2].y,t[3].y],f=numeric1_2_6.solve(u,l).concat(1);return`matrix3d(${f[0]}, ${f[3]}, 0, ${f[6]}, ${f[1]}, ${f[4]}, 0, ${f[7]}, 0, 0, 1, 0, ${f[2]}, ${f[5]}, 0, 1)`}(g,x,d);r(5,_=e)}onMount((()=>{r(12,a=document.createElement("canvas"))}));return e.$$set=e=>{"imageurl"in e&&r(0,i=e.imageurl),"position"in e&&r(10,o=e.position),"resultCanvas"in e&&r(12,a=e.resultCanvas),"resultdim"in e&&r(13,c=e.resultdim),"layerimagedata"in e&&r(11,s=e.layerimagedata),"zoom"in e&&r(14,u=e.zoom),"ratio"in e&&r(15,l=e.ratio),"opacity"in e&&r(1,f=e.opacity)},e.$$.update=()=>{3076&e.$$.dirty[0]&&h&&!o&&s&&(r(10,o={}),k(),$()),262144&e.$$.dirty[0]&&d&&T()},globalThis.gyre?.canvas.zoom,[i,f,h,n,x,_,m,M,function(){v=!1,b=null},function(e){if(!v||null===b)return;const t=h.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;y=y.map(((e,t)=>t===b?{x:n/p,y:i/p}:e)),r(4,x=x.map(((e,t)=>t===b?{x:n,y:i}:e))),T()},o,s,a,c,u,l,function(){globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&r(1,f=globalThis.gyre.paletteValues.selectedLayer.opacity),globalThis.gyre&&r(11,s=globalThis.gyre.paletteValues.selectedLayer),globalThis.gyre&&r(14,u=globalThis.gyre?.canvas.zoom),globalThis.gyre&&r(0,i=s.url),p=parseFloat(u)/100/l,k(),$()},function(){!function(){let e=x.map((e=>(e.x=w(e.x),e.y=w(e.y),e)));warpImage(m,e,a,d);var t=Math.min(...e.map((e=>e.x))),n=Math.max(...e.map((e=>e.x))),i=Math.min(...e.map((e=>e.y))),o=Math.max(...e.map((e=>e.y)));r(13,c={x:t,y:i,width:n-t,height:o-i})}()},d,function(e){binding_callbacks[e?"unshift":"push"]((()=>{n=e,r(3,n)}))},e=>M(e),function(e){binding_callbacks[e?"unshift":"push"]((()=>{h=e,r(2,h)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{m=e,r(6,m)}))}]}class FourCornersTransformation extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent=".container{position:absolute;left:0px;top:0px;width:100%;height:100%;transform:rotate(0rad)}img{position:absolute;top:0;left:0;width:100%;height:100%;transform-origin:top left;user-select:none}.corner{position:absolute;width:10px;height:10px;background-color:red;border-radius:50%;cursor:pointer;user-select:none}",this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$3,create_fragment$3,safe_not_equal,{imageurl:0,position:10,resultCanvas:12,resultdim:13,layerimagedata:11,zoom:14,ratio:15,opacity:1,refresh:16,csstoimage:17},null,[-1,-1]),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["imageurl","position","resultCanvas","resultdim","layerimagedata","zoom","ratio","opacity","refresh","csstoimage"]}get imageurl(){return this.$$.ctx[0]}set imageurl(e){this.$$set({imageurl:e}),flush()}get position(){return this.$$.ctx[10]}set position(e){this.$$set({position:e}),flush()}get resultCanvas(){return this.$$.ctx[12]}set resultCanvas(e){this.$$set({resultCanvas:e}),flush()}get resultdim(){return this.$$.ctx[13]}set resultdim(e){this.$$set({resultdim:e}),flush()}get layerimagedata(){return this.$$.ctx[11]}set layerimagedata(e){this.$$set({layerimagedata:e}),flush()}get zoom(){return this.$$.ctx[14]}set zoom(e){this.$$set({zoom:e}),flush()}get ratio(){return this.$$.ctx[15]}set ratio(e){this.$$set({ratio:e}),flush()}get opacity(){return this.$$.ctx[1]}set opacity(e){this.$$set({opacity:e}),flush()}get refresh(){return this.$$.ctx[16]}get csstoimage(){return this.$$.ctx[17]}}function clickOutside(e){const t=t=>{!e||e.contains(t.target)||t.defaultPrevented||e.dispatchEvent(new CustomEvent("click_outside",e))};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function create_if_block_1$1(e){let t,r,n,i,o,a,c,s;return{c(){t=element("div"),r=element("fds-image-editor-button"),n=space(),i=element("fds-image-editor-button"),o=space(),a=element("fds-image-editor-button"),a.textContent="Coordinates",set_custom_element_data(r,"icon","flipHorizontal"),set_custom_element_data(r,"title","Flip Horizontal"),set_custom_element_data(i,"icon","flipVertical"),set_custom_element_data(i,"title","Flip Vertical"),set_custom_element_data(a,"type","button"),set_style(t,"display","flex"),set_style(t,"align-items","center")},m(u,l){insert(u,t,l),append(t,r),append(t,n),append(t,i),append(t,o),append(t,a),c||(s=[listen(r,"click",e[5]),listen(i,"click",e[6]),listen(a,"click",e[7])],c=!0)},p:noop,d(e){e&&detach(t),c=!1,run_all(s)}}}function create_if_block$1(e){let t,r,n,i,o,a,c,s,u,l,f,h,m,p,d,g,y,x,v,b,_,w,k,$,M,T,A,j,S,E,C,P,L,q,V;return{c(){t=element("div"),r=element("div"),n=element("div"),i=element("label"),i.textContent="X:",o=space(),a=element("input"),s=space(),u=element("div"),l=element("label"),l.textContent="Y:",f=space(),h=element("input"),p=space(),d=element("div"),g=element("div"),y=element("label"),y.textContent="Width:",x=space(),v=element("input"),_=space(),w=element("div"),k=element("div"),$=element("label"),$.textContent="Height:",M=space(),T=element("input"),j=space(),S=element("div"),E=element("label"),E.textContent="Rotation:",C=space(),P=element("input"),attr(i,"for","x"),attr(i,"class","more-label"),a.value=c=e[0].x,attr(a,"type","text"),attr(a,"class","formInput"),attr(a,"placeholder",""),set_style(a,"font-size","12px"),set_style(a,"width","220px"),set_style(a,"display","inline-block"),attr(n,"class","formLine"),attr(l,"for","y"),attr(l,"class","more-label"),h.value=m=e[0].y,attr(h,"type","text"),attr(h,"class","formInput"),attr(h,"placeholder",""),set_style(h,"font-size","12px"),set_style(h,"width","220px"),set_style(h,"display","inline-block"),attr(u,"class","formLine"),attr(r,"class","formRow"),attr(y,"for","width"),attr(y,"class","more-label"),v.value=b=e[0].width,attr(v,"type","text"),attr(v,"class","formInput"),attr(v,"placeholder",""),set_style(v,"font-size","12px"),set_style(v,"width","220px"),set_style(v,"display","inline-block"),attr(g,"class","formLine"),attr($,"for","height"),attr($,"class","more-label"),T.value=A=e[0].height,attr(T,"type","text"),attr(T,"class","formInput"),attr(T,"placeholder",""),set_style(T,"font-size","12px"),set_style(T,"width","220px"),set_style(T,"display","inline-block"),attr(k,"class","formLine"),attr(w,"class","formLine"),attr(d,"class","formRow"),attr(E,"for","rotation"),attr(E,"class","more-label"),P.value=L=180*e[0].rotation/Math.PI,attr(P,"type","text"),attr(P,"class","formInput"),attr(P,"placeholder",""),set_style(P,"font-size","12px"),set_style(P,"width","220px"),set_style(P,"display","inline-block"),attr(S,"class","formLine"),attr(t,"class","editcoord")},m(c,m){insert(c,t,m),append(t,r),append(r,n),append(n,i),append(n,o),append(n,a),append(r,s),append(r,u),append(u,l),append(u,f),append(u,h),append(t,p),append(t,d),append(d,g),append(g,y),append(g,x),append(g,v),append(d,_),append(d,w),append(w,k),append(k,$),append(k,M),append(k,T),append(t,j),append(t,S),append(S,E),append(S,C),append(S,P),q||(V=[listen(a,"change",e[8]),listen(h,"change",e[9]),listen(v,"change",e[10]),listen(T,"change",e[11]),listen(P,"change",e[12]),action_destroyer(clickOutside.call(null,t)),listen(t,"click_outside",handleClickOutside)],q=!0)},p(e,t){1&t&&c!==(c=e[0].x)&&a.value!==c&&(a.value=c),1&t&&m!==(m=e[0].y)&&h.value!==m&&(h.value=m),1&t&&b!==(b=e[0].width)&&v.value!==b&&(v.value=b),1&t&&A!==(A=e[0].height)&&T.value!==A&&(T.value=A),1&t&&L!==(L=180*e[0].rotation/Math.PI)&&P.value!==L&&(P.value=L)},d(e){e&&detach(t),q=!1,run_all(V)}}}function create_fragment$2(e){let t,r,n=e[0]&&create_if_block_1$1(e),i=e[1]&&e[0]&&create_if_block$1(e);return{c(){t=element("div"),n&&n.c(),r=space(),i&&i.c(),this.c=noop,attr(t,"class","show"),set_style(t,"display","inline-flex")},m(e,o){insert(e,t,o),n&&n.m(t,null),append(t,r),i&&i.m(t,null)},p(e,[o]){e[0]?n?n.p(e,o):(n=create_if_block_1$1(e),n.c(),n.m(t,r)):n&&(n.d(1),n=null),e[1]&&e[0]?i?i.p(e,o):(i=create_if_block$1(e),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i:noop,o:noop,d(e){e&&detach(t),n&&n.d(),i&&i.d()}}}function handleClickOutside(){}function instance$2(e,t,r){let n;component_subscribe(e,toollayer,(e=>r(4,n=e)));let i=get_current_component().$$.root.host,{coordinates:o={x:0,y:0,width:0,height:0,rotation:0}}=t;function a(e,t){"flipHorizontal"!=e&&"flipVertical"!=e&&isNaN(t)||(set_store_value(toollayer,n[e]=parseInt(t),n),"rotation"!=e&&"opacity"!=e||set_store_value(toollayer,n[e]=parseFloat(t),n),i.dispatchEvent(new CustomEvent("change",{detail:{name:e,value:t}})))}let{editcoord:c}=t;function s(){r(0,o=n)}return e.$$set=e=>{"coordinates"in e&&r(0,o=e.coordinates),"editcoord"in e&&r(1,c=e.editcoord)},e.$$.update=()=>{16&e.$$.dirty&&n&&s()},[o,c,a,s,n,()=>{a("flipHorizontal")},()=>{a("flipVertical")},()=>{r(1,c=!c),a("editcoord",c)},e=>{r(0,o.x=e.target.value,o),r(0,o),a("x",e.target.value)},e=>{r(0,o.y=e.target.value,o),r(0,o),a("y",e.target.value)},e=>{r(0,o.width=e.target.value,o),r(0,o),a("width",e.target.value)},e=>{r(0,o.height=e.target.value,o),r(0,o),a("height",e.target.value)},e=>{r(0,o.rotation=e.target.value,o),r(0,o),a("rotation",parseInt(e.target.value)*(Math.PI/180))}]}customElements.define("fds-image-transform-corners",FourCornersTransformation);class Dialog extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent='*{box-sizing:border-box}.editcoord{min-width:330px;min-height:100px;box-shadow:0 0 1rem 0 rgba(255, 255, 255, .2);border-radius:8px;background-color:rgba(0, 0, 0, .65);backdrop-filter:blur(10px);color:rgba(255, 255, 255, 0.6);position:absolute;left:0px;top:50px;padding:14px;font-family:"Segoe UI", Roboto, system-ui;z-index:2000}.formLine{display:flex;align-items:center;margin-bottom:5px}.formLine label{margin-right:10px;width:60px}.formLine input{flex:1;min-width:0}.formRow{display:flex;justify-content:space-between;gap:20px;margin-bottom:20px}.formInput{width:100%;max-width:80px;outline:0;border:0;border-bottom:2px solid rgba(255, 255, 255, 0.2);padding:5px;font-size:14px;font-weight:normal;border-radius:3px;color:rgba(255, 255, 255, 0.9);margin-bottom:10px;display:block;background:none;font-family:system-ui, "Segoe UI", Roboto}.show{display:block}',this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$2,create_fragment$2,safe_not_equal,{coordinates:0,editcoord:1,refresh:3},null),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["coordinates","editcoord","refresh"]}get coordinates(){return this.$$.ctx[0]}set coordinates(e){this.$$set({coordinates:e}),flush()}get editcoord(){return this.$$.ctx[1]}set editcoord(e){this.$$set({editcoord:e}),flush()}get refresh(){return this.$$.ctx[3]}}function create_fragment$1(e){let t,r,n,i,o,a,c,s;return{c(){t=element("div"),r=element("div"),n=element("fds-image-editor-button"),n.textContent="Done",i=space(),o=element("div"),a=element("fds-image-editor-button"),a.textContent="Cancel",this.c=noop,set_custom_element_data(n,"type","button"),set_style(r,"display","flex"),set_style(r,"align-items","center"),set_custom_element_data(a,"type","button"),set_style(o,"display","flex"),set_style(o,"align-items","center"),attr(t,"class","show"),set_style(t,"display","inline-flex")},m(u,l){insert(u,t,l),append(t,r),append(r,n),append(t,i),append(t,o),append(o,a),c||(s=[listen(n,"click",e[1]),listen(a,"click",e[2])],c=!0)},p:noop,i:noop,o:noop,d(e){e&&detach(t),c=!1,run_all(s)}}}function instance$1(e){let t=get_current_component().$$.root.host;function r(e,r){t.dispatchEvent(new CustomEvent("change",{detail:{name:e,value:r}}))}return[r,()=>{r("csstoimage")},()=>{r("changeview",!0)}]}customElements.define("fds-coord-dialog",Dialog);class DialogFourCorners extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent="*{box-sizing:border-box}.show{display:block}",this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$1,create_fragment$1,safe_not_equal,{},null),e&&e.target&&insert(e.target,this,e.anchor)}}customElements.define("fds-four-corners-dialog",DialogFourCorners);const{window:window_1}=globals;function get_each_context(e,t,r){const n=e.slice();return n[80]=t[r],n}function create_if_block(e){let t,r,n,i,o,a,c,s,u,l,f,h,m,p,d,g,y,x,v,b,_,w;function k(e,t){return e[2]?create_if_block_4:create_else_block}let $=k(e),M=$(e),T=e[5]&&create_if_block_2(e),A=e[4]&&create_if_block_1(),j=e[11],S=[];for(let t=0;t<j.length;t+=1)S[t]=create_each_block(get_each_context(e,j,t));return{c(){t=element("div"),r=element("div"),n=element("div"),M.c(),i=space(),o=element("div"),o.innerHTML="<slot></slot>",a=space(),c=element("div"),s=element("div"),s.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',u=space(),l=element("div"),l.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',f=space(),h=element("div"),h.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',m=space(),p=element("div"),p.innerHTML='<slot name="handle"><div class="handle-shape"></div></slot>',d=space(),T&&T.c(),y=space(),x=element("div"),v=space(),A&&A.c(),b=space();for(let e=0;e<S.length;e+=1)S[e].c();attr(n,"class","contents"),set_style(n,"opacity",e[0].opacity/100),set_style(o,"width","80px"),set_style(o,"height","50px"),set_style(o,"position","sticky"),set_style(o,"z-index","5"),set_style(o,"bottom","0px"),set_style(o,"left","0px"),set_style(o,"align-self","flex-end"),attr(s,"class","handle corner top right"),attr(l,"class","handle corner bottom right"),attr(h,"class","handle corner bottom left"),attr(p,"class","handle corner top left"),attr(c,"class","frame"),attr(r,"class","free-transform"),attr(r,"style",g=e[12]?e[1].style:null),toggle_class(r,"noclicks",!e[7]),attr(x,"class","fullwidthheight"),set_style(x,"display","none"),attr(t,"class","faded transform-area")},m(g,k){insert(g,t,k),append(t,r),append(r,n),M.m(n,null),append(r,i),append(r,o),append(r,a),append(r,c),append(c,s),e[41](s),append(c,u),append(c,l),e[42](l),append(c,f),append(c,h),e[43](h),append(c,m),append(c,p),e[44](p),append(c,d),T&&T.m(c,null),e[46](r),append(t,y),append(t,x),append(t,v),A&&A.m(t,null),append(t,b);for(let e=0;e<S.length;e+=1)S[e]&&S[e].m(t,null);e[47](t),_||(w=[listen(r,"pointerdown",e[20]),listen(t,"pointerup",e[22]),listen(t,"click",e[24])],_=!0)},p(e,i){if($===($=k(e))&&M?M.p(e,i):(M.d(1),M=$(e),M&&(M.c(),M.m(n,null))),1&i[0]&&set_style(n,"opacity",e[0].opacity/100),e[5]?T?T.p(e,i):(T=create_if_block_2(e),T.c(),T.m(c,null)):T&&(T.d(1),T=null),4098&i[0]&&g!==(g=e[12]?e[1].style:null)&&attr(r,"style",g),128&i[0]&&toggle_class(r,"noclicks",!e[7]),e[4]?A||(A=create_if_block_1(),A.c(),A.m(t,b)):A&&(A.d(1),A=null),2048&i[0]){let r;for(j=e[11],r=0;r<j.length;r+=1){const n=get_each_context(e,j,r);S[r]?S[r].p(n,i):(S[r]=create_each_block(n),S[r].c(),S[r].m(t,null))}for(;r<S.length;r+=1)S[r].d(1);S.length=j.length}},d(r){r&&detach(t),M.d(),e[41](null),e[42](null),e[43](null),e[44](null),T&&T.d(),e[46](null),A&&A.d(),destroy_each(S,r),e[47](null),_=!1,run_all(w)}}}function create_else_block(e){let t,r;return{c(){t=element("img"),set_style(t,"width","100%"),set_style(t,"height","100%"),src_url_equal(t.src,r=e[3]||e[0].url)||attr(t,"src",r)},m(r,n){insert(r,t,n),e[40](t)},p(e,n){9&n[0]&&!src_url_equal(t.src,r=e[3]||e[0].url)&&attr(t,"src",r)},d(r){r&&detach(t),e[40](null)}}}function create_if_block_4(e){let t,r;return{c(){t=new HtmlTag(!1),r=empty(),t.a=r},m(n,i){t.m(e[2],n,i),insert(n,r,i)},p(e,r){4&r[0]&&t.p(e[2])},d(e){e&&detach(r),e&&t.d()}}}function create_if_block_2(e){let t,r,n,i=e[6]&&create_if_block_3();return{c(){t=element("div"),r=element("slot"),r.innerHTML='<div class="handle-shape"></div>',n=space(),i&&i.c(),attr(r,"name","rotator"),attr(t,"class","handle rotator")},m(o,a){insert(o,t,a),append(t,r),append(t,n),i&&i.m(t,null),e[45](t)},p(e,r){e[6]?i||(i=create_if_block_3(),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},d(r){r&&detach(t),i&&i.d(),e[45](null)}}}function create_if_block_3(e){let t;return{c(){t=element("div"),attr(t,"class","rotator-bar")},m(e,r){insert(e,t,r)},d(e){e&&detach(t)}}}function create_if_block_1(e){let t;return{c(){t=element("div"),set_style(t,"position","absolute"),set_style(t,"top","100px"),set_style(t,"left","100px"),set_style(t,"width","400px"),set_style(t,"height","400px"),set_style(t,"border","1px solid grey"),set_style(t,"transform","rotate(-45deg)"),set_style(t,"transform-origin","center center")},m(e,r){insert(e,t,r)},d(e){e&&detach(t)}}}function create_each_block(e){let t;return{c(){t=element("div"),attr(t,"class","line"),set_style(t,"--x-line",e[80].x_line+"px"),set_style(t,"--y-line",e[80].y_line+"px"),set_style(t,"--line-length",e[80].lineLength+"px"),set_style(t,"--theta-line",e[80].theta_line+"rad")},m(e,r){insert(e,t,r)},p(e,r){2048&r[0]&&set_style(t,"--x-line",e[80].x_line+"px"),2048&r[0]&&set_style(t,"--y-line",e[80].y_line+"px"),2048&r[0]&&set_style(t,"--line-length",e[80].lineLength+"px"),2048&r[0]&&set_style(t,"--theta-line",e[80].theta_line+"rad")},d(e){e&&detach(t)}}}function create_fragment(e){let t,r,n,i=(e[3]||e[0].url)&&create_if_block(e);return{c(){i&&i.c(),t=empty(),this.c=noop},m(o,a){i&&i.m(o,a),insert(o,t,a),r||(n=[listen(window_1,"pointermove",e[21]),listen(window_1,"pointerup",e[23]),listen(window_1,"keyup",e[18]),listen(window_1,"keydown",e[19])],r=!0)},p(e,r){e[3]||e[0].url?i?i.p(e,r):(i=create_if_block(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:noop,o:noop,d(e){i&&i.d(e),e&&detach(t),r=!1,run_all(n)}}}const magneticTolerance=10;function isResizing(e){return e&&e.target&&"handle"===e.target.type}function getFullBounds(e){const t=e.getBoundingClientRect();return t.x=t.left,t.y=t.top,t.center={x:(t.left+t.right)/2,y:(t.top+t.bottom)/2},t}function instance(e,t,r){let n;component_subscribe(e,toollayer,(e=>r(39,n=e)));let i=!1,o=get_current_component();const a=createEventDispatcher(),c=(e,t)=>{t=g,set_store_value(toollayer,n=g,n),t.endDrag=!!i,i&&(i=!i),a(e="transformchange",t),o.dispatchEvent&&o.dispatchEvent(new CustomEvent(e,{detail:t}))};let s={x:null,y:null,width:null,height:null,rotation:null};function u(){r(1,g=n)}let l,f,h,{layers:m=[]}=t,{demo:p=!1}=t,{layerimagedata:d={}}=t,{position:g=s}=t,{target:y=null}=t,{container:x=null}=t,{rotatorEnabled:v=!0}=t,{rotatorBar:b=!1}=t,{handleMode:_="resize"}=t,{lockAspect:w=!1}=t,{lockTouchResize:k=!1}=t,{captureClicks:$=!0}=t,{zoom:M=100}=t,{ratio:T=window.devicePixelRatio}=t,{imageurl:A}=t,{imagesvg:j}=t,{svgcolor:S}=t,{type:E}=t,C=!1,P=[];function L(e,t,r,n){let i=(new magneticLines).calcMagneticLine(e,t,r,n);P.push(i)}function q(e,t,r){let n={...t};return e.forEach((e=>{e!==g&&(Math.abs(t.x-e.x)<r?(L("left","side","vertical",e.originalData),n.x=e.x):Math.abs(t.x+t.width-(e.x+e.width))<r?(L("right","side","vertical",e.originalData),n.x=e.x+e.width-t.width):Math.abs(t.x+t.width/2-(e.x+e.width/2))<r?(L("","center","vertical",e.originalData),n.x=e.x+e.width/2-t.width/2):Math.abs(t.x-(e.x+e.width))<r?(n.x=e.x+e.width,L("right","side","vertical",e.originalData)):Math.abs(t.x+t.width-e.x)<r&&(n.x=e.x-t.width,L("left","side","",e.originalData)),Math.abs(t.y-e.y)<r?(n.y=e.y,L("top","side","",e.originalData)):Math.abs(t.y+t.height-(e.y+e.height))<r?(n.y=e.y+e.height-t.height,L("bottom","side","",e.originalData)):Math.abs(t.y+t.height/2-(e.y+e.height/2))<r?(n.y=e.y+e.height/2-t.height/2,L("","center","horizontal",e.originalData)):Math.abs(t.y-(e.y+e.height))<r?(n.y=e.y+e.height,L("bottom","side","",e.originalData)):Math.abs(t.y+t.height-e.y)<r&&(n.y=e.y-t.height,L("top","side","",e.originalData)))})),n}let V,N,F=!1;const R={};let z,O,B,I,D,U,H,X,Y=0;function Q(){H||(H=!0,r(8,f.onload=()=>{r(1,g={x:f.x,y:f.y,width:f.naturalWidth,height:f.naturalHeight,rotation:0}),Z(),async function(){await tick(),z&&(z.getBoundingClientRect(),c("boundsChanged",g),h.classList.contains("fade-in-div")||(h.classList.remove("faded"),h.classList.add("fade-in-div")))}()},f),y||r(25,y=z),x||r(26,x=y.parentNode))}function Z(){(d?._x||0==d?._x)&&r(1,g.x=d._x,g),(d?._y||0==d?._y)&&r(1,g.y=d._y,g),d?._width&&r(1,g.width=d._width,g),d?._height&&r(1,g.height=d._height,g),(d?.x||0==d?.x)&&r(1,g.x=J(d.x),g),(d?.y||0==d?.y)&&r(1,g.y=J(d.y),g),d?.width&&r(1,g.width=J(d.width),g),d?.height&&r(1,g.height=J(d.height),g),d?.rotation&&r(1,g.rotation=d.rotation,g),d?.rotation&&r(1,g.r=d.rotation,g),(d?._x||0==d?._x)&&d._imgwidth&&(r(1,g.x=J(d._imgx),g),r(1,g.y=J(d._imgy),g),r(1,g.width=J(d._imgwidth),g),r(1,g.height=J(d._imgheight),g),delete d._imgx,delete d._imgy,delete d._imgwidth,delete d._imgheight)}function J(e){return e*(parseFloat(M)/100/T)}onMount((()=>{r(38,X=!0),f&&Q()}));const G={x:"left",y:"top",width:"width",height:"height"};function W(e){return"position: absolute; "+["x","y","width","height"].map((t=>null!=e[t]?`${G[t]}: ${e[t]}px; `:"")).join(" ")+`; transform: rotate(${e.rotation}rad)`}function K(e){r(1,g.y=s.y+(e.end.y-e.start.y),g),r(1,g.x=s.x+(e.end.x-e.start.x),g);let t={x:s.x+(e.end.x-e.start.x),y:s.y+(e.end.y-e.start.y),width:g.width,height:g.height};r(11,P=[]);const n=function(e,t,r){let n={...t},i=[],o=[];if(e.forEach((e=>{if(e!==g&&(e.rotation!==g.rotation||0===e.rotation)){let t=JSON.parse(JSON.stringify(e));t.rotation=0,t.originalData=JSON.parse(JSON.stringify(t)),i.push(t)}})),n=q(i,t,r),e.forEach((e=>{if(e!==g&&e.rotation===g.rotation&&0!==e.rotation){let t=JSON.parse(JSON.stringify(e));t.originalData=JSON.parse(JSON.stringify(e)),o.push(t)}})),o.length>0){let e=o[0].rotation;o.push(JSON.parse(JSON.stringify(t)));let i=new magneticLines;i.rotateBoxesToZero(o,e);let a=o.pop(),c=q(o,a,r);P.length&&(n=i.rotatePositionBackToOriginal(c,e))}return n}(m,t,magneticTolerance);r(1,g.x=n.x,g),r(1,g.y=n.y,g)}function ee(e,t){const n=function(e,t){const r=s.rotation,n=N.center,i=vector.sub(n,{x:s.width/2,y:s.height/2}),o=vector.rotate(e.end,-r,t),a=o.x-t.x,c=o.y-t.y,u=vector.add(i,{x:Math.abs(a/2),y:Math.abs(c/2)}),l=vector.add(u,{x:-a/2,y:-c/2}),f=vector.rotate(l,r,u);return{width:a,height:c,translate:vector.sub(t,f)}}(e,t,N.center);r(1,g.x=s.x+n.translate.x,g),r(1,g.y=s.y+n.translate.y,g),r(1,g.width=Math.abs(n.width),g),r(1,g.height=Math.abs(n.height),g)}function te(e,t,n,i){const o=function(e,t,r,n,i){const o=t.start?t.start:t,a=t.end?t.end:t,c=vector.sub(o,e.start),s=vector.sub(a,e.end),u=vector.length(s)/vector.length(c),l=n?0:vector.direction(c)-vector.direction(s),f=vector.add(vector.rotate(vector.scale(vector.sub(r,o),u),l,{x:0,y:0}),a);return{scale:i?1:u,rotate:l,translate:vector.sub(f,r),center:f}}(e,t,N.center,n,i);r(1,g.width=s.width*o.scale,g),r(1,g.height=s.height*o.scale,g);const a=vector.sub(N.center,s),c=vector.add(vector.add(a,o.translate),{x:-g.width/2,y:-g.height/2});r(1,g.x=s.x+c.x-V.left,g),r(1,g.y=s.y+c.y-V.top,g),r(1,g.rotation=s.rotation+o.rotate,g)}async function re(){await tick(),z&&z.getBoundingClientRect(),c("positionChanged",g)}return e.$$set=e=>{"layers"in e&&r(29,m=e.layers),"demo"in e&&r(4,p=e.demo),"layerimagedata"in e&&r(0,d=e.layerimagedata),"position"in e&&r(1,g=e.position),"target"in e&&r(25,y=e.target),"container"in e&&r(26,x=e.container),"rotatorEnabled"in e&&r(5,v=e.rotatorEnabled),"rotatorBar"in e&&r(6,b=e.rotatorBar),"handleMode"in e&&r(30,_=e.handleMode),"lockAspect"in e&&r(27,w=e.lockAspect),"lockTouchResize"in e&&r(31,k=e.lockTouchResize),"captureClicks"in e&&r(7,$=e.captureClicks),"zoom"in e&&r(32,M=e.zoom),"ratio"in e&&r(33,T=e.ratio),"imageurl"in e&&r(3,A=e.imageurl),"imagesvg"in e&&r(2,j=e.imagesvg),"svgcolor"in e&&r(34,S=e.svgcolor),"type"in e&&r(35,E=e.type)},e.$$.update=()=>{256&e.$$.dirty[1]&&n&&u(),4&e.$$.dirty[0]|8&e.$$.dirty[1]&&j&&S&&(r(2,j=j.replace("<svg ",`<svg style="fill:${S}" `)),r(0,d.url=r(3,A="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(j)))),d)),134217732&e.$$.dirty[0]&&j&&w&&(r(2,j=j.replace('preserveAspectRatio="none"'," ")),r(2,j=j.replace('class="fullwidthheight"'," ")),r(0,d.url=r(3,A="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(j)))),d)),134217732&e.$$.dirty[0]&&j&&!w&&(r(2,j=j.replace("<svg ",'<svg preserveAspectRatio="none" class="fullwidthheight" ')),r(0,d.url=r(3,A="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(j)))),d)),100664065&e.$$.dirty[0]|128&e.$$.dirty[1]&&X&&f&&z&&d&&d.url&&(y||r(25,y=z),x||r(26,x=y.parentNode),Q()),33554944&e.$$.dirty[0]&&r(12,F=y===z),2&e.$$.dirty[0]&&r(1,g.style=W(g),g),2&e.$$.dirty[0]|66&e.$$.dirty[1]&&M&&M!=l&&(r(37,l=M),Z(),r(1,g.style=W(g),g))},[d,g,j,A,p,v,b,$,f,z,h,P,F,O,B,I,D,U,function(e){16===e.keyCode&&r(27,w=!1)},function(e){16===e.keyCode&&r(27,w=!0)},function(e){let t=function(e){return O.contains(e.target)?{type:"handle",top:!0,right:!0}:B.contains(e.target)?{type:"handle",top:!0,left:!0}:I.contains(e.target)?{type:"handle",bottom:!0,right:!0}:D.contains(e.target)?{type:"handle",bottom:!0,left:!0}:U&&U.contains(e.target)?{type:"rotate"}:{type:"body"}}(e),r=R[e.pointerId];if(r?(r.end.x=e.pageX,r.end.y=e.pageY,r.target=t):(Y++,r={id:e.pointerId,priority:Y-1,start:{x:e.pageX,y:e.pageY},end:{x:e.pageX,y:e.pageY},target:t},R[e.pointerId]=r),C=!1,r.priority<2)if(N=getFullBounds(y),V=getFullBounds(x),Y>1&&Object.values(R).forEach((e=>{e.id!==e&&(e.start.x=e.end.x),e.start.y=e.end.y})),s.x=g.x,s.y=g.y,s.width=g.width,s.height=g.height,s.rotation=g.rotation,"handle"===t.type){let e;e=t.top?t.right?D:I:t.right?B:O;const r=e.getBoundingClientRect(),n={x:(r.left+r.right)/2,y:(r.top+r.bottom)/2};R.anchor=n}else delete R.anchor;re()},function(e){i=!1;let t=R[e.pointerId];if(t&&t.priority<2){if(C=!0,t.end.x=e.pageX,t.end.y=e.pageY,function(e){return e&&e.target&&"body"===e.target.type&&1===Y}(t))K(t);else if(function(e){return e&&e.target&&("rotate"===e.target.type||"handle"===e.target.type&&"rotate"===_)}(t))te(t,N.center,!1,!0);else if(isResizing(t)&&!w)ee(t,R.anchor);else if(isResizing(t)&&w)te(t,R.anchor,!0);else if(function(e){return e&&e.target&&"handle"!==e.target.type&&Y>1}(t)){let e,r=Y>1;e=r?Object.values(R).find((e=>e.id!==t.id)):R.anchor?R.anchor:N.center,te(t,e,!1,r&&k)}re()}},function(){C&&(i=!0,r(27,w=!1),C=!1,c("positionChanged",g))},function(e){let t=1/0;R[e.pointerId]&&(Y--,t=R[e.pointerId].priority),delete R[e.pointerId],Y&&(s.y=g.y,s.x=g.x,s.width=g.width,s.height=g.height,s.rotation=g.rotation,Object.values(R).forEach((e=>{e.id&&(e.priority>t&&e.priority--,e.start.x=e.end.x,e.start.y=e.end.y)})))},function(e){C||c("click",e.detail)},y,x,w,u,m,_,k,M,T,S,E,function(){null!=g.opacity&&r(0,d.opacity=g.opacity,d),r(1,g.style=W(g),g),c("positionChanged",g)},l,X,n,function(e){binding_callbacks[e?"unshift":"push"]((()=>{f=e,r(8,f)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{O=e,r(13,O)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{I=e,r(15,I)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{D=e,r(16,D)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{B=e,r(14,B)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{U=e,r(17,U)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{z=e,r(9,z)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{h=e,r(10,h)}))}]}class App extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent=':root{--frameBorder:solid 1px cyan}*{box-sizing:border-box}.free-transform{position:absolute;top:0;left:0;right:0;bottom:0;transform-origin:center;touch-action:none;display:flex}.free-transform.noclicks{pointer-events:none}.contents{position:absolute;top:0;left:0;right:0;bottom:0}.contents:before{content:"";position:absolute;top:0px;left:0px;width:100%;height:100%;border:var(--frameBorder, 2px solid #3965c7);box-sizing:border-box}.free-transform.noclicks .contents{pointer-events:none}.frame{position:absolute;top:0;left:0;right:0;bottom:0;cursor:move}.free-transform.noclicks .frame{pointer-events:none}.handle{position:absolute;user-select:none;touch-action:none;cursor:grab;pointer-events:auto}.handle:active{cursor:grabbing}.handle-shape{width:12px;height:12px;border-radius:50%;background:white;border:var(--frameBorder)}.handle.top{top:0px}.handle.right{right:0px}.handle.bottom{bottom:0px}.handle.left{left:0px}.handle.top.left{transform:translate(-50%, -50%) rotate(-45deg)}.handle.top.right{transform:translate(50%, -50%) rotate(45deg)}.handle.bottom.left{transform:translate(-50%, 50%) rotate(-135deg)}.handle.bottom.right{transform:translate(50%, 50%) rotate(135deg)}.handle.rotator{left:50%;top:-30px;transform:translateX(-50%)}.rotator-bar{position:absolute;top:100%;right:50%;width:1px;height:calc(30px - 100%);border-right:var(--frameBorder)}.fullwidthheight{width:100%;height:100%}.transform-area{position:relative;width:100%;height:100%;flex-grow:1}.faded{opacity:0.01}@keyframes fadeIn{to{opacity:1}}.line{position:absolute;width:var(--line-length);height:1px;left:var(--x-line);top:var(--y-line);transform:translate(-50%, -50%) rotate(var(--theta-line));transform-origin:center center;background-color:red}',this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance,create_fragment,safe_not_equal,{refresh:28,layers:29,demo:4,layerimagedata:0,position:1,target:25,container:26,rotatorEnabled:5,rotatorBar:6,handleMode:30,lockAspect:27,lockTouchResize:31,captureClicks:7,zoom:32,ratio:33,imageurl:3,imagesvg:2,svgcolor:34,type:35,changePosition:36},null,[-1,-1,-1]),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["refresh","layers","demo","layerimagedata","position","target","container","rotatorEnabled","rotatorBar","handleMode","lockAspect","lockTouchResize","captureClicks","zoom","ratio","imageurl","imagesvg","svgcolor","type","changePosition"]}get refresh(){return this.$$.ctx[28]}get layers(){return this.$$.ctx[29]}set layers(e){this.$$set({layers:e}),flush()}get demo(){return this.$$.ctx[4]}set demo(e){this.$$set({demo:e}),flush()}get layerimagedata(){return this.$$.ctx[0]}set layerimagedata(e){this.$$set({layerimagedata:e}),flush()}get position(){return this.$$.ctx[1]}set position(e){this.$$set({position:e}),flush()}get target(){return this.$$.ctx[25]}set target(e){this.$$set({target:e}),flush()}get container(){return this.$$.ctx[26]}set container(e){this.$$set({container:e}),flush()}get rotatorEnabled(){return this.$$.ctx[5]}set rotatorEnabled(e){this.$$set({rotatorEnabled:e}),flush()}get rotatorBar(){return this.$$.ctx[6]}set rotatorBar(e){this.$$set({rotatorBar:e}),flush()}get handleMode(){return this.$$.ctx[30]}set handleMode(e){this.$$set({handleMode:e}),flush()}get lockAspect(){return this.$$.ctx[27]}set lockAspect(e){this.$$set({lockAspect:e}),flush()}get lockTouchResize(){return this.$$.ctx[31]}set lockTouchResize(e){this.$$set({lockTouchResize:e}),flush()}get captureClicks(){return this.$$.ctx[7]}set captureClicks(e){this.$$set({captureClicks:e}),flush()}get zoom(){return this.$$.ctx[32]}set zoom(e){this.$$set({zoom:e}),flush()}get ratio(){return this.$$.ctx[33]}set ratio(e){this.$$set({ratio:e}),flush()}get imageurl(){return this.$$.ctx[3]}set imageurl(e){this.$$set({imageurl:e}),flush()}get imagesvg(){return this.$$.ctx[2]}set imagesvg(e){this.$$set({imagesvg:e}),flush()}get svgcolor(){return this.$$.ctx[34]}set svgcolor(e){this.$$set({svgcolor:e}),flush()}get type(){return this.$$.ctx[35]}set type(e){this.$$set({type:e}),flush()}get changePosition(){return this.$$.ctx[36]}}return customElements.define("fds-image-transform",App),App}();
//# sourceMappingURL=fds-image-transform.js.map
