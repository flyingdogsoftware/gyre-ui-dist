var app=function(){"use strict";function noop(){}function run(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run)}function is_function(e){return"function"==typeof e}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let src_url_equal_anchor;function src_url_equal(e,t){return src_url_equal_anchor||(src_url_equal_anchor=document.createElement("a")),src_url_equal_anchor.href=t,e===src_url_equal_anchor.href}function is_empty(e){return 0===Object.keys(e).length}function subscribe(e,...t){if(null==e)return noop;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function component_subscribe(e,t,n){e.$$.on_destroy.push(subscribe(t,n))}function set_store_value(e,t,n){return e.set(n),t}function action_destroyer(e){return e&&is_function(e.destroy)?e.destroy:noop}const globals="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function append(e,t){e.appendChild(t)}function insert(e,t,n){e.insertBefore(t,n||null)}function detach(e){e.parentNode&&e.parentNode.removeChild(e)}function destroy_each(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function element(e){return document.createElement(e)}function svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function text(e){return document.createTextNode(e)}function space(){return text(" ")}function empty(){return text("")}function listen(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function attr(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function set_custom_element_data(e,t,n){t in e?e[t]="boolean"==typeof e[t]&&""===n||n:attr(e,t,n)}function children(e){return Array.from(e.childNodes)}function set_style(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function toggle_class(e,t,n){e.classList[n?"add":"remove"](t)}function custom_event(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,r,t),i}class HtmlTag{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=svg_element(t.nodeName):this.e=element(11===t.nodeType?"TEMPLATE":t.nodeName),this.t="TEMPLATE"!==t.tagName?t:t.content,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from("TEMPLATE"===this.e.nodeName?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)insert(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(detach)}}function attribute_to_object(e){const t={};for(const n of e)t[n.name]=n.value;return t}let current_component;function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(e){get_current_component().$$.on_mount.push(e)}function createEventDispatcher(){const e=get_current_component();return(t,n,{cancelable:r=!1}={})=>{const i=e.$$.callbacks[t];if(i){const o=custom_event(t,n,{cancelable:r});return i.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}const dirty_components=[],binding_callbacks=[];let render_callbacks=[];const flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function tick(){return schedule_update(),resolved_promise}function add_render_callback(e){render_callbacks.push(e)}const seen_callbacks=new Set;let flushidx=0;function flush(){if(0!==flushidx)return;const e=current_component;do{try{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}}catch(e){throw dirty_components.length=0,flushidx=0,e}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(e)}function update(e){if(null!==e.fragment){e.update(),run_all(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(add_render_callback)}}function flush_render_callbacks(e){const t=[],n=[];render_callbacks.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),render_callbacks=t}const outroing=new Set;function transition_in(e,t){e&&e.i&&(outroing.delete(e),e.i(t))}function mount_component(e,t,n,r){const{fragment:i,after_update:o}=e.$$;i&&i.m(t,n),r||add_render_callback((()=>{const t=e.$$.on_mount.map(run).filter(is_function);e.$$.on_destroy?e.$$.on_destroy.push(...t):run_all(t),e.$$.on_mount=[]})),o.forEach(add_render_callback)}function destroy_component(e,t){const n=e.$$;null!==n.fragment&&(flush_render_callbacks(n.after_update),run_all(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function make_dirty(e,t){-1===e.$$.dirty[0]&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function init(e,t,n,r,i,o,a,c=[-1]){const s=current_component;set_current_component(e);const u=e.$$={fragment:null,ctx:[],props:o,update:noop,not_equal:i,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(s?s.$$.context:[])),callbacks:blank_object(),dirty:c,skip_bound:!1,root:t.target||s.$$.root};a&&a(u.root);let l=!1;if(u.ctx=n?n(e,t.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return u.ctx&&i(u.ctx[t],u.ctx[t]=o)&&(!u.skip_bound&&u.bound[t]&&u.bound[t](o),l&&make_dirty(e,t)),n})):[],u.update(),l=!0,run_all(u.before_update),u.fragment=!!r&&r(u.ctx),t.target){if(t.hydrate){const e=children(t.target);u.fragment&&u.fragment.l(e),e.forEach(detach)}else u.fragment&&u.fragment.c();t.intro&&transition_in(e.$$.fragment),mount_component(e,t.target,t.anchor,t.customElement),flush()}set_current_component(s)}let SvelteElement;function add(e,t){return{x:e.x+t.x,y:e.y+t.y}}function subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}}function scale(e,t){return{x:e.x*t,y:e.y*t}}function rotate(e,t,n={x:0,y:0}){const r=e.x-n.x,i=e.y-n.y;return{x:n.x+r*Math.cos(t)-i*Math.sin(t),y:n.y+i*Math.cos(t)+r*Math.sin(t)}}function direction(e){const t=Math.atan(e.x/e.y);return e.y>0?t+Math.PI:t}function length(e){return Math.sqrt(e.x*e.x+e.y*e.y)}"function"==typeof HTMLElement&&(SvelteElement=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(run).filter(is_function);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){run_all(this.$$.on_disconnect)}$destroy(){destroy_component(this,1),this.$destroy=noop}$on(e,t){if(!is_function(t))return noop;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});var vector={add:add,subtract:subtract,sub:subtract,scale:scale,rotate:rotate,direction:direction,length:length,len:length};const subscriber_queue=[];function writable(e,t=noop){let n;const r=new Set;function i(t){if(safe_not_equal(e,t)&&(e=t,n)){const t=!subscriber_queue.length;for(const t of r)t[1](),subscriber_queue.push(t,e);if(t){for(let e=0;e<subscriber_queue.length;e+=2)subscriber_queue[e][0](subscriber_queue[e+1]);subscriber_queue.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(o,a=noop){const c=[o,a];return r.add(c),1===r.size&&(n=t(i)||noop),o(e),()=>{r.delete(c),0===r.size&&n&&(n(),n=null)}}}}let toollayer=writable(0);class magneticLines{rotatePoint(e,t,n){const r=Math.cos(n),i=Math.sin(n);return{x:e*r-t*i,y:e*i+t*r}}calcMagneticLine(e,t,n,r){let i,o,a,c,s,u=r.x,l=r.y,h=r.width,f=r.height,m=r.rotation,d=u+h/2,p=l+f/2;if("side"===t)"top"===e?(i=this.rotatePoint(0,-f/2,m),o=m,s=h+1e3):"right"===e?(i=this.rotatePoint(h/2,0,m),o=m+Math.PI/2,s=f+1e3):"bottom"===e?(i=this.rotatePoint(0,f/2,m),o=m+Math.PI,s=h+1e3):"left"===e&&(i=this.rotatePoint(-h/2,0,m),o=m-Math.PI/2,s=f+1e3),a=d+i.x,c=p+i.y;else if("center"===t){a=d,c=p,"horizontal"===n?o=m:"vertical"===n?o=m+Math.PI/2:"aligned"===n&&(o=m);s=Math.hypot(h,f)+1e3}return{x_line:a,y_line:c,lineLength:s,theta_line:o}}rotatePositionBackToOriginal(e,t){let n=this.centerX,r=this.centerY;const i=e.x,o=e.y,a=e.width,c=e.height,s=i+a/2,u=o+c/2;return{x:n+(s-n)*Math.cos(t)-(u-r)*Math.sin(t)-a/2,y:r+(s-n)*Math.sin(t)+(u-r)*Math.cos(t)-c/2,width:a,height:c,rotation:t}}rotateBoxesToZero(e,t){let n=0,r=0;return e.forEach((e=>{n+=e.x+e.width/2,r+=e.y+e.height/2})),n/=e.length,r/=e.length,this.centerX=n,this.centerY=r,e.forEach((e=>{let i=e.x+e.width/2,o=e.y+e.height/2,a=n+(i-n)*Math.cos(-t)-(o-r)*Math.sin(-t),c=r+(i-n)*Math.sin(-t)+(o-r)*Math.cos(-t);e.x=a-e.width/2,e.y=c-e.height/2,e.rotation=0})),e}}function warpImage(e,t,n,r){var i=e.naturalWidth,o=e.naturalHeight,a=[{x:0,y:0},{x:i,y:0},{x:i,y:o},{x:0,y:o}];const c=-r,s=Math.cos(c),u=Math.sin(c);let[l,h]=getCenterFromCorners$1(a);r&&(a=a.map((({x:e,y:t})=>{const n=e-l,r=t-h;return{x:n*s-r*u+l,y:n*u+r*s+h}})));var f=computeHomography(a,t),m=Math.min(...t.map((e=>e.x))),d=Math.max(...t.map((e=>e.x))),p=Math.min(...t.map((e=>e.y)));let g=d-m,y=Math.max(...t.map((e=>e.y)))-p;n.width=Math.ceil(g),n.height=Math.ceil(y);var x=invertHomography(f),v=document.createElement("canvas");v.width=i,v.height=o;var b=v.getContext("2d");b.drawImage(e,0,0,i,o);for(var _=b.getImageData(0,0,i,o).data,w=n.getContext("2d"),$=w.createImageData(n.width,n.height),k=$.data,M=0;M<n.height;M++)for(var T=0;T<n.width;T++){var A=applyHomography(x,T+m,M+p),j=A.x,L=A.y;if(j>=0&&j<i&&L>=0&&L<o){var S=sampleBilinear(_,i,o,j,L),C=4*(M*n.width+T);k[C]=S[0],k[C+1]=S[1],k[C+2]=S[2],k[C+3]=S[3]}}w.putImageData($,0,0)}function getCenterFromCorners$1(e){const t=e[0],n=e[2];return[(t.x+n.x)/2,(t.y+n.y)/2]}function computeHomography(e,t){for(var n=[],r=0;r<4;r++){var i=e[r].x,o=e[r].y,a=t[r].x,c=t[r].y;n.push([-i,-o,-1,0,0,0,i*a,o*a,a]),n.push([0,0,0,-i,-o,-1,i*c,o*c,c])}var s=solveHomography(n);return[[s[0],s[1],s[2]],[s[3],s[4],s[5]],[s[6],s[7],s[8]]]}function solveHomography(e){for(var t=[],n=[],r=0;r<e.length;r++)t.push(e[r].slice(0,8)),n.push(-e[r][8]);var i=solveLinearSystem(t,n);return i.push(1),i}function solveLinearSystem(e,t){for(var n=e.length,r=e[0].length,i=0;i<n;i++)e[i].push(t[i]);for(var o=0;o<r;o++){var a=o,c=Math.abs(e[o][o]);for(i=o+1;i<n;i++)Math.abs(e[i][o])>c&&(c=Math.abs(e[i][o]),a=i);if(a!==o){var s=e[o];e[o]=e[a],e[a]=s}for(i=o+1;i<n;i++)for(var u=e[i][o]/e[o][o],l=o;l<=r;l++)e[i][l]-=u*e[o][l]}var h=new Array(r);for(i=r-1;i>=0;i--){h[i]=e[i][r]/e[i][i];for(o=i-1;o>=0;o--)e[o][r]-=e[o][i]*h[i]}return h}function invertHomography(e){var t=e[0][0]*(e[1][1]*e[2][2]-e[2][1]*e[1][2])-e[0][1]*(e[1][0]*e[2][2]-e[2][0]*e[1][2])+e[0][2]*(e[1][0]*e[2][1]-e[2][0]*e[1][1]);if(0===t)throw new Error("Homography matrix is singular and cannot be inverted.");var n=1/t;return[[(e[1][1]*e[2][2]-e[2][1]*e[1][2])*n,(e[0][2]*e[2][1]-e[0][1]*e[2][2])*n,(e[0][1]*e[1][2]-e[0][2]*e[1][1])*n],[(e[1][2]*e[2][0]-e[1][0]*e[2][2])*n,(e[0][0]*e[2][2]-e[0][2]*e[2][0])*n,(e[1][0]*e[0][2]-e[0][0]*e[1][2])*n],[(e[1][0]*e[2][1]-e[2][0]*e[1][1])*n,(e[2][0]*e[0][1]-e[0][0]*e[2][1])*n,(e[0][0]*e[1][1]-e[1][0]*e[0][1])*n]]}function applyHomography(e,t,n){var r=e[2][0]*t+e[2][1]*n+e[2][2];return{x:(e[0][0]*t+e[0][1]*n+e[0][2])/r,y:(e[1][0]*t+e[1][1]*n+e[1][2])/r}}function sampleBilinear(e,t,n,r,i){var o=Math.floor(r),a=Math.floor(i),c=o+1,s=a+1,u=r-o,l=i-a,h=function(e,r){return e=Math.max(0,Math.min(t-1,e)),4*((r=Math.max(0,Math.min(n-1,r)))*t+e)},f=getPixel(e,h(o,a)),m=getPixel(e,h(c,a)),d=getPixel(e,h(o,s)),p=getPixel(e,h(c,s)),g=interpolateColor(f,m,u),y=interpolateColor(d,p,u);return interpolateColor(g,y,l)}function getPixel(e,t){return[e[t],e[t+1],e[t+2],e[t+3]]}function interpolateColor(e,t,n){for(var r=[],i=0;i<4;i++)r[i]=e[i]*(1-n)+t[i]*n;return r}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var numeric1_2_6=createCommonjsModule((function(module,exports){var numeric=exports;void 0!==commonjsGlobal&&(commonjsGlobal.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var n,r,i;for(void 0===t&&(t=15),r=.5,n=new Date;;){for(i=r*=2;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;if(new Date-n>t)break}for(i=r;i>3;i-=4)e(),e(),e(),e();for(;i>0;)e(),i--;return 1e3*(3*r-1)/(new Date-n)},numeric._myIndexOf=function(e){var t,n=this.length;for(t=0;t<n;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),r=e/Math.pow(10,n),i=r.toPrecision(numeric.precision);return 10===parseFloat(i)&&(n++,i=(r=1).toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+n.toString()}return"Infinity"}var n=[];return function e(r){var i;if(void 0===r)return n.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof r)return n.push('"'+r+'"'),!1;if("boolean"==typeof r)return n.push(r.toString()),!1;if("number"==typeof r){var o=t(r),a=r.toPrecision(numeric.precision),c=parseFloat(r.toString()).toString(),s=[o,a,c,parseFloat(a).toString(),parseFloat(c).toString()];for(i=1;i<s.length;i++)s[i].length<o.length&&(o=s[i]);return n.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===r)return n.push("null"),!1;if("function"==typeof r){n.push(r.toString());var u=!1;for(i in r)r.hasOwnProperty(i)&&(u?n.push(",\n"):n.push("\n{"),u=!0,n.push(i),n.push(": \n"),e(r[i]));return u&&n.push("}\n"),!0}if(r instanceof Array){if(r.length>numeric.largeArray)return n.push("...Large Array..."),!0;u=!1;for(n.push("["),i=0;i<r.length;i++)i>0&&(n.push(","),u&&n.push("\n ")),u=e(r[i]);return n.push("]"),!0}for(i in n.push("{"),u=!1,r)r.hasOwnProperty(i)&&(u&&n.push(",\n"),u=!0,n.push(i),n.push(": \n"),e(r[i]));return n.push("}"),!0}(e),n.join("")},numeric.parseDate=function(e){return function e(t){if("string"==typeof t)return Date.parse(t.replace(/-/g,"/"));if(!(t instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseFloat=function(e){return function e(t){if("string"==typeof t)return parseFloat(t);if(!(t instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseCSV=function(e){var t,n,r,i=e.split("\n"),o=[],a=/(([^'",]*)|('[^']*')|("[^"]*")),/g,c=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,s=0;for(n=0;n<i.length;n++){var u,l=(i[n]+",").match(a);if(l.length>0){for(o[s]=[],t=0;t<l.length;t++)u=(r=l[t]).substr(0,r.length-1),c.test(u)?o[s][t]=parseFloat(u):o[s][t]=u;s++}}return o},numeric.toCSV=function(e){var t,n,r,i,o,a=numeric.dim(e);for(r=a[0],a[1],o=[],t=0;t<r;t++){for(i=[],n=0;n<r;n++)i[n]=e[t][n].toString();o[t]=i.join(", ")}return o.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length);var r,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1;for(e.length,r=t;r<n;r++)o=o>>>8^i[255&(o^e[r])];return~o}var n,r,i,o,a,c,s,u,l,h,f=e[0].length,m=e[0][0].length,d=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,m>>24&255,m>>16&255,m>>8&255,255&m,f>>24&255,f>>16&255,f>>8&255,255&f,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(h=t(d,12,29),d[29]=h>>24&255,d[30]=h>>16&255,d[31]=h>>8&255,d[32]=255&h,n=1,r=0,s=0;s<f;s++){for(s<f-1?d.push(0):d.push(1),a=3*m+1+(0===s)&255,c=3*m+1+(0===s)>>8&255,d.push(a),d.push(c),d.push(255&~a),d.push(255&~c),0===s&&d.push(0),u=0;u<m;u++)for(i=0;i<3;i++)r=(r+(n=(n+(a=(a=e[i][s][u])>255?255:a<0?0:Math.round(a)))%65521))%65521,d.push(a);d.push(0)}return l=(r<<16)+n,d.push(l>>24&255),d.push(l>>16&255),d.push(l>>8&255),d.push(255&l),o=d.length-41,d[33]=o>>24&255,d[34]=o>>16&255,d[35]=o>>8&255,d[36]=255&o,h=t(d,37),d.push(h>>24&255),d.push(h>>16&255),d.push(h>>8&255),d.push(255&h),d.push(0),d.push(0),d.push(0),d.push(0),d.push(73),d.push(69),d.push(78),d.push(68),d.push(174),d.push(66),d.push(96),d.push(130),"data:image/png;base64,"+function(e){var t,n,r,i,o,a,c,s=e.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="";for(t=0;t<s;t+=3)o=((3&(n=e[t]))<<4)+((r=e[t+1])>>4),a=((15&r)<<2)+((i=e[t+2])>>6),c=63&i,t+1>=s?a=c=64:t+2>=s&&(c=64),l+=u.charAt(n>>2)+u.charAt(o)+u.charAt(a)+u.charAt(c);return l}(d)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t;return"object"==typeof e?"object"==typeof(t=e[0])?"object"==typeof t[0]?numeric._dim(e):[e.length,t.length]:[e.length]:[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,n){var r,i;if(!(t instanceof Array&&n instanceof Array))return!1;if((i=t.length)!==n.length)return!1;for(r=0;r<i;r++)if(t[r]!==n[r]){if("object"!=typeof t[r])return!1;if(!e(t[r],n[r]))return!1}return!0},numeric.rep=function(e,t,n){void 0===n&&(n=0);var r,i=e[n],o=Array(i);if(n===e.length-1){for(r=i-2;r>=0;r-=2)o[r+1]=t,o[r]=t;return-1===r&&(o[0]=t),o}for(r=i-1;r>=0;r--)o[r]=numeric.rep(e,t,n+1);return o},numeric.dotMMsmall=function(e,t){var n,r,i,o,a,c,s,u,l,h,f;for(o=e.length,a=t.length,c=t[0].length,s=Array(o),n=o-1;n>=0;n--){for(u=Array(c),l=e[n],i=c-1;i>=0;i--){for(h=l[a-1]*t[a-1][i],r=a-2;r>=1;r-=2)f=r-1,h+=l[r]*t[r][i]+l[f]*t[f][i];0===r&&(h+=l[0]*t[0][i]),u[i]=h}s[n]=u}return s},numeric._getCol=function(e,t,n){var r;for(r=e.length-1;r>0;--r)n[r]=e[r][t],n[--r]=e[r][t];0===r&&(n[0]=e[0][t])},numeric.dotMMbig=function(e,t){var n,r,i,o=numeric._getCol,a=t.length,c=Array(a),s=e.length,u=t[0].length,l=new Array(s),h=numeric.dotVV;for(--a,r=--s;-1!==r;--r)l[r]=Array(u);for(r=--u;-1!==r;--r)for(o(t,r,c),i=s;-1!==i;--i)n=e[i],l[i][r]=h(n,c);return l},numeric.dotMV=function(e,t){var n,r=e.length;t.length;var i=Array(r),o=numeric.dotVV;for(n=r-1;n>=0;n--)i[n]=o(e[n],t);return i},numeric.dotVM=function(e,t){var n,r,i,o,a,c,s;for(i=e.length,o=t[0].length,a=Array(o),r=o-1;r>=0;r--){for(c=e[i-1]*t[i-1][r],n=i-2;n>=1;n-=2)s=n-1,c+=e[n]*t[n][r]+e[s]*t[s][r];0===n&&(c+=e[0]*t[0][r]),a[r]=c}return a},numeric.dotVV=function(e,t){var n,r,i=e.length,o=e[i-1]*t[i-1];for(n=i-2;n>=1;n-=2)r=n-1,o+=e[n]*t[n]+e[r]*t[r];return 0===n&&(o+=e[0]*t[0]),o},numeric.dot=function(e,t){var n=numeric.dim;switch(1e3*n(e).length+n(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,n,r,i,o=e.length,a=Array(o);for(t=o-1;t>=0;t--){for(i=Array(o),n=t+2,r=o-1;r>=n;r-=2)i[r]=0,i[r-1]=0;for(r>t&&(i[r]=0),i[t]=e[t],r=t-1;r>=1;r-=2)i[r]=0,i[r-1]=0;0===r&&(i[0]=0),a[t]=i}return a},numeric.getDiag=function(e){var t,n=Math.min(e.length,e[0].length),r=Array(n);for(t=n-1;t>=1;--t)r[t]=e[t][t],r[--t]=e[t][t];return 0===t&&(r[0]=e[0][0]),r},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,n){void 0===n&&(n="");var r,i,o=[],a=/\[i\]$/,c="",s=!1;for(r=0;r<e.length;r++)a.test(e[r])?c=i=e[r].substring(0,e[r].length-3):i=e[r],"ret"===i&&(s=!0),o.push(i);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+c+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(s?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,t,n){void 0===n&&(n="");var r,i,o=[],a=/\[i\]$/,c="",s=!1;for(r=0;r<e.length;r++)a.test(e[r])?c=i=e[r].substring(0,e[r].length-3):i=e[r],"ret"===i&&(s=!0),o.push(i);return o[e.length]="var _n = "+c+".length;\nvar i"+(s?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function e(t,n,r,i,o){var a;if(i!==r.length-1)for(a=r[i]-1;a>=0;a--)e("object"==typeof t?t[a]:t,"object"==typeof n?n[a]:n,r,i+1,o);else o(t,n)},numeric._biforeach2=function e(t,n,r,i,o){if(i===r.length-1)return o(t,n);var a,c=r[i],s=Array(c);for(a=c-1;a>=0;--a)s[a]=e("object"==typeof t?t[a]:t,"object"==typeof n?n[a]:n,r,i+1,o);return s},numeric._foreach=function e(t,n,r,i){var o;if(r!==n.length-1)for(o=n[r]-1;o>=0;o--)e(t[o],n,r+1,i);else i(t)},numeric._foreach2=function e(t,n,r,i){if(r===n.length-1)return i(t);var o,a=n[r],c=Array(a);for(o=a-1;o>=0;o--)c[o]=e(t[o],n,r+1,i);return c},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var n,r,i="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(i="var "+t+" = Math."+t+";\n",n=function(e,n,r){return e+" = "+t+"("+n+","+r+")"},r=function(e,n){return e+" = "+t+"("+e+","+n+")"}):(n=function(e,n,r){return e+" = "+n+" "+t+" "+r},r=numeric.opseq.hasOwnProperty(e+"eq")?function(e,n){return e+" "+t+"= "+n}:function(e,n){return e+" = "+e+" "+t+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+r("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,n,r,i,o,a,c,s=numeric.dim(e),u=Math.abs,l=s[0],h=s[1],f=numeric.clone(e),m=numeric.identity(l);for(a=0;a<h;++a){var d=-1,p=-1;for(o=a;o!==l;++o)(c=u(f[o][a]))>p&&(d=o,p=c);for(n=f[d],f[d]=f[a],f[a]=n,i=m[d],m[d]=m[a],m[a]=i,e=n[a],c=a;c!==h;++c)n[c]/=e;for(c=h-1;-1!==c;--c)i[c]/=e;for(o=l-1;-1!==o;--o)if(o!==a){for(t=f[o],r=m[o],e=t[a],c=a+1;c!==h;++c)t[c]-=n[c]*e;for(c=h-1;c>0;--c)r[c]-=i[c]*e,r[--c]-=i[c]*e;0===c&&(r[0]-=i[0]*e)}}return m},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var n,r,i,o,a,c,s,u,l=t[0],h=1,f=numeric.clone(e);for(r=0;r<l-1;r++){for(i=r,n=r+1;n<l;n++)Math.abs(f[n][r])>Math.abs(f[i][r])&&(i=n);for(i!==r&&(s=f[i],f[i]=f[r],f[r]=s,h*=-1),o=f[r],n=r+1;n<l;n++){for(c=(a=f[n])[r]/o[r],i=r+1;i<l-1;i+=2)u=i+1,a[i]-=o[i]*c,a[u]-=o[u]*c;i!==l&&(a[i]-=o[i]*c)}if(0===o[r])return 0;h*=o[r]}return h*f[r][r]},numeric.transpose=function(e){var t,n,r,i,o,a=e.length,c=e[0].length,s=Array(c);for(n=0;n<c;n++)s[n]=Array(a);for(t=a-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=c-1;n>=1;--n)(o=s[n])[t]=i[n],o[t-1]=r[n],(o=s[--n])[t]=i[n],o[t-1]=r[n];0===n&&((o=s[0])[t]=i[0],o[t-1]=r[0])}if(0===t){for(r=e[0],n=c-1;n>=1;--n)s[n][0]=r[n],s[--n][0]=r[n];0===n&&(s[0][0]=r[0])}return s},numeric.negtranspose=function(e){var t,n,r,i,o,a=e.length,c=e[0].length,s=Array(c);for(n=0;n<c;n++)s[n]=Array(a);for(t=a-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=c-1;n>=1;--n)(o=s[n])[t]=-i[n],o[t-1]=-r[n],(o=s[--n])[t]=-i[n],o[t-1]=-r[n];0===n&&((o=s[0])[t]=-i[0],o[t-1]=-r[0])}if(0===t){for(r=e[0],n=c-1;n>=1;--n)s[n][0]=-r[n],s[--n][0]=-r[n];0===n&&(s[0][0]=-r[0])}return s},numeric._random=function e(t,n){var r,i,o=t[n],a=Array(o);if(n===t.length-1){for(i=Math.random,r=o-1;r>=1;r-=2)a[r]=i(),a[r-1]=i();return 0===r&&(a[0]=i()),a}for(r=o-1;r>=0;r--)a[r]=e(t,n+1);return a},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,n){if(void 0===n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var r,i=Array(n);for(r=--n;r>=0;r--)i[r]=(r*t+(n-r)*e)/n;return i},numeric.getBlock=function(e,t,n){var r=numeric.dim(e);return function e(i,o){var a,c=t[o],s=n[o]-c,u=Array(s);if(o===r.length-1){for(a=s;a>=0;a--)u[a]=i[a+c];return u}for(a=s;a>=0;a--)u[a]=e(i[a+c],o+1);return u}(e,0)},numeric.setBlock=function(e,t,n,r){var i=numeric.dim(e);return function e(r,o,a){var c,s=t[a],u=n[a]-s;if(a===i.length-1)for(c=u;c>=0;c--)r[c+s]=o[c];for(c=u;c>=0;c--)e(r[c+s],o[c],a+1)}(e,r,0),e},numeric.getRange=function(e,t,n){var r,i,o,a,c=t.length,s=n.length,u=Array(c);for(r=c-1;-1!==r;--r)for(u[r]=Array(s),o=u[r],a=e[t[r]],i=s-1;-1!==i;--i)o[i]=a[n[i]];return u},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var n,r,i,o,a,c=t[0],s=t[1];for(n=0,r=0,i=0;i<c;++i)n+=e[i][0].length;for(o=0;o<s;++o)r+=e[0][o][0].length;var u=Array(n);for(i=0;i<n;++i)u[i]=Array(r);var l,h,f,m,d,p=0;for(i=0;i<c;++i){for(l=r,o=s-1;-1!==o;--o)for(l-=(a=e[i][o])[0].length,f=a.length-1;-1!==f;--f)for(d=a[f],h=u[p+f],m=d.length-1;-1!==m;--m)h[l+m]=d[m];p+=e[i][0].length}return u},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var n=numeric.dim(e),r=numeric.dim(t);if(1!==n.length||1!==r.length)throw new Error("numeric: tensor product is only defined for vectors");var i,o,a,c,s=n[0],u=r[0],l=Array(s);for(o=s-1;o>=0;o--){for(i=Array(u),c=e[o],a=u-1;a>=3;--a)i[a]=c*t[a],i[--a]=c*t[a],i[--a]=c*t[a],i[--a]=c*t[a];for(;a>=0;)i[a]=c*t[a],--a;l[o]=i}return l},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,n,r,i){var o;if(numeric.indexOf,"string"!=typeof i)for(o in i="",numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||t.indexOf(o)>=0||n.indexOf(o)>=0||r.indexOf(o)>=0)&&o.length>1&&(i+="var "+o+" = numeric."+o+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+r+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var n=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,n),t(numeric.neg(this.y),n))}return new T(t(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var t=numeric.div;return this.y?new numeric.T(t(this.x,e.x),t(this.y,e.x)):new numeric.T(t(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),e(n)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),numeric.negtranspose(n)):new numeric.T(e(t))},numeric.Tunop=function(e,t,n){return"string"!=typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if(void 0===e.y)return new numeric.T(numeric.inv(e.x));var t,n,r,i,o,a,c,s,u,l,h,f,m,d,p,g,y,x,v=e.x.length,b=numeric.identity(v),_=numeric.rep([v,v],0),w=numeric.clone(e.x),$=numeric.clone(e.y);for(u=0;u<v;u++){for(f=(d=w[u][u])*d+(p=$[u][u])*p,h=u,l=u+1;l<v;l++)(m=(d=w[l][u])*d+(p=$[l][u])*p)>f&&(h=l,f=m);for(h!==u&&(x=w[u],w[u]=w[h],w[h]=x,x=$[u],$[u]=$[h],$[h]=x,x=b[u],b[u]=b[h],b[h]=x,x=_[u],_[u]=_[h],_[h]=x),t=w[u],n=$[u],o=b[u],a=_[u],d=t[u],p=n[u],l=u+1;l<v;l++)g=t[l],y=n[l],t[l]=(g*d+y*p)/f,n[l]=(y*d-g*p)/f;for(l=0;l<v;l++)g=o[l],y=a[l],o[l]=(g*d+y*p)/f,a[l]=(y*d-g*p)/f;for(l=u+1;l<v;l++){for(r=w[l],i=$[l],c=b[l],s=_[l],d=r[u],p=i[u],h=u+1;h<v;h++)g=t[h],y=n[h],r[h]-=g*d-y*p,i[h]-=y*d+g*p;for(h=0;h<v;h++)g=o[h],y=a[h],c[h]-=g*d-y*p,s[h]-=y*d+g*p}}for(u=v-1;u>0;u--)for(o=b[u],a=_[u],l=u-1;l>=0;l--)for(c=b[l],s=_[l],d=w[l][u],p=$[l][u],h=v-1;h>=0;h--)g=o[h],y=a[h],c[h]-=d*g-p*y,s[h]-=d*y+p*g;return new numeric.T(b,_)},numeric.T.prototype.get=function(e){var t,n=this.x,r=this.y,i=0,o=e.length;if(r){for(;i<o;)n=n[t=e[i]],r=r[t],i++;return new numeric.T(n,r)}for(;i<o;)n=n[t=e[i]],i++;return new numeric.T(n)},numeric.T.prototype.set=function(e,t){var n,r=this.x,i=this.y,o=0,a=e.length,c=t.x,s=t.y;if(0===a)return s?this.y=s:i&&(this.y=void 0),this.x=r,this;if(s){for(i||(i=numeric.rep(numeric.dim(r),0),this.y=i);o<a-1;)r=r[n=e[o]],i=i[n],o++;return r[n=e[o]]=c,i[n]=s,this}if(i){for(;o<a-1;)r=r[n=e[o]],i=i[n],o++;return r[n=e[o]]=c,i[n]=c instanceof Array?numeric.rep(numeric.dim(c),0):0,this}for(;o<a-1;)r=r[n=e[o]],o++;return r[n=e[o]]=c,this},numeric.T.prototype.getRows=function(e,t){var n,r,i=t-e+1,o=Array(i),a=this.x,c=this.y;for(n=e;n<=t;n++)o[n-e]=a[n];if(c){for(r=Array(i),n=e;n<=t;n++)r[n-e]=c[n];return new numeric.T(o,r)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,t,n){var r,i=this.x,o=this.y,a=n.x,c=n.y;for(r=e;r<=t;r++)i[r]=a[r-e];if(c)for(o||(o=numeric.rep(numeric.dim(i),0),this.y=o),r=e;r<=t;r++)o[r]=c[r-e];else if(o)for(r=e;r<=t;r++)o[r]=numeric.rep([a[r-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,n=this.y;return n?new numeric.T(t[e],n[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var n=this.x,r=this.y,i=t.x,o=t.y;return n[e]=i,o?(r||(r=numeric.rep(numeric.dim(n),0),this.y=r),r[e]=o):r&&(r=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var n=this.x,r=this.y,i=numeric.getBlock;return r?new numeric.T(i(n,e,t),i(r,e,t)):new numeric.T(i(n,e,t))},numeric.T.prototype.setBlock=function(e,t,n){n instanceof numeric.T||(n=new numeric.T(n));var r=this.x,i=this.y,o=numeric.setBlock,a=n.x,c=n.y;if(c)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),o(r,e,t,a),o(i,e,t,c),this;o(r,e,t,a),i&&o(i,e,t,numeric.rep(numeric.dim(a),0))},numeric.T.rep=function(e,t){var n=numeric.T;t instanceof n||(t=new n(t));var r=t.x,i=t.y,o=numeric.rep;return i?new n(o(e,r),o(e,i)):new n(o(e,r))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,n=e.y,r=numeric.diag;return n?new numeric.T(r(t),r(n)):new numeric.T(r(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,n=this.y;return n?new e.T(e.getDiag(t),e.getDiag(n)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),n=(e[0]>=0?1:-1)*numeric.norm2(e);t[0]+=n;var r=numeric.norm2(t);if(0===r)throw new Error("eig: internal error");return numeric.div(t,r)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var n,r,i,o,a,c,s,u,l,h,f=t[0],m=numeric.clone(e),d=numeric.identity(f);for(r=0;r<f-2;r++){for(o=Array(f-r-1),n=r+1;n<f;n++)o[n-r-1]=m[n][r];if(numeric.norm2(o)>0){for(a=numeric.house(o),c=numeric.getBlock(m,[r+1,r],[f-1,f-1]),s=numeric.tensor(a,numeric.dot(a,c)),n=r+1;n<f;n++)for(u=m[n],l=s[n-r-1],i=r;i<f;i++)u[i]-=2*l[i-r];for(c=numeric.getBlock(m,[0,r+1],[f-1,f-1]),s=numeric.tensor(numeric.dot(c,a),a),n=0;n<f;n++)for(u=m[n],l=s[n],i=r+1;i<f;i++)u[i]-=2*l[i-r-1];for(c=Array(f-r-1),n=r+1;n<f;n++)c[n-r-1]=d[n];for(s=numeric.tensor(a,numeric.dot(a,c)),n=r+1;n<f;n++)for(h=d[n],l=s[n-r-1],i=0;i<f;i++)h[i]-=2*l[i]}}return{H:m,Q:d}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(e,t){void 0===t&&(t=1e4),e=numeric.clone(e),numeric.clone(e);var n,r,i,o,a,c,s,u,l,h,f,m,d,p,g,y,x,v,b=numeric.dim(e)[0],_=numeric.identity(b);if(b<3)return{Q:_,B:[[0,b-1]]};var w=numeric.epsilon;for(v=0;v<t;v++){for(y=0;y<b-1;y++)if(Math.abs(e[y+1][y])<w*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){var $=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),k=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[b-1,b-1]),t);for(m=Array(y+1),g=0;g<=y;g++)m[g]=_[g];for(d=numeric.dot($.Q,m),g=0;g<=y;g++)_[g]=d[g];for(m=Array(b-y-1),g=y+1;g<b;g++)m[g-y-1]=_[g];for(d=numeric.dot(k.Q,m),g=y+1;g<b;g++)_[g]=d[g-y-1];return{Q:_,B:$.B.concat(numeric.add(k.B,y+1))}}var M,T,A;if(i=e[b-2][b-2],o=e[b-2][b-1],a=e[b-1][b-2],u=i+(c=e[b-1][b-1]),s=i*c-o*a,l=numeric.getBlock(e,[0,0],[2,2]),u*u>=4*s)M=.5*(u+Math.sqrt(u*u-4*s)),T=.5*(u-Math.sqrt(u*u-4*s)),l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,M+T)),numeric.diag(numeric.rep([3],M*T)));else l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,u)),numeric.diag(numeric.rep([3],s)));for(n=[l[0][0],l[1][0],l[2][0]],r=numeric.house(n),m=[e[0],e[1],e[2]],d=numeric.tensor(r,numeric.dot(r,m)),g=0;g<3;g++)for(f=e[g],p=d[g],x=0;x<b;x++)f[x]-=2*p[x];for(m=numeric.getBlock(e,[0,0],[b-1,2]),d=numeric.tensor(numeric.dot(m,r),r),g=0;g<b;g++)for(f=e[g],p=d[g],x=0;x<3;x++)f[x]-=2*p[x];for(m=[_[0],_[1],_[2]],d=numeric.tensor(r,numeric.dot(r,m)),g=0;g<3;g++)for(h=_[g],p=d[g],x=0;x<b;x++)h[x]-=2*p[x];for(y=0;y<b-2;y++){for(x=y;x<=y+1;x++)if(Math.abs(e[x+1][x])<w*(Math.abs(e[x][x])+Math.abs(e[x+1][x+1]))){$=numeric.QRFrancis(numeric.getBlock(e,[0,0],[x,x]),t),k=numeric.QRFrancis(numeric.getBlock(e,[x+1,x+1],[b-1,b-1]),t);for(m=Array(x+1),g=0;g<=x;g++)m[g]=_[g];for(d=numeric.dot($.Q,m),g=0;g<=x;g++)_[g]=d[g];for(m=Array(b-x-1),g=x+1;g<b;g++)m[g-x-1]=_[g];for(d=numeric.dot(k.Q,m),g=x+1;g<b;g++)_[g]=d[g-x-1];return{Q:_,B:$.B.concat(numeric.add(k.B,x+1))}}for(A=Math.min(b-1,y+3),n=Array(A-y),g=y+1;g<=A;g++)n[g-y-1]=e[g][y];for(r=numeric.house(n),m=numeric.getBlock(e,[y+1,y],[A,b-1]),d=numeric.tensor(r,numeric.dot(r,m)),g=y+1;g<=A;g++)for(f=e[g],p=d[g-y-1],x=y;x<b;x++)f[x]-=2*p[x-y];for(m=numeric.getBlock(e,[0,y+1],[b-1,A]),d=numeric.tensor(numeric.dot(m,r),r),g=0;g<b;g++)for(f=e[g],p=d[g],x=y+1;x<=A;x++)f[x]-=2*p[x-y-1];for(m=Array(A-y),g=y+1;g<=A;g++)m[g-y-1]=_[g];for(d=numeric.tensor(r,numeric.dot(r,m)),g=y+1;g<=A;g++)for(h=_[g],p=d[g-y-1],x=0;x<b;x++)h[x]-=2*p[x]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var n,r,i,o,a,c,s,u,l,h,f,m,d,p,g,y,x=numeric.toUpperHessenberg(e),v=numeric.QRFrancis(x.H,t),b=numeric.T,_=e.length,w=v.B,$=numeric.dot(v.Q,numeric.dot(x.H,numeric.transpose(v.Q))),k=new b(numeric.dot(v.Q,x.Q)),M=w.length,T=Math.sqrt;for(r=0;r<M;r++)if((n=w[r][0])===w[r][1]);else{if(o=n+1,a=$[n][n],c=$[n][o],s=$[o][n],u=$[o][o],0===c&&0===s)continue;(h=(l=-a-u)*l-4*(a*u-c*s))>=0?((g=(a-(f=l<0?-.5*(l-T(h)):-.5*(l+T(h))))*(a-f)+c*c)>(y=s*s+(u-f)*(u-f))?(d=(a-f)/(g=T(g)),p=c/g):(d=s/(y=T(y)),p=(u-f)/y),i=new b([[p,-d],[d,p]]),k.setRows(n,o,i.dot(k.getRows(n,o)))):(f=-.5*l,m=.5*T(-h),(g=(a-f)*(a-f)+c*c)>(y=s*s+(u-f)*(u-f))?(d=(a-f)/(g=T(g+m*m)),p=c/g,f=0,m/=g):(d=s/(y=T(y+m*m)),p=(u-f)/y,f=m/y,m=0),i=new b([[p,-d],[d,p]],[[f,m],[m,-f]]),k.setRows(n,o,i.dot(k.getRows(n,o))))}var A=k.dot(e).dot(k.transjugate()),j=(_=e.length,numeric.T.identity(_));for(o=0;o<_;o++)if(o>0)for(r=o-1;r>=0;r--){var L=A.get([r,r]),S=A.get([o,o]);numeric.neq(L.x,S.x)||numeric.neq(L.y,S.y)?(f=A.getRow(r).getBlock([r],[o-1]),m=j.getRow(o).getBlock([r],[o-1]),j.set([o,r],A.get([r,o]).neg().sub(f.dot(m)).div(L.sub(S)))):j.setRow(o,j.getRow(r))}for(o=0;o<_;o++)f=j.getRow(o),j.setRow(o,f.div(f.norm2()));return j=j.transpose(),j=k.transjugate().dot(j),{lambda:A.getDiag(),E:j}},numeric.ccsSparse=function(e){var t,n,r,i=e.length,o=[];for(n=i-1;-1!==n;--n)for(r in t=e[n]){for(r=parseInt(r);r>=o.length;)o[o.length]=0;0!==t[r]&&o[r]++}var a=o.length,c=Array(a+1);for(c[0]=0,n=0;n<a;++n)c[n+1]=c[n]+o[n];var s=Array(c[a]),u=Array(c[a]);for(n=i-1;-1!==n;--n)for(r in t=e[n])0!==t[r]&&(o[r]--,s[c[r]+o[r]]=n,u[c[r]+o[r]]=t[r]);return[c,s,u]},numeric.ccsFull=function(e){var t,n,r,i,o=e[0],a=e[1],c=e[2],s=numeric.ccsDim(e),u=s[0],l=s[1],h=numeric.rep([u,l],0);for(t=0;t<l;t++)for(r=o[t],i=o[t+1],n=r;n<i;++n)h[a[n]][t]=c[n];return h},numeric.ccsTSolve=function(e,t,n,r,i){var o,a,c,s,u,l,h,f=e[0],m=e[1],d=e[2],p=f.length-1,g=Math.max,y=0;function x(e){var t;if(0===n[e]){for(n[e]=1,t=f[e];t<f[e+1];++t)x(m[t]);i[y]=e,++y}}for(void 0===r&&(n=numeric.rep([p],0)),void 0===r&&(r=numeric.linspace(0,n.length-1)),void 0===i&&(i=[]),o=r.length-1;-1!==o;--o)x(r[o]);for(i.length=y,o=i.length-1;-1!==o;--o)n[i[o]]=0;for(o=r.length-1;-1!==o;--o)a=r[o],n[a]=t[a];for(o=i.length-1;-1!==o;--o){for(a=i[o],c=f[a],s=g(f[a+1],c),u=c;u!==s;++u)if(m[u]===a){n[a]/=d[u];break}for(h=n[a],u=c;u!==s;++u)(l=m[u])!==a&&(n[l]-=h*d[u])}return n},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,n,r,i,o){var a,c,s,u=0,l=i.length,h=this.k,f=this.k1,m=this.j;if(0===r[e])for(r[e]=1,m[0]=e,h[0]=c=t[e],f[0]=s=t[e+1];;)if(c>=s){if(i[l]=m[u],0===u)return;++l,c=h[--u],s=f[u]}else 0===r[a=o[n[c]]]?(r[a]=1,h[u]=c,m[++u]=a,c=t[a],f[u]=s=t[a+1]):++c},numeric.ccsLPSolve=function(e,t,n,r,i,o,a){var c=e[0],s=e[1],u=e[2];c.length;var l,h,f,m,d,p,g,y,x,v=t[0],b=t[1],_=t[2];for(h=v[i],f=v[i+1],r.length=0,l=h;l<f;++l)a.dfs(o[b[l]],c,s,n,r,o);for(l=r.length-1;-1!==l;--l)n[r[l]]=0;for(l=h;l!==f;++l)n[m=o[b[l]]]=_[l];for(l=r.length-1;-1!==l;--l){for(d=c[m=r[l]],p=c[m+1],g=d;g<p;++g)if(o[s[g]]===m){n[m]/=u[g];break}for(x=n[m],g=d;g<p;++g)(y=o[s[g]])!==m&&(n[y]-=x*u[g])}return n},numeric.ccsLUP1=function(e,t){var n,r,i,o,a,c,s,u=e[0].length-1,l=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],f=l[0],m=l[1],d=l[2],p=h[0],g=h[1],y=h[2],x=numeric.rep([u],0),v=numeric.rep([u],0),b=numeric.ccsLPSolve,_=Math.abs,w=numeric.linspace(0,u-1),$=numeric.linspace(0,u-1),k=new numeric.ccsDFS(u);for(void 0===t&&(t=1),n=0;n<u;++n){for(b(l,e,x,v,n,$,k),o=-1,a=-1,r=v.length-1;-1!==r;--r)(i=v[r])<=n||(c=_(x[i]))>o&&(a=i,o=c);for(_(x[n])<t*o&&(r=w[n],o=w[a],w[n]=o,$[o]=n,w[a]=r,$[r]=a,o=x[n],x[n]=x[a],x[a]=o),o=f[n],a=p[n],s=x[n],m[o]=w[n],d[o]=1,++o,r=v.length-1;-1!==r;--r)c=x[i=v[r]],v[r]=0,x[i]=0,i<=n?(g[a]=i,y[a]=c,++a):(m[o]=w[i],d[o]=c/s,++o);f[n+1]=o,p[n+1]=a}for(r=m.length-1;-1!==r;--r)m[r]=$[m[r]];return{L:l,U:h,P:w,Pinv:$}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,n,r,i,o,a){var c,s,u,l=0,h=i.length,f=this.k,m=this.k1,d=this.j;if(0===r[e])for(r[e]=1,d[0]=e,f[0]=s=t[o[e]],m[0]=u=t[o[e]+1];;){if(isNaN(s))throw new Error("Ow!");if(s>=u){if(i[h]=o[d[l]],0===l)return;++h,s=f[--l],u=m[l]}else 0===r[c=n[s]]?(r[c]=1,f[l]=s,d[++l]=c,s=t[c=o[c]],m[l]=u=t[c+1]):++s}},numeric.ccsLPSolve0=function(e,t,n,r,i,o,a,c){var s=e[0],u=e[1],l=e[2];s.length;var h,f,m,d,p,g,y,x,v,b=t[0],_=t[1],w=t[2];for(f=b[i],m=b[i+1],r.length=0,h=f;h<m;++h)c.dfs(_[h],s,u,n,r,o,a);for(h=r.length-1;-1!==h;--h)n[a[d=r[h]]]=0;for(h=f;h!==m;++h)n[d=_[h]]=w[h];for(h=r.length-1;-1!==h;--h){for(x=a[d=r[h]],p=s[d],g=s[d+1],y=p;y<g;++y)if(u[y]===x){n[x]/=l[y];break}for(v=n[x],y=p;y<g;++y)n[u[y]]-=v*l[y];n[x]=v}},numeric.ccsLUP0=function(e,t){var n,r,i,o,a,c,s,u=e[0].length-1,l=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],f=l[0],m=l[1],d=l[2],p=h[0],g=h[1],y=h[2],x=numeric.rep([u],0),v=numeric.rep([u],0),b=numeric.ccsLPSolve0,_=Math.abs,w=numeric.linspace(0,u-1),$=numeric.linspace(0,u-1),k=new numeric.ccsDFS0(u);for(void 0===t&&(t=1),n=0;n<u;++n){for(b(l,e,x,v,n,$,w,k),o=-1,a=-1,r=v.length-1;-1!==r;--r)(i=v[r])<=n||(c=_(x[w[i]]))>o&&(a=i,o=c);for(_(x[w[n]])<t*o&&(r=w[n],o=w[a],w[n]=o,$[o]=n,w[a]=r,$[r]=a),o=f[n],a=p[n],s=x[w[n]],m[o]=w[n],d[o]=1,++o,r=v.length-1;-1!==r;--r)c=x[w[i=v[r]]],v[r]=0,x[w[i]]=0,i<=n?(g[a]=i,y[a]=c,++a):(m[o]=w[i],d[o]=c/s,++o);f[n+1]=o,p[n+1]=a}for(r=m.length-1;-1!==r;--r)m[r]=$[m[r]];return{L:l,U:h,P:w,Pinv:$}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,n){var r=numeric.ccsDim(e),i=r[0],o=r[1];void 0===t?t=numeric.linspace(0,i-1):"number"==typeof t&&(t=[t]),void 0===n?n=numeric.linspace(0,o-1):"number"==typeof n&&(n=[n]);var a,c,s,u,l=t.length,h=n.length,f=numeric.rep([o],0),m=[],d=[],p=[f,m,d],g=e[0],y=e[1],x=e[2],v=numeric.rep([i],0),b=0,_=numeric.rep([i],0);for(c=0;c<h;++c){var w=g[u=n[c]],$=g[u+1];for(a=w;a<$;++a)_[s=y[a]]=1,v[s]=x[a];for(a=0;a<l;++a)_[t[a]]&&(m[b]=a,d[b]=v[t[a]],++b);for(a=w;a<$;++a)_[s=y[a]]=0;f[c+1]=b}return p},numeric.ccsDot=function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],c=t[2],s=numeric.ccsDim(e),u=numeric.ccsDim(t),l=s[0];s[1];var h,f,m,d,p,g,y,x,v,b,_,w=u[1],$=numeric.rep([l],0),k=numeric.rep([l],0),M=Array(l),T=numeric.rep([w],0),A=[],j=[],L=[T,A,j];for(m=0;m!==w;++m){for(d=o[m],p=o[m+1],v=0,f=d;f<p;++f)for(b=a[f],_=c[f],g=n[b],y=n[b+1],h=g;h<y;++h)0===k[x=r[h]]&&(M[v]=x,k[x]=1,v+=1),$[x]=$[x]+i[h]*_;for(p=(d=T[m])+v,T[m+1]=p,f=v-1;-1!==f;--f)_=d+f,h=M[f],A[_]=h,j[_]=$[h],k[h]=0,$[h]=0;T[m+1]=T[m]+v}return L},numeric.ccsLUPSolve=function(e,t){var n=e.L,r=e.U;e.P;var i=t[0],o=!1;"object"!=typeof i&&(i=(t=[[0,t.length],numeric.linspace(0,t.length-1),t])[0],o=!0);var a,c,s,u,l,h,f=t[1],m=t[2],d=n[0].length-1,p=i.length-1,g=numeric.rep([d],0),y=Array(d),x=numeric.rep([d],0),v=Array(d),b=numeric.rep([p+1],0),_=[],w=[],$=numeric.ccsTSolve,k=0;for(a=0;a<p;++a){for(l=0,s=i[a],u=i[a+1],c=s;c<u;++c)h=e.Pinv[f[c]],v[l]=h,x[h]=m[c],++l;for(v.length=l,$(n,x,g,v,y),c=v.length-1;-1!==c;--c)x[v[c]]=0;if($(r,g,x,y,v),o)return x;for(c=y.length-1;-1!==c;--c)g[y[c]]=0;for(c=v.length-1;-1!==c;--c)h=v[c],_[k]=h,w[k]=x[h],x[h]=0,++k;b[a+1]=k}return[b,_,w]},numeric.ccsbinop=function(e,t){return void 0===t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,n=e[0],r=e[1],i=e[2],o=numeric.sup(r)+1,a=n.length,c=numeric.rep([o],0),s=Array(a),u=Array(a),l=numeric.rep([o],0);for(t=0;t<a;++t)l[r[t]]++;for(t=0;t<o;++t)c[t+1]=c[t]+l[t];var h,f,m=c.slice(0);for(t=0;t<a;++t)s[h=m[f=r[t]]]=n[t],u[h]=i[t],m[f]=m[f]+1;return[c,s,u]},numeric.ccsGather=function(e){var t,n,r,i,o,a=e[0],c=e[1],s=e[2],u=a.length-1,l=c.length,h=Array(l),f=Array(l),m=Array(l);for(o=0,t=0;t<u;++t)for(r=a[t],i=a[t+1],n=r;n!==i;++n)f[o]=t,h[o]=c[n],m[o]=s[n],++o;return[h,f,m]},numeric.sdim=function e(t,n,r){if(void 0===n&&(n=[]),"object"!=typeof t)return n;var i;for(i in void 0===r&&(r=0),r in n||(n[r]=0),t.length>n[r]&&(n[r]=t.length),t)t.hasOwnProperty(i)&&e(t[i],n,r+1);return n},numeric.sclone=function e(t,n,r){void 0===n&&(n=0),void 0===r&&(r=numeric.sdim(t).length);var i,o=Array(t.length);if(n===r-1){for(i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);return o}for(i in t)t.hasOwnProperty(i)&&(o[i]=e(t[i],n+1,r));return o},numeric.sdiag=function(e){var t,n,r=e.length,i=Array(r);for(t=r-1;t>=1;t-=2)n=t-1,i[t]=[],i[t][t]=e[t],i[n]=[],i[n][n]=e[n];return 0===t&&(i[0]=[],i[0][0]=e[t]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,n,r,i=[];for(t in e.length,e)if(e.hasOwnProperty(t))for(n in r=e[t])r.hasOwnProperty(n)&&("object"!=typeof i[n]&&(i[n]=[]),i[n][t]=r[n]);return i},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var n=e.length;t.length;var r,i,o,a,c,s,u,l=numeric.stranspose(t),h=l.length,f=Array(n);for(o=n-1;o>=0;o--){for(u=[],r=e[o],c=h-1;c>=0;c--){for(a in s=0,i=l[c],r)r.hasOwnProperty(a)&&a in i&&(s+=r[a]*i[a]);s&&(u[c]=s)}f[o]=u}return f},numeric.sdotMV=function(e,t){var n,r,i,o,a=e.length,c=Array(a);for(r=a-1;r>=0;r--){for(i in o=0,n=e[r])n.hasOwnProperty(i)&&t[i]&&(o+=n[i]*t[i]);o&&(c[r]=o)}return c},numeric.sdotVM=function(e,t){var n,r,i,o,a=[];for(n in e)if(e.hasOwnProperty(n))for(r in i=t[n],o=e[n],i)i.hasOwnProperty(r)&&(a[r]||(a[r]=0),a[r]+=o*i[r]);return a},numeric.sdotVV=function(e,t){var n,r=0;for(n in e)e[n]&&t[n]&&(r+=e[n]*t[n]);return r},numeric.sdot=function(e,t){var n=numeric.sdim(e).length,r=numeric.sdim(t).length;switch(1e3*n+r){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+r)}},numeric.sscatter=function(e){var t,n,r,i,o=e[0].length,a=e.length,c=[];for(n=o-1;n>=0;--n)if(e[a-1][n]){for(i=c,r=0;r<a-2;r++)i[t=e[r][n]]||(i[t]=[]),i=i[t];i[e[r][n]]=e[r+1][n]}return c},numeric.sgather=function e(t,n,r){var i,o,a;for(o in void 0===n&&(n=[]),void 0===r&&(r=[]),i=r.length,t)if(t.hasOwnProperty(o))if(r[i]=parseInt(o),"number"==typeof(a=t[o])){if(a){if(0===n.length)for(o=i+1;o>=0;--o)n[o]=[];for(o=i;o>=0;--o)n[o].push(r[o]);n[i+1].push(a)}}else e(a,n,r);return r.length>i&&r.pop(),n},numeric.cLU=function(e){var t,n,r,i,o,a,c=e[0],s=e[1],u=e[2],l=c.length,h=0;for(t=0;t<l;t++)c[t]>h&&(h=c[t]);h++;var f,m=Array(h),d=Array(h),p=numeric.rep([h],1/0),g=numeric.rep([h],-1/0);for(r=0;r<l;r++)t=c[r],(n=s[r])<p[t]&&(p[t]=n),n>g[t]&&(g[t]=n);for(t=0;t<h-1;t++)g[t]>g[t+1]&&(g[t+1]=g[t]);for(t=h-1;t>=1;t--)p[t]<p[t-1]&&(p[t-1]=p[t]);for(t=0;t<h;t++)d[t]=numeric.rep([g[t]-p[t]+1],0),m[t]=numeric.rep([t-p[t]],0),t-p[t]+1,g[t]-t+1;for(r=0;r<l;r++)d[t=c[r]][s[r]-p[t]]=u[r];for(t=0;t<h-1;t++)for(i=t-p[t],v=d[t],n=t+1;p[n]<=t&&n<h;n++)if(o=t-p[n],a=g[t]-t,f=(b=d[n])[o]/v[i]){for(r=1;r<=a;r++)b[r+o]-=f*v[r+i];m[n][t-p[n]]=f}var y,x,v=[],b=[],_=[],w=[],$=[],k=[];for(l=0,y=0,t=0;t<h;t++){for(i=p[t],o=g[t],x=d[t],n=t;n<=o;n++)x[n-i]&&(v[l]=t,b[l]=n,_[l]=x[n-i],l++);for(x=m[t],n=i;n<t;n++)x[n-i]&&(w[y]=t,$[y]=n,k[y]=x[n-i],y++);w[y]=t,$[y]=t,k[y]=1,y++}return{U:[v,b,_],L:[w,$,k]}},numeric.cLUsolve=function(e,t){var n=e.L,r=e.U,i=numeric.clone(t),o=n[0],a=n[1],c=n[2],s=r[0],u=r[1],l=r[2],h=s.length;o.length;var f,m,d=i.length;for(m=0,f=0;f<d;f++){for(;a[m]<f;)i[f]-=c[m]*i[a[m]],m++;m++}for(m=h-1,f=d-1;f>=0;f--){for(;u[m]>f;)i[f]-=l[m]*i[u[m]],m--;i[f]/=l[m],m--}return i},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var n,r,i,o=numeric.rep(e,-1);if("function"!=typeof t)if("L"===t)t=function(t,n){return t>=e[0]/2||n<e[1]/2};else t=function(e,t){return!0};for(i=0,n=1;n<e[0]-1;n++)for(r=1;r<e[1]-1;r++)t(n,r)&&(o[n][r]=i,i++);return o},numeric.cdelsq=function(e){var t,n,r,i,o,a=[[-1,0],[0,-1],[0,1],[1,0]],c=numeric.dim(e),s=c[0],u=c[1],l=[],h=[],f=[];for(t=1;t<s-1;t++)for(n=1;n<u-1;n++)if(!(e[t][n]<0)){for(r=0;r<4;r++)i=t+a[r][0],o=n+a[r][1],e[i][o]<0||(l.push(e[t][n]),h.push(e[i][o]),f.push(-1));l.push(e[t][n]),h.push(e[t][n]),f.push(4)}return[l,h,f]},numeric.cdotMV=function(e,t){var n,r,i,o=e[0],a=e[1],c=e[2],s=o.length;for(i=0,r=0;r<s;r++)o[r]>i&&(i=o[r]);for(i++,n=numeric.rep([i],0),r=0;r<s;r++)n[o[r]]+=c[r]*t[a[r]];return n},numeric.Spline=function(e,t,n,r,i){this.x=e,this.yl=t,this.yr=n,this.kl=r,this.kr=i},numeric.Spline.prototype._at=function(e,t){var n,r,i,o=this.x,a=this.yl,c=this.yr,s=this.kl,u=this.kr,l=numeric.add,h=numeric.sub,f=numeric.mul;n=h(f(s[t],o[t+1]-o[t]),h(c[t+1],a[t])),r=l(f(u[t+1],o[t]-o[t+1]),h(c[t+1],a[t]));var m=(i=(e-o[t])/(o[t+1]-o[t]))*(1-i);return l(l(l(f(1-i,a[t]),f(i,c[t+1])),f(n,m*(1-i))),f(r,m*i))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,n,r,i=this.x,o=i.length,a=Math.floor;for(t=0,n=o-1;n-t>1;)i[r=a((t+n)/2)]<=e?t=r:n=r;return this._at(e,t)}o=e.length;var c,s=Array(o);for(c=o-1;-1!==c;--c)s[c]=this.at(e[c]);return s},numeric.Spline.prototype.diff=function(){var e,t,n,r=this.x,i=this.yl,o=this.yr,a=this.kl,c=this.kr,s=i.length,u=a,l=c,h=Array(s),f=Array(s),m=numeric.add,d=numeric.mul,p=numeric.div,g=numeric.sub;for(e=s-1;-1!==e;--e)t=r[e+1]-r[e],n=g(o[e+1],i[e]),h[e]=p(m(d(n,6),d(a[e],-4*t),d(c[e+1],-2*t)),t*t),f[e+1]=p(m(d(n,-6),d(a[e],2*t),d(c[e+1],4*t)),t*t);return new numeric.Spline(r,u,l,h,f)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],n=this.x,r=this.yl,i=this.yr,o=this.kl,a=this.kr;"number"==typeof r[0]&&(r=[r],i=[i],o=[o],a=[a]);var c,s,u,l,h,f,m,d,p,g,y,x,v,b,_,w,$,k,M,T,A,j,L,S=r.length,C=n.length-1,E=(t=Array(S),Math.sqrt);for(c=0;c!==S;++c){for(l=r[c],h=i[c],f=o[c],m=a[c],d=[],s=0;s!==C;s++){for(s>0&&h[s]*l[s]<0&&d.push(n[s]),w=n[s+1]-n[s],n[s],y=l[s],x=h[s+1],p=f[s]/w,v=(g=m[s+1]/w)+3*y+2*p-3*x,b=3*(g+p+2*(y-x)),(_=e(p-g+3*(y-x))+12*g*y)<=0?$=(k=v/b)>n[s]&&k<n[s+1]?[n[s],k,n[s+1]]:[n[s],n[s+1]]:(k=(v-E(_))/b,M=(v+E(_))/b,$=[n[s]],k>n[s]&&k<n[s+1]&&$.push(k),M>n[s]&&M<n[s+1]&&$.push(M),$.push(n[s+1])),A=$[0],k=this._at(A,s),u=0;u<$.length-1;u++)if(j=$[u+1],M=this._at(j,s),0!==k)if(0===M||k*M>0)A=j,k=M;else{for(var P=0;!((L=(k*j-M*A)/(k-M))<=A||L>=j);)if((T=this._at(L,s))*M>0)j=L,M=T,-1===P&&(k*=.5),P=-1;else{if(!(T*k>0))break;A=L,k=T,1===P&&(M*=.5),P=1}d.push(L),A=$[u+1],k=this._at(A,s)}else d.push(A),A=j,k=M;0===M&&d.push(j)}t[c]=d}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,n,r){var i,o=e.length,a=[],c=[],s=[],u=numeric.sub,l=numeric.mul,h=numeric.add;for(i=o-2;i>=0;i--)c[i]=e[i+1]-e[i],s[i]=u(t[i+1],t[i]);"string"!=typeof n&&"string"!=typeof r||(n=r="periodic");var f=[[],[],[]];switch(typeof n){case"undefined":a[0]=l(3/(c[0]*c[0]),s[0]),f[0].push(0,0),f[1].push(0,1),f[2].push(2/c[0],1/c[0]);break;case"string":a[0]=h(l(3/(c[o-2]*c[o-2]),s[o-2]),l(3/(c[0]*c[0]),s[0])),f[0].push(0,0,0),f[1].push(o-2,0,1),f[2].push(1/c[o-2],2/c[o-2]+2/c[0],1/c[0]);break;default:a[0]=n,f[0].push(0),f[1].push(0),f[2].push(1)}for(i=1;i<o-1;i++)a[i]=h(l(3/(c[i-1]*c[i-1]),s[i-1]),l(3/(c[i]*c[i]),s[i])),f[0].push(i,i,i),f[1].push(i-1,i,i+1),f[2].push(1/c[i-1],2/c[i-1]+2/c[i],1/c[i]);switch(typeof r){case"undefined":a[o-1]=l(3/(c[o-2]*c[o-2]),s[o-2]),f[0].push(o-1,o-1),f[1].push(o-2,o-1),f[2].push(1/c[o-2],2/c[o-2]);break;case"string":f[1][f[1].length-1]=0;break;default:a[o-1]=r,f[0].push(o-1),f[1].push(o-1),f[2].push(1)}a="number"!=typeof a[0]?numeric.transpose(a):[a];var m=Array(a.length);if("string"==typeof n)for(i=m.length-1;-1!==i;--i)m[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(f)),a[i]),m[i][o-1]=m[i][0];else for(i=m.length-1;-1!==i;--i)m[i]=numeric.cLUsolve(numeric.cLU(f),a[i]);return m="number"==typeof t[0]?m[0]:numeric.transpose(m),new numeric.Spline(e,t,t,m,m)},numeric.fftpow2=function e(t,n){var r=t.length;if(1!==r){var i,o,a=Math.cos,c=Math.sin,s=Array(r/2),u=Array(r/2),l=Array(r/2),h=Array(r/2);for(o=r/2,i=r-1;-1!==i;--i)l[--o]=t[i],h[o]=n[i],--i,s[o]=t[i],u[o]=n[i];e(s,u),e(l,h),o=r/2;var f,m,d,p=-6.283185307179586/r;for(i=r-1;-1!==i;--i)-1===--o&&(o=r/2-1),m=a(f=p*i),d=c(f),t[i]=s[o]+m*l[o]-d*h[o],n[i]=u[o]+m*h[o]+d*l[o]}},numeric._ifftpow2=function e(t,n){var r=t.length;if(1!==r){var i,o,a=Math.cos,c=Math.sin,s=Array(r/2),u=Array(r/2),l=Array(r/2),h=Array(r/2);for(o=r/2,i=r-1;-1!==i;--i)l[--o]=t[i],h[o]=n[i],--i,s[o]=t[i],u[o]=n[i];e(s,u),e(l,h),o=r/2;var f,m,d,p=6.283185307179586/r;for(i=r-1;-1!==i;--i)-1===--o&&(o=r/2-1),m=a(f=p*i),d=c(f),t[i]=s[o]+m*l[o]-d*h[o],n[i]=u[o]+m*h[o]+d*l[o]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,n,r){var i,o,a,c,s;for(numeric.fftpow2(e,t),numeric.fftpow2(n,r),i=e.length-1;-1!==i;--i)o=e[i],c=t[i],a=n[i],s=r[i],e[i]=o*a-c*s,t[i]=o*s+c*a;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,n=this.x,r=this.y,i=n.length,o=Math.log,a=o(2),c=Math.ceil(o(2*i-1)/a),s=Math.pow(2,c),u=numeric.rep([s],0),l=numeric.rep([s],0),h=Math.cos,f=Math.sin,m=-3.141592653589793/i,d=numeric.rep([s],0),p=numeric.rep([s],0);for(e=0;e<i;e++)d[e]=n[e];if(void 0!==r)for(e=0;e<i;e++)p[e]=r[e];for(u[0]=1,e=1;e<=s/2;e++)t=m*e*e,u[e]=h(t),l[e]=f(t),u[s-e]=h(t),l[s-e]=f(t);var g=new numeric.T(d,p),y=new numeric.T(u,l);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),(g=g.mul(y)).x.length=i,g.y.length=i,g},numeric.T.prototype.ifft=function(){var e,t,n=this.x,r=this.y,i=n.length,o=Math.log,a=o(2),c=Math.ceil(o(2*i-1)/a),s=Math.pow(2,c),u=numeric.rep([s],0),l=numeric.rep([s],0),h=Math.cos,f=Math.sin,m=3.141592653589793/i,d=numeric.rep([s],0),p=numeric.rep([s],0);for(e=0;e<i;e++)d[e]=n[e];if(void 0!==r)for(e=0;e<i;e++)p[e]=r[e];for(u[0]=1,e=1;e<=s/2;e++)t=m*e*e,u[e]=h(t),l[e]=f(t),u[s-e]=h(t),l[s-e]=f(t);var g=new numeric.T(d,p),y=new numeric.T(u,l);return g=g.mul(y),numeric.convpow2(g.x,g.y,numeric.clone(y.x),numeric.neg(y.y)),(g=g.mul(y)).x.length=i,g.y.length=i,g.div(i)},numeric.gradient=function(e,t){var n=t.length,r=e(t);if(isNaN(r))throw new Error("gradient: f(x) is a NaN!");var i,o,a,c=Math.max,s=numeric.clone(t),u=Array(n);numeric.div,numeric.sub;c=Math.max;var l,h,f,m,d,p,g=Math.abs,y=Math.min,x=0;for(i=0;i<n;i++)for(var v=c(1e-6*r,1e-8);;){if(++x>20)throw new Error("Numerical gradient fails");if(s[i]=t[i]+v,o=e(s),s[i]=t[i]-v,a=e(s),s[i]=t[i],isNaN(o)||isNaN(a))v/=16;else{if(u[i]=(o-a)/(2*v),l=t[i]-v,h=t[i],f=t[i]+v,m=(o-r)/v,d=(r-a)/v,p=c(g(u[i]),g(r),g(o),g(a),g(l),g(h),g(f),1e-8),!(y(c(g(m-u[i]),g(d-u[i]),g(m-d))/p,v/p)>.001))break;v/=16}}return u},numeric.uncmin=function(e,t,n,r,i,o,a){var c=numeric.gradient;void 0===a&&(a={}),void 0===n&&(n=1e-8),void 0===r&&(r=function(t){return c(e,t)}),void 0===i&&(i=1e3);var s,u,l=(t=numeric.clone(t)).length,h=e(t);if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var f=Math.max,m=numeric.norm2;n=f(n,numeric.epsilon);var d,p,g,y=a.Hinv||numeric.identity(l),x=numeric.dot;numeric.inv;var v,b,_,w,$,k,M,T=numeric.sub,A=numeric.add,j=numeric.tensor,L=numeric.div,S=numeric.mul,C=numeric.all,E=numeric.isFinite,P=numeric.neg,q=0,V="";for(p=r(t);q<i;){if("function"==typeof o&&o(q,t,h,p,y)){V="Callback returned true";break}if(!C(E(p))){V="Gradient has Infinity or NaN";break}if(!C(E(d=P(x(y,p))))){V="Search direction has Infinity or NaN";break}if((M=m(d))<n){V="Newton step smaller than tol";break}for(k=1,u=x(p,d),b=t;q<i&&!(k*M<n)&&(b=A(t,v=S(d,k)),(s=e(b))-h>=.1*k*u||isNaN(s));)k*=.5,++q;if(k*M<n){V="Line search step size smaller than tol";break}if(q===i){V="maxit reached during line search";break}$=x(_=T(g=r(b),p),v),w=x(y,_),y=T(A(y,S(($+x(_,w))/($*$),j(v,v))),L(A(j(w,v),j(v,w)),$)),t=b,h=s,p=g,++q}return{solution:t,f:h,gradient:p,invHessian:y,iterations:q,message:V}},numeric.Dopri=function(e,t,n,r,i,o,a){this.x=e,this.y=t,this.f=n,this.ymid=r,this.iterations=i,this.events=a,this.message=o},numeric.Dopri.prototype._at=function(e,t){function n(e){return e*e}var r,i,o,a,c,s,u=this,l=u.x,h=u.y,f=u.f,m=u.ymid;l.length;var d,p,g,y=numeric.add,x=numeric.mul,v=numeric.sub;return r=l[t],i=l[t+1],a=h[t],c=h[t+1],o=r+.5*(i-r),s=m[t],d=v(f[t],x(a,1/(r-o)+2/(r-i))),p=v(f[t+1],x(c,1/(i-o)+2/(i-r))),y(y(y(y(x(a,(g=[n(e-i)*(e-o)/n(r-i)/(r-o),n(e-r)*n(e-i)/n(r-o)/n(i-o),n(e-r)*(e-o)/n(i-r)/(i-o),(e-r)*n(e-i)*(e-o)/n(r-i)/(r-o),(e-i)*n(e-r)*(e-o)/n(r-i)/(i-o)])[0]),x(s,g[1])),x(c,g[2])),x(d,g[3])),x(p,g[4]))},numeric.Dopri.prototype.at=function(e){var t,n,r,i=Math.floor;if("number"!=typeof e){var o=e.length,a=Array(o);for(t=o-1;-1!==t;--t)a[t]=this.at(e[t]);return a}var c=this.x;for(t=0,n=c.length-1;n-t>1;)c[r=i(.5*(t+n))]<=e?t=r:n=r;return this._at(e,t)},numeric.dopri=function(e,t,n,r,i,o,a){void 0===i&&(i=1e-6),void 0===o&&(o=1e3);var c,s,u,l,h,f,m,d,p,g,y,x,v,b=[e],_=[n],w=[r(e,n)],$=[],k=[3/40,9/40],M=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],A=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],j=[35/384,0,500/1113,125/192,-2187/6784,11/84],L=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],S=[.2,.3,.8,8/9,1,1],C=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],E=0,P=(t-e)/10,q=0,V=numeric.add,N=numeric.mul,R=Math.min,F=Math.abs,I=numeric.norminf,B=Math.pow,z=numeric.any,D=numeric.lt,O=numeric.and;numeric.sub;var H=new numeric.Dopri(b,_,w,$,-1,"");for("function"==typeof a&&(y=a(e,n));e<t&&q<o;)if(++q,e+P>t&&(P=t-e),c=r(e+S[0]*P,V(n,N(.2*P,w[E]))),s=r(e+S[1]*P,V(V(n,N(k[0]*P,w[E])),N(k[1]*P,c))),u=r(e+S[2]*P,V(V(V(n,N(M[0]*P,w[E])),N(M[1]*P,c)),N(M[2]*P,s))),l=r(e+S[3]*P,V(V(V(V(n,N(T[0]*P,w[E])),N(T[1]*P,c)),N(T[2]*P,s)),N(T[3]*P,u))),h=r(e+S[4]*P,V(V(V(V(V(n,N(A[0]*P,w[E])),N(A[1]*P,c)),N(A[2]*P,s)),N(A[3]*P,u)),N(A[4]*P,l))),f=r(e+P,p=V(V(V(V(V(n,N(w[E],P*j[0])),N(s,P*j[2])),N(u,P*j[3])),N(l,P*j[4])),N(h,P*j[5]))),(g="number"==typeof(m=V(V(V(V(V(N(w[E],P*C[0]),N(s,P*C[2])),N(u,P*C[3])),N(l,P*C[4])),N(h,P*C[5])),N(f,P*C[6])))?F(m):I(m))>i){if(e+(P=.2*P*B(i/g,.25))===e){H.msg="Step size became too small";break}}else{if($[E]=V(V(V(V(V(V(n,N(w[E],P*L[0])),N(s,P*L[2])),N(u,P*L[3])),N(l,P*L[4])),N(h,P*L[5])),N(f,P*L[6])),b[++E]=e+P,_[E]=p,w[E]=f,"function"==typeof a){var U,X,Y=e,Q=e+.5*P;if(x=a(Q,$[E-1]),z(v=O(D(y,0),D(0,x)))||(Y=Q,y=x,x=a(Q=e+P,p),v=O(D(y,0),D(0,x))),z(v)){for(var Z,J,G=0,W=1,K=1;;){if("number"==typeof y)X=(K*x*Y-W*y*Q)/(K*x-W*y);else for(X=Q,d=y.length-1;-1!==d;--d)y[d]<0&&x[d]>0&&(X=R(X,(K*x[d]*Y-W*y[d]*Q)/(K*x[d]-W*y[d])));if(X<=Y||X>=Q)break;J=a(X,U=H._at(X,E-1)),z(Z=O(D(y,0),D(0,J)))?(Q=X,x=J,v=Z,K=1,-1===G?W*=.5:W=1,G=-1):(Y=X,y=J,W=1,1===G?K*=.5:K=1,G=1)}return p=H._at(.5*(e+X),E-1),H.f[E]=r(X,U),H.x[E]=X,H.y[E]=U,H.ymid[E-1]=p,H.events=v,H.iterations=q,H}}e+=P,n=p,y=x,P=R(.8*P*B(i/g,.25),4*P)}return H.iterations=q,H},numeric.LU=function(e,t){t=t||!1;var n,r,i,o,a,c,s,u,l,h=Math.abs,f=e.length,m=f-1,d=new Array(f);for(t||(e=numeric.clone(e)),i=0;i<f;++i){for(s=i,l=h((c=e[i])[i]),r=i+1;r<f;++r)l<(o=h(e[r][i]))&&(l=o,s=r);for(d[i]=s,s!=i&&(e[i]=e[s],e[s]=c,c=e[i]),a=c[i],n=i+1;n<f;++n)e[n][i]/=a;for(n=i+1;n<f;++n){for(u=e[n],r=i+1;r<m;++r)u[r]-=u[i]*c[r],u[++r]-=u[i]*c[r];r===m&&(u[r]-=u[i]*c[r])}}return{LU:e,P:d}},numeric.LUsolve=function(e,t){var n,r,i,o,a,c=e.LU,s=c.length,u=numeric.clone(t),l=e.P;for(n=s-1;-1!==n;--n)u[n]=t[n];for(n=0;n<s;++n)for(i=l[n],l[n]!==n&&(a=u[n],u[n]=u[i],u[i]=a),o=c[n],r=0;r<n;++r)u[n]-=u[r]*o[r];for(n=s-1;n>=0;--n){for(o=c[n],r=n+1;r<s;++r)u[n]-=u[r]*o[r];u[n]/=o[n]}return u},numeric.solve=function(e,t,n){return numeric.LUsolve(numeric.LU(e,n),t)},numeric.echelonize=function(e){var t,n,r,i,o,a,c,s,u=numeric.dim(e),l=u[0],h=u[1],f=numeric.identity(l),m=Array(l),d=Math.abs,p=numeric.diveq;for(e=numeric.clone(e),t=0;t<l;++t){for(r=0,o=e[t],a=f[t],n=1;n<h;++n)d(o[r])<d(o[n])&&(r=n);for(m[t]=r,p(a,o[r]),p(o,o[r]),n=0;n<l;++n)if(n!==t){for(s=(c=e[n])[r],i=h-1;-1!==i;--i)c[i]-=o[i]*s;for(c=f[n],i=l-1;-1!==i;--i)c[i]-=a[i]*s}}return{I:f,A:e,P:m}},numeric.__solveLP=function(e,t,n,r,i,o,a){var c=numeric.sum;numeric.log;var s,u=numeric.mul,l=numeric.sub,h=numeric.dot,f=numeric.div,m=numeric.add,d=e.length,p=n.length,g=!1,y=1;numeric.transpose(t),numeric.svd;var x=numeric.transpose;numeric.leq;var v=Math.sqrt,b=Math.abs;numeric.muleq,numeric.norminf,numeric.any;var _,w=Math.min,$=numeric.all,k=numeric.gt,M=Array(d),T=Array(p);numeric.rep([p],1);var A,j,L=numeric.solve,S=l(n,h(t,o)),C=h(e,e);for(A=0;A<i;++A){var E,P;for(E=p-1;-1!==E;--E)T[E]=f(t[E],S[E]);var q=x(T);for(E=d-1;-1!==E;--E)M[E]=c(q[E]);y=.25*b(C/h(e,M));var V=100*v(C/h(M,M));for((!isFinite(y)||y>V)&&(y=V),j=m(e,u(y,M)),_=h(q,T),E=d-1;-1!==E;--E)_[E][E]+=1;P=L(_,f(j,y),!0);var N=f(S,h(t,P)),R=1;for(E=p-1;-1!==E;--E)N[E]<0&&(R=w(R,-.999*N[E]));if(s=l(o,u(P,R)),!$(k(S=l(n,h(t,s)),0)))return{solution:o,message:"",iterations:A};if(o=s,y<r)return{solution:s,message:"",iterations:A};if(a){var F=h(e,j),I=h(t,j);for(g=!0,E=p-1;-1!==E;--E)if(F*I[E]<0){g=!1;break}}else g=!(o[d-1]>=0);if(g)return{solution:s,message:"Unbounded",iterations:A}}return{solution:o,message:"maximum iteration count exceeded",iterations:A}},numeric._solveLP=function(e,t,n,r,i){var o=e.length,a=n.length;numeric.sum,numeric.log,numeric.mul;var c=numeric.sub,s=numeric.dot;numeric.div,numeric.add;var u=numeric.rep([o],0).concat([1]),l=numeric.rep([a,1],-1),h=numeric.blockMatrix([[t,l]]),f=n,m=numeric.rep([o],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),d=numeric.__solveLP(u,h,f,r,i,m,!1),p=numeric.clone(d.solution);if(p.length=o,numeric.inf(c(n,s(t,p)))<0)return{solution:NaN,message:"Infeasible",iterations:d.iterations};var g=numeric.__solveLP(e,t,n,r,i-d.iterations,p,!0);return g.iterations+=d.iterations,g},numeric.solveLP=function(e,t,n,r,i,o,a){if(void 0===a&&(a=1e3),void 0===o&&(o=numeric.epsilon),void 0===r)return numeric._solveLP(e,t,n,o,a);var c,s=r.length,u=r[0].length,l=t.length,h=numeric.echelonize(r),f=numeric.rep([u],0),m=h.P,d=[];for(c=m.length-1;-1!==c;--c)f[m[c]]=1;for(c=u-1;-1!==c;--c)0===f[c]&&d.push(c);var p=numeric.getRange,g=numeric.linspace(0,s-1),y=numeric.linspace(0,l-1),x=p(r,g,d),v=p(t,y,m),b=p(t,y,d),_=numeric.dot,w=numeric.sub,$=_(v,h.I),k=w(b,_($,x)),M=w(n,_($,i)),T=Array(m.length),A=Array(d.length);for(c=m.length-1;-1!==c;--c)T[c]=e[m[c]];for(c=d.length-1;-1!==c;--c)A[c]=e[d[c]];var j=w(A,_(T,_(h.I,x))),L=numeric._solveLP(j,k,M,o,a),S=L.solution;if(S!=S)return L;var C=_(h.I,w(i,_(x,S))),E=Array(e.length);for(c=m.length-1;-1!==c;--c)E[m[c]]=C[c];for(c=d.length-1;-1!==c;--c)E[d[c]]=S[c];return{solution:E,message:L.message,iterations:L.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var t,n,r,i,o=0,a=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],c=e.length,s=0,u={},l=[],h=0,f={},m=0,d=[],p=[],g=[];function y(n){throw new Error("MPStoLP: "+n+"\nLine "+t+": "+e[t]+"\nCurrent state: "+a[o]+"\n")}for(t=0;t<c;++t){var x=(r=e[t]).match(/\S*/g),v=[];for(n=0;n<x.length;++n)""!==x[n]&&v.push(x[n]);if(0!==v.length){for(n=0;n<a.length&&r.substr(0,a[n].length)!==a[n];++n);if(n<a.length){if(o=n,1===n&&(i=v[1]),6===n)return{name:i,c:d,A:numeric.transpose(p),b:g,rows:u,vars:f}}else switch(o){case 0:case 1:y("Unexpected line");case 2:switch(v[0]){case"N":0===s?s=v[1]:y("Two or more N rows");break;case"L":u[v[1]]=h,l[h]=1,g[h]=0,++h;break;case"G":u[v[1]]=h,l[h]=-1,g[h]=0,++h;break;case"E":u[v[1]]=h,l[h]=0,g[h]=0,++h;break;default:y("Parse error "+numeric.prettyPrint(v))}break;case 3:f.hasOwnProperty(v[0])||(f[v[0]]=m,d[m]=0,p[m]=numeric.rep([h],0),++m);var b=f[v[0]];for(n=1;n<v.length;n+=2)if(v[n]!==s){var _=u[v[n]];p[b][_]=(l[_]<0?-1:1)*parseFloat(v[n+1])}else d[b]=parseFloat(v[n+1]);break;case 4:for(n=1;n<v.length;n+=2)g[u[v[n]]]=(l[u[v[n]]]<0?-1:1)*parseFloat(v[n+1]);break;case 5:break;case 6:y("Internal error")}}}y("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,n,r,i,o,a){function c(e){var t,r,i=this,o=e.length,a=0,c=i.i=i.j=i.m=0;for(i.S=[],i.c=[],o||(e=[o++]);a<n;)i.S[a]=a++;for(a=0;a<n;a++)c=l(c+(t=i.S[a])+e[a%o]),r=i.S[c],i.S[a]=r,i.S[c]=t;i.g=function(e){var t=i.S,r=l(i.i+1),o=t[r],a=l(i.j+o),c=t[a];t[r]=c,t[a]=o;for(var s=t[l(o+c)];--e;)r=l(r+1),c=t[a=l(a+(o=t[r]))],t[r]=c,t[a]=o,s=s*n+t[l(o+c)];return i.i=r,i.j=a,s},i.g(n)}function s(e,t,n,r,i){if(n=[],i=typeof e,t&&"object"==i)for(r in e)if(r.indexOf("S")<5)try{n.push(s(e[r],t-1))}catch(e){}return n.length?n:e+("string"!=i?"\0":"")}function u(e,t,n,r){for(e+="",n=0,r=0;r<e.length;r++)t[l(r)]=l((n^=19*t[l(r)])+e.charCodeAt(r));for(r in e="",t)e+=String.fromCharCode(t[r]);return e}function l(e){return 255&e}t.seedrandom=function(r,l){var h,f=[];return r=u(s(l?[r,e]:arguments.length?r:[(new Date).getTime(),e,window],3),f),u((h=new c(f)).S,e),t.random=function(){for(var e=h.g(6),t=a,r=0;e<i;)e=(e+r)*n,t*=n,r=h.g(1);for(;e>=o;)e/=2,t/=2,r>>>=1;return(e+r)/t},r},a=t.pow(n,6),i=t.pow(2,i),o=2*i,u(t.random(),e)}([],numeric.seedrandom,256,0,52),function(e){function t(e){if("object"!=typeof e)return e;var n,r=[],i=e.length;for(n=0;n<i;n++)r[n+1]=t(e[n]);return r}function n(e){if("object"!=typeof e)return e;var t,r=[],i=e.length;for(t=1;t<i;t++)r[t-1]=n(e[t]);return r}function r(e,t,n,r,i,o,a,c,s,u,l,h,f,m,d,p){var g,y,x,v,b,_,w,$,k,M,T,A,j,L,S,C,E,P,q,V,N,R,F,I,B,z,D;j=Math.min(r,u),x=2*r+j*(j+5)/2+2*u+1,I=1e-60;do{B=1+.1*(I+=I),z=1+.2*I}while(B<=1||z<=1);for(g=1;g<=r;g+=1)d[g]=t[g];for(g=r+1;g<=x;g+=1)d[g]=0;for(g=1;g<=u;g+=1)h[g]=0;if(b=[],0===p[1]){if(function(e,t,n,r){var i,o,a,c,s,u;for(o=1;o<=n;o+=1){if(r[1]=o,u=0,(a=o-1)<1){if((u=e[o][o]-u)<=0)break;e[o][o]=Math.sqrt(u)}else{for(c=1;c<=a;c+=1){for(s=e[c][o],i=1;i<c;i+=1)s-=e[i][o]*e[i][c];s/=e[c][c],e[c][o]=s,u+=s*s}if((u=e[o][o]-u)<=0)break;e[o][o]=Math.sqrt(u)}r[1]=0}}(e,0,r,b),0!==b[1])return void(p[1]=2);!function(e,t,n,r){var i,o,a,c;for(o=1;o<=n;o+=1){for(c=0,i=1;i<o;i+=1)c+=e[i][o]*r[i];r[o]=(r[o]-c)/e[o][o]}for(a=1;a<=n;a+=1)for(r[o=n+1-a]=r[o]/e[o][o],c=-r[o],i=1;i<o;i+=1)r[i]=r[i]+c*e[i][o]}(e,0,r,t),function(e,t,n){var r,i,o,a,c;for(o=1;o<=n;o+=1){for(e[o][o]=1/e[o][o],c=-e[o][o],r=1;r<o;r+=1)e[r][o]=c*e[r][o];if(n<(a=o+1))break;for(i=a;i<=n;i+=1)for(c=e[o][i],e[o][i]=0,r=1;r<=o;r+=1)e[r][i]=e[r][i]+c*e[r][o]}}(e,0,r)}else{for(y=1;y<=r;y+=1)for(i[y]=0,g=1;g<=y;g+=1)i[y]=i[y]+e[g][y]*t[g];for(y=1;y<=r;y+=1)for(t[y]=0,g=y;g<=r;g+=1)t[y]=t[y]+e[y][g]*i[g]}for(o[1]=0,y=1;y<=r;y+=1)for(i[y]=t[y],o[1]=o[1]+d[y]*i[y],d[y]=0,g=y+1;g<=r;g+=1)e[g][y]=0;for(o[1]=-o[1]/2,p[1]=0,L=(M=(k=(T=($=(w=r)+r)+j)+j+1)+j*(j+1)/2)+u,g=1;g<=u;g+=1){for(C=0,y=1;y<=r;y+=1)C+=a[y][g]*a[y][g];d[L+g]=Math.sqrt(C)}function O(){for(m[1]=m[1]+1,x=M,g=1;g<=u;g+=1){for(x+=1,C=-c[g],y=1;y<=r;y+=1)C+=a[y][g]*i[y];if(Math.abs(C)<I&&(C=0),g>l)d[x]=C;else if(d[x]=-Math.abs(C),C>0){for(y=1;y<=r;y+=1)a[y][g]=-a[y][g];c[g]=-c[g]}}for(g=1;g<=f;g+=1)d[M+h[g]]=0;for(A=0,S=0,g=1;g<=u;g+=1)d[M+g]<S*d[L+g]&&(A=g,S=d[M+g]/d[L+g]);return 0===A?999:0}function H(){for(g=1;g<=r;g+=1){for(C=0,y=1;y<=r;y+=1)C+=e[y][g]*a[y][A];d[g]=C}for(v=w,g=1;g<=r;g+=1)d[v+g]=0;for(y=f+1;y<=r;y+=1)for(g=1;g<=r;g+=1)d[v+g]=d[v+g]+e[g][y]*d[y];for(R=!0,g=f;g>=1;g-=1){for(C=d[g],v=(x=k+g*(g+3)/2)-g,y=g+1;y<=f;y+=1)C-=d[x]*d[$+y],x+=y;if(C/=d[v],d[$+g]=C,h[g]<l)break;if(C<0)break;R=!1,_=g}if(!R)for(E=d[T+_]/d[$+_],g=1;g<=f&&!(h[g]<l)&&!(d[$+g]<0);g+=1)(S=d[T+g]/d[$+g])<E&&(E=S,_=g);for(C=0,g=w+1;g<=w+r;g+=1)C+=d[g]*d[g];if(Math.abs(C)<=I){if(R)return p[1]=1,999;for(g=1;g<=f;g+=1)d[T+g]=d[T+g]-E*d[$+g];return d[T+f+1]=d[T+f+1]+E,700}for(C=0,g=1;g<=r;g+=1)C+=d[w+g]*a[g][A];for(P=-d[M+A]/C,F=!0,R||E<P&&(P=E,F=!1),g=1;g<=r;g+=1)i[g]=i[g]+P*d[w+g],Math.abs(i[g])<I&&(i[g]=0);for(o[1]=o[1]+P*C*(P/2+d[T+f+1]),g=1;g<=f;g+=1)d[T+g]=d[T+g]-P*d[$+g];if(d[T+f+1]=d[T+f+1]+P,!F){for(C=-c[A],y=1;y<=r;y+=1)C+=i[y]*a[y][A];if(A>l)d[M+A]=C;else if(d[M+A]=-Math.abs(C),C>0){for(y=1;y<=r;y+=1)a[y][A]=-a[y][A];c[A]=-c[A]}return 700}for(h[f+=1]=A,x=k+(f-1)*f/2+1,g=1;g<=f-1;g+=1)d[x]=d[g],x+=1;if(f===r)d[x]=d[r];else{for(g=r;g>=f+1&&0!==d[g]&&(q=Math.max(Math.abs(d[g-1]),Math.abs(d[g])),V=Math.min(Math.abs(d[g-1]),Math.abs(d[g])),S=d[g-1]>=0?Math.abs(q*Math.sqrt(1+V*V/(q*q))):-Math.abs(q*Math.sqrt(1+V*V/(q*q))),q=d[g-1]/S,V=d[g]/S,1!==q);g-=1)if(0===q)for(d[g-1]=V*S,y=1;y<=r;y+=1)S=e[y][g-1],e[y][g-1]=e[y][g],e[y][g]=S;else for(d[g-1]=S,N=V/(1+q),y=1;y<=r;y+=1)S=q*e[y][g-1]+V*e[y][g],e[y][g]=N*(e[y][g-1]+S)-e[y][g],e[y][g-1]=S;d[x]=d[f]}return 0}function U(){if(0===d[v=(x=k+_*(_+1)/2+1)+_])return 798;if(q=Math.max(Math.abs(d[v-1]),Math.abs(d[v])),V=Math.min(Math.abs(d[v-1]),Math.abs(d[v])),S=d[v-1]>=0?Math.abs(q*Math.sqrt(1+V*V/(q*q))):-Math.abs(q*Math.sqrt(1+V*V/(q*q))),q=d[v-1]/S,V=d[v]/S,1===q)return 798;if(0===q){for(g=_+1;g<=f;g+=1)S=d[v-1],d[v-1]=d[v],d[v]=S,v+=g;for(g=1;g<=r;g+=1)S=e[g][_],e[g][_]=e[g][_+1],e[g][_+1]=S}else{for(N=V/(1+q),g=_+1;g<=f;g+=1)S=q*d[v-1]+V*d[v],d[v]=N*(d[v-1]+S)-d[v],d[v-1]=S,v+=g;for(g=1;g<=r;g+=1)S=q*e[g][_]+V*e[g][_+1],e[g][_+1]=N*(e[g][_]+S)-e[g][_+1],e[g][_]=S}return 0}function X(){for(v=x-_,g=1;g<=_;g+=1)d[v]=d[x],x+=1,v+=1;return d[T+_]=d[T+_+1],h[_]=h[_+1],(_+=1)<f?797:0}function Y(){return d[T+f]=d[T+f+1],d[T+f+1]=0,h[f]=0,f-=1,m[2]=m[2]+1,0}for(f=0,m[1]=0,m[2]=0,D=0;;){if(999===(D=O()))return;for(;0!==(D=H());){if(999===D)return;if(700===D)if(_===f)Y();else{for(;U(),797===(D=X()););Y()}}}}e.solveQP=function(e,i,o,a,c,s){e=t(e),i=t(i),o=t(o);var u,l,h,f,m,d=[],p=[],g=[],y=[],x=[];if(c=c||0,s=s?t(s):[void 0,0],a=a?t(a):[],l=e.length-1,h=o[1].length-1,!a)for(u=1;u<=h;u+=1)a[u]=0;for(u=1;u<=h;u+=1)p[u]=0;for(f=Math.min(l,h),u=1;u<=l;u+=1)g[u]=0;for(d[1]=0,u=1;u<=2*l+f*(f+5)/2+2*h+1;u+=1)y[u]=0;for(u=1;u<=2;u+=1)x[u]=0;return r(e,i,0,l,g,d,o,a,0,h,c,p,0,x,y,s),m="",1===s[1]&&(m="constraints are inconsistent, no solution!"),2===s[1]&&(m="matrix D in quadratic function is not positive definite!"),{solution:n(g),value:n(d),unconstrained_solution:n(i),iterations:n(x),iact:n(p),message:m}}}(numeric),numeric.svd=function(e){var t,n=numeric.epsilon,r=1e-64/n,i=0,o=0,a=0,c=0,s=0,u=numeric.clone(e),l=u.length,h=u[0].length;if(l<h)throw"Need more rows than columns";var f=new Array(h),m=new Array(h);for(o=0;o<h;o++)f[o]=m[o]=0;var d=numeric.rep([h,h],0);function p(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var g=0,y=0,x=0,v=0,b=0,_=0,w=0;for(o=0;o<h;o++){for(f[o]=y,w=0,s=o+1,a=o;a<l;a++)w+=u[a][o]*u[a][o];if(w<=r)y=0;else for(g=u[o][o],y=Math.sqrt(w),g>=0&&(y=-y),x=g*y-w,u[o][o]=g-y,a=s;a<h;a++){for(w=0,c=o;c<l;c++)w+=u[c][o]*u[c][a];for(g=w/x,c=o;c<l;c++)u[c][a]+=g*u[c][o]}for(m[o]=y,w=0,a=s;a<h;a++)w+=u[o][a]*u[o][a];if(w<=r)y=0;else{for(g=u[o][o+1],y=Math.sqrt(w),g>=0&&(y=-y),x=g*y-w,u[o][o+1]=g-y,a=s;a<h;a++)f[a]=u[o][a]/x;for(a=s;a<l;a++){for(w=0,c=s;c<h;c++)w+=u[a][c]*u[o][c];for(c=s;c<h;c++)u[a][c]+=w*f[c]}}(b=Math.abs(m[o])+Math.abs(f[o]))>v&&(v=b)}for(o=h-1;-1!=o;o+=-1){if(0!=y){for(x=y*u[o][o+1],a=s;a<h;a++)d[a][o]=u[o][a]/x;for(a=s;a<h;a++){for(w=0,c=s;c<h;c++)w+=u[o][c]*d[c][a];for(c=s;c<h;c++)d[c][a]+=w*d[c][o]}}for(a=s;a<h;a++)d[o][a]=0,d[a][o]=0;d[o][o]=1,y=f[o],s=o}for(o=h-1;-1!=o;o+=-1){for(s=o+1,y=m[o],a=s;a<h;a++)u[o][a]=0;if(0!=y){for(x=u[o][o]*y,a=s;a<h;a++){for(w=0,c=s;c<l;c++)w+=u[c][o]*u[c][a];for(g=w/x,c=o;c<l;c++)u[c][a]+=g*u[c][o]}for(a=o;a<l;a++)u[a][o]=u[a][o]/y}else for(a=o;a<l;a++)u[a][o]=0;u[o][o]+=1}for(n*=v,c=h-1;-1!=c;c+=-1)for(var $=0;$<50;$++){var k=!1;for(s=c;-1!=s;s+=-1){if(Math.abs(f[s])<=n){k=!0;break}if(Math.abs(m[s-1])<=n)break}if(!k){i=0,w=1;var M=s-1;for(o=s;o<c+1&&(g=w*f[o],f[o]=i*f[o],!(Math.abs(g)<=n));o++)for(x=p(g,y=m[o]),m[o]=x,i=y/x,w=-g/x,a=0;a<l;a++)b=u[a][M],_=u[a][o],u[a][M]=b*i+_*w,u[a][o]=-b*w+_*i}if(_=m[c],s==c){if(_<0)for(m[c]=-_,a=0;a<h;a++)d[a][c]=-d[a][c];break}if($>=49)throw"Error: no convergence.";for(v=m[s],y=p(g=(((b=m[c-1])-_)*(b+_)+((y=f[c-1])-(x=f[c]))*(y+x))/(2*x*b),1),g=g<0?((v-_)*(v+_)+x*(b/(g-y)-x))/v:((v-_)*(v+_)+x*(b/(g+y)-x))/v,i=1,w=1,o=s+1;o<c+1;o++){for(y=f[o],b=m[o],x=w*y,y*=i,_=p(g,x),f[o-1]=_,g=v*(i=g/_)+y*(w=x/_),y=-v*w+y*i,x=b*w,b*=i,a=0;a<h;a++)v=d[a][o-1],_=d[a][o],d[a][o-1]=v*i+_*w,d[a][o]=-v*w+_*i;for(_=p(g,x),m[o-1]=_,g=(i=g/_)*y+(w=x/_)*b,v=-w*y+i*b,a=0;a<l;a++)b=u[a][o-1],_=u[a][o],u[a][o-1]=b*i+_*w,u[a][o]=-b*w+_*i}f[s]=0,f[c]=g,m[c]=v}for(o=0;o<m.length;o++)m[o]<n&&(m[o]=0);for(o=0;o<h;o++)for(a=o-1;a>=0;a--)if(m[a]<m[o]){for(i=m[a],m[a]=m[o],m[o]=i,c=0;c<u.length;c++)t=u[c][o],u[c][o]=u[c][a],u[c][a]=t;for(c=0;c<d.length;c++)t=d[c][o],d[c][o]=d[c][a],d[c][a]=t;o=a}return{U:u,S:m,V:d}}}));const{window:window_1$1}=globals;function get_each_context$1(e,t,n){const r=e.slice();return r[37]=t[n].x,r[38]=t[n].y,r[40]=n,r}function create_each_block$1(e){let t,n,r;function i(){return e[20](e[40])}return{c(){t=element("div"),attr(t,"class","corner"),set_style(t,"left",e[37]-5+"px"),set_style(t,"top",e[38]-5+"px")},m(e,o){insert(e,t,o),n||(r=listen(t,"mousedown",i),n=!0)},p(n,r){e=n,16&r[0]&&set_style(t,"left",e[37]-5+"px"),16&r[0]&&set_style(t,"top",e[38]-5+"px")},d(e){e&&detach(t),n=!1,r()}}}function create_fragment$3(e){let t,n,r,i,o,a,c,s,u,l,h=e[4],f=[];for(let t=0;t<h.length;t+=1)f[t]=create_each_block$1(get_each_context$1(e,h,t));return{c(){t=element("div"),n=element("div"),r=element("img"),o=space();for(let e=0;e<f.length;e+=1)f[e].c();a=space(),c=element("img"),this.c=noop,set_style(r,"opacity",e[1]/100),set_style(r,"transform",e[5]),src_url_equal(r.src,i=e[0])||attr(r,"src",i),set_style(n,"position","relative"),set_style(n,"width","100%"),set_style(n,"height","100% "),attr(t,"class","container"),src_url_equal(c.src,s=e[0])||attr(c,"src",s),set_style(c,"visibility","hidden")},m(i,s){insert(i,t,s),append(t,n),append(n,r),e[19](r),append(n,o);for(let e=0;e<f.length;e+=1)f[e]&&f[e].m(n,null);e[21](t),insert(i,a,s),insert(i,c,s),e[22](c),u||(l=[listen(window_1$1,"pointermove",e[9]),listen(window_1$1,"pointerup",e[8])],u=!0)},p(e,t){if(2&t[0]&&set_style(r,"opacity",e[1]/100),32&t[0]&&set_style(r,"transform",e[5]),1&t[0]&&!src_url_equal(r.src,i=e[0])&&attr(r,"src",i),144&t[0]){let r;for(h=e[4],r=0;r<h.length;r+=1){const i=get_each_context$1(e,h,r);f[r]?f[r].p(i,t):(f[r]=create_each_block$1(i),f[r].c(),f[r].m(n,null))}for(;r<f.length;r+=1)f[r].d(1);f.length=h.length}1&t[0]&&!src_url_equal(c.src,s=e[0])&&attr(c,"src",s)},i:noop,o:noop,d(n){n&&detach(t),e[19](null),destroy_each(f,n),e[21](null),n&&detach(a),n&&detach(c),e[22](null),u=!1,run_all(l)}}}function getCenterFromCorners(e){const t=e[0],n=e[2];return[(t.x+n.x)/2,(t.y+n.y)/2]}function instance$3(e,t,n){let r,{imageurl:i=""}=t,{position:o}=t,{resultCanvas:a}=t,{resultdim:c}=t,{layerimagedata:s}=t,{zoom:u=100}=t,{ratio:l=window.devicePixelRatio}=t,{opacity:h=100}=t;globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&(h=globalThis.gyre.paletteValues.selectedLayer.opacity),globalThis.gyre&&(s=globalThis.gyre.paletteValues.selectedLayer),globalThis.gyre&&(u=globalThis.gyre?.canvas.zoom),globalThis.gyre&&(i=s.url);let f,m,d=parseFloat(u)/100/l,p=0,g=[],y=[],x=[...g],v=!1,b=null,_="",w=null;function $(e){return e/d}function k(){n(10,o.x=s._x,o),n(10,o.y=s._y,o),n(10,o.width=s._width,o),n(10,o.height=s._height,o)}function M(){!function(){g=[{x:0,y:0},{x:o.width,y:0},{x:o.width,y:o.height},{x:0,y:o.height}],y.length?n(4,x=y.map((e=>({x:e.x*d,y:e.y*d})))):n(4,x=[...g]);y=[{x:0,y:0},{x:parseInt(o.width/d),y:0},{x:parseInt(o.width/d),y:parseInt(o.height/d)},{x:0,y:parseInt(o.height/d)}],n(18,p=o.rotation||0)}(),A(),n(2,f.style.top=s._y+"px",f),n(2,f.style.left=s._x+"px",f),n(2,f.style.width=s._width+"px",f),n(2,f.style.height=s._height+"px",f),n(2,f.style.transform=`rotate(${s.rotation}rad)`,f)}function T(e,t){v=!0,b=e,function(){let e=f;const t=window.getComputedStyle(e).transform,n=new DOMMatrix(t);w=Math.atan2(n.b,n.a)}()}function A(){const e=function(e,t,n){const r=-n,i=Math.cos(r),o=Math.sin(r);let[a,c]=getCenterFromCorners(e);const s=e.map((({x:e,y:t})=>{const n=e-a,r=t-c;return{x:n*i-r*o+a,y:n*o+r*i+c}})),u=[];for(let e=0;e<8;e++)u[e]=[];for(let e=0;e<4;e++)u[e][0]=u[e+4][3]=s[e].x,u[e][1]=u[e+4][4]=s[e].y,u[e][2]=u[e+4][5]=1,u[e][3]=u[e][4]=u[e][5]=0,u[e+4][0]=u[e+4][1]=u[e+4][2]=0,u[e][6]=-s[e].x*t[e].x,u[e][7]=-s[e].y*t[e].x,u[e+4][6]=-s[e].x*t[e].y,u[e+4][7]=-s[e].y*t[e].y;const l=[t[0].x,t[1].x,t[2].x,t[3].x,t[0].y,t[1].y,t[2].y,t[3].y],h=numeric1_2_6.solve(u,l).concat(1);return`matrix3d(${h[0]}, ${h[3]}, 0, ${h[6]}, ${h[1]}, ${h[4]}, 0, ${h[7]}, 0, 0, 1, 0, ${h[2]}, ${h[5]}, 0, 1)`}(g,x,p);n(5,_=e)}onMount((()=>{n(12,a=document.createElement("canvas"))}));return e.$$set=e=>{"imageurl"in e&&n(0,i=e.imageurl),"position"in e&&n(10,o=e.position),"resultCanvas"in e&&n(12,a=e.resultCanvas),"resultdim"in e&&n(13,c=e.resultdim),"layerimagedata"in e&&n(11,s=e.layerimagedata),"zoom"in e&&n(14,u=e.zoom),"ratio"in e&&n(15,l=e.ratio),"opacity"in e&&n(1,h=e.opacity)},e.$$.update=()=>{3076&e.$$.dirty[0]&&f&&!o&&s&&(n(10,o={}),k(),M()),262144&e.$$.dirty[0]&&p&&A()},globalThis.gyre?.canvas.zoom,[i,h,f,r,x,_,m,T,function(){v=!1,b=null},function(e){if(!v||null===b)return;const t=f.getBoundingClientRect(),r=t.left+t.width/2,i=t.top+t.height/2,o=e.clientX-r,a=e.clientY-i,c=Math.cos(-w),s=Math.sin(-w),u=o*c-a*s,l=o*s+a*c;let h=e.clientX-t.left,m=e.clientY-t.top;w&&(h=u+f.offsetWidth/2,m=l+f.offsetHeight/2),y=y.map(((e,t)=>t===b?{x:h/d,y:m/d}:e)),n(4,x=x.map(((e,t)=>t===b?{x:h,y:m}:e))),A()},o,s,a,c,u,l,function(){globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&n(1,h=globalThis.gyre.paletteValues.selectedLayer.opacity),globalThis.gyre&&n(11,s=globalThis.gyre.paletteValues.selectedLayer),globalThis.gyre&&n(14,u=globalThis.gyre?.canvas.zoom),globalThis.gyre&&n(0,i=s.url),d=parseFloat(u)/100/l,k(),M()},function(){!function(){let e=x.map((e=>(e.x=$(e.x),e.y=$(e.y),e)));warpImage(m,e,a,p);var t=Math.min(...e.map((e=>e.x))),r=Math.max(...e.map((e=>e.x))),i=Math.min(...e.map((e=>e.y))),o=Math.max(...e.map((e=>e.y)));n(13,c={x:t,y:i,width:r-t,height:o-i})}()},p,function(e){binding_callbacks[e?"unshift":"push"]((()=>{r=e,n(3,r)}))},e=>T(e),function(e){binding_callbacks[e?"unshift":"push"]((()=>{f=e,n(2,f)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{m=e,n(6,m)}))}]}class FourCornersTransformation extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent=".container{position:absolute;left:0px;top:0px;width:100%;height:100%;transform:rotate(0rad)}img{position:absolute;top:0;left:0;width:100%;height:100%;transform-origin:top left;user-select:none}.corner{position:absolute;width:10px;height:10px;background-color:red;border-radius:50%;cursor:pointer;user-select:none}",this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$3,create_fragment$3,safe_not_equal,{imageurl:0,position:10,resultCanvas:12,resultdim:13,layerimagedata:11,zoom:14,ratio:15,opacity:1,refresh:16,csstoimage:17},null,[-1,-1]),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["imageurl","position","resultCanvas","resultdim","layerimagedata","zoom","ratio","opacity","refresh","csstoimage"]}get imageurl(){return this.$$.ctx[0]}set imageurl(e){this.$$set({imageurl:e}),flush()}get position(){return this.$$.ctx[10]}set position(e){this.$$set({position:e}),flush()}get resultCanvas(){return this.$$.ctx[12]}set resultCanvas(e){this.$$set({resultCanvas:e}),flush()}get resultdim(){return this.$$.ctx[13]}set resultdim(e){this.$$set({resultdim:e}),flush()}get layerimagedata(){return this.$$.ctx[11]}set layerimagedata(e){this.$$set({layerimagedata:e}),flush()}get zoom(){return this.$$.ctx[14]}set zoom(e){this.$$set({zoom:e}),flush()}get ratio(){return this.$$.ctx[15]}set ratio(e){this.$$set({ratio:e}),flush()}get opacity(){return this.$$.ctx[1]}set opacity(e){this.$$set({opacity:e}),flush()}get refresh(){return this.$$.ctx[16]}get csstoimage(){return this.$$.ctx[17]}}function clickOutside(e){const t=t=>{!e||e.contains(t.target)||t.defaultPrevented||e.dispatchEvent(new CustomEvent("click_outside",e))};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function create_if_block_1$1(e){let t,n,r,i,o,a,c,s,u,l=e[2]&&create_if_block_2$1(e);return{c(){t=element("div"),n=element("fds-image-editor-button"),r=space(),i=element("fds-image-editor-button"),o=space(),a=element("fds-image-editor-button"),a.textContent="Coordinates",c=space(),l&&l.c(),set_custom_element_data(n,"icon","flipHorizontal"),set_custom_element_data(n,"title","Flip Horizontal"),set_custom_element_data(i,"icon","flipVertical"),set_custom_element_data(i,"title","Flip Vertical"),set_custom_element_data(a,"type","button"),set_style(t,"display","flex"),set_style(t,"align-items","center")},m(h,f){insert(h,t,f),append(t,n),append(t,r),append(t,i),append(t,o),append(t,a),append(t,c),l&&l.m(t,null),s||(u=[listen(n,"click",e[6]),listen(i,"click",e[7]),listen(a,"click",e[8])],s=!0)},p(e,n){e[2]?l?l.p(e,n):(l=create_if_block_2$1(e),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},d(e){e&&detach(t),l&&l.d(),s=!1,run_all(u)}}}function create_if_block_2$1(e){let t,n,r,i,o;return{c(){t=element("fds-image-editor-button"),t.textContent="Done",n=space(),r=element("fds-image-editor-button"),r.textContent="Cancel",set_custom_element_data(t,"type","button"),set_custom_element_data(r,"type","button")},m(a,c){insert(a,t,c),insert(a,n,c),insert(a,r,c),i||(o=[listen(t,"click",e[9]),listen(r,"click",e[10])],i=!0)},p:noop,d(e){e&&detach(t),e&&detach(n),e&&detach(r),i=!1,run_all(o)}}}function create_if_block$1(e){let t,n,r,i,o,a,c,s,u,l,h,f,m,d,p,g,y,x,v,b,_,w,$,k,M,T,A,j,L,S,C,E,P,q,V,N;return{c(){t=element("div"),n=element("div"),r=element("div"),i=element("label"),i.textContent="X:",o=space(),a=element("input"),s=space(),u=element("div"),l=element("label"),l.textContent="Y:",h=space(),f=element("input"),d=space(),p=element("div"),g=element("div"),y=element("label"),y.textContent="Width:",x=space(),v=element("input"),_=space(),w=element("div"),$=element("div"),k=element("label"),k.textContent="Height:",M=space(),T=element("input"),j=space(),L=element("div"),S=element("label"),S.textContent="Rotation:",C=space(),E=element("input"),q=text("°"),attr(i,"for","x"),attr(i,"class","more-label"),a.value=c=parseInt(e[0].x),attr(a,"type","text"),attr(a,"class","formInput"),attr(a,"placeholder",""),set_style(a,"font-size","12px"),set_style(a,"width","220px"),set_style(a,"display","inline-block"),attr(r,"class","formLine"),attr(l,"for","y"),attr(l,"class","more-label"),f.value=m=parseInt(e[0].y),attr(f,"type","text"),attr(f,"class","formInput"),attr(f,"placeholder",""),set_style(f,"font-size","12px"),set_style(f,"width","220px"),set_style(f,"display","inline-block"),attr(u,"class","formLine"),attr(n,"class","formRow"),attr(y,"for","width"),attr(y,"class","more-label"),v.value=b=parseInt(e[0].width),attr(v,"type","text"),attr(v,"class","formInput"),attr(v,"placeholder",""),set_style(v,"font-size","12px"),set_style(v,"width","220px"),set_style(v,"display","inline-block"),attr(g,"class","formLine"),attr(k,"for","height"),attr(k,"class","more-label"),T.value=A=parseInt(e[0].height),attr(T,"type","text"),attr(T,"class","formInput"),attr(T,"placeholder",""),set_style(T,"font-size","12px"),set_style(T,"width","220px"),set_style(T,"display","inline-block"),attr($,"class","formLine"),attr(w,"class","formLine"),attr(p,"class","formRow"),attr(S,"for","rotation"),attr(S,"class","more-label"),E.value=P=(180*e[0].rotation/Math.PI).toFixed(2),attr(E,"type","text"),attr(E,"class","formInput"),attr(E,"placeholder",""),set_style(E,"font-size","12px"),set_style(E,"width","220px"),set_style(E,"display","inline-block"),attr(L,"class","formLine"),attr(t,"class","editcoord")},m(c,m){insert(c,t,m),append(t,n),append(n,r),append(r,i),append(r,o),append(r,a),append(n,s),append(n,u),append(u,l),append(u,h),append(u,f),append(t,d),append(t,p),append(p,g),append(g,y),append(g,x),append(g,v),append(p,_),append(p,w),append(w,$),append($,k),append($,M),append($,T),append(t,j),append(t,L),append(L,S),append(L,C),append(L,E),append(L,q),V||(N=[listen(a,"change",e[11]),listen(f,"change",e[12]),listen(v,"change",e[13]),listen(T,"change",e[14]),listen(E,"change",e[15]),action_destroyer(clickOutside.call(null,t)),listen(t,"click_outside",handleClickOutside)],V=!0)},p(e,t){1&t&&c!==(c=parseInt(e[0].x))&&a.value!==c&&(a.value=c),1&t&&m!==(m=parseInt(e[0].y))&&f.value!==m&&(f.value=m),1&t&&b!==(b=parseInt(e[0].width))&&v.value!==b&&(v.value=b),1&t&&A!==(A=parseInt(e[0].height))&&T.value!==A&&(T.value=A),1&t&&P!==(P=(180*e[0].rotation/Math.PI).toFixed(2))&&E.value!==P&&(E.value=P)},d(e){e&&detach(t),V=!1,run_all(N)}}}function create_fragment$2(e){let t,n,r=e[0]&&create_if_block_1$1(e),i=e[1]&&e[0]&&create_if_block$1(e);return{c(){t=element("div"),r&&r.c(),n=space(),i&&i.c(),this.c=noop,attr(t,"class","show"),set_style(t,"display","inline-flex")},m(e,o){insert(e,t,o),r&&r.m(t,null),append(t,n),i&&i.m(t,null)},p(e,[o]){e[0]?r?r.p(e,o):(r=create_if_block_1$1(e),r.c(),r.m(t,n)):r&&(r.d(1),r=null),e[1]&&e[0]?i?i.p(e,o):(i=create_if_block$1(e),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i:noop,o:noop,d(e){e&&detach(t),r&&r.d(),i&&i.d()}}}function handleClickOutside(){}function instance$2(e,t,n){let r;component_subscribe(e,toollayer,(e=>n(5,r=e)));let i=get_current_component().$$.root.host,o=!1,{coordinates:a={x:0,y:0,width:0,height:0,rotation:0}}=t;function c(e,t){"flipHorizontal"!=e&&"flipVertical"!=e&&"foldermovedone"!=e&&"foldermovecancel"!=e&&isNaN(t)||("foldermovedone"!=e&&"foldermovecancel"!=e&&"destructmovetool"!=e&&set_store_value(toollayer,r[e]=parseInt(t),r),"rotation"!=e&&"opacity"!=e||set_store_value(toollayer,r[e]=parseFloat(t),r),"x"!=e&&"y"!=e&&"width"!=e&&"height"!=e&&"rotation"!=e||set_store_value(toollayer,r.changecoordsindialog=e,r),i.dispatchEvent(new CustomEvent("change",{detail:{name:e,value:t}})))}onMount((()=>()=>{c("destructmovetool",1),setTimeout((()=>{globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&globalThis.gyre.layerManager.traverseLayers((e=>{e.nocache=!1}))}),40)}));let{editcoord:s}=t;function u(){n(0,a=r)}return e.$$set=e=>{"coordinates"in e&&n(0,a=e.coordinates),"editcoord"in e&&n(1,s=e.editcoord)},e.$$.update=()=>{32&e.$$.dirty&&r&&u()},globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&"folder"==globalThis.gyre.paletteValues.selectedLayer.type&&n(2,o=!0),[a,s,o,c,u,r,()=>{c("flipHorizontal")},()=>{c("flipVertical")},()=>{n(1,s=!s),c("editcoord",s)},()=>{c("foldermovedone",1)},()=>{c("foldermovecancel",1)},e=>{n(0,a.x=e.target.value,a),n(0,a),c("x",e.target.value)},e=>{n(0,a.y=e.target.value,a),n(0,a),c("y",e.target.value)},e=>{n(0,a.width=e.target.value,a),n(0,a),c("width",e.target.value)},e=>{n(0,a.height=e.target.value,a),n(0,a),c("height",e.target.value)},e=>{n(0,a.rotation=e.target.value,a),n(0,a),c("rotation",parseInt(e.target.value)*(Math.PI/180))}]}customElements.define("fds-image-transform-corners",FourCornersTransformation);class Dialog extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent='*{box-sizing:border-box}.editcoord{min-width:330px;min-height:100px;box-shadow:0 0 1rem 0 rgba(255, 255, 255, .2);border-radius:8px;background-color:rgba(0, 0, 0, .65);backdrop-filter:blur(10px);color:rgba(255, 255, 255, 0.6);position:absolute;left:0px;top:50px;padding:14px;font-family:"Segoe UI", Roboto, system-ui;z-index:2000}.formLine{display:flex;align-items:center;margin-bottom:5px}.formLine label{margin-right:10px;width:60px}.formLine input{flex:1;min-width:0}.formRow{display:flex;justify-content:space-between;gap:20px;margin-bottom:20px}.formInput{width:100%;max-width:80px;outline:0;border:0;border-bottom:2px solid rgba(255, 255, 255, 0.2);padding:5px;font-size:14px;font-weight:normal;border-radius:3px;color:rgba(255, 255, 255, 0.9);margin-bottom:10px;display:block;background:none;font-family:system-ui, "Segoe UI", Roboto}.show{display:block}',this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$2,create_fragment$2,safe_not_equal,{coordinates:0,editcoord:1,refresh:4},null),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["coordinates","editcoord","refresh"]}get coordinates(){return this.$$.ctx[0]}set coordinates(e){this.$$set({coordinates:e}),flush()}get editcoord(){return this.$$.ctx[1]}set editcoord(e){this.$$set({editcoord:e}),flush()}get refresh(){return this.$$.ctx[4]}}function create_fragment$1(e){let t,n,r,i,o,a,c,s;return{c(){t=element("div"),n=element("div"),r=element("fds-image-editor-button"),r.textContent="Done",i=space(),o=element("div"),a=element("fds-image-editor-button"),a.textContent="Cancel",this.c=noop,set_custom_element_data(r,"type","button"),set_style(n,"display","flex"),set_style(n,"align-items","center"),set_custom_element_data(a,"type","button"),set_style(o,"display","flex"),set_style(o,"align-items","center"),attr(t,"class","show"),set_style(t,"display","inline-flex")},m(u,l){insert(u,t,l),append(t,n),append(n,r),append(t,i),append(t,o),append(o,a),c||(s=[listen(r,"click",e[1]),listen(a,"click",e[2])],c=!0)},p:noop,i:noop,o:noop,d(e){e&&detach(t),c=!1,run_all(s)}}}function instance$1(e){let t=get_current_component().$$.root.host;function n(e,n){t.dispatchEvent(new CustomEvent("change",{detail:{name:e,value:n}}))}return[n,()=>{n("csstoimage")},()=>{n("changeview",!0)}]}customElements.define("fds-coord-dialog",Dialog);class DialogFourCorners extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent="*{box-sizing:border-box}.show{display:block}",this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance$1,create_fragment$1,safe_not_equal,{},null),e&&e.target&&insert(e.target,this,e.anchor)}}customElements.define("fds-four-corners-dialog",DialogFourCorners);const{window:window_1}=globals;function get_each_context(e,t,n){const r=e.slice();return r[97]=t[n],r}function create_if_block(e){let t,n,r,i,o,a,c,s,u,l,h,f,m,d,p,g,y,x,v,b,_,w,$,k,M,T,A,j,L,S;function C(e,t){return e[2]?create_if_block_4:create_else_block}let E=C(e),P=E(e),q=e[6]&&create_if_block_2(e),V=e[5]&&create_if_block_1(),N=e[22],R=[];for(let t=0;t<N.length;t+=1)R[t]=create_each_block(get_each_context(e,N,t));return{c(){t=element("div"),n=element("div"),r=element("div"),P.c(),i=space(),o=element("div"),o.innerHTML="<slot></slot>",a=space(),c=element("div"),s=element("div"),s.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',u=space(),l=element("div"),l.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',h=space(),f=element("div"),f.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',m=space(),d=element("div"),d.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',p=space(),g=element("div"),g.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',y=space(),x=element("div"),x.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',v=space(),b=element("div"),b.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',_=space(),w=element("div"),w.innerHTML='<slot name="handle"><div class="circle circle-large"><div class="circle circle-small"></div></div></slot>',$=space(),q&&q.c(),M=space(),T=element("div"),A=space(),V&&V.c(),j=space();for(let e=0;e<R.length;e+=1)R[e].c();attr(r,"class","contents"),set_style(r,"opacity",e[3]/100),set_style(o,"width","80px"),set_style(o,"height","50px"),set_style(o,"position","sticky"),set_style(o,"z-index","5"),set_style(o,"bottom","0px"),set_style(o,"left","0px"),set_style(o,"align-self","flex-end"),attr(s,"class","handle corner top right"),attr(l,"class","handle corner right-middle"),attr(f,"class","handle corner left-middle"),attr(d,"class","handle corner top-middle"),attr(g,"class","handle corner bottom-middle"),attr(x,"class","handle corner bottom right"),attr(b,"class","handle corner bottom left"),attr(w,"class","handle corner top left"),attr(c,"class","frame"),attr(n,"class","free-transform"),attr(n,"style",k=e[20]?e[1].style:null),toggle_class(n,"noclicks",!e[8]),attr(T,"class","fullwidthheight"),set_style(T,"display","none"),attr(t,"class","faded transform-area")},m(k,C){insert(k,t,C),append(t,n),append(n,r),P.m(r,null),append(n,i),append(n,o),append(n,a),append(n,c),append(c,s),e[48](s),append(c,u),append(c,l),e[49](l),append(c,h),append(c,f),e[50](f),append(c,m),append(c,d),e[51](d),append(c,p),append(c,g),e[52](g),append(c,y),append(c,x),e[53](x),append(c,v),append(c,b),e[54](b),append(c,_),append(c,w),e[55](w),append(c,$),q&&q.m(c,null),e[57](n),append(t,M),append(t,T),append(t,A),V&&V.m(t,null),append(t,j);for(let e=0;e<R.length;e+=1)R[e]&&R[e].m(t,null);e[58](t),L||(S=[listen(n,"pointerdown",e[25]),listen(t,"pointerup",pointerUpInside),listen(t,"click",e[28])],L=!0)},p(e,i){if(E===(E=C(e))&&P?P.p(e,i):(P.d(1),P=E(e),P&&(P.c(),P.m(r,null))),8&i[0]&&set_style(r,"opacity",e[3]/100),e[6]?q?q.p(e,i):(q=create_if_block_2(e),q.c(),q.m(c,null)):q&&(q.d(1),q=null),1048578&i[0]&&k!==(k=e[20]?e[1].style:null)&&attr(n,"style",k),256&i[0]&&toggle_class(n,"noclicks",!e[8]),e[5]?V||(V=create_if_block_1(),V.c(),V.m(t,j)):V&&(V.d(1),V=null),4194304&i[0]){let n;for(N=e[22],n=0;n<N.length;n+=1){const r=get_each_context(e,N,n);R[n]?R[n].p(r,i):(R[n]=create_each_block(r),R[n].c(),R[n].m(t,null))}for(;n<R.length;n+=1)R[n].d(1);R.length=N.length}},d(n){n&&detach(t),P.d(),e[48](null),e[49](null),e[50](null),e[51](null),e[52](null),e[53](null),e[54](null),e[55](null),q&&q.d(),e[57](null),V&&V.d(),destroy_each(R,n),e[58](null),L=!1,run_all(S)}}}function create_else_block(e){let t,n;return{c(){t=element("img"),set_style(t,"width","100%"),set_style(t,"height","100%"),src_url_equal(t.src,n=e[4]||e[0].url)||attr(t,"src",n)},m(n,r){insert(n,t,r),e[47](t)},p(e,r){17&r[0]&&!src_url_equal(t.src,n=e[4]||e[0].url)&&attr(t,"src",n)},d(n){n&&detach(t),e[47](null)}}}function create_if_block_4(e){let t,n;return{c(){t=new HtmlTag(!1),n=empty(),t.a=n},m(r,i){t.m(e[2],r,i),insert(r,n,i)},p(e,n){4&n[0]&&t.p(e[2])},d(e){e&&detach(n),e&&t.d()}}}function create_if_block_2(e){let t,n,r,i=e[7]&&create_if_block_3();return{c(){t=element("div"),n=element("slot"),n.innerHTML='<div class="circle circle-large"><div class="circle circle-small"></div></div>',r=space(),i&&i.c(),attr(n,"name","rotator"),attr(t,"class","handle rotator")},m(o,a){insert(o,t,a),append(t,n),append(t,r),i&&i.m(t,null),e[56](t)},p(e,n){e[7]?i||(i=create_if_block_3(),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},d(n){n&&detach(t),i&&i.d(),e[56](null)}}}function create_if_block_3(e){let t;return{c(){t=element("div"),attr(t,"class","rotator-bar")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_if_block_1(e){let t;return{c(){t=element("div"),set_style(t,"position","absolute"),set_style(t,"top","100px"),set_style(t,"left","100px"),set_style(t,"width","400px"),set_style(t,"height","400px"),set_style(t,"border","1px solid grey"),set_style(t,"transform","rotate(-45deg)"),set_style(t,"transform-origin","center center")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_each_block(e){let t;return{c(){t=element("div"),attr(t,"class","line"),set_style(t,"--x-line",e[97].x_line+"px"),set_style(t,"--y-line",e[97].y_line+"px"),set_style(t,"--line-length",e[97].lineLength+"px"),set_style(t,"--theta-line",e[97].theta_line+"rad")},m(e,n){insert(e,t,n)},p(e,n){4194304&n[0]&&set_style(t,"--x-line",e[97].x_line+"px"),4194304&n[0]&&set_style(t,"--y-line",e[97].y_line+"px"),4194304&n[0]&&set_style(t,"--line-length",e[97].lineLength+"px"),4194304&n[0]&&set_style(t,"--theta-line",e[97].theta_line+"rad")},d(e){e&&detach(t)}}}function create_fragment(e){let t,n,r,i=(e[4]||e[0].url)&&create_if_block(e);return{c(){i&&i.c(),t=empty(),this.c=noop},m(o,a){i&&i.m(o,a),insert(o,t,a),n||(r=[listen(window_1,"pointermove",e[26]),listen(window_1,"pointerup",e[27]),listen(window_1,"keyup",e[23]),listen(window_1,"keydown",e[24])],n=!0)},p(e,n){e[4]||e[0].url?i?i.p(e,n):(i=create_if_block(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:noop,o:noop,d(e){i&&i.d(e),e&&detach(t),n=!1,run_all(r)}}}const magneticTolerance=10;function isResizing(e){return e&&e.target&&"handle"===e.target.type}function getFullBounds(e){const t=e.getBoundingClientRect();return t.x=t.left,t.y=t.top,t.center={x:(t.left+t.right)/2,y:(t.top+t.bottom)/2},t}function pointerUpInside(){}function instance(e,t,n){let r;component_subscribe(e,toollayer,(e=>n(46,r=e)));let i={x:null,y:null,width:null,height:null,rotation:null},{transformationhistory:o=[]}=t,{opacity:a=100}=t;globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&(a=globalThis.gyre.paletteValues.selectedLayer.opacity);let c,s,u,{layers:l=[]}=t,{demo:h=!1}=t,{layerimagedata:f={}}=t,{internalposition:m=i}=t,{position:d}=t,{target:p=null}=t,{container:g=null}=t,{rotatorEnabled:y=!0}=t,{rotatorBar:x=!1}=t,{handleMode:v="resize"}=t,{lockAspect:b=!0}=t,{lockTouchResize:_=!1}=t,{captureClicks:w=!0}=t,{zoom:$=100}=t,{ratio:k=window.devicePixelRatio}=t,{imageurl:M}=t,{imagesvg:T}=t,{svgcolor:A}=t,{type:j}=t,{initialposition:L}=t,S=!1,C=get_current_component();const E={};let P,q,V,N,R,F,I,B,z,D,O,H,U=0,X=!1;const Y=createEventDispatcher(),Q=(e,t)=>{t=ae({...m}),set_store_value(toollayer,r=ae({...m}),r),t.endDrag=!!S,function(e,t){if("boundsChanged"!==e&&"positionChanged"!==e)return;if(t.endDrag||c){let e;c&&K&&K.type&&(e=K.type,K.type=""),"width"!=c&&"height"!=c&&"handle"!=K?.type||o.push(ae({...t,type:"scale"})),"rotation"!=c&&"rotate"!=K?.type||o.push(ae({...t,type:"rotation"})),"y"!=c&&"body"!=K?.type&&"x"!=c||o.push(ae({...t,type:"move"})),c=!1,set_store_value(toollayer,r.changecoordsindialog=!1,r),e&&(K.type=e,e=null)}}(e,{endDrag:!!S,...m}),S&&(S=!S),Y(e="transformchange",t),C.dispatchEvent&&C.dispatchEvent(new CustomEvent(e,{detail:t}))};function Z(){globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&n(3,a=globalThis.gyre.paletteValues.selectedLayer.opacity),globalThis.gyre&&n(32,$=globalThis.gyre?.canvas.zoom),ne(),n(1,m=function(e){let t={...e};return t.x=se(e.x),t.y=se(e.y),t.width=se(e.width),t.height=se(e.height),t}({...r})),r.changecoordsindialog&&(c=r.changecoordsindialog)}let J,G,W,K,ee=!1,te=[];function ne(){if(globalThis.gyre&&globalThis.gyre.paletteValues.selectedLayer&&!L){let e=globalThis.gyre.paletteValues.selectedLayer;n(34,L={x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation})}L||null===m.x||n(34,L=ae({...m}))}function re(e,t,n,r){let i=(new magneticLines).calcMagneticLine(e,t,n,r);te.push(i)}function ie(e,t,n){let r={...t};return e.forEach((e=>{e!==m&&(Math.abs(t.x-e.x)<n?(re("left","side","vertical",e.originalData),r.x=e.x):Math.abs(t.x+t.width-(e.x+e.width))<n?(re("right","side","vertical",e.originalData),r.x=e.x+e.width-t.width):Math.abs(t.x+t.width/2-(e.x+e.width/2))<n?(re("","center","vertical",e.originalData),r.x=e.x+e.width/2-t.width/2):Math.abs(t.x-(e.x+e.width))<n?(r.x=e.x+e.width,re("right","side","vertical",e.originalData)):Math.abs(t.x+t.width-e.x)<n&&(r.x=e.x-t.width,re("left","side","",e.originalData)),Math.abs(t.y-e.y)<n?(r.y=e.y,re("top","side","",e.originalData)):Math.abs(t.y+t.height-(e.y+e.height))<n?(r.y=e.y+e.height-t.height,re("bottom","side","",e.originalData)):Math.abs(t.y+t.height/2-(e.y+e.height/2))<n?(r.y=e.y+e.height/2-t.height/2,re("","center","horizontal",e.originalData)):Math.abs(t.y-(e.y+e.height))<n?(r.y=e.y+e.height,re("bottom","side","",e.originalData)):Math.abs(t.y+t.height-e.y)<n&&(r.y=e.y-t.height,re("top","side","",e.originalData)))})),r}function oe(){O||(O=!0,n(10,G.onload=()=>{n(1,m={x:G.x,y:G.y,width:G.naturalWidth,height:G.naturalHeight,rotation:0}),ce(),async function(){await tick(),P&&(P.getBoundingClientRect(),Q("boundsChanged",m),W.classList.contains("fade-in-div")||(W.classList.remove("faded"),W.classList.add("fade-in-div")))}()},G),p||n(29,p=P),g||n(30,g=p.parentNode))}function ae(e){let t={...e};return t.x=se(e.x,"rev"),t.y=se(e.y,"rev"),t.width=se(e.width,"rev"),t.height=se(e.height,"rev"),t}function ce(){(f?._x||0==f?._x)&&n(1,m.x=f._x,m),(f?._y||0==f?._y)&&n(1,m.y=f._y,m),f?._width&&n(1,m.width=f._width,m),f?._height&&n(1,m.height=f._height,m),(f?.x||0==f?.x)&&n(1,m.x=se(f.x),m),(f?.y||0==f?.y)&&n(1,m.y=se(f.y),m),f?.width&&n(1,m.width=se(f.width),m),f?.height&&n(1,m.height=se(f.height),m),f?.rotation&&n(1,m.rotation=f.rotation,m),f?.rotation&&n(1,m.r=f.rotation,m),(f?._x||0==f?._x)&&f._imgwidth&&(n(1,m.x=se(f._imgx),m),n(1,m.y=se(f._imgy),m),n(1,m.width=se(f._imgwidth),m),n(1,m.height=se(f._imgheight),m),delete f._imgx,delete f._imgy,delete f._imgwidth,delete f._imgheight)}function se(e,t){let n,r=parseFloat($)/100/k;return n=t?e/r:e*r,n}onMount((()=>{ne(),n(44,H=!0),G&&oe()}));const ue={x:"left",y:"top",width:"width",height:"height"};function le(e){return"position: absolute; "+["x","y","width","height"].map((t=>null!=e[t]?`${ue[t]}: ${e[t]}px; `:"")).join(" ")+`; transform: rotate(${e.rotation}rad)`}function he(e){n(1,m.y=i.y+(e.end.y-e.start.y),m),n(1,m.x=i.x+(e.end.x-e.start.x),m);let t={x:i.x+(e.end.x-e.start.x),y:i.y+(e.end.y-e.start.y),width:m.width,height:m.height};n(22,te=[]);const r=function(e,t,n){let r={...t},i=[],o=[];if(e.forEach((e=>{if(e!==m&&(e.rotation!==m.rotation||0===e.rotation)){let t=JSON.parse(JSON.stringify(e));t.rotation=0,t.originalData=JSON.parse(JSON.stringify(t)),i.push(t)}})),r=ie(i,t,n),e.forEach((e=>{if(e!==m&&e.rotation===m.rotation&&0!==e.rotation){let t=JSON.parse(JSON.stringify(e));t.originalData=JSON.parse(JSON.stringify(e)),o.push(t)}})),o.length>0){let e=o[0].rotation;o.push(JSON.parse(JSON.stringify(t)));let i=new magneticLines;i.rotateBoxesToZero(o,e);let a=o.pop(),c=ie(o,a,n);te.length&&(r=i.rotatePositionBackToOriginal(c,e))}return r}(l,t,magneticTolerance);n(1,m.x=r.x,m),n(1,m.y=r.y,m)}function fe(e,t){const r=function(e,t){const n=i.rotation,r=u.center,o=vector.sub(r,{x:i.width/2,y:i.height/2}),a=vector.rotate(e.end,-n,t),c=a.x-t.x,s=a.y-t.y,l=vector.add(o,{x:Math.abs(c/2),y:Math.abs(s/2)}),h=vector.add(l,{x:-c/2,y:-s/2}),f=vector.rotate(h,n,l);return{width:c,height:s,translate:vector.sub(t,f)}}(e,t,u.center);"handleT"!=e.target.name&&"handleB"!=e.target.name&&(n(1,m.x=i.x+r.translate.x,m),n(1,m.width=Math.abs(r.width),m)),"handleL"!=e.target.name&&"handleR"!=e.target.name&&(n(1,m.y=i.y+r.translate.y,m),n(1,m.height=Math.abs(r.height),m))}function me(e,t,r,o){const a=function(e,t,n,r,i){const o=t.start?t.start:t,a=t.end?t.end:t,c=vector.sub(o,e.start),s=vector.sub(a,e.end),u=vector.length(s)/vector.length(c),l=r?0:vector.direction(c)-vector.direction(s),h=vector.add(vector.rotate(vector.scale(vector.sub(n,o),u),l,{x:0,y:0}),a);return{scale:i?1:u,rotate:l,translate:vector.sub(h,n),center:h}}(e,t,u.center,r,o);n(1,m.width=i.width*a.scale,m),n(1,m.height=i.height*a.scale,m);const c=vector.sub(u.center,i),l=vector.add(vector.add(c,a.translate),{x:-m.width/2,y:-m.height/2});n(1,m.x=i.x+l.x-s.left,m),n(1,m.y=i.y+l.y-s.top,m),n(1,m.rotation=i.rotation+a.rotate,m)}async function de(){await tick(),P&&P.getBoundingClientRect(),Q("positionChanged",m)}return e.$$set=e=>{"transformationhistory"in e&&n(35,o=e.transformationhistory),"opacity"in e&&n(3,a=e.opacity),"layers"in e&&n(36,l=e.layers),"demo"in e&&n(5,h=e.demo),"layerimagedata"in e&&n(0,f=e.layerimagedata),"internalposition"in e&&n(1,m=e.internalposition),"position"in e&&n(33,d=e.position),"target"in e&&n(29,p=e.target),"container"in e&&n(30,g=e.container),"rotatorEnabled"in e&&n(6,y=e.rotatorEnabled),"rotatorBar"in e&&n(7,x=e.rotatorBar),"handleMode"in e&&n(37,v=e.handleMode),"lockAspect"in e&&n(31,b=e.lockAspect),"lockTouchResize"in e&&n(38,_=e.lockTouchResize),"captureClicks"in e&&n(8,w=e.captureClicks),"zoom"in e&&n(32,$=e.zoom),"ratio"in e&&n(39,k=e.ratio),"imageurl"in e&&n(4,M=e.imageurl),"imagesvg"in e&&n(2,T=e.imagesvg),"svgcolor"in e&&n(40,A=e.svgcolor),"type"in e&&n(41,j=e.type),"initialposition"in e&&n(34,L=e.initialposition)},e.$$.update=()=>{32768&e.$$.dirty[1]&&r&&Z(),4&e.$$.dirty[0]|512&e.$$.dirty[1]&&T&&A&&(n(2,T=T.replace("<svg ",`<svg style="fill:${A}" `)),n(0,f.url=n(4,M="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(T)))),f)),4&e.$$.dirty[0]|1&e.$$.dirty[1]&&T&&b&&(n(2,T=T.replace('preserveAspectRatio="none"'," ")),n(2,T=T.replace('class="fullwidthheight"'," ")),n(0,f.url=n(4,M="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(T)))),f)),4&e.$$.dirty[0]|1&e.$$.dirty[1]&&T&&!b&&(n(2,T=T.replace("<svg ",'<svg preserveAspectRatio="none" class="fullwidthheight" ')),n(0,f.url=n(4,M="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(T)))),f)),1610614273&e.$$.dirty[0]|8192&e.$$.dirty[1]&&H&&G&&P&&f&&f.url&&(p||n(29,p=P),g||n(30,g=p.parentNode),oe()),536871424&e.$$.dirty[0]&&n(20,X=p===P),2&e.$$.dirty[0]&&(n(33,d=ae({...m})),n(1,m.style=le(m),m)),2&e.$$.dirty[0]|16386&e.$$.dirty[1]&&$&&$!=J&&(n(45,J=$),ce(),n(1,m.style=le(m),m))},[f,m,T,a,M,h,y,x,w,P,G,q,V,N,R,F,I,B,z,D,X,W,te,function(e){16===e.keyCode&&n(31,b=!0)},function(e){16===e.keyCode&&n(31,b=!1)},function(e){K=function(e){return q.contains(e.target)?{name:"handleTR",type:"handle",top:!0,right:!0}:V.contains(e.target)?{name:"handleTL",type:"handle",top:!0,left:!0}:N.contains(e.target)?{name:"handleBR",type:"handle",bottom:!0,right:!0}:R.contains(e.target)?{name:"handleBL",type:"handle",bottom:!0,left:!0}:F.contains(e.target)?{name:"handleL",type:"handle",left:!0}:I.contains(e.target)?{name:"handleR",type:"handle",right:!0}:B.contains(e.target)?{name:"handleT",type:"handle",top:!0}:z.contains(e.target)?{name:"handleB",type:"handle",bottom:!0}:D&&D.contains(e.target)?{type:"rotate"}:{type:"body"}}(e),function(e){return!!(F.contains(e.target)||I.contains(e.target)||B.contains(e.target)||z.contains(e.target))}(e)&&n(31,b=!1);let t=E[e.pointerId];if(t?(t.end.x=e.pageX,t.end.y=e.pageY,t.target=K):(U++,t={id:e.pointerId,priority:U-1,start:{x:e.pageX,y:e.pageY},end:{x:e.pageX,y:e.pageY},target:K},E[e.pointerId]=t),ee=!1,t.priority<2)if(u=getFullBounds(p),s=getFullBounds(g),U>1&&Object.values(E).forEach((e=>{e.id!==e&&(e.start.x=e.end.x),e.start.y=e.end.y})),i.x=m.x,i.y=m.y,i.width=m.width,i.height=m.height,i.rotation=m.rotation,"handle"===K.type){let e;e="handleL"==K.name?I:"handleR"==K.name?F:"handleT"==K.name?z:"handleB"==K.name?B:K.top?K.right?R:N:K.right?V:q;const t=e.getBoundingClientRect(),n={x:(t.left+t.right)/2,y:(t.top+t.bottom)/2};E.anchor=n}else delete E.anchor;de()},function(e){S=!1;let t=E[e.pointerId];if(t&&t.priority<2){if(ee=!0,t.end.x=e.pageX,t.end.y=e.pageY,function(e){return e&&e.target&&"body"===e.target.type&&1===U}(t))he(t);else if(function(e){return e&&e.target&&("rotate"===e.target.type||"handle"===e.target.type&&"rotate"===v)}(t))me(t,u.center,!1,!0);else if(isResizing(t)&&!b)fe(t,E.anchor);else if(isResizing(t)&&b)me(t,E.anchor,!0);else if(function(e){return e&&e.target&&"handle"!==e.target.type&&U>1}(t)){let e,n=U>1;e=n?Object.values(E).find((e=>e.id!==t.id)):E.anchor?E.anchor:u.center,me(t,e,!1,n&&_)}de()}},function(e){ee&&(S=!0,n(31,b=!0),ee=!1,Q("positionChanged",m));let t=1/0;E[e.pointerId]&&(U--,t=E[e.pointerId].priority),delete E[e.pointerId],U&&(i.y=m.y,i.x=m.x,i.width=m.width,i.height=m.height,i.rotation=m.rotation,Object.values(E).forEach((e=>{e.id&&(e.priority>t&&e.priority--,e.start.x=e.end.x,e.start.y=e.end.y)})))},function(e){ee||Q("click",e.detail)},p,g,b,$,d,L,o,l,v,_,k,A,j,Z,function(){n(1,m.style=le(m),m),Q("positionChanged",m)},H,J,r,function(e){binding_callbacks[e?"unshift":"push"]((()=>{G=e,n(10,G)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{q=e,n(11,q)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{F=e,n(15,F)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{I=e,n(16,I)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{B=e,n(17,B)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{z=e,n(18,z)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{N=e,n(13,N)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{R=e,n(14,R)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{V=e,n(12,V)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{D=e,n(19,D)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{P=e,n(9,P)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{W=e,n(21,W)}))}]}class App extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent=':root{--frameBorder:solid 1px cyan}*{box-sizing:border-box}.free-transform{position:absolute;top:0;left:0;right:0;bottom:0;transform-origin:center;touch-action:none;display:flex}.free-transform.noclicks{pointer-events:none}.contents{position:absolute;top:0;left:0;right:0;bottom:0}.contents:before{content:"";position:absolute;top:0px;left:0px;width:100%;height:100%;border:var(--frameBorder, 2px solid #3965c7);box-sizing:border-box}.free-transform.noclicks .contents{pointer-events:none}.frame{position:absolute;top:0;left:0;right:0;bottom:0;cursor:move}.free-transform.noclicks .frame{pointer-events:none}.handle{position:absolute;user-select:none;touch-action:none;cursor:grab;pointer-events:auto}.handle:active{cursor:grabbing}.circle{width:16px;height:16px;border-radius:50%}.circle-large{width:16px;height:16px;background-color:transparent;border:2px solid black;display:flex;justify-content:center;align-items:center}.circle-small{width:12px;height:12px;background-color:var(--circle-color, white);border:2px solid white}.handle.top{top:0px}.handle.right{right:0px}.handle.bottom{bottom:0px}.handle.left{left:0px}.handle.top.left{transform:translate(-50%, -50%) rotate(-45deg)}.handle.top.right{transform:translate(50%, -50%) rotate(45deg)}.handle.right-middle{transform:translate(-50%, -50%);top:50%}.handle.left-middle{transform:translate(50%, -50%);top:50%;right:0px}.handle.top-middle{transform:translate(-50%, -50%);top:0;left:50%}.handle.bottom-middle{transform:translate(-50%, 50%);bottom:0;left:50%}.handle.bottom.left{transform:translate(-50%, 50%) rotate(-135deg)}.handle.bottom.right{transform:translate(50%, 50%) rotate(135deg)}.handle.rotator{left:50%;top:-30px;transform:translateX(-50%)}.rotator-bar{position:absolute;top:100%;right:50%;width:1px;height:calc(30px - 100%);border-right:var(--frameBorder)}.fullwidthheight{width:100%;height:100%}.transform-area{position:relative;width:100%;height:100%;flex-grow:1}.faded{opacity:0.01}@keyframes fadeIn{to{opacity:1}}.line{position:absolute;width:var(--line-length);height:1px;left:var(--x-line);top:var(--y-line);transform:translate(-50%, -50%) rotate(var(--theta-line));transform-origin:center center;background-color:red}',this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance,create_fragment,safe_not_equal,{transformationhistory:35,opacity:3,layers:36,demo:5,layerimagedata:0,internalposition:1,position:33,target:29,container:30,rotatorEnabled:6,rotatorBar:7,handleMode:37,lockAspect:31,lockTouchResize:38,captureClicks:8,zoom:32,ratio:39,imageurl:4,imagesvg:2,svgcolor:40,type:41,initialposition:34,refresh:42,changePosition:43},null,[-1,-1,-1,-1]),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["transformationhistory","opacity","layers","demo","layerimagedata","internalposition","position","target","container","rotatorEnabled","rotatorBar","handleMode","lockAspect","lockTouchResize","captureClicks","zoom","ratio","imageurl","imagesvg","svgcolor","type","initialposition","refresh","changePosition"]}get transformationhistory(){return this.$$.ctx[35]}set transformationhistory(e){this.$$set({transformationhistory:e}),flush()}get opacity(){return this.$$.ctx[3]}set opacity(e){this.$$set({opacity:e}),flush()}get layers(){return this.$$.ctx[36]}set layers(e){this.$$set({layers:e}),flush()}get demo(){return this.$$.ctx[5]}set demo(e){this.$$set({demo:e}),flush()}get layerimagedata(){return this.$$.ctx[0]}set layerimagedata(e){this.$$set({layerimagedata:e}),flush()}get internalposition(){return this.$$.ctx[1]}set internalposition(e){this.$$set({internalposition:e}),flush()}get position(){return this.$$.ctx[33]}set position(e){this.$$set({position:e}),flush()}get target(){return this.$$.ctx[29]}set target(e){this.$$set({target:e}),flush()}get container(){return this.$$.ctx[30]}set container(e){this.$$set({container:e}),flush()}get rotatorEnabled(){return this.$$.ctx[6]}set rotatorEnabled(e){this.$$set({rotatorEnabled:e}),flush()}get rotatorBar(){return this.$$.ctx[7]}set rotatorBar(e){this.$$set({rotatorBar:e}),flush()}get handleMode(){return this.$$.ctx[37]}set handleMode(e){this.$$set({handleMode:e}),flush()}get lockAspect(){return this.$$.ctx[31]}set lockAspect(e){this.$$set({lockAspect:e}),flush()}get lockTouchResize(){return this.$$.ctx[38]}set lockTouchResize(e){this.$$set({lockTouchResize:e}),flush()}get captureClicks(){return this.$$.ctx[8]}set captureClicks(e){this.$$set({captureClicks:e}),flush()}get zoom(){return this.$$.ctx[32]}set zoom(e){this.$$set({zoom:e}),flush()}get ratio(){return this.$$.ctx[39]}set ratio(e){this.$$set({ratio:e}),flush()}get imageurl(){return this.$$.ctx[4]}set imageurl(e){this.$$set({imageurl:e}),flush()}get imagesvg(){return this.$$.ctx[2]}set imagesvg(e){this.$$set({imagesvg:e}),flush()}get svgcolor(){return this.$$.ctx[40]}set svgcolor(e){this.$$set({svgcolor:e}),flush()}get type(){return this.$$.ctx[41]}set type(e){this.$$set({type:e}),flush()}get initialposition(){return this.$$.ctx[34]}set initialposition(e){this.$$set({initialposition:e}),flush()}get refresh(){return this.$$.ctx[42]}get changePosition(){return this.$$.ctx[43]}}return customElements.define("fds-image-transform",App),App}();
//# sourceMappingURL=fds-image-transform.js.map
